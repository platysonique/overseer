"use strict";(self.webpackChunkSingular=self.webpackChunkSingular||[]).push([[27],{56027:(i,o,t)=>{t.d(o,{A:()=>r});var e=t(25897),s=t(10611),n={};const r={COMPOSITION_PROPS:["logicLayers","timeline2Active","scripts","durations","snapshot"],importTile:function(i,o){var t=JSON.parse(JSON.stringify(i.tile));t.id=o,t.name=i.tile.name;var r={};i.data&&(r=JSON.parse(JSON.stringify(i.data)));var a={};i.dataLinks&&(a=JSON.parse(JSON.stringify(i.dataLinks)));var d={};i.nodeRefs&&(d=JSON.parse(JSON.stringify(i.nodeRefs)));var p={};if("composition"==i.tile.type&&i.comp){var c=this.importComposition2(i.comp,i.compositions,o,i.tile.id);$.extend(!0,p,c)}var l={},m={};for(var f in this.COMPOSITION_PROPS.forEach(function(i){m[i]={}}),p){var h;for(var v in n)if(n[v]==f){h=v;break}h&&i.compositionStates&&i.compositionStates[h]&&(l[f]=i.compositionStates[h]),this.COMPOSITION_PROPS.forEach(function(o){h&&i.compositionProps&&i.compositionProps[o]&&void 0!==i.compositionProps[o][h]&&(m[o][f]=i.compositionProps[o][h])})}var u=[],g={},y={},S=e.A.getWidgetById(i.tile.widget,i.tile.version);for(var C in S&&S.model&&S.model.fields&&Array.isArray(S.model.fields)&&S.model.fields.forEach(function(o){if("composition"==o.type&&""!=i.data[o.id]){var t=i.data[o.id],e=s.v4();u.push(t),g[o.id]=e,y[t]=e}}.bind(this)),u.forEach(function(o){var t=y[o];if(i.compositions[o]){var e=this.importComposition2(i.compositions[o],i.compositions,t,o);$.extend(!0,p,e)}}.bind(this)),g)r[C]=g[C];return{tile:t,data:r,dataLinks:a,nodeRefs:d,compositions:p,compositionStates:l,compositionProps:m}},importGroup:function(i,o){var t=JSON.parse(JSON.stringify(i.group));t.id=o,t.name=i.group.name;var e={group:t,tiles:[],data:{},dataLinks:{},nodeRefs:{},compositions:{},compositionStates:{},compositionProps:{}},n=t.items;for(var r in t.items={},n){var a=i.tiles.filter(function(i){return i.id==r})[0],d=s.v4(),p={tile:a,data:i.data[r],dataLinks:i.dataLinks[r],nodeRefs:i.nodeRefs[r],comp:i.compositions[r],compositions:i.compositions,compositionStates:i.compositionStates,compositionProps:i.compositionProps},c=this.importTile(p,d,!1);t.items[d]={id:d,priority:n[r].priority},e.tiles=e.tiles.concat(c.tile);var l={};l[d]=c.data,$.extend(!0,e.data,l);var m={};m[d]=c.dataLinks,$.extend(!0,e.dataLinks,m);var f={};f[d]=c.nodeRefs,$.extend(!0,e.nodeRefs,f),$.extend(!0,e.compositions,c.compositions),$.extend(!0,e.compositionStates,c.compositionStates),$.extend(!0,e.compositionProps,c.compositionProps)}return e},pasteTileTo:function(i,o,t,e,s,r){n={};var a=void 0,d=[];for(var p in o.items)d.push(o.items[p]);d.sort(function(i,o){return i.priority-o.priority-.5});for(var c=0;c<d.length;c++)if((m=d[c]).id==s){a=m.priority;for(var l=c;l<d.length;l++){var m,f=(m=d[l]).priority+1;t.child("groups").child(o.id).child("items").child(m.id).update({priority:f}),t.child("tiles").child(m.id).child("layout").child("zindex").set(f)}break}a||(a=0);var h={};$.extend(!0,h,i.tile),h.layout.zindex=a;var v=h.id;e.update(i.compositions),e.parent.child("compositionStates").update(i.compositionStates),e.parent.child("compositionProps").update(i.compositionProps),t.child("tiles").child(v).set(h),t.child("data").child(v).set(i.data),t.child("dataLinks").child(v).set(this.__remapDataLinks(i.dataLinks,t,r)),t.child("nodeRefs").child(v).set(i.nodeRefs),t.child("groups").child(o.id).child("items").child(v).set({id:v,priority:a})},__remapDataLinks:function(i,o,t){var e={};if(i)for(var s in i){var n=i[s];n&&("root"==n.locationId?(o.key==t.key&&(n.locationId="self"),e[s]=n):"self"==n.locationId||(e[s]=n))}return e},pasteGroupTo:function(i,o,t,e,s){n={};var r=void 0,a=void 0,d=Number.MIN_VALUE;o.sort(function(i,o){return i.priority-o.priority-.5});for(var p=0;p<o.length;p++)if(d=Math.max(d,o[p].priority),null==r&&o[p].id==s&&(a=r=o[p].priority),null!=r){r++;var c=t.child("groups").child(o[p].id);c.update({priority:r}),c.child("layout").child("zindex").set(r)}a||(a=d?d+1:0);var l={};$.extend(!0,l,i.group),l.layout.zindex=a,e.update(i.compositions),e.parent.child("compositionStates").update(i.compositionStates),e.parent.child("compositionProps").update(i.compositionProps),i.tiles.forEach(function(i){t.child("tiles").child(i.id).set(i)}),t.child("data").update(i.data),t.child("dataLinks").update(i.dataLinks),t.child("nodeRefs").update(i.nodeRefs),t.child("groups").child(l.id).set(l)},importComposition2:function(i,o,t,e){n[e]=t;var s={},r=[],a=this._importComposition(s,i),d={};d[t]=s,s={};do{a.forEach(function(i){r=r.concat(this._importComposition(s,o[i]));var t=n[i];d[t]=s,s={}}.bind(this)),a=r.slice(),r=[]}while(a.length>0);return this._remapParentComp(d),d},importComposition:function(i,o,t){t||console.error("importComposition: oldId must be vaild"),n[t]=o;var e={},s=[],r=this._importComposition(e,i),a={};a[o]=e,e={},i.tiles||r.push(t);do{r.forEach(function(o){if(i.compositions[o]){s=s.concat(this._importComposition(e,i.compositions[o]));var t=n[o];a[t]=e,e={}}}.bind(this)),r=s.slice(),s=[]}while(r.length>0);return this._remapParentComp(a),a},_remapParentComp:function(i){for(var o in i)if((e=i[o]).settings&&e.settings.linkTimeline&&e.settings.parentTimeline){var t=n[e.settings.parentTimeline];t&&(e.settings.parentTimeline=t)}for(var o in i){var e;if((e=i[o])&&e.dataLinks)for(var s in e.dataLinks){var r=e.dataLinks[s];for(var a in r)(p=r[a])&&("root"==p.locationId||"self"==p.locationId||(l=n[p.locationId])&&(p.locationId=l))}if(e&&e.nodeRefs)for(var s in e.nodeRefs){var d=e.nodeRefs[s];for(var a in d){var p;if((p=d[a])&&p.sourceLocation&&p.sourceLocation.length){var c=p.sourceLocation[0];if("<rootCompId>"==c);else if("<selfCompId>"==c);else{var l;(l=n[c])&&(p.sourceLocation[0]=l)}}}}}},_importComposition:function(i,o){var t={};$.extend(!0,t,o);var r=i,a=[];if(t.tiles)for(var d in t.tiles)"composition"==t.tiles[d].type&&a.push(t.tiles[d].id);var p=function(i){if(r[i]||(r[i]={}),t[i])for(var o in t[i]){var d;n[o]?d=n[o]:(d=s.v4(),n[o]=d);var p=JSON.parse(JSON.stringify(t[i][o]));if("tiles"!=i&&"groups"!=i&&"data"!=i||(p.id=d),"groups"==i){var c={};for(var l in p.items)c[n[l]]={id:n[l],priority:p.items[l].priority};p.items=c}var m,f=[];if("tiles"==i&&t.data){var h=t.tiles[o],v=t.data[o];h&&v&&(m=e.A.getWidgetById(h.widget,h.version))&&m.model&&m.model.fields&&Array.isArray(m.model.fields)&&m.model.fields.forEach(function(i){if("composition"==i.type){var o=n[v[i.id]];o||(o=s.v4(),n[v[i.id]]=o),f.push(v[i.id])}}),a=a.concat(f)}if("data"==i&&t.tiles)h=t.tiles[o],v=t.data[o],h&&v&&(m=e.A.getWidgetById(h.widget,h.version))&&m.model&&m.model.fields&&Array.isArray(m.model.fields)&&m.model.fields.forEach(function(i){if("composition"==i.type){var o=n[v[i.id]];o||(o=s.v4(),n[v[i.id]]=o),p[i.id]=o}});r[i][d]=p}},c=function(i){t[i]&&(r[i]=JSON.parse(JSON.stringify(t[i])))};return p("tiles"),p("data"),p("dataLinks"),p("groups"),p("nodeRefs"),c("selections"),c("settings"),c("dataSources"),a},getCompositionChildren:function(i,o,t,s){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(o[i]){var r=o[i].tiles,a=o[i].data;r&&Object.keys(r).forEach(function(i){var d=r[i];"composition"==d.type&&(t.push(d.id),n||this.getCompositionChildren(d.id,o,t,s));var p=e.A.getWidgetById(d.widget,d.version);p&&p.model&&p.model.fields&&Array.isArray(p.model.fields)&&p.model.fields.forEach(function(e){"composition"==e.type&&""!=a[i][e.id]&&(t.push(a[i][e.id]),n||this.getCompositionChildren(a[i][e.id],o,t,s),s&&(s[a[i][e.id]]=[d.name,p,d.id,e.id]))}.bind(this))}.bind(this))}},getCompositionTree:function(i,o){var t={},e=[];return this.getCompositionChildren(i,o,e,void 0,!0),e.forEach(function(i){t[i]=this.getCompositionTree(i,o)}.bind(this)),t},getParentChildren:function(i,o){var t={},e=[i],s={};do{var n=[];e.forEach(function(i){var e=[];this.getCompositionChildren(i,o,e,s,!0),t[i]=e.slice(),n=n.concat(e.slice())}.bind(this)),e=n.slice()}while(e.length>0);return[t,s]},copyCompositionStatesWithIdMapping:function(i){var o={};if(i)for(var t in i){var e=n[t];e&&(o[e]=i[t])}return o},copyCompositionPropsWithIdMapping:function(i){var o={};return i&&this.COMPOSITION_PROPS.forEach(function(t){for(var e in o[t]={},i[t]){var s=n[e];s&&(o[t][s]=i[t][e])}}),o}}}}]);