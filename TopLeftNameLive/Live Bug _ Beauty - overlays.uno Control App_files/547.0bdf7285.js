(self.webpackChunkSingular=self.webpackChunkSingular||[]).push([[547],{5876:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(56027),i=a(10611),s=function(e){var t=[];for(var a in e)t.push(e[a]);return t},o={},r=function(){if(1!=document.hidden){var e;try{e=localStorage.getItem("singularclipboard")}catch(e){}e&&(o=JSON.parse(e))}};r(),window.addEventListener("focus",r);const l={onCopy:function(){var e=this.props.selection;if(!e||e&&0==e.id)o={};else{if("widget"==e.type||"composition"==e.type){var t=this.props.sbRootRef.child("compositions").val(),a=this.props.sbRootRef.child("compositionStates").val(),n=this.props.sbRootRef.child("compositionProps").val(),i=t[this.props.sbRef.key],r=i.tiles[e.id],l=t[e.id],d=i.data?i.data[e.id]:null,c=i.dataLinks?i.dataLinks[e.id]:null,p=i.nodeRefs?i.nodeRefs[e.id]:null,u={};$.extend(!0,u,r);var m={};$.extend(!0,m,d);var h={};$.extend(!0,h,c);var f={};$.extend(!0,f,p);var g={};$.extend(!0,g,l);var v={};$.extend(!0,v,t);var b={};$.extend(!0,b,a);var y={};$.extend(!0,y,n),(o={}).source={tile:u,data:m,dataLinks:h,nodeRefs:f,comp:g,compositions:v,compositionStates:b,compositionProps:y},o.type=e.type}else if("group"==e.type){var w=this.props.sbRef.child("groups").child(e.id).val(),E=s(this.props.sbRef.child("tiles").val()),I=this.props.sbRef.child("data").val(),N=this.props.sbRef.child("dataLinks").val(),S=this.props.sbRef.child("nodeRefs").val(),C=this.props.sbRootRef.child("compositions").val(),x=this.props.sbRootRef.child("compositionStates").val(),F=this.props.sbRootRef.child("compositionProps").val(),D={};$.extend(!0,D,w);var k=[].concat(E),T={};$.extend(!0,T,I);var R={};$.extend(!0,R,N),$.extend(!0,{},S);var A={};$.extend(!0,A,C);var M={};$.extend(!0,M,x);var O={};$.extend(!0,O,F),(o={}).source={group:D,tiles:k,data:T,dataLinks:R,nodeRefs:S,compositions:A,compositionStates:M,compositionProps:O},o.type=e.type}try{localStorage.setItem("singularclipboard",JSON.stringify(o))}catch(e){}}},onPaste:function(){var e=this.props.selection;if(!e||e&&0==e.id)console.warn("invalid target");else{if(this.props.sbRef.beginBatch(),"widget"==o.type||"composition"==o.type){var t=i.v4(),a=n.A.importTile({tile:o.source.tile,data:o.source.data,dataLinks:o.source.dataLinks,nodeRefs:o.source.nodeRefs,comp:o.source.comp,compositions:o.source.compositions,compositionStates:o.source.compositionStates,compositionProps:o.source.compositionProps},t);if("group"==e.type||"widget"==e.type||"composition"==e.type){var r="group"==e.type?e.id:e.groupId,l=this.props.sbRef.child("groups").child(r).val();n.A.pasteTileTo(a,l,this.props.sbRef,this.props.sbRef.parent,e.id,this.props.sbRootRef);var d={id:t,type:o.type};this.props.onWidgetSelect("",d,{id:r})}else console.warn("invalid target")}else{var c=i.v4(),p=n.A.importGroup({group:o.source.group,tiles:o.source.tiles,data:o.source.data,dataLinks:o.source.dataLinks,nodeRefs:o.source.nodeRefs,compositions:o.source.compositions,compositionStates:o.source.compositionStates,compositionProps:o.source.compositionProps},c),u=s(this.props.sbRef.child("groups").val()),m="group"==e.type?e.id:e.groupId;e.type,n.A.pasteGroupTo(p,u,this.props.sbRef,this.props.sbRef.parent,m),this.props.onGroupSelect({id:c,type:"group"})}this.props.sbRef.endBatch()}},onFetchClipBoardData:function(e,t){var a;if(o&&o.source&&(a="widget"==o.type||"composition"==o.type?o.source.tile:o.source.group))return"widget"==e?"widget"==a.type&&t==a.widget?o.source.data:void 0:e?t?void 0!==a[e]&&void 0!==a[e][t]?a[e][t]:void 0:a[e]:a}}},10036:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});const n={cache:{},register:function(e,t,a){if(!e)return{status:"error",message:"No url provided"};var n=this.cache[e];return n||(n={data:null,lastUpdated:null,listeners:[]},this.cache[e]=n),0===n.listeners.filter(function(e){return e.id===t}).length&&n.listeners.push({id:t,callback:a}),this.get(e,!0)},unregister:function(e,t){this.cache[e]&&(this.cache[e].listeners=this.cache[e].listeners.filter(function(e){return e.id!==t}))},get:function(e,t){var a=this;if(!e)return{status:"error",message:"No url provided"};var n=this.cache[e];if(!n)return{status:"error",message:"No entry for this url"};if(t&&n.lastUpdated&&(new Date).getTime()-n.lastUpdated<1e4)return{status:"ok",data:n.data};if(!n.fetching){n.fetching=!0,n.listeners.forEach(function(e){e.callback({status:"fetching"})});var i=(new Date).getTime();fetch(e).then(function(e){if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.json()}).then(function(t){var s=(new Date).getTime()-i;s<250?setTimeout(function(){n.fetching=!1,a.set(e,t)},250-s):(n.fetching=!1,a.set(e,t))}).catch(function(e){n.fetching=!1,n.listeners.forEach(function(t){t.callback({status:"error",message:e.message})}),n.fetching=!1})}return{status:"fetching"}},set:function(e,t){var a=this.cache[e];a&&(a.data=t,a.lastUpdated=(new Date).getTime(),a.listeners.forEach(function(e){e.callback({status:"ok",data:t})}))}}},18245:(e,t,a)=>{var n=a(25499),i=n({FILE:null,FOLDER:null});i.SORT_BY=n({NAME:null,OWNER:null,LAST_MODIFIED:null}),i.SORT_DIRECTION=n({ASC:null,DESC:null}),e.exports=i},18654:(e,t,a)=>{"use strict";a.d(t,{A:()=>Vt});var n=a(40927),i=a.n(n),s=a(31018),o=a.n(s),r=a(40961),l=a.n(r),d=a(15734),c=a.n(d),p=a(18093),u=a.n(p),m=a(17334),h=a.n(m),f=a(63210),g=a(68204),v=a.n(g),b=a(71906),y=a.n(b),w=a(5556),E=a.n(w),I=a(80765);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function S(e,t,a){return(t=function(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=N(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var C=a(9769),F=a(18245),D=a(17987).Tl,k=a(83384),T=function(e){return!(!e||"folder-tree-item-root"==e.id)&&(!!function(e){var t=e,a=2==t.childElementCount;return a&&(t=t.childNodes[0]),a&&(a=t.childElementCount>2),a&&(t=t.childNodes[2]),a&&(a=t.hasChildNodes()),a&&(t=t.childNodes[0]),a&&(a=!!t.src&&t.src.includes("loading")),a}(e)||T(e.parentElement))},R={hover:function(e,t,a){this.dipDrop=a.props.folder},canDrop:function(e,t){var a=t.getItem().selectedItems,n=a.filter(function(e){return"fo"===e.type}),i=e.folder,s=a[0],o=s.parents?s.parents[0]:s.parent,r=i.fid,l=n.length?new Set(n.map(function(e){return e.fid})):new Set,d=i&&i.fid;if(l.has(d))return!1;var c=document.getElementById("folder-tree-item-"+r);if(T(c))return!1;if(o===r)return!1;var p=function(e,t,a){e.add(a),(t[a]&&t[a].folders?Object.keys(t[a].folders):[]).forEach(function(a){return p(e,t,a)})},u=n.map(function(e){return e.fid}),m=new Set;if(u.forEach(function(t){return p(m,e.tree,t)}),m.has(d))return!1;if(new Set(["inbox","recent","myrecent"]).has(d))return!1;var h={from:new Set(["trash"]),to:new Set(["favorites"])};if(h.from.has(o)&&h.to.has(d))return!1;var f={from:new Set(["inbox"]),to:new Set(["favorites","myrecent","recent","inbox"])};if(f.from.has(o)&&f.to.has(d))return!1;var g=a.filter(function(e){return"ai"===e.type}).length;return!("myshows"==d&&!g)},drop:function(e,t,a){this.dropTo=a.props.folder,t.didDrop()||this.dipDrop&&this.dipDrop.fid===this.dropTo.fid&&e.dropItems({fid:this.dropTo.fid,type:"fo",name:this.dropTo.name})}},A=i().createClass(S(S(S(S(S(S(S(S({displayName:"FolderTreeItem",getInitialState:function(){return{editing:!1}},scrollIntoViewIfNeeded:function(){if(this.props.selectedFolder&&this.props.selectedFolder.fid==this.props.folder.fid&&this.props.folder&&"root"!=this.props.folder.fid){var e=$("#folder-tree-item-"+this.props.folder.fid);e.length&&e[0].scrollIntoViewIfNeeded(!0)}},componentDidMount:function(){var e=this;this.scrollIntoViewIfNeeded(),$(document).mouseup(function(t){var a=l().findDOMNode(e.refs.dropdownMenu),n=$(a);C.getMouseEventType(t)!=k.MOUSE_RIGHT_CLICK&&(n.is(t.target)||0!==n.has(t.target).length||n.removeClass("show"))})},componentWillReceiveProps:function(e){!0===e.expandAll?this.expandAll():!1===e.expandAll&&this.collapseAll()},shouldComponentUpdate:function(e,t){return!C.compareObject(t,this.state)||!C.compareObject(e,this.props)||!!e.tree.action},select:function(e,t){t&&T(t.currentTarget)||((!this.props.selectedFolder||this.props.selectedFolder.fid!==e)&&this.props.gotoFolder(e),this.scrollIntoViewIfNeeded())},onFolderAdd:function(){this.props.onFolderAdd()},onFolderDelete:function(){this.props.onFolderDelete()},addToFavorites:function(){this.props.addToFavorites()},removeFromFavorites:function(){this.props.removeFromFavorites()},rename:function(){var e=prompt("Please enter your name",this.props.folder.name);null!=e&&this.props.renameFolder(e)},onNameChanged:function(e){this.props.renameFolder(e.name),this.setState({editing:!1})},localStorageSetItem:function(e,t){try{localStorage.setItem(e,t)}catch(e){}},toggleExpand:function(e){var t=0;try{t=parseInt(localStorage.getItem(this.props.folder.fid))}catch(e){}0==t||isNaN(t)?this.localStorageSetItem(this.props.folder.fid,"1"):this.localStorageSetItem(this.props.folder.fid,"0"),this.setState({expandAll:void 0}),this.forceUpdate()}},"onFolderAdd",function(){this.props.onFolderAdd()}),"renameFolder",function(){this.setState({editing:!0})}),"onNavigate",function(e,t){this.setState({editing:!1})}),"collapseAll",function(){this.localStorageSetItem(this.props.folder.fid,"0"),this.setState({expandAll:!1})}),"expandAll",function(){this.localStorageSetItem(this.props.folder.fid,"1"),this.setState({expandAll:!0})}),"render",function(){var e=this,t=this.props.folder;if(!t)return null;var a=[];if(!C.isSpecialFolder(t.fid)||"root"==t.fid)for(var n in t.folders){var s=this.props.tree[n];s&&(!1===s.active||C.isSpecialFolder(s.fid)||a.push(n),!1===s.active&&"trash"==s.fid&&a.push(n))}var o,r,l={};if(0==a.length)o="fa fa-fw",r="fa fa-folder-open";else{var d;try{d=localStorage.getItem(t.fid)}catch(e){}"1"==d?(o="fa fa-caret-down",r="fa fa-folder-open"):(l={display:"none"},o="fa fa-caret-right",r="fa fa-folder")}switch(t.fid){case"myshows":r="fa fa-eye";break;case"sharedWithMe":r="fa fa-share-alt";break;case"favorites":r="fa fa-star";break;case"recent":case"myrecent":r="fa fa-clock-o";break;case"trash":r="fa fa-trash";break;case"root":r="fa fa-cloud";break;case"inbox":r="fa fa-inbox"}a.sort(function(t,a){return(e.props.tree[t].name.toLowerCase()>e.props.tree[a].name.toLowerCase())-.5});var c=this.props.connectDropTarget,p="";this.props.selectedFolder&&this.props.selectedFolder.fid==t.fid&&(p=" active"),this.props.isOverCurrent&&this.props.canDrop&&(p+=" drop-over");var u,m=i().createElement("li",{onClick:this.onFolderDelete},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Remove")),h=i().createElement("li",{id:"addFav",onClick:this.addToFavorites},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Add to favorites")),f=i().createElement("li",{id:"removeFav",onClick:this.removeFromFavorites},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Remove from favorites")),g=i().createElement("li",null,i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Share...")),v=i().createElement("li",{onClick:this.onFolderAdd},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"New Folder")),b=i().createElement("li",{onClick:this.renameFolder},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Rename")),y=i().createElement("li",{onClick:this.expandAll},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Expand All")),w=i().createElement("li",{onClick:this.collapseAll},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Collapse All"));g=null,C.isSpecialFolder(t.fid)&&(m=null,h=null,f=null,g=null,b=null),"packages"==t.fid&&(m=null,b=null,v=null),C.isSpecialFolder(t.fid)&&"root"!=t.fid&&(v=null);var E,N,S=this.state.editing,x={display:"inline-block",top:"7px",width:"calc(100% - 40px)",overflow:"hidden",textOverflow:"ellipsis"},F=this.props.loadingItemIds.has(t.fid);u=C.isSpecialFolder(t.fid)?i().createElement("span",{style:x}," ","root"==t.fid?window.singularUser.account.accountName:t.name," "):F?i().createElement("img",{style:{height:"100%"},src:"/images/loading-bubbles-blue.svg"}):i().createElement("span",{style:x},i().createElement(I.A,{key:t.fid,text:t.name,paramName:"name",className:"asset-label",activeClassName:"asset-edit",change:this.onNameChanged,onNavigate:this.onNavigate,editing:S})),(g||v||b||h||f||m)&&(m&&(N=i().createElement("li",{className:"divider",style:{height:"1px"}})),E=i().createElement("div",{className:"btn-group dropdown-grey"},i().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),i().createElement("ul",{id:"context-menu-"+t.fid,ref:"dropdownMenu",className:"dropdown-menu",role:"menu",style:{position:"fixed",minWidth:"100px",width:"auto"},onClick:this.closeContextMenu},g,v,b,h,f,N,y,w,N,m)));var D=i().createElement("li",{onClick:this.props.emptyTrash},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Empty Trash")),k=i().createElement("div",{className:"btn-group dropdown-grey"},i().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),i().createElement("ul",{id:"context-menu-"+t.fid,ref:"dropdownMenu",className:"dropdown-menu",role:"menu",style:{position:"fixed",minWidth:"100px",width:"auto"},onClick:this.closeContextMenu},D)),T="trash"==t.fid;return(F?function(e){return e}:c)(i().createElement("ul",{id:"folder-tree-item-"+t.fid},i().createElement("li",{onContextMenu:this.contextMenu.bind(this,t.fid),className:p},i().createElement("i",{className:o,onMouseDown:this.toggleExpand,style:{width:"14px",top:"2px"}}),i().createElement("i",{className:r,onMouseDown:this.toggleExpand,style:{width:"20px",top:"2px"}}),i().createElement("span",{onClick:this.select.bind(this,t.fid),style:{display:"inline-block",width:"100%",height:"100%"}},u),T?k:E),i().createElement("div",{style:l,className:"grouped-tree-items"},a.map(function(t,a){return i().createElement("div",{key:t},i().createElement(M,{key:t,expandAll:e.state.expandAll,tree:e.props.tree,folder:e.props.tree[t],gotoFolder:e.props.gotoFolder,selectedFolder:e.props.selectedFolder,onFolderAdd:e.props.onFolderAdd,onFolderDelete:e.props.onFolderDelete,addToFavorites:e.props.addToFavorites,removeFromFavorites:e.props.removeFromFavorites,renameFolder:e.props.renameFolder,dropItems:e.props.dropItems,userFolders:e.props.userFolders,loadingItemIds:e.props.loadingItemIds}))}))))}),"contextMenu",function(e,t){if(t&&T(t.currentTarget))return t.stopPropagation(),void t.preventDefault();var a=l().findDOMNode(this.refs.dropdownTrigger),n=l().findDOMNode(this.refs.dropdownMenu);if(a&&n){var i=!!this.props.tree[e].favorite,s=n.querySelector("#addFav"),o=n.querySelector("#removeFav");i?(s&&(s.style.display="none"),o&&(o.style.display="block")):(s&&(s.style.display="block"),o&&(o.style.display="none")),C.dropdownClearAllContextExceptCurrentElement($(n)),C.dropDownFixPosition($(n),t),$(n).toggleClass("show"),this.select(e),t.stopPropagation(),t.preventDefault()}}),"closeContextMenu",function(){var e=l().findDOMNode(this.refs.dropdownMenu);$(e).removeClass("show")})),M=D(F.FILE,R,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop(),itemType:t.getItemType()}})(A);const O=M;function U(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?P(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}a(9769);const B=i().createClass({displayName:"FolderNavigator",getInitialState:function(){return{}},shouldComponentUpdate:function(e,t){return e.trigger!==this.props.trigger||!!this.props.tree.action},componentDidUpdate:function(){this.props.tree.action&&delete this.props.tree.action},render:function(){var e=this;if($.isEmptyObject(this.props.tree))return null;this.props.tree.action||(this.props.tree.action={type:""});var t=function(t){return e.props.tree[t]},a=U(this.props.loadingItemIds).filter(t),n=U(this.props.pendingItemIds).filter(t),s=new Set([].concat(U(a),U(n))),o=this,r=function(e){return!!o.props.tree[e]&&i().createElement(O,{key:e,tree:o.props.tree,folder:o.props.tree[e],gotoFolder:o.props.gotoFolder,selectedFolder:o.props.selectedFolder,onFolderAdd:o.props.onFolderAdd,onFolderDelete:o.props.onFolderDelete,addToFavorites:o.props.addToFavorites,removeFromFavorites:o.props.removeFromFavorites,renameFolder:o.props.renameFolder,dropItems:o.props.dropItems,userFolders:o.props.userFolders,loadingItemIds:s,emptyTrash:o.props.emptyTrash})},l="calc(100% - 155px)";return this.props.browserStyle&&"string"==typeof this.props.browserStyle&&-1!=this.props.browserStyle.indexOf("modal")&&(l="calc(100% - 255px)"),i().createElement("div",{style:{height:"100%"}},i().createElement("div",{className:"navigator-wrapper special",style:{overflow:"hidden",height:"155px"}},i().createElement("ul",{className:"dashboard-tree",style:{margin:"0px"}},r("favorites"),r("myrecent"),r("recent"),r("inbox"),r("trash"))),i().createElement("div",{className:"navigator-wrapper main",style:{overflowX:"hidden",overflowY:"auto",height:l,paddingBottom:"5px"}},i().createElement("ul",{className:"dashboard-tree",style:{margin:"0px"}},r("root"))))}});var V=a(95093),L=a.n(V),j=a(33738);function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}var q=a(17987).I4,G=a(18245),Y=a(9769),J=a(82465),z=i().createClass({displayName:"FileItem",getInitialState:function(){return this.oNodePool=[],this.itemLoading=!1,{editing:!1,isLoading:!1,revisions:[],revisionLoaded:!1,liveStatus:!1}},shouldComponentUpdate:function(e,t){return!Y.compareObject(t,this.state)||!Y.compareObject(e,this.props)},componentWillReceiveProps:function(e){e.editingItem&&this.props.file.fid==e.editingItem.fid&&this.setState({editing:!0,isLoading:!0})},componentDidUpdate:function(e,t){(e.editingItem||this.state.editing)&&this.props.active||this.setState({isLoading:!1}),new Set(this.props.selectedItems.map(function(e){return e.fid})).has(this.props.file.fid)&&this.props.connectDragPreview(this.createItemPreviewImage())},componentDidMount:function(){var e=this;if(this.props.active){var t=$("#item-"+this.props.file.fid);t.length&&t[0].scrollIntoViewIfNeeded(!0)}var a=this.props;a.editingItem&&a.file.fid==a.editingItem.fid&&this.setState({editing:!0,isLoading:!0}),this.onAppStreamStatus(function(t,a){a.type?e.state.liveStatus||e.setState({liveStatus:!0}):e.state.liveStatus&&e.setState({liveStatus:!1})})},componentWillUnmount:function(){this.oNodePool.forEach(function(e){return e.ref.off("value",e.listener)})},createItemPreviewImage:function(){var e=document.createElement("canvas");e.style.height="16px";var t,a,n=e.getContext("2d"),i=(t=this.props.file.name).length>30?t.substr(0,29)+"...":t,s=this.props.selectedItems.length,o=1.5*n.measureText(i).width+50;if(n.rect(0,0,o+10,48),n.save(),n.fillStyle="#5395d2",n.shadowColor="black",n.shadowBlur=10,s>1&&(n.fillStyle="#2a68a2",n.fillRect(12,12,o+2,40),n.fillStyle="#5395d2",n.shadowBlur=0),n.fillRect(10,10,o,38),this.props.file.thumbnail)if((a=this.fiDom.firstElementChild.firstElementChild).currentSrc.indexOf("singularlive")>-1)a.crossOrigin="anonymous",a.src=this.props.file.thumbnail;else{(a=new Image).crossOrigin="anonymous";var r=this.fiDom.firstElementChild.firstElementChild.src;a.src=r.replace("http://","https://")}else{a=new Image(42,38);var l=J.BROWSERITEM_DEFAULT_ICON_MAP[this.props.file.type];l||(l="/images/default-composition-icon.png"),a.src=l}n.drawImage(a,10,10,42,38),s>1&&function(e,t,a){e.save(),e.textBaseline="top",e.fillStyle="red";var n=1.5*e.measureText(t).width;e.font="bold 10pt Courier",e.fillRect(a,2,n+4,14),e.fillStyle="white",e.fillText(t,a+2,2),e.restore()}(n,s,o+2),n.fillStyle="white",n.font="14px Lato",n.fillText(i,55,33);var d=new Image;return d.src=e.toDataURL(),d.height="500px",d},selectItems:function(e,t,a){this.props.selectItems(e,a,t)},onNameChanged:function(e){var t=!!e.isCancel;t?(this.props.renameSelectedItems(e.oldName,t),this.setState({editing:!1,isLoading:!1}),this.props.finishEditing({isCancel:t})):(this.props.renameSelectedItems(e.name,t),this.setState({editing:!1}),this.props.finishEditing({isCancel:t}))},onNavigate:function(e){var t=""===e;this.setState({editing:!1}),this.props.finishEditing({isCancel:t})},cancelEditing:function(){this.setState({editing:!1,isLoading:!1}),this.props.finishEditing({isCancel:!0})},openItemInNewWindow:function(e){"trash"!=this.props.currentFolder&&this.props.openItemInNewWindow(e)},onRevisionDropdown:function(e){this.state.revisionLoaded||c().get("/apiv1/compositions/"+e.refId+"/revisions").set("Content-Type","application/json").end(function(e,t){var a,n=[],i=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return W(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?W(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){r=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(r)throw s}}}}(t.body);try{for(i.s();!(a=i.n()).done;){var s=a.value;s.storageUrl&&n.push(s)}}catch(e){i.e(e)}finally{i.f()}this.setState({revisions:n,revisionLoaded:!0})}.bind(this))},showRevision:function(e){var t=function(e){var t={};$.extend(!0,t,this.props.file),t.revFirebaseUrl=e.firebaseUrl,t.revStorageUrl="/apiv1/compositions/"+this.props.file.refId+"/revisions/"+e.id+"/content",t.revisionId=e.revision_id,this.openItemInNewWindow(t)}.bind(this);return i().createElement("li",{key:e.id},i().createElement("a",{className:"dropdown-item",onClick:t.bind(this,e)},e.description))},onAppStreamStatus:function(e){var t=this;if("ai"===this.props.file.type){var a,n=window.singularUser.account.accountId;!function(e,a){!function(a){e.once("value",function(n){var i=n.val();if(i&&i.outputs){var s=Object.keys(i.outputs)[0],o=e.child("outputs").child(s),r=o.on("value",function(e){var t=e.val();if(t){var n={type:""};t.deviceId&&(n.id=t.deviceId,n.type="w"),a(null,n)}else a("error during get weboutput info")});t.oNodePool.push({ref:o,listener:r})}else a(null,{type:""})})}(function(e,t){e?a(e):("w"==t.type&&function(e,t){t(null,{type:"weboutput",status:"running",deviceId:e.id})}(t,a),""==t.type&&a(null,{}))})}((a=this.props.file.refId,window.singularRtdbCoreRef.child("accounts").child(n).child("appinstances").child(a)),e)}},render:function(){var e,t,a=this,n=this.props.file.type;t=this.props.file.thumbnail?this.props.file.thumbnail:Y.getDefaultIconFromBrowserShortType(n);var s=this.props.file.seActiveUsers,o=this.props.file.activeUsers;if((s||o)&&"list"==this.props.viewStyle){var r=this.props.file,l=o?{marginLeft:"15px"}:{},d=o?i().createElement("span",{className:"u-float-left"},i().createElement("i",{className:"fa fa-lock"})," ",function(e){var t=Object.keys(e.activeUsers)[0];return e.activeUsers[t]}(r)):null,c=s?i().createElement("span",{className:"u-float-right"},i().createElement("i",{className:"fa fa-code",style:l})," ",function(e){var t=Object.keys(e.seActiveUsers)[0];return e.seActiveUsers[t]}(r)):null;e=i().createElement("div",null,c,i().createElement("span",null),d)}var p,u=this.state.editing,m=this.props.connectDragSource,h=!!(this.props.itemLoading||!u&&this.state.isLoading);p=h?this.props.active?i().createElement("img",{style:{height:"40px"},src:"/images/loading-bubbles.svg",className:"loader"}):i().createElement("img",{style:{height:"40px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}):i().createElement(I.A,{key:this.props.file.fid,text:this.props.file.name,paramName:"name",className:"asset-label",activeClassName:"asset-edit",change:this.onNameChanged,onNavigate:this.onNavigate,editing:u,preventDoubleClickEditing:!0,cancelEditing:this.cancelEditing});var f,g="/images/loading-bubbles-blue.svg";this.props.active&&(g="/images/loading-bubbles.svg"),f=t?i().createElement(j.A,{imageUrl:t,initialImage:g,defaultImageUrl:Y.getDefaultIconFromBrowserShortType(n)}):i().createElement("i",{className:"fa "+Y.getIconClassFromBrowserShortType(n)});var v="singular-browser-row";this.props.active&&(v+=" active"),this.props.showRevisionSelection&&(v+=" revision");var b=i().createElement("li",{style:{textAlign:"center"}},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{width:"35px"}})),y=i().createElement("li",{style:{textAlign:"center",padding:"10px"}},"No Revision found"),w="";!0===this.props.favorite&&(w=i().createElement("i",{className:"fa fa-star",style:{color:"#ffc107",position:"relative",left:"15px"}}));var E="";this.state.liveStatus&&(E=i().createElement("i",{className:"fa fa-wifi",style:{color:"#439439",position:"relative",left:"15px"}}));var N=i().createElement("div",{key:this.props.file.fid,id:"item-"+this.props.file.fid,className:v,ref:function(e){return a.fiDom=e},onMouseDown:this.selectItems.bind(this,[this.props.file],!1),onMouseUp:this.selectItems.bind(this,[this.props.file],!0),onContextMenu:this.selectItems.bind(this,[this.props.file],!1),onDoubleClick:u||h?function(){}:this.openItemInNewWindow.bind(this,this.props.file)},i().createElement("div",{className:"row-detail icon"},f),i().createElement("div",{className:"row-detail name"},i().createElement("div",{className:"detail-name"},p," ",w," ",E," ",i().createElement("span",{className:"label label-primary"},e))),i().createElement("div",{className:"row-detail block  modified-detail"},i().createElement("div",{className:"detail-label"},"Last modified"),i().createElement("div",{className:"detail-value"},L()(this.props.file.ts?this.props.file.ts:L()().toString()).fromNow()+(this.props.file.lastModifiedBy?" by "+this.props.file.lastModifiedBy:""))),i().createElement("div",{className:"row-detail block owner-detail"},i().createElement("div",{className:"detail-label"},"Owner"),i().createElement("div",{className:"detail-value"},this.props.file.owner)),i().createElement("div",{className:"row-detail block mobile-open",onClick:u?function(){}:this.openItemInNewWindow.bind(this,this.props.file)},i().createElement("i",{className:"fa fa-caret-right"})),this.props.file.type==J.COMPOSITION&&this.props.showRevisionSelection&&i().createElement("div",{className:"row-detail actions"},i().createElement("div",{className:"dropdown dropdown-white",id:"btnGroupDropNewItem"},i().createElement("button",{onClick:this.onRevisionDropdown.bind(this,this.props.file),type:"button",tabIndex:"-1",className:"btn btn-white create-asset dropdown-toggle",style:{width:"125px",marginBottom:"0px"},"data-toggle":"dropdown"},"Current"),i().createElement("ul",{className:"dropdown-menu"},this.state.revisionLoaded?this.state.revisions.length>0?this.state.revisions.map(this.showRevision):y:b))));return u||h?N:m(N)}});const H=q(G.FILE,{beginDrag:function(e){return{selectedItems:e.selectedItems}}},function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()}})(z);var K=a(17987).I4,Q=a(17987).Tl,X=a(18245),Z=a(9769);a(82465);var ee={canDrop:function(e,t){var a=t.getItem().selectedItems,n=a.length?new Set(a.map(function(e){return e.fid})):new Set,i=e.folder?e.folder.fid:null;return!n.has(i)},drop:function(e,t,a){t.didDrop()||e.dropItems&&e.dropItems({fid:e.folder.fid,type:"fo",name:e.folder.name})}},te=i().createClass({displayName:"FolderItem",getInitialState:function(){return this.loadingItemIds=new Set,this.itemLoading=!1,{editing:!1}},shouldComponentUpdate:function(e,t){var a=!Z.compareObject(t,this.state)||!Z.compareObject(e,this.props),n=!(!e.editingItem||e.folder.fid!=e.editingItem.fid),i=!(!e.editingItem||!e.editingItem.force),s=i||n;return s&&(t.editing=n,t.force=i),a||s},componentWillReceiveProps:function(e){this.loadingItemIds=e.loadingItemIds},componentDidUpdate:function(e,t){new Set(this.props.selectedItems.map(function(e){return e.fid})).has(this.props.folder.fid)&&this.props.connectDragPreview(this.createItemPreviewImage())},componentDidMount:function(){if(this.props.active){var e=$("#item-"+this.props.folder.fid);e.length&&e[0].scrollIntoViewIfNeeded(!0)}var t=this.props;t.editingItem&&t.folder.fid==t.editingItem.fid&&this.setState({editing:!0})},createItemPreviewImage:function(){var e=document.createElement("canvas");e.style.height="16px";var t,a=e.getContext("2d"),n=(t=this.props.folder.name).length>30?t.substr(0,29)+"...":t,i=this.props.selectedItems.length,s=1.5*a.measureText(n).width+50;a.rect(0,0,s+10,48),a.save(),a.fillStyle="#5395d2",a.shadowColor="black",a.shadowBlur=10,i>1&&(a.fillStyle="#2a68a2",a.fillRect(12,12,s+2,40),a.fillStyle="#5395d2",a.shadowBlur=0),a.fillRect(10,10,s,38);var o=new Image(42,38);o.src="/images/default-folder-icon.png",o.crossOrigin="Anonymous",a.drawImage(o,10,10,42,38),i>1&&function(e,t,a){e.save(),e.textBaseline="top",e.fillStyle="red";var n=1.5*e.measureText(t).width;e.font="bold 10pt Courier",e.fillRect(a,2,n+4,14),e.fillStyle="white",e.fillText(t,a+2,2),e.restore()}(a,i,s+2),a.fillStyle="white",a.font="14px Lato",a.fillText(n,55,33);var r=new Image;return r.src=e.toDataURL(),r.height="500px",r},selectItems:function(e,t,a){this.props.selectItems(e,a,t)},onNameChanged:function(e){var t=!!e.isCancel;t?(this.props.renameSelectedItems(e.oldName,t),this.setState({editing:!1}),this.props.finishEditing({isCancel:t})):(this.props.renameSelectedItems(e.name,t),this.setState({editing:!1}),this.props.finishEditing({isCancel:t}))},onNavigate:function(e){var t=""===e;this.setState({editing:!1}),this.props.finishEditing({isCancel:t})},gotoFolder:function(e){"trash"!=this.props.currentFolder&&this.props.gotoFolder(e.fid)},render:function(){var e="";this.props.active&&(e="active"),this.props.isOverCurrent&&(e+=" drop-over");var t="";!0===this.props.favorite&&(t=i().createElement("i",{className:"fa fa-star",style:{color:"#ffc107",marginLeft:"10px"}}));var a,n=this.state.editing,s=!!this.state.force,o=this.props,r=(o.isDragging,o.connectDragSource),l=o.connectDropTarget;this.props.folder.fid,a=this.props.itemLoading?this.props.active?i().createElement("img",{style:{height:"40px"},src:"\\images\\loading-bubbles.svg",className:"loader"}):i().createElement("img",{style:{height:"40px"},src:"\\images\\loading-bubbles-blue.svg",className:"loader"}):i().createElement(I.A,{key:this.props.folder.fid,text:this.props.folder.name,paramName:"name",className:"asset-label",activeClassName:"asset-edit",change:this.onNameChanged,onNavigate:this.onNavigate,editing:n,force:s,preventDoubleClickEditing:!0});var d=i().createElement("div",{key:this.props.folder.fid,id:"item-"+this.props.folder.fid,className:"singular-browser-row folder "+e,onMouseDown:this.selectItems.bind(this,[this.props.folder],!1),onMouseUp:this.selectItems.bind(this,[this.props.folder],!0),onContextMenu:this.selectItems.bind(this,[this.props.folder],!1),onDoubleClick:n||this.props.itemLoading?function(){}:this.gotoFolder.bind(this,this.props.folder)},i().createElement("div",{className:"row-detail icon"},i().createElement("i",{className:"fa "+this.props.icon})),i().createElement("div",{className:"row-detail name"},i().createElement("div",{className:"detail-name"},a,t)),i().createElement("div",{className:"row-detail block mobile-open",onClick:n?function(){}:this.gotoFolder.bind(this,this.props.folder)},i().createElement("i",{className:"fa fa-angle-right"})));return n||this.props.itemLoading?d:r(l(d))}}),ae=Q(X.FILE,ee,function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver(),isOverCurrent:t.isOver({shallow:!0}),canDrop:t.canDrop()}})(te);const ne=K(X.FILE,{beginDrag:function(e){return{selectedItems:e.selectedItems}}},function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()}})(ae);var ie=a(47500),se=a.n(ie);function oe(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return re(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?re(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}var le=a(9769),de=a(82465),ce=a(18245),pe=a(10611),ue=a(83384);const me=i().createClass({displayName:"FolderViewer",getInitialState:function(){return this.trackingFolder=[],this.trackingFile=[],this.requestItemLength=50,this.requestItemIncrement=50,{message:void 0,editingItem:void 0,selectedItems:[],filesLength:0,loadingMore:!1}},shouldComponentUpdate:function(e,t){if(this.props.errorMessage)return!0;var a=!!e.treeReady,n=t.needRedraw!=this.state.needRedraw,i=e.trigger!==this.props.trigger,s=e.busy!==this.props.busy;return a&&(n||i||s)},componentWillUpdate:function(e,t){e.items&&(e.selectedItems.length?t.selectedItems=e.selectedItems:t.selectedItems=t.selectedItems.filter(function(t){return e.items[t.fid]}))},findFirstItem:function(e){var t=this,a=$("div[id^='item-']"),n=[];a.each(function(e,t){return n.push(t.id.replace("item-",""))});var i=n.filter(function(e){return t.props.items[e]}),s=i.length?this.props.items[i[0]]:null;return s?[s]:[]},componentDidUpdate:function(){var e=this,t=$("#folder-items").find(".active").length>0;if(this.props.items&&this.props.currentConfig.autoSelectFirstItem&&!t){var a=this.findFirstItem(this.props.items);a.length>0&&this.setState({selectedItems:a},function(){return e.props.selectItems(a)})}},componentWillUnmount:function(){},componentDidMount:function(){var e=this;"trash"!=this.props.folderId&&"recent"!=this.props.folderId&&"myrecent"!=this.props.folderId&&(this.requestItemLength=500),$(document).mouseup(function(t){var a=l().findDOMNode(e.refs.dropdownMenu),n=$(a);le.getMouseEventType(t)!=ue.MOUSE_RIGHT_CLICK&&(n.is(t.target)||0!==n.has(t.target).length||n.removeClass("show"))})},redraw:function(e,t){(e=e||{}).needRedraw=!this.state.needRedraw,this.setState(e,t)},restoreSelectedItems:function(){this.props.restoreSelectedItems()},addSelectedItemsToFavorites:function(){this.props.addSelectedItemsToFavorites()},removeSelectedItemsFromFavorites:function(){this.props.removeSelectedItemsFromFavorites()},openItemInNewWindow:function(){this.props.openItemInNewWindow()},duplicateItem:function(){this.props.duplicateItem(this.redraw)},onFolderAdd:function(){var e={action:"new",fid:pe.v4(),name:"New Folder",parent:!this.props.folderId||le.isSpecialFolder(this.props.folderId)?"root":this.props.folderId,promptToRename:!0};this.items.cmd=e,this.redraw()},onCompositionAdd:function(){this.props.onCompositionAdd()},onJsonAdd:function(){this.props.onJsonAdd()},newOrRenameItem:function(e,t){var a=this.items,n=this.state.editingItem.fid,i=function(t){return t&&"new"===t.action&&null==t.type?t:{fid:n,action:"ren",name:e}}(a.cmd),s=i.action;t||("new"===s&&(a[i.fid].name=e,i.name=e,this.props.onFolderAdd(i),this.props.loadingItemIds.add(n)),"ren"===s&&(this.props.renameSelectedItems(e,this.state.editingItem),this.props.loadingItemIds.add(n))),this.redraw()},renameItem:function(e){this.state.selectedItems.length&&this.redraw({editingItem:this.state.selectedItems[0]})},finishEditing:function(e){var t=null==e||e.isCancel,a=this.items,n=a.cmd;if(null!=n&&t){var i=n.fid;this.props.loadingItemIds.delete(i),"new"===n.action&&null==n.type&&a.remove(i)}this.redraw({editingItem:void 0})},cancelEditing:function(){this.setState({editingItem:void 0})},showMore:function(e){var t=this,a=[function(e){return t.redraw({loadingMore:!0},e)},function(e){return t.props.loadMoreFolders(e)},function(e){return t.redraw({loadingMore:!1},e)}];se().waterfall(a,function(e,t){})},sortItems:function(e,t){if(!e||!e.length)return e;t=t||this.props.sortBy;var a=function(e,t){var a=null==e||e==ce.SORT_DIRECTION.ASC;return t!=ce.SORT_BY.LAST_MODIFIED&&a}(this.props.sortDirection,t);switch(t){case ce.SORT_BY.NAME:return function(t){return e.sort(function(e,a){return t?(e.name.toLowerCase()>a.name.toLowerCase())-.5:(e.name.toLowerCase()<a.name.toLowerCase())-.5})}(a);case ce.SORT_BY.OWNER:return function(t){return e.sort(function(e,a){return e.owner=e.owner||"",a.owner=a.owner||"",t?(e.owner.toLowerCase()>a.owner.toLowerCase())-.5:(e.owner.toLowerCase()<a.owner.toLowerCase())-.5})}(a);case ce.SORT_BY.LAST_MODIFIED:return function(t){return e.sort(function(e,a){var n=14712156e5,i=e.ts||n,s=a.ts||n;return t?new Date(i)-new Date(s):new Date(s)-new Date(i)})}(a)}},filterItems:function(e,t){return!("ALL"!=this.props.filteredByType&&e.type!=de.FOLDER&&e.type!=this.props.filteredByType||0==le.compareDashboardItemType(e.type,t)||e.type==de.FOLDER&&le.isSpecialFolder(e.fid))},selectAllItems:function(){var e=this;if(this.props.items&&this.props.items.length){var t=this.props.items.map(function(e){return e.fid});this.setState({selectedItems:t},function(){return e.props.selectItems(t)})}},validateItem:function(e){var t=function(e){var a="empty";return null==e||e.className&&"singular-browser-message"==e.className?a:null==/item-[0-9a-f]{8}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{4}\-[0-9a-f]{12}/gi.exec(e.id)?t(e.parentElement):e},a=t(e.target);if("empty"==a)return!0;var n=a.children[1].children[0].children[0];return!("IMG"==n.tagName&&n.src.includes("loading")&&(e.stopPropagation(),e.preventDefault(),1))},selectItems:function(e,t,a){var n=this;if(t&&this.validateItem(t)){var i,s=e.length?e[e.length-1]:e,o=function(e){return"string"==typeof e&&e};i=o(i)||t&&function(e){return function(e){return"which"in e&&3==e.which}(e)||function(e){return"button"in e&&2==e.button}(e)}(t)&&"right",i=o(i)||(t.ctrlKey||t.metaKey)&&"ctrl";var r=(a?"mouseUp":"mouseDown")+((i=o(i)||t.shiftKey&&"shift")?"|"+i:"");!function(e){var t=n.state.selectedItems,a=new Map(n.state.selectedItems.map(function(e){return[e.fid,e]})),i=a.has(s.fid);switch(r){case"mouseDown|ctrl":i&&a.size>1&&a.delete(s.fid),!i&&a.set(s.fid,s),t=oe(a.values());break;case"mouseDown|shift":var o=oe(l().findDOMNode(n).childNodes[0].children).filter(function(e){return e.id}).map(function(e){return e.id}).map(function(e){return e.substr(5)}),d=n.prvSelected||n.state.selectedItems[n.state.selectedItems.length-1];n.prvSelected=d;var c=o.indexOf(d.fid),p=o.indexOf(s.fid);if(c>p){var u=[p,c];c=u[0],p=u[1]}var m=new Set(o.slice(c,p+1));t=n.props.items.filter(function(e){return m.has(e.fid)});break;case"mouseDown|right":case"mouseDown":if(i)break;case"mouseUp":case"mouseDown|ctrl":delete n.prvSelected,t=[s]}n.setState({selectedItems:t},function(){return e(t)})}(this.props.selectItems)}},processCommand:function(){var e=this;this.items=this.props.items||{};var t=function(t){var a=e.items,n=new Set(t),i=new Set(a.keys()),s=new Set(oe(n).filter(function(e){return i.has(e)}));return n.size===s.size},a=function(a){if(t(a)){a.forEach(function(t){return delete e.items[t]});var n=new Set(a);e.state.selectedItems=e.state.selectedItems.filter(function(e){return!n.has(e.fid)}),0===e.state.selectedItems.length&&(e.state.selectedItems=e.findFirstItem(e.props.items))}},n=this.items.cmd;if(n&&!n.parsed)switch(n.action){case"fav":var i=n.ids;t(i)&&i.forEach(function(t){return e.items[t].favorite=!0});break;case"ufv":var s=n.ids;t(s)&&s.forEach(function(t){return delete e.items[t].favorite});break;case"del":a(n.ids);break;case"new":n.fid&&function(t){var a,n=t.fid;(a=t.type?t.newItem:{fid:n,name:t.name,parents:[t.parent],owner:"unknown",type:"fo",force:!0}).owner||(a.owner=e.props.users[a.user_id].firstName),e.items[n]=a,a.parents=[a.parent],e.props.updateItems([a]);var i=e.state;if(!t.dontChangeSelection){i.selectedItems=[a];var s=e.props;s.selectedItems.splice(0,s.selectedItems.length),s.selectedItems.push(a),t.promptToRename&&(i.editingItem=a)}}(n),n.items&&n.items.length>0&&function(t){var a=t.items;e.items.merge(a);var n=a.map(function(e){return e.parents[0]=e.parent,e});e.props.updateItems(n)}(n);break;case"upt":case"ren":case"thb":var o=n.fid;t([o])&&(n.name&&(this.items[o].name=n.name),n.thumbnail&&(this.items[o].thumbnail=n.thumbnail));break;case"res":case"mov":if(n.parentFid==this.props.folderId&&a(n.ids||n.sourceFids),n.targetFid==this.props.folderId){var r=n.items,l=n.targetFid,d=r.map(function(e){return e.parents[0]=l,e});this.props.updateItems(d),this.items.merge(d)}if("favorites"==this.props.folderId){var c=n.items.filter(function(e){return e.favorite});this.items.merge(c)}}return n&&(n.parsed=!0),this.items.length=this.items.keys?this.items.keys().length:0,this.items},render:function(){var e,t,a,n=this,s=function(e,t){var a=new Set(this.state.selectedItems.map(function(e){return e.fid})),n=a.has(e.fid),s=this.props.pendingItemIds,o=this.props.loadingItemIds.has(e.fid),r=s.has(e.refId+e.type)||s.has(e.fid);return e.type!=de.FOLDER||this.props.dblClicktoSelectedFolder?i().createElement(H,{key:e.fid,trigger:this.props.trigger,file:e,favorite:e.favorite,currentFolder:this.props.folderId,selectItems:this.selectItems,gotoFolder:this.props.gotoFolder,active:n,openItemInNewWindow:this.props.openItemInNewWindow,renameSelectedItems:this.newOrRenameItem,editingItem:this.state.editingItem,itemLoading:o||r,finishEditing:this.finishEditing,viewStyle:this.props.viewStyle,showRevisionSelection:this.props.showRevisionSelection,selectedItems:this.state.selectedItems}):i().createElement(ne,{dblClicktoSelectedFolder:this.props.dblClicktoSelectedFolder,key:e.fid,trigger:this.props.trigger,folder:e,favorite:e.favorite,currentFolder:this.props.folderId,selectItems:this.selectItems,gotoFolder:this.props.gotoFolder,active:n,dropItems:this.props.dropItems,renameSelectedItems:this.newOrRenameItem,editingItem:this.state.editingItem,itemLoading:o||r,finishEditing:this.finishEditing,viewStyle:this.props.viewStyle,icon:"fa-folder-o",selectedItems:this.state.selectedItems})}.bind(this),o=this.processCommand();if(!o.ready||this.props.busy)t=this.state.message?i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},i().createElement("h5",null,this.state.message)):i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}));else if(0==o.length){var r="";this.props.errorMessage?r=this.props.errorMessage:(r=this.props.folderId?"There are no items in this folder":"No items found","ALL"===this.props.filteredByType||this.props.isModal||(r+=", but a filter for "+le.getNiceNameFromBrowserShortType(this.props.filteredByType)+" is active.")),t=i().createElement("div",{className:"singular-browser-message"},i().createElement("h5",null,r))}else{var l=this,d=o.filter(function(e){return l.filterItems(e,de.ASSET)}),c=o.filter(function(e){return l.filterItems(e,de.FOLDER)}),p=o.filter(function(e){return l.filterItems(e,de.COMPOSITION)}),u=o.filter(function(e){return l.filterItems(e,de.DATANODE)}),m=o.filter(function(e){return l.filterItems(e,de.APPINSTANCE)}),h=o.filter(function(e){return l.filterItems(e,de.DEVICE)}),f=o.filter(function(e){return l.filterItems(e,de.JSON)}),g=o.filter(function(e){return l.filterItems(e,de.AUDIO)}),v=o.filter(function(e){return l.filterItems(e,de.DATA)}),b=o.filter(function(e){return l.filterItems(e,de.VIDEO)}),y="recent"==this.props.folderId||"myrecent"==this.props.folderId,w=y?(a=[].concat(p,d,m,h,u,f,g,v,b),n.sortItems(a,ce.SORT_BY.LAST_MODIFIED)):(d=n.sortItems(d),c=n.sortItems(c,ce.SORT_BY.NAME),p=n.sortItems(p),u=n.sortItems(u),m=n.sortItems(m),h=n.sortItems(h),f=n.sortItems(f),g=n.sortItems(g),v=n.sortItems(v),b=n.sortItems(b),p.concat(c,d,m,h,u,f,g,v,b)),E=function(e,t,a){if(!y)return e.length>0&&("ALL"==this.props.filteredByType||null==t)||this.props.filteredByType==t?i().createElement("div",{className:"singular-browser-row header sticky"},a):null}.bind(this),I=E(c,null,"Folders"),N=E(p,de.COMPOSITION,"Compositions"),S=E(u,de.DATANODE,"Datanodes"),C=E(m,de.APPINSTANCE,"Apps"),x=E(h,de.DEVICE,"Devices"),F=E(d,de.ASSET,"Assets"),D=E(f,de.JSON,"JSON"),k=E(g,de.AUDIO,"Audio"),T=E(v,de.DATA,"Data"),R=E(b,de.VIDEO,"Video");this.props.showFolderOnly&&(I=null,N=null,F=null,C=null,x=null,S=null,D=null,k=null,T=null,R=null,p=[],d=[],m=[],h=[],u=[],f=[],g=[],v=[],b=[]),e="recent"==this.props.folderId||"myrecent"==this.props.folderId?i().createElement("div",{id:"folder-items",style:{paddingBottom:"10px"}},w.map(s)):i().createElement("div",{id:"folder-items",style:{paddingBottom:"10px"}},I,c.map(s),N,p.map(s),F,d.map(s),C,m.map(s),x,h.map(s),S,u.map(s),D,f.map(s),k,g.map(s),R,b.map(s),T,v.map(s))}var A=i().createElement("li",{onClick:this.restoreSelectedItems},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Restore")),M=i().createElement("li",{onClick:this.props.removeSelectedItems},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Remove")),O=i().createElement("li",{onClick:this.addSelectedItemsToFavorites},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Add to favorites")),U=i().createElement("li",{onClick:this.removeSelectedItemsFromFavorites},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Remove from favorites")),P=i().createElement("li",null,i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Share...")),B=i().createElement("li",{onClick:this.openItemInNewWindow},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Open")),V=i().createElement("li",{onClick:this.duplicateItem},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Duplicate")),L=i().createElement("li",{onClick:this.props.locateItem},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Locate")),j=i().createElement("li",{onClick:this.props.deleteForever},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Delete Forever")),W=i().createElement("li",{onClick:this.onFolderAdd},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},i().createElement("i",{className:"fa fa-folder-o item-icon"})," Folder")),_=i().createElement("li",{onClick:this.onCompositionAdd},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},i().createElement("i",{className:"fa fa-object-group item-icon"})," Composition")),q=i().createElement("li",{onClick:this.onJsonAdd},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},i().createElement("i",{className:"fa fa-file-code-o item-icon"})," JSON")),G=i().createElement("li",{onClick:this.renameItem},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Rename")),Y=i().createElement("li",{onClick:this.props.showSendItem},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Send a copy to user")),$=i().createElement("li",{onClick:this.props.openScriptEditor},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Open Script Editor")),J=i().createElement("li",{onClick:this.props.showExportComposition},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Extract Composition")),z=i().createElement("li",{onClick:this.props.onEditComposition},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Edit Composition")),K=i().createElement("li",{onClick:this.props.showOpenWith},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},i().createElement("i",{className:"fa fa-window-restore item-icon"})," Control App")),Q=i().createElement("li",{onClick:this.props.exportToCSV},i().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Export selection to CSV")),X=this.state.selectedItems;if(P=null,this.props.items&&X.length>=1)if("favorites"===this.props.folderId)O=null;else if("root"!=this.props.folderId&&le.isSpecialFolder(this.props.folderId))O=U=null;else{var Z=function(e){return n.props.items[e]};X.map(function(e){return e.fid}).filter(Z).map(Z).filter(function(e){return e.favorite}).length>0?O=null:U=null}if("trash"!=this.props.folderId?A=null:M=null,X.length>1&&(V=null,B=null,L=null,G=null,J=null,z=null,"favorites"!==this.props.folderId)){var ee=X.length,te=X.filter(function(e){return e.favorite}).length;0==te&&(U=null),te==ee&&(O=null)}"favorites"!=this.props.folderId&&"recent"!=this.props.folderId&&"myrecent"!=this.props.folderId&&null!=this.props.folderId&&(L=null);var ae=de.FOLDER,ie=de.ASSET,se=de.JSON,oe=de.AUDIO,re=de.DATANODE,pe=de.DATA,ue=de.VIDEO,me=function(e,t){return le.compareDashboardItemType(e,t)};X.filter(function(e){return me(e.type,ae)||me(e.type,ie)||me(e.type,se)||me(e.type,oe)||me(e.type,ue)||me(e.type,re)||me(e.type,pe)}).length>0&&(V=null),"recent"!=this.props.folderId&&"myrecent"!=this.props.folderId&&"favorites"!=this.props.folderId||(V=null),X.filter(function(e){return le.compareDashboardItemType(e.type,de.COMPOSITION)||le.compareDashboardItemType(e.type,de.APPINSTANCE)}).length!=X.length&&(Y=null),1===X.length&&X[0].type==de.COMPOSITION||($=null),X.filter(function(e){return le.compareDashboardItemType(e.type,de.APPINSTANCE)}).length!=X.length&&(J=null,z=null),1==X.length&&X[0].type==de.APPINSTANCE&&1!=X[0].composition_managed_by_singular&&(z=null);var he="myshows"!=this.props.folderId;le.isSpecialFolder(this.props.folderId)&&"root"!=this.props.folderId&&(W=null,he&&(_=null,q=null)),"trash"!=this.props.folderId&&(j=null),he||(_=null,q=null);var fe=i().createElement("li",{className:"dropdown dropdown-submenu","data-hover":"dropdown"},i().createElement("a",{className:"submenu-title"},"New ",i().createElement("i",{className:"fa fa-caret-right caret","aria-hidden":"true"})),i().createElement("ul",{ref:"subDropdownMenu",className:"dropdown-menu",role:"menu"},W,_,K,q));le.isSpecialFolder(this.props.folderId)&&"root"!=this.props.folderId&&he&&(fe=null),null==this.props.folderId&&(fe=null,V=null),this.props.isModal&&(_=null,K=null,Y=null,J=null,z=null,$=null),"trash"==this.props.folderId&&(M=null,O=null,U=null,P=null,B=null,V=null,Y=null,G=null,J=null,z=null,$=null);var ge,ve,be={};return 0==X.length?(M=null,O=null,U=null,P=null,B=null,V=null,Y=null,G=null,A=null,J=null,z=null,L=null,this.props.errorMessage&&(be={display:"none"})):X.length>1&&(fe=null),!this.state.message&&o.ready&&o.hasMore&&!this.props.busy&&(ge=this.state.loadingMore?i().createElement("div",{style:{display:"flex",justifyContent:"center",paddingBottom:"10px"}},i().createElement("button",{className:"btn btn-white disabled",style:{padding:"0px 20px 0px 20px",height:"33px"}},i().createElement("img",{style:{height:"30px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}))):i().createElement("div",{style:{display:"flex",justifyContent:"center",paddingBottom:"10px"}},i().createElement("button",{className:"btn btn-white",onClick:function(){return n.showMore()},style:{height:"33px"}},"Load more items"))),(J||z)&&(ve=i().createElement("li",{className:"divider"})),i().createElement("div",{ref:"folderViewerMain",onContextMenu:this.contextMenu,style:{height:"100%"}},e,ge,t,i().createElement("div",{className:"dropdown-grey",ref:"contextMenuWrapper",style:be},i().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),i().createElement("ul",{id:"context-menu-folder-viewer",ref:"dropdownMenu",className:"dropdown-menu",role:"menu",style:{position:"fixed"},onClick:this.closeContextMenu},B,$,fe,G,i().createElement("li",{className:"divider"}),P,O,U,V,j,L,Y,ve,Q,ve,J,z,i().createElement("li",{className:"divider"}),M,A)))},contextMenu:function(e){if(e&&this.validateItem(e)){l().findDOMNode(this.refs.dropdownTrigger);var t=$(l().findDOMNode(this.refs.dropdownMenu));$(".dropdown-menu").removeClass("show");var a=0,n=0;this.browserRect&&(a=-this.browserRect.left-15,n=(this.props.isModal?-this.browserRect.top:0)-15);var i=t.width(),s=t.height();e.pageX+i>window.innerWidth?t.css("left",e.pageX-i-5+a+"px"):t.css("left",e.pageX+5+a+"px"),e.pageY+s>window.innerHeight?t.css("top",e.pageY-s+n+"px"):t.css("top",e.pageY+n+"px"),this.refs.contextMenuWrapper.classList.contains("open")||t.toggleClass("show"),e.stopPropagation(),e.preventDefault()}},closeContextMenu:function(){var e=l().findDOMNode(this.refs.dropdownMenu);$(e).removeClass("show")}});var he=a(13023),fe=a(82765),ge=a.n(fe),ve=a(26201),be=a(87195),ye=a.n(be),we=a(58776),Ee=a.n(we),Ie=a(94768),Ne=a(88534),Se=a.n(Ne),Ce=a(16918),xe=a.n(Ce),Fe=a(9769),De=a(82465);const ke=i().createClass({displayName:"DataNodeDetail",getInitialState:function(){return this.currentFetchDataNodeRequest=null,this.dataNodeRtdbRef=null,this.dataNodeDS=null,this.isFirstFirstbaseCallback=!1,{dataNode:"",showBusyIcon:!1,autoRefreshActive:!0,firebaseData:null,payload:null,contentMode:"Form"}},shouldComponentUpdate:function(e,t){return!Fe.compareObject(t,this.state)||!Fe.compareObject(e,this.props)},componentWillMount:function(){this.componentWillReceiveProps(this.props)},componentWillUnmount:function(){this.disconnectFromFirebase(),this.currentFetchDataNodeRequest&&(this.currentFetchDataNodeRequest.abort(),this.currentFetchDataNodeRequest=null)},componentWillReceiveProps:function(e){this.fetchDataNode(e.item)},fetchDataNode:function(e){this.setState({dataNode:null}),e&&e.type==De.DATANODE&&(this.setState({showBusyIcon:!0}),this.currentFetchDataNodeRequest&&this.currentFetchDataNodeRequest.abort(),this.currentFetchDataNodeRequest=c().get("/apiv1/datanodes/"+e.refId).set("Content-Type","application/json").end(function(e,t){e?(this.props.onNotification("Error while fetching datanode details: "+e.message,"error",5,"tc"),this.setState({dataNode:null})):this.setState({dataNode:t.body}),this.connectToFirebase(),this.currentFetchDataNodeRequest=null}.bind(this)))},connectToFirebase:function(){var e=this;this.disconnectFromFirebase(),null!=this.state.dataNode?this.state.dataNode&&(this.isFirstFirstbaseCallback=!0,this.state.dataNode.datastore?(this.dataNodeRtdbRef=new(xe())(null,"".concat(this.state.dataNode.datastore)),new(Se())(this.dataNodeRtdbRef,this.state.dataNode.datastore).then(function(t){e.dataNodeDS=t,e.dataNodeRtdbRef.on("value",e.dataNodeUpdate)})):(this.dataNodeRtdbRef=window.singularRtdbCoreRef.child(this.state.dataNode.firebaseUrl.replace(window.singularRtdbCoreRef.toString(),"")),this.dataNodeRtdbRef.on("value",this.dataNodeUpdate))):this.setState({showBusyIcon:!1})},disconnectFromFirebase:function(){this.dataNodeRtdbRef&&(this.dataNodeRtdbRef.off("value",this.dataNodeUpdate),this.dataNodeRtdbRef=null,this.setState({firebaseData:null})),this.dataNodeDS&&this.dataNodeDS.disconnect()},dataNodeUpdate:function(e){var t=e.val();this.setState({firebaseData:t,showBusyIcon:!1}),(this.state.autoRefreshActive||this.isFirstFirstbaseCallback)&&(this.isFirstFirstbaseCallback=!1,this.refresh())},refresh:function(){if(this.state.firebaseData){var e={};$.extend(!0,e,this.state.firebaseData.payload),this.setState({payload:e})}},onChangeStorage:function(e){var t=this,a="/apiv1/datanodes/"+this.props.item.refId;a+="firebase"===e?"/nof2fb":"/fb2nof",this.setState({showBusyIcon:!0}),c().post(a).set("Content-Type","application/json").end(function(e,a){e?(t.props.onNotification("Error while changing storage: "+e.message,"error",5,"tc"),t.setState({showBusyIcon:!1})):t.fetchDataNode(t.props.item)})},toggleAutoRefresh:function(){this.setState({autoRefreshActive:!this.state.autoRefreshActive})},onSingularFormChanged:function(e,t){if(this.state.payload){var a={};$.extend(!0,a,this.state.payload),a[e]=t,this.setState({payload:a})}},onContentMode:function(e){this.setState({contentMode:e})},buildDataNodeJSON:function(e,t){return t?JSON.stringify({payload:this.state.payload},null,"\t"):JSON.stringify({payload:this.state.payload})},generateUuid:function(){this.setState({showBusyIcon:!0}),c().post("/apiv1/datanodes/"+this.props.item.refId+"/token").end(function(e,t){e?this.props.onNotification("Error while while generating token: "+e.message,"error",5,"tc"):this.fetchDataNode(this.props.item)}.bind(this))},render:function(){var e,t,a,n=this.state.dataNode;if(this.state.autoRefreshActive,this.state.firebaseData&&this.state.firebaseData.model&&(e=this.state.firebaseData.model),n&&(t=e&&"Form"==this.state.contentMode?i().createElement("div",{style:{height:"calc(100% - 180px)",overflow:"auto"}},i().createElement(Ie.A,{key:"form",model:e,fields:this.state.payload,enableDataLink:!1,disabled:!0,onValueChanged:this.onSingularFormChanged})):i().createElement("div",{style:{height:"calc(100% - 180px)"}},i().createElement(ve.A,{name:"dataNodeJson",id:"DND"+n.Id,className:"widget-version-json",width:"100%",height:"100%",value:this.buildDataNodeJSON(this.state.payload,!0),onValueChanged:this.onJsonValueChanged,disabled:!0,theme:"light"}))),this.state.showBusyIcon)a=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}));else{if(!n)return null;var s=this.state.dataNode.updated_at;this.state.firebaseData&&(s=this.state.firebaseData.ts);var o="";this.state.dataNode.token&&(o=this.state.dataNode.token);var r,l;l=n.datastore?"Datastore":"Firebase",("firebase"===window.singularUser.account.storage||"datastore"===window.singularUser.account.storage&&"singular"===window.singularUser.account.brand&&window.singularUser.account.accountId<30525)&&(r=n.datastore?i().createElement("button",{className:"btn btn-white",onClick:this.onChangeStorage.bind(this,"firebase")},"Change to Firebase"):i().createElement("button",{className:"btn btn-white",onClick:this.onChangeStorage.bind(this,"datastore")},"Change to Datastore")),a=i().createElement("div",{style:{width:"100%",height:"100%"}},i().createElement("table",{style:{width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Token"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control v2",id:"deploykey",name:"deploykey",placeholder:"No token generated",value:o,disabled:!0}),i().createElement("div",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":o,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})),i().createElement(ye(),{placement:"top",delayShow:500,overlay:i().createElement(Ee(),{id:"regenerate"},"Generate API token")},i().createElement("button",{tabIndex:"-1",onClick:this.generateUuid,className:"btn btn-white icon-only"},i().createElement("i",{className:"fa fa-refresh fa-lg"}))))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.dataNode.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(s).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Storage"),i().createElement("td",{className:"field-col"},l)),r&&i().createElement("tr",null,i().createElement("td",{className:"label-col"}),i().createElement("td",{className:"field-col"},r)),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Display"),i().createElement("td",{className:"field-col"},i().createElement(ye(),{placement:"top",delayShow:500,overlay:i().createElement(Ee(),{id:"ContentMode"},"Show data node content in fill-in form or JSON editor")},i().createElement("div",{className:"btn-group"},i().createElement("button",{tabIndex:"-1",className:("Form"==this.state.contentMode?"active ":"")+"btn btn-sm btn-white v2",onClick:this.onContentMode.bind(this,"Form")},"Form"),i().createElement("button",{tabIndex:"-1",className:("JSON"==this.state.contentMode?"active ":"")+"btn btn-sm btn-white v2",onClick:this.onContentMode.bind(this,"JSON")},"JSON"))))))),t)}return i().createElement("div",{className:"item-info-wrapper data-node-detail",style:{height:"calc(100% - 50px)"}},i().createElement("div",{className:"property-group",style:{width:"100%",height:"100%"}},i().createElement("div",{className:"group-body",style:{height:"100%"}},a)))}});var Te=a(9769),Re=a(82465),Ae=null;const Me=i().createClass({displayName:"CompositionDetail",getInitialState:function(){return this.currentDetailsRequest=null,this.currentAppTemplateRequest=null,{detailInfo:null,showBusyIcon:!1,forceRedraw:0}},shouldComponentUpdate:function(e,t){return!Te.compareObject(t,this.state)||!Te.compareObject(e,this.props)},componentWillMount:function(){var e=this;Ae||(this.currentAppTemplateRequest=c().get(Re.API_ENDPOINTS.at+"/json?status=development").set("Content-Type","application/json").end(function(t,a){t?console.log("Cannot fetch app templates"):(Ae=a.body,e.setState({forceRedraw:Math.random()})),e.currentAppTemplateRequest=null})),this.componentWillReceiveProps(this.props)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null),this.currentAppTemplateRequest&&(this.currentAppTemplateRequest.abort(),this.currentAppTemplateRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==Re.COMPOSITION&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/compositions/"+e.refId).set("Content-Type","application/json").end(function(e,t){e?(he.A.add(he.A.TYPE.ERROR,{title:"Cannot fetch composition details",description:e.message}),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1}),this.currentDetailsRequest=null}.bind(this)))},render:function(){if(!this.props.item)return null;var e;if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else if(this.state.detailInfo){var t,a="";if(this.state.detailInfo.uuid&&(a=this.state.detailInfo.uuid),this.state.detailInfo.appTemplateId&&Ae){var n=Ae.find(function(e){return e.id==this.state.detailInfo.appTemplateId}.bind(this));n&&(t=[i().createElement("tr",{key:"tr1",style:{height:"10px"}}),i().createElement("tr",{key:"tr2"},i().createElement("td",{className:"label-col"},"App Template Name"),i().createElement("td",{className:"field-col"},n.name)),i().createElement("tr",{key:"tr3"},i().createElement("td",{className:"label-col"},"App Template ID"),i().createElement("td",{className:"field-col"},this.state.detailInfo.appTemplateId))])}e=i().createElement("div",{style:{display:"flex",width:"100%",height:"100%",flexFlow:"column"}},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},Te.humanFileSize(this.state.detailInfo.size))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Token"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control v2",placeholder:"No token generated",value:a,disabled:!0}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":a,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),t,i().createElement("tr",{style:{height:"10px"}}),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))))}return i().createElement("div",{className:"item-info-wrapper"},i().createElement("div",{className:"property-group",style:{width:"100%"}},i().createElement("div",{className:"group-title"},Re.BROWSERITEM_NICENAME_MAP[Re.COMPOSITION]," ","Details"),i().createElement("div",{className:"group-body"},e)))}});var Oe=a(9769),Ue=a(82465);const Pe=i().createClass({displayName:"ImageDetail",getInitialState:function(){return this.currentDetailsRequest=null,{detailInfo:"",showBusyIcon:!1}},shouldComponentUpdate:function(e,t){return!Oe.compareObject(t,this.state)||!Oe.compareObject(e,this.props)},componentWillMount:function(){this.componentWillReceiveProps(this.props)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==Ue.ASSET&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/mediatoS3/"+e.refId).set("Content-Type","application/json").end(function(e,t){e?(he.A.add(he.A.TYPE.ERROR,{title:"Cannot fetch image details",description:e.message}),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1}),this.currentDetailsRequest=null}.bind(this)))},render:function(){if(!this.props.item)return null;var e;if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else{if(!this.state.detailInfo)return null;var t=null;this.state.detailInfo.width&&(t=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Width"),i().createElement("td",{className:"field-col"},this.state.detailInfo.width," px")));var a=null;this.state.detailInfo.height&&(a=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Height"),i().createElement("td",{className:"field-col"},this.state.detailInfo.height," px"))),e=i().createElement("div",{style:{display:"flex",width:"100%",height:"100%",flexFlow:"column"}},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,t,a,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},Oe.humanFileSize(this.state.detailInfo.size,!0))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"URL"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control",defaultValue:"https:"+this.state.detailInfo.url,disabled:"true"}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":"https:"+this.state.detailInfo.url,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))))}return i().createElement("div",{className:"item-info-wrapper"},i().createElement("div",{className:"property-group",style:{width:"100%"}},i().createElement("div",{className:"group-title"},Ue.BROWSERITEM_NICENAME_MAP[Ue.ASSET]," ","Details"),i().createElement("div",{className:"group-body"},e)))}});var Be=a(9769),Ve=a(82465),Le=null;const je=i().createClass({displayName:"AppInstanceDetail",getInitialState:function(){return this.currentDetailsRequest=null,this.currentAppTemplateRequest=null,{detailInfo:null,showBusyIcon:!1,forceRedraw:0}},shouldComponentUpdate:function(e,t){return!Be.compareObject(t,this.state)||!Be.compareObject(e,this.props)},componentWillMount:function(){var e=this;Le||(this.currentAppTemplateRequest=c().get(Ve.API_ENDPOINTS.at+"/json?status=development").set("Content-Type","application/json").end(function(t,a){t?console.log("Cannot fetch app templates"):(Le=a.body,e.setState({forceRedraw:Math.random()})),e.currentAppTemplateRequest=null})),this.componentWillReceiveProps(this.props)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null),this.currentAppTemplateRequest&&(this.currentAppTemplateRequest.abort(),this.currentAppTemplateRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==Ve.APPINSTANCE&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/appinstances/"+e.refId).set("Content-Type","application/json").end(function(e,t){e?(this.props.onNotification("Error while fetching app details: "+e.message,"error",5,"tc"),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1}),this.currentDetailsRequest=null}.bind(this)))},onChangeStorage:function(e){var t=this,a="/apiv1/appinstances/"+this.state.detailInfo.access_token;a+="firebase"===e?"/nof2fb":"/fb2nof",this.setState({showBusyIcon:!0}),c().post(a).set("Content-Type","application/json").end(function(e,a){e?(t.props.onNotification("Error while changing storage: "+e.message,"error",5,"tc"),t.setState({showBusyIcon:!1})):t.fetchDetails(t.props.item)})},render:function(){if(!this.props.item)return null;var e,t=function(e,t){return i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control v2",placeholder:t,value:e,disabled:!0}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":e,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"}))))};if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else if(this.state.detailInfo){var a,n,s,o,r=this.state.detailInfo,l="",d="",c="";r.token&&(l=r.token,d=window.singularUrlBase+"control/"+l,c=window.singularUrlBase+"apiv2/controlapps/"+l+"/control"),a=r.datastore?"Datastore":"Firebase",("firebase"===window.singularUser.account.storage||"datastore"===window.singularUser.account.storage&&"singular"===window.singularUser.account.brand&&window.singularUser.account.accountId<30525)&&(n=r.datastore?i().createElement("button",{className:"btn btn-white",onClick:this.onChangeStorage.bind(this,"firebase")},"Change to Firebase"):i().createElement("button",{className:"btn btn-white",onClick:this.onChangeStorage.bind(this,"datastore")},"Change to Datastore")),(window.singularUser.isImpersonated||"enterprise"==window.singularUser.account.subscription.subscription_plan||0==window.singularUser.account.accountId)&&(o=(o=r.token?d:r.control_url).replace("/control","/analytics"),s=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Analytics URL"),i().createElement("td",{className:"field-col"},t(o,"No URL found"))));var p="App info not found";if(Le){var u=Le.find(function(e){return e.id==r.apptemplate_id});u&&(p=u.name)}var m="//apptemplates.singular.live/"+r.apptemplate_id+"/"+r.apptemplate_version+"/icon.png";e=i().createElement("div",null,i().createElement("div",{className:"group-title"},"App URLs and Token"),i().createElement("div",{className:"group-body"},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Output URL"),i().createElement("td",{className:"field-col"},t(r.onair_url,"No URL found"))),s,i().createElement("tr",{style:{height:"10px"}}),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Public App URL"),i().createElement("td",{className:"field-col"},t(d,"No URL generated"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Public API URL"),i().createElement("td",{className:"field-col"},t(c,"No URL generated"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Public App Token"),i().createElement("td",{className:"field-col"},t(l,"No token generated")))))),i().createElement("div",{className:"group-title"},"App Template"),i().createElement("div",{className:"group-body"},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Thumbnail"),i().createElement("td",{className:"field-col"},i().createElement("img",{src:m,style:{width:"32px",height:"32px"}}))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Name"),i().createElement("td",{className:"field-col"},p)),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"ID"),i().createElement("td",{className:"field-col"},r.apptemplate_id)),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Version"),i().createElement("td",{className:"field-col"},r.apptemplate_version))))),i().createElement("div",{className:"group-title"},"Info"),i().createElement("div",{className:"group-body"},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(r.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(r.updated_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Storage"),i().createElement("td",{className:"field-col"},a)),n&&i().createElement("tr",null,i().createElement("td",{className:"label-col"}),i().createElement("td",{className:"field-col"},n))))))}return i().createElement("div",{className:"item-info-wrapper",style:{height:"100%",overflow:"auto"}},i().createElement("div",{className:"property-group"},e))}});var We=a(9769),_e=a(82465);const qe=i().createClass({displayName:"FolderDetail",getInitialState:function(){return this.currentDetailsRequest=null,{detailInfo:""}},shouldComponentUpdate:function(e,t){return!We.compareObject(t,this.state)||!We.compareObject(e,this.props)},render:function(){if(!this.props.item)return null;var e=i().createElement("div",{style:{display:"flex",width:"100%",height:"100%",flexFlow:"column"}},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Folder ID"),i().createElement("td",{className:"field-col",style:{fontSize:"11px"}},this.props.item.fid)))));return i().createElement("div",{className:"item-info-wrapper"},i().createElement("div",{className:"property-group",style:{width:"100%"}},i().createElement("div",{className:"group-title"},_e.BROWSERITEM_NICENAME_MAP[_e.FOLDER]," ","Details"),i().createElement("div",{className:"group-body"},e)))}});var Ge=a(9769),Ye=a(82465);const $e=i().createClass({displayName:"AudioDetail",getInitialState:function(){return this.currentDetailsRequest=null,{detailInfo:"",showBusyIcon:!1}},shouldComponentUpdate:function(e,t){return!Ge.compareObject(t,this.state)||!Ge.compareObject(e,this.props)},componentWillMount:function(){this.componentWillReceiveProps(this.props)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==Ye.AUDIO&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/audios/"+e.refId).set("Content-Type","application/json").end(function(e,t){e?(he.A.add(he.A.TYPE.ERROR,{title:"Cannot fetch image details",description:e.message}),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1}),this.currentDetailsRequest=null}.bind(this)))},render:function(){if(!this.props.item)return null;var e;if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else{if(!this.state.detailInfo)return null;var t=null;this.state.detailInfo.channels&&(t=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Channels"),i().createElement("td",{className:"field-col"},this.state.detailInfo.channels," channels")));var a=null;this.state.detailInfo.samplerate&&(a=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Sample rate"),i().createElement("td",{className:"field-col"},this.state.detailInfo.samplerate/1e3," kHz")));var n=null;this.state.detailInfo.duration&&(n=i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Duration"),i().createElement("td",{className:"field-col"},Ge.millisecondsToHms(this.state.detailInfo.duration<500?1e3*this.state.detailInfo.duration:this.state.detailInfo.duration)))),e=i().createElement("div",{style:{display:"flex",width:"100%",height:"100%",flexFlow:"column"}},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,t,a,n,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},Ge.humanFileSize(this.state.detailInfo.size,!0))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"URL"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control",defaultValue:this.state.detailInfo.url,disabled:"true"}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":this.state.detailInfo.url,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))))}return i().createElement("div",{className:"item-info-wrapper"},i().createElement("div",{className:"property-group",style:{width:"100%"}},i().createElement("div",{className:"group-title"},Ye.BROWSERITEM_NICENAME_MAP[Ye.AUDIO]," ","Details"),i().createElement("div",{className:"group-body"},e)))}});var Je=a(9769),ze=a(82465);const He=i().createClass({displayName:"VideoDetail",getInitialState:function(){return this.currentDetailsRequest=null,{detailInfo:"",showBusyIcon:!1}},shouldComponentUpdate:function(e,t){return!Je.compareObject(t,this.state)||!Je.compareObject(e,this.props)},componentWillMount:function(){this.fetchDetails(this.props.item)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==ze.VIDEO&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/videos/"+e.refId).set("Content-Type","application/json").end(function(e,t){this.currentDetailsRequest=null,e?(this.props.onNotification("Error while fetching video details: "+e.message,"error",5,"tc"),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1})}.bind(this)))},render:function(){if(!this.props.item)return null;var e;if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else{if(!this.state.detailInfo)return null;e=i().createElement("div",null,i().createElement("table",{style:{width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Width"),i().createElement("td",{className:"field-col"},null!=this.state.detailInfo.width?this.state.detailInfo.width+" px":"-")),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Height"),i().createElement("td",{className:"field-col"},null!=this.state.detailInfo.height?this.state.detailInfo.height+" px":"-")),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Duration"),i().createElement("td",{className:"field-col"},Je.millisecondsToHms(this.state.detailInfo.duration<500?1e3*this.state.detailInfo.duration:this.state.detailInfo.duration))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},Je.humanFileSize(this.state.detailInfo.size,!0))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"URL"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control",defaultValue:this.state.detailInfo.url,disabled:"true"}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":this.state.detailInfo.url,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))))}return i().createElement("div",{className:"item-info-wrapper",style:{flex:"1"}},i().createElement("div",{className:"property-group",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},i().createElement("div",{className:"group-title"},ze.BROWSERITEM_NICENAME_MAP[ze.VIDEO]," ","Details"),i().createElement("div",{className:"group-body",style:{display:"flex",flex:"1",flexDirection:"column",paddingBottom:"0px"}},e)))}});var Ke=a(70470),Qe=(a(4708),a(87874),a(51289),a(9769)),Xe=a(82465);ace.config.set("basePath","/build/ace-builds"),ace.config.set("workerPath","/build/ace-builds"),ace.config.set("modePath","/build/ace-builds"),ace.config.set("themePath","/build/ace-builds");const Ze=i().createClass({displayName:"JsonDetail",getInitialState:function(){return this.currentDetailsRequest=null,this.currentJsonRequest=null,{detailInfo:"",jsonValue:"",jsonEditorValue:"",showBusyIcon:!1,editMode:!1}},shouldComponentUpdate:function(e,t){return!Qe.compareObject(t,this.state)||!Qe.compareObject(e,this.props)},componentWillMount:function(){this.fetchDetails(this.props.item)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null),this.currentJsonRequest&&(this.currentJsonRequest.abort(),this.currentJsonRequest=null)},fetchDetails:function(e){var t=this;this.setState({detailInfo:null}),e&&e.type==Xe.JSON&&(this.setState({showBusyIcon:!0}),se().waterfall([function(t){this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/jsons/"+e.refId).set("Content-Type","application/json").end(function(e,a){this.currentDetailsRequest=null,e?(this.props.onNotification("Error while fetching JSON details: "+e.message,"error",5,"tc"),this.setState({detailInfo:null,showBusyIcon:!1}),t(null)):t(null,a.body)}.bind(this))}.bind(this),function(e,a){t.currentJsonRequest&&t.currentJsonRequest.abort(),t.currentJsonRequest=c().get(e.url+"?rnd="+Math.random()).end(function(n,i){if(t.currentJsonRequest=null,n)t.setState({showBusyIcon:!1}),a(null,e,n.rawResponse);else{var s=i.body;try{a(null,e,JSON.parse(s))}catch(t){a(null,e,s)}}})}],function(e,t,a){if(e)this.setState({detailInfo:null,showBusyIcon:!1});else{var n="";a&&(n=JSON.stringify(a,null,"\t")),this.setState({detailInfo:t,jsonValue:n,jsonEditorValue:n,showBusyIcon:!1})}}.bind(this)))},onSave:function(){var e=this,t=!0;try{JSON.parse(this.state.jsonEditorValue)}catch(e){t=!1}t?(this.setState({editMode:!1,showBusyIcon:!0}),c().put("/apiv1/jsons/"+this.props.item.refId+"/content").set("Content-Type","application/json").send({content:JSON.parse(this.state.jsonEditorValue)}).end(function(t,a){t&&e.props.onNotification("Error while saving JSON: "+t.message,"error",5,"tc"),e.setState({showBusyIcon:!1}),e.fetchDetails(e.props.item)})):this.props.onNotification("Invalid JSON, please correct the JSON before saving","error",5,"tc")},onCancel:function(){this.setState({editMode:!1,jsonEditorValue:this.state.jsonValue})},onJsonChange:function(e){this.setState({jsonEditorValue:e})},render:function(){var e,t=this;if(!this.props.item)return null;if(this.props.theme&&this.props.theme,this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else{if(!this.state.detailInfo)return null;var a=!0;try{JSON.parse(this.state.jsonEditorValue)}catch(e){a=!1}e=i().createElement("div",{style:{display:"flex",flexFlow:"column",flex:"1"}},i().createElement("table",{style:{flex:"0 1 auto",width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},Qe.humanFileSize(this.state.detailInfo.size,!0))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"URL"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control",defaultValue:this.state.detailInfo.url,disabled:"true"}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":this.state.detailInfo.url,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))),i().createElement("div",{style:{flex:"1",opacity:this.state.editMode?1:.7,border:a?"1px solid transparent":"1px solid red",paddingRight:"8px"}},i().createElement(Ke.Ay,{id:"jsonEditor-"+this.props.item.refId,mode:"json",theme:"xcode",name:"jsonEditor-"+this.props.item.refId,width:"100%",height:"100%",readOnly:!this.state.editMode,tabSize:2,showPrintMargin:!1,highlightActiveLine:!0,wrapEnabled:!0,editorProps:{$blockScrolling:1},value:this.state.jsonEditorValue,className:"disabled",commands:[{name:"Save",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(){t.onSave()}}],onChange:this.onJsonChange,ref:"aceEditor"})),!1===this.state.editMode&&i().createElement("div",{style:{display:"flex",justifyContent:"center"}},i().createElement("button",{className:"btn btn-white",onClick:function(){t.setState({editMode:!0})},style:{height:"30px"}},"Edit JSON")),!0===this.state.editMode&&i().createElement("div",{style:{display:"flex",justifyContent:"center",gap:"10px"}},i().createElement("button",{className:"btn btn-white",onClick:function(){t.onSave()},style:{width:"100px",height:"30px"}},"Save"),i().createElement("button",{className:"btn btn-white",onClick:function(){t.onCancel()},style:{width:"100px",height:"30px"}},"Cancel")))}return i().createElement("div",{className:"item-info-wrapper",style:{flex:"1"}},i().createElement("div",{className:"property-group",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},i().createElement("div",{className:"group-title"},Xe.BROWSERITEM_NICENAME_MAP[Xe.JSON]," ","Details"),i().createElement("div",{className:"group-body",style:{display:"flex",flex:"1",flexDirection:"column",paddingBottom:"0px"}},e)))}});var et=a(9769),tt=a(82465);const at=i().createClass({displayName:"DataDetail",getInitialState:function(){return this.currentDetailsRequest=null,{detailInfo:"",showBusyIcon:!1}},shouldComponentUpdate:function(e,t){return!et.compareObject(t,this.state)||!et.compareObject(e,this.props)},componentWillMount:function(){this.fetchDetails(this.props.item)},componentWillReceiveProps:function(e){this.fetchDetails(e.item)},componentWillUnmount:function(){this.currentDetailsRequest&&(this.currentDetailsRequest.abort(),this.currentDetailsRequest=null)},fetchDetails:function(e){this.setState({detailInfo:null}),e&&e.type==tt.DATA&&(this.setState({showBusyIcon:!0}),this.currentDetailsRequest&&this.currentDetailsRequest.abort(),this.currentDetailsRequest=c().get("/apiv1/data/"+e.refId).set("Content-Type","application/json").end(function(e,t){this.currentDetailsRequest=null,e?(this.props.onNotification("Error while fetching data details: "+e.message,"error",5,"tc"),this.setState({detailInfo:null,showBusyIcon:!1})):this.setState({detailInfo:t.body,showBusyIcon:!1})}.bind(this)))},render:function(){if(!this.props.item)return null;var e;if(this.state.showBusyIcon)e=i().createElement("div",{className:"loader-wrapper"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",height:"25px",className:"loader"}));else{if(!this.state.detailInfo)return null;e=i().createElement("div",null,i().createElement("table",{style:{width:"100%"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Size"),i().createElement("td",{className:"field-col"},et.humanFileSize(this.state.detailInfo.size,!0))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"URL"),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"input-group",style:{width:"100%"}},i().createElement("input",{type:"text",className:"form-control",defaultValue:this.state.detailInfo.url,disabled:"true"}),i().createElement("span",{className:"input-group-btn"},i().createElement(ge(),{className:"btn btn-white icon-only","data-clipboard-text":this.state.detailInfo.url,"button-tabIndex":"-1"},i().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Created"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.created_at).format("YYYY-MM-DD HH:mm:ss"))),i().createElement("tr",null,i().createElement("td",{className:"label-col"},"Updated"),i().createElement("td",{className:"field-col"},L()(this.state.detailInfo.updated_at).format("YYYY-MM-DD HH:mm:ss"))))))}return i().createElement("div",{className:"item-info-wrapper",style:{flex:"1"}},i().createElement("div",{className:"property-group",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},i().createElement("div",{className:"group-title"},tt.BROWSERITEM_NICENAME_MAP[tt.DATA]," ","Details"),i().createElement("div",{className:"group-body",style:{display:"flex",flex:"1",flexDirection:"column",paddingBottom:"0px"}},e)))}});var nt=a(9769),it=a(82465);const st=i().createClass({displayName:"ItemViewer",getInitialState:function(){return this.audioPlayerTimeout=null,this.lastItem=null,{iconUploadActive:!1,audioPlaying:""}},shouldComponentUpdate:function(e,t){return!nt.compareObject(t,this.state)||!nt.compareObject(e,this.props)},componentWillMount:function(){this.updateState(this.props)},componentDidMount:function(){var e=this;this.refs.audio&&(this.audioPlayerTimeout=setTimeout(function(){e.refs.audio.style.width="100.001%"},250))},componentWillUnmount:function(){this.audioPlayerTimeout&&(clearTimeout(this.audioPlayerTimeout),this.audioPlayerTimeout=null)},componentWillReceiveProps:function(e){this.updateState(e)},updateState:function(e){if(e.selectedItems&&e.selectedItems.length){var t=e.selectedItems[e.selectedItems.length-1];this.lastItem&&t&&this.lastItem.refId!=t.refId&&"au"==this.lastItem.type&&this.refs.audio&&this.refs.audio.pause(),"au"==t.type&&(null==this.lastItem||this.lastItem&&t&&this.lastItem.refId!=t.refId)&&this.onTrackChange(t.url),this.setState({item:t,iconUploadActive:!1}),this.lastItem=t}else this.setState({item:null,iconUploadActive:!1}),this.lastItem=null},onNameChanged:function(e){this.props.renameSelectedItems(e.name)},onTrackChange:function(e){this.setState({audioPlaying:e},function(){this.refs.audio.pause(),this.refs.audio.load()})},render:function(){if(!this.props.selectedItems||0==this.props.selectedItems.length)return null;var e,t,a,n,s=this.props.selectedItems[this.props.selectedItems.length-1];switch(e=s.thumbnail?(e=s.thumbnail).replace("fit-in/150x150","fit-in/300x150"):nt.getDefaultIconFromBrowserShortType(s.type),s.type!=it.ASSET&&s.type!=it.FOLDER&&(t=1==this.state.iconUploadActive?i().createElement("div",null,i().createElement("span",null,"Uploading image"),i().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):i().createElement("input",{type:"file",accept:"image/*",className:"form-control inspector-fileselect",style:{minHeight:"auto",height:"auto"},onChange:this.editThumbnail,ref:"imageInput"})),s.type){case it.ASSET:a=i().createElement(Pe,{item:s,onNotification:this.props.onNotification});break;case it.COMPOSITION:a=i().createElement(Me,{item:s,onNotification:this.props.onNotification});break;case it.DATANODE:a=i().createElement(ke,{item:s,onNotification:this.props.onNotification});break;case it.APPINSTANCE:a=i().createElement(je,{item:s,onNotification:this.props.onNotification});break;case it.FOLDER:a=i().createElement(qe,{item:s,onNotification:this.props.onNotification});break;case it.AUDIO:a=i().createElement($e,{item:s,onNotification:this.props.onNotification});break;case it.VIDEO:a=i().createElement(He,{item:s,onNotification:this.props.onNotification});break;case it.JSON:a=i().createElement(Ze,{item:s,onNotification:this.props.onNotification});break;case it.DATA:a=i().createElement(at,{item:s,onNotification:this.props.onNotification})}s.refId&&(n=i().createElement("span",{className:"asset-label",style:{position:"absolute",right:"5px"}},"ID: ",s.refId));var o,r=n?"245px":"335px",l=i().createElement("div",{className:"asset-title",style:{height:"50px"}},i().createElement("span",{className:"asset-label",style:{width:r,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},s.name),n);if(s.type==it.ASSET||s.type==it.COMPOSITION||s.type==it.APPINSTANCE||s.type==it.DEVICE||s.type==it.VIDEO)o=i().createElement("div",{style:{margin:"10px"}},i().createElement("img",{onClick:this.openFileDialog,className:"inspector-thumbnail",src:e,ref:"imageDisplay"}),t);else if(s.type==it.AUDIO){var d=/[.]/.exec(this.state.audioPlaying)?/[^.]+$/.exec(this.state.audioPlaying):void 0;o=i().createElement("div",{style:{margin:"10px",width:"300px"}},i().createElement("audio",{controls:!0,ref:"audio",tabIndex:"-1",style:{width:"100%"}},i().createElement("source",{src:this.state.audioPlaying,type:"audio/"+d})))}return i().createElement("div",{style:{height:"calc(100% - 20px)",width:"calc(100% - 5px)"},className:"singular-item-viewer"},this.props.hasItems?i().createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},l,o,a):i().createElement("div",{style:{marginTop:"20px",textAlign:"center"}},"No item selected"))},openFileDialog:function(){var e=this.refs.imageInput;e&&e.click()},editThumbnail:function(e){if(e.target.files&&e.target.files[0]){var t=nt.getApiEndpointFromBrowserShortType(this.state.item.type)+this.state.item.refId+"/thumbnail";this.setState({iconUploadActive:!0});var a=this.state.item.parents?this.state.item.parents[0]:this.state.item.parent,n=c().put(t);n.field("name",e.target.files[0].name),n.field("folder",a),n.attach("file",e.target.files[0]),n.end(function(e,t){if(e)he.A.add(he.A.TYPE.ERROR,{title:"Image upload failed",description:e.message}),this.setState({iconUploadActive:!1});else{var a=this.refs.imageDisplay.src=t.body;this.state.item.thumbnail=a;var n=this.refs.imageDisplay.getRootNode().getElementById("folder-items").children["item-"+this.state.item.fid],i=Array.from(n.children).filter(function(e){return"row-detail icon"===e.className});i.length&&(i[0].innerHTML='<img src="'+a+'" class="thumbnail-image-wide">'),this.setState({iconUploadActive:!1})}this.refs.imageInput.value=""}.bind(this))}}}),ot=i().createClass({displayName:"VideoPlayer",propTypes:{videoUrl:E().string.isRequired,videoName:E().string,videoRefId:E().number,onCaptureThumbnail:E().func,onClose:E().func},getInitialState:function(){return{isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,isFullscreen:!1,isDraggingProgress:!1,isUploadingThumbnail:!1,frameRate:30}},componentDidMount:function(){var e=this.videoRef;e&&(e.addEventListener("loadedmetadata",this.handleLoadedMetadata),e.addEventListener("timeupdate",this.handleTimeUpdate),e.addEventListener("play",this.handlePlay),e.addEventListener("pause",this.handlePause),e.addEventListener("ended",this.handleEnded))},componentWillUnmount:function(){var e=this.videoRef;e&&(e.removeEventListener("loadedmetadata",this.handleLoadedMetadata),e.removeEventListener("timeupdate",this.handleTimeUpdate),e.removeEventListener("play",this.handlePlay),e.removeEventListener("pause",this.handlePause),e.removeEventListener("ended",this.handleEnded)),document.removeEventListener("mousemove",this.handleProgressDrag),document.removeEventListener("mouseup",this.handleProgressMouseUp)},handleLoadedMetadata:function(){var e=this.videoRef;e&&this.setState({duration:e.duration})},handleTimeUpdate:function(){var e=this.videoRef;e&&this.setState({currentTime:e.currentTime})},handlePlay:function(){this.setState({isPlaying:!0})},handlePause:function(){this.setState({isPlaying:!1})},handleEnded:function(){this.setState({isPlaying:!1})},togglePlayPause:function(){var e=this.videoRef;e&&(this.state.isPlaying?e.pause():e.play())},handleSeek:function(e){var t=this.videoRef;if(t){var a=e.currentTarget,n=e.nativeEvent.offsetX/a.offsetWidth*this.state.duration;t.currentTime=n}},handleProgressMouseDown:function(e){this.setState({isDraggingProgress:!0}),this.handleProgressDrag(e),document.addEventListener("mousemove",this.handleProgressDrag),document.addEventListener("mouseup",this.handleProgressMouseUp)},handleProgressDrag:function(e){if(this.progressBarRef){var t=this.videoRef;if(t&&!1!==this.state.isDraggingProgress){var a=this.progressBarRef.getBoundingClientRect(),n=e.clientX-a.left,i=Math.max(0,Math.min(1,n/a.width))*this.state.duration;t.currentTime=i}}},handleProgressMouseUp:function(){this.setState({isDraggingProgress:!1}),document.removeEventListener("mousemove",this.handleProgressDrag),document.removeEventListener("mouseup",this.handleProgressMouseUp)},handleVolumeChange:function(e){var t=this.videoRef,a=parseFloat(e.target.value);t&&(t.volume=a,this.setState({volume:a,isMuted:0===a}))},toggleMute:function(){var e=this.videoRef;if(e){var t=!this.state.isMuted;e.muted=t,this.setState({isMuted:t})}},toggleFullscreen:function(){var e=this,t=this.playerContainerRef;t&&(document.fullscreenElement?document.exitFullscreen().then(function(){e.setState({isFullscreen:!1})}):t.requestFullscreen().then(function(){e.setState({isFullscreen:!0})}).catch(function(e){console.error("Error attempting to enable fullscreen:",e)}))},goToFirstFrame:function(){var e=this.videoRef;e&&(e.currentTime=0,e.pause(),this.setState({isPlaying:!1}))},goToPreviousFrame:function(){var e=this.videoRef;if(e){var t=1/this.state.frameRate;e.currentTime=Math.max(0,e.currentTime-t),e.pause(),this.setState({isPlaying:!1})}},goToNextFrame:function(){var e=this.videoRef;if(e){var t=1/this.state.frameRate;e.currentTime=Math.min(e.duration,e.currentTime+t),e.pause(),this.setState({isPlaying:!1})}},goToLastFrame:function(){var e=this.videoRef;e&&(e.currentTime=e.duration,e.pause(),this.setState({isPlaying:!1}))},captureThumbnail:function(){var e=this,t=this.videoRef;if(t){var a=document.createElement("canvas"),n=480,i=t.videoWidth,s=t.videoHeight;if(i>n||s>n){var o=i/s;i>s?(i=n,s=Math.round(n/o)):(s=n,i=Math.round(n*o))}a.width=i,a.height=s,a.getContext("2d").drawImage(t,0,0,i,s),a.toBlob(function(t){t&&e.uploadThumbnail(t)},"image/jpeg",.95)}},uploadThumbnail:function(e){var t=this,a=this.props,n=a.videoRefId;if(a.videoName,n){this.setState({isUploadingThumbnail:!0});var i=this.formatTime(this.state.currentTime),s="thumbnail-".concat(i.replace(/:/g,"-"),".jpg"),o="/apiv1/videos/".concat(n,"/thumbnail"),r=new File([e],s,{type:"image/jpeg"}),l=c().put(o);l.field("name",s),l.attach("file",r),l.end(function(e,a){e?(he.A.add(he.A.TYPE.ERROR,{title:"Thumbnail upload failed",description:e.message||"Failed to upload thumbnail"}),t.setState({isUploadingThumbnail:!1})):(t.setState({isUploadingThumbnail:!1}),t.props.onCaptureThumbnail&&t.props.onCaptureThumbnail(a.body,i))})}else he.A.add(he.A.TYPE.ERROR,{title:"Thumbnail upload failed",description:"Video ID is missing"})},formatTime:function(e){if(isNaN(e)||null===e)return"00:00";var t=Math.floor(e/3600),a=Math.floor(e%3600/60),n=Math.floor(e%60);return t>0?"".concat(t.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(a.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},formatTimeWithFrame:function(e){if(isNaN(e)||null===e)return"00:00 (Frame 0)";var t=Math.floor(e*this.state.frameRate),a=this.formatTime(e);return"".concat(a," (Frame ").concat(t,")")},render:function(){var e=this,t=this.props,a=t.videoUrl,n=(t.videoName,this.state),s=n.isPlaying,o=n.currentTime,r=n.duration,l=n.volume,d=n.isMuted,c=n.isFullscreen,p=n.isUploadingThumbnail,u=r>0?o/r*100:0;return i().createElement("div",{ref:function(t){return e.playerContainerRef=t},className:"video-player-container"},i().createElement("div",{className:"video-element"},i().createElement("video",{ref:function(t){return e.videoRef=t},src:a,crossOrigin:"anonymous",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onClick:this.togglePlayPause})),i().createElement("div",{className:"video-controls"},i().createElement("div",{ref:function(t){return e.progressBarRef=t},className:"progress-bar",onClick:this.handleSeek,onMouseDown:this.handleProgressMouseDown},i().createElement("div",{style:{width:"".concat(u,"%"),height:"100%",backgroundColor:"#007bff",borderRadius:"3px",transition:this.state.isDraggingProgress?"none":"width 0.1s",position:"relative"}},i().createElement("div",{className:"handle"}))),i().createElement("div",{className:"controls"},i().createElement("button",{onClick:this.togglePlayPause,className:"btn btn-link control"},i().createElement("i",{className:"fa ".concat(s?"fa-pause":"fa-play")})),i().createElement("div",{className:"frame-controls"},i().createElement("button",{onClick:this.goToFirstFrame,className:"btn btn-link control",title:"First frame"},i().createElement("i",{className:"fa fa-step-backward"})),i().createElement("button",{onClick:this.goToPreviousFrame,className:"btn btn-link control",title:"Previous frame"},i().createElement("i",{className:"fa fa-backward"})),i().createElement("button",{onClick:this.goToNextFrame,className:"btn btn-link control",title:"Next frame"},i().createElement("i",{className:"fa fa-forward"})),i().createElement("button",{onClick:this.goToLastFrame,className:"btn btn-link control",title:"Last frame"},i().createElement("i",{className:"fa fa-step-forward"}))),i().createElement("div",{className:"time-and-duration"},this.formatTimeWithFrame(o)," /"," ",this.formatTime(r)),i().createElement("div",{style:{flex:1}}),i().createElement("button",{onClick:this.captureThumbnail,className:"btn btn-primary btn-sm snapshot",title:"Capture thumbnail at current time",disabled:p},i().createElement("i",{className:"fa fa-camera"}),p?i().createElement("img",{style:{margin:"auto",display:"block",height:"25px"},src:"/images/loading-bubbles.svg",className:"loader"}):i().createElement("span",null,"Capture Thumbnail")),i().createElement("button",{onClick:this.toggleMute,className:"btn btn-link control"},i().createElement("i",{className:"fa ".concat(d||0===l?"fa-volume-off":l<.5?"fa-volume-down":"fa-volume-up")})),i().createElement("input",{type:"range",min:"0",max:"1",step:"0.01",value:d?0:l,onChange:this.handleVolumeChange,style:{width:"80px"}}),i().createElement("button",{onClick:this.toggleFullscreen,className:"btn btn-link control"},i().createElement("i",{className:"fa ".concat(c?"fa-compress":"fa-expand")})))))}});var rt=a(35259),lt=a(45261),dt=(a(95093),a(9769)),ct="New Release",pt=[ct,"UNO","Business","Education","General","News","Resources","Spiritual","Sports","Wellness"];const ut=i().createClass({displayName:"MarketplaceBrowser",getInitialState:function(){return this.packageRequest=null,this.downloadRequest=null,this.imageLoaded={},{packages:[],cardHover:null,cardSelected:null,variantSelected:0,typeFilter:"all",filter:"",showBusyIcon:!0,showDraft:0,selectedTags:[],downloadBusy:!1,downloadItemName:""}},componentDidMount:function(){var e=l().findDOMNode(this.refs.MarketplaceBrowserModal);e&&($(e).on("hide.bs.modal",function(){this.refs.videoElement&&l().findDOMNode(this.refs.videoElement).pause(),this.setState({cardSelected:null,variantSelected:0})}.bind(this)),$(e).on("show.bs.modal",function(){0==this.state.packages.length&&this.getPackages(),this.refs.videoElement&&l().findDOMNode(this.refs.videoElement).play()}.bind(this)))},componentWillUnmount:function(){this.packageRequest&&this.packageRequest.abort(),this.downloadRequest&&this.downloadRequest.abort()},getPackages:function(){this.setState({showBusyIcon:!0}),this.packageRequest&&this.packageRequest.abort();var e="/apiv1/marketplace/items?display=dashboard";this.state.showDraft?e+="&status=draft":e+="&status=published",this.packageRequest=c().get(e).set("Content-Type","application/json").end(function(e,t){if(this.packageRequest=null,e)this.props.onNotification("Could not fetch marketplace items","error",5,"tc"),this.setState({showBusyIcon:!1});else{if(t.headers.location)return void(window.location=t.headers.location);var a=t.body;a.map(function(e){var t=[];try{t=JSON.parse(e.tags)}catch(e){}e.tags=t,e.tags=e.tags.filter(function(e){return!String(e).startsWith("uno_")});var a={};try{a=JSON.parse(e.content)}catch(e){}e.content=a}),a=a.filter(function(e){if(e.content&&e.content.type&&e.content.content&&e.content.content.length&&e.content.content[0].element&&e.content.content[0].element.id)return!0}),this.setState({packages:a,showBusyIcon:!1})}}.bind(this))},addPackage:function(e,t,a){var n=t.content.content[a].element.id,i=this.props.selectedFolder;dt.isSpecialFolder(i)&&(i="root");var s,o={sendEmail:0,targetFolder:i,target_email:window.singularUser.email,fromMarketplace:1,marketplaceID:t.id};"composition"==t.content.type?(s="/apiv1/compositions/duplicateto",o.comp_id=n):(s="/apiv1/appinstances/duplicateto",o.app_id=n),this.setState({downloadBusy:!0,downloadItem:t}),this.downloadRequest&&this.downloadRequest.abort(),this.downloadRequest=c().post(s).send(o).end(function(e,a){if(this.downloadRequest=null,e)this.props.onNotification('Could not download marketplace item "'+t.name+'"',"error",5,"tc");else{if(a.headers.location)return void(window.location=a.headers.location);this.props.onNotification('Marketplace item "'+t.name+'" has been added to your dashboard',"success",5,"tc")}this.setState({downloadBusy:!1,downloadItem:null});try{singularanalytics.event(analyticEventType.MARKETPLACE_DOWNLOADED,window.singularUser.account.accountId,"UI",window.location.hostname,{element_id:t.id,user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.MARKETPLACE_DOWNLOADED,{plan:window.singularUser.account.subscription.subscription_plan,marketplace_element_id:n,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}}.bind(this))},onSearchBoxFilterChanged:function(e){this.setState({filter:e.target.value,cardSelected:null,variantSelected:0})},onSearchBoxFilterKeyDown:function(e){"Escape"==e.key&&""!=this.state.filter&&(this.setState({filter:"",cardSelected:null,variantSelected:0}),e.preventDefault(),e.stopPropagation())},clearSearchBox:function(){this.setState({filter:"",cardSelected:null,variantSelected:0})},onCardMouseEnter:function(e){this.setState({cardHover:e})},onCardMouseLeave:function(){this.setState({cardHover:null})},onCardSelect:function(e){this.setState({cardSelected:e,variantSelected:0});var t=l().findDOMNode(this.refs.MarketplaceBrowserModal);t&&t.focus()},onVariantSelect:function(e){this.setState({variantSelected:e})},onFilterChanged:function(e){this.setState({typeFilter:e,cardSelected:null})},onImageLoad:function(e){this.imageLoaded[e]=!0,this.setState({redraw:Math.random()})},onTagSelect:function(e){if(3!=this.state.selectedTags.length)if(e&&"string"==typeof e&&-1!==e.indexOf(","))this.setState({selectedTags:e.split(",").slice(0,3),cardSelected:null});else{var t=this.state.selectedTags.slice();t.push(e),this.setState({selectedTags:t,cardSelected:null})}},onRemoveSelectedTag:function(e){var t=this.state.selectedTags.slice();t.splice(e,1),this.setState({selectedTags:t,cardSelected:null})},onDraftToggleChanged:function(e){this.setState({showDraft:e.target.checked,cardSelected:null,variantSelected:0},this.getPackages)},render:function(){var e=this,t=!1;this.state.packages.forEach(function(e){(e.tags.includes(ct)||0!==dt.getMarketplaceNewReleaseDaysLeft(e.new_release))&&(t=!0)});var a,n=[];if(this.state.packages.forEach(function(t){for(var a=0;a<e.state.selectedTags.length;a++)if(e.state.selectedTags[a]!=ct){if(!t.tags.includes(e.state.selectedTags[a]))return}else if(0===dt.getMarketplaceNewReleaseDaysLeft(t.new_release)&&!t.tags.includes(ct))return;n.push(t)}),n.sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),0==this.state.selectedTags.length)a=pt;else{var s={};if(this.state.selectedTags.length<3)for(var o=0;o<n.length;o++)for(var r=n[o],l=0;l<r.tags.length;l++){var d=r.tags[l];this.state.selectedTags.includes(d)||pt.includes(d)||(s[d]?s[d]++:s[d]=1)}(a=Object.keys(s)).sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())})}var c,p,u,m,h,f,g,v=function(e,a){if(0!=t||e!=ct){var n={};return e==ct&&(n.color="#63b4ff",n.fontWeight="bold"),i().createElement("span",{key:a,className:"tag",style:n,onClick:this.onTagSelect.bind(this,e)},e)}}.bind(this),b=function(e,t,a){var n;return n=t==a.length-1?i().createElement("i",{className:"fa fa-times tag-delete",onClick:this.onRemoveSelectedTag.bind(this,t)}):i().createElement("span",{style:{marginRight:"5px"}}),i().createElement("span",{key:t,className:"tag-selected"},e,n)}.bind(this),y=0,w=function(e){if(""!=this.state.filter.trim()){var t=this.state.filter.trim().toUpperCase(),a=!1,n=e.content;n&&n.content&&n.content.length&&(a=n.content.find(function(e){return-1!==e.name.toUpperCase().indexOf(t)}));var s=e.description.replace(/<\/?[^>]+(>|$)/g,"");if(-1==e.name.toUpperCase().indexOf(t)&&e.id!=t&&-1==e.tags.join(" ").toUpperCase().indexOf(t)&&-1==s.toUpperCase().indexOf(t)&&!a)return null}if("all"!=this.state.typeFilter&&this.state.typeFilter!=e.content.type)return null;for(var o=0;o<this.state.selectedTags.length;o++)if(this.state.selectedTags[o]!=ct){if(!e.tags.includes(this.state.selectedTags[o]))return null}else if(0===dt.getMarketplaceNewReleaseDaysLeft(e.new_release)&&!e.tags.includes(ct))return null;var r,l,d,c,p,u,m,h=e.content.content[0];this.state.cardHover==e.id&&h.videoURL&&(r=i().createElement("video",{key:h.videoURL,className:"video",playsInline:!0,autoPlay:!0,muted:!0,loop:!0,ref:"videoElement"},i().createElement("source",{src:(l=h.videoURL,d="tiny",c="",p=l.lastIndexOf("."),-1!==p?(c=l.substring(p,l.length),l.substring(0,p,l.length)+"-"+d+c):l+"-"+d),type:"video/webm"}),i().createElement("source",{src:h.videoURL,type:"video/webm"}))),e.marker&&(u=i().createElement("img",{className:"marker",src:e.marker}));var f=h.imageURL;return f&&(m=i().createElement("div",{className:"tile-container"},i().createElement("img",{className:"image",src:f,onLoad:this.onImageLoad.bind(this,e.id),style:{visibility:this.imageLoaded[e.id]?"visible":"hidden"}}),i().createElement("img",{className:"busy",src:"/images/loading-bubbles-blue.svg",style:{visibility:this.imageLoaded[e.id]?"hidden":"visible"}}))),y++,i().createElement("div",{className:"package",key:e.id,onMouseEnter:this.onCardMouseEnter.bind(this,e.id),onMouseLeave:this.onCardMouseLeave},i().createElement("div",{className:"card__tile",onClick:this.onCardSelect.bind(this,e.id)},m,r,u),i().createElement("div",{className:"card__title"},i().createElement("div",{className:"card__label"},e.name)))}.bind(this),E=function(e,t,a){var n="item-detail-variant";this.state.variantSelected==t&&(n+=" selected",c=e.name);var s="item-"+e.id+"-variant-"+t,o={};return t==a.length-1&&(o.marginBottom="0px"),i().createElement("div",{key:t,className:n,onClick:this.onVariantSelect.bind(this,t),style:o},i().createElement("img",{className:"variant-image",src:e.imageURL,onLoad:this.onImageLoad.bind(this,s),style:{visibility:this.imageLoaded[s]?"visible":"hidden"}}),i().createElement("div",{className:"variant-label"},e.name))}.bind(this);if(this.state.cardSelected&&(p=this.state.packages.find(function(t){return t.id==e.state.cardSelected})),p){var I,N,S=p.content.content[this.state.variantSelected];if(p.content.content.length>1&&(I=p.content.content),I){var C;if(S.videoURL)C=i().createElement("div",{className:"wrapper"},i().createElement("div",{className:"variant-list"},I.map(E)),i().createElement("video",{key:S.videoURL,className:"video",autoPlay:!0,muted:!0,loop:!0,ref:"videoElement"},i().createElement("source",{src:S.videoURL,type:"video/webm"})));else{var x=S.imageURL;if(x){var F=p.id+"-detail";C=i().createElement("div",{className:"wrapper"},i().createElement("div",{className:"variant-list"},I.map(E)),i().createElement("img",{className:"image",src:x,onLoad:this.onImageLoad.bind(this,F),style:{visibility:this.imageLoaded[F]?"visible":"hidden"}}),i().createElement("img",{className:"busy",src:"/images/loading-bubbles-blue.svg",style:{visibility:this.imageLoaded[F]?"hidden":"visible",display:"none"}}))}}N=i().createElement("div",{className:"item-detail-tile-with-variants"},i().createElement("button",{className:"item-detail-back",tabIndex:"-1",onClick:this.onCardSelect.bind(this,null)},i().createElement("i",{className:"fa fa-angle-left"})),i().createElement("button",{tabIndex:"-1",className:"item-detail-close","data-dismiss":"modal","aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},"")),C)}else{var D;if(S.videoURL)D=i().createElement("div",{className:"wrapper"},i().createElement("video",{key:S.videoURL,className:"video",autoPlay:!0,muted:!0,loop:!0,ref:"videoElement"},i().createElement("source",{src:S.videoURL,type:"video/webm"})));else{var k=S.imageURL;if(k){var T=p.id+"-detail";D=i().createElement("div",{className:"wrapper"},i().createElement("img",{className:"image",src:k,onLoad:this.onImageLoad.bind(this,T),style:{visibility:this.imageLoaded[T]?"visible":"hidden"}}),i().createElement("img",{className:"busy",src:"/images/loading-bubbles-blue.svg",style:{visibility:this.imageLoaded[T]?"hidden":"visible"}}))}}N=i().createElement("div",{className:"item-detail-tile"},i().createElement("button",{className:"item-detail-back",tabIndex:"-1",onClick:this.onCardSelect.bind(this,null)},i().createElement("i",{className:"fa fa-angle-left"})),i().createElement("button",{tabIndex:"-1",className:"item-detail-close","data-dismiss":"modal","aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},"")),D)}var R=p.name;c&&(R=c),u=i().createElement("div",{className:"item-detail-wrapper"},N,i().createElement("div",{className:"item-detail-description"},i().createElement("div",{className:"item-detail-left-column"},i().createElement("div",{className:"item-detail-label"},R),i().createElement("div",{className:"item-detail-description-html"},i().createElement("div",{className:"ql-editor ql-blank","data-gramm":"false",dangerouslySetInnerHTML:{__html:p.description}}))),i().createElement("div",{style:{flex:"1"}}),i().createElement("button",{className:"item-detail-download",tabIndex:"-1",onClick:function(t){return e.addPackage(t,p,e.state.variantSelected)}},this.state.downloadBusy&&i().createElement("img",{src:"/images/loading-bubbles.svg",style:{width:"100px",height:"49px"}}),!this.state.downloadBusy&&i().createElement("span",null,"Use this template"))))}if(0==this.state.showBusyIcon){var A="item-detail";p&&(A+=" in"),m=i().createElement("div",{className:"package-list"},n.map(w)),h=i().createElement("div",{className:A},u),g=i().createElement("span",{className:"search-message"},y," of ",this.state.packages.length," items")}else f=i().createElement("div",{className:"download-package-busy"},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})),g=i().createElement("span",{className:"search-message"});var M,O=this.state.filter?"search-box dirty":"search-box",U=this.state.filter?"fa fa-times":"fa fa-search";M=0==window.singularUser.account.accountId?i().createElement("div",{className:"draft-toggle-area"},"Show Draft Versions",i().createElement("label",{className:"switch",style:{position:"relative",top:"4px"}},i().createElement("input",{type:"checkbox",className:"switch-input",checked:this.state.showDraft,onChange:this.onDraftToggleChanged}),i().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),i().createElement("span",{className:"switch-handle"}))):i().createElement("div",{className:"draft-toggle-area"});var P,B=this.state.selectedTags;return P=this.state.showBusyIcon?i().createElement("div",{className:"tag-area"},i().createElement("div",{className:"tag-options-area",style:{visibility:"hidden"}},a.map(v))):i().createElement("div",{className:"tag-area"},0!==B.length&&i().createElement("div",{className:"tag-selected-area"},B.map(b),i().createElement("div",{className:"tag-area-separator"})),i().createElement("div",{className:"tag-options-area"},a.map(v))),i().createElement("div",{id:"MarketplaceBrowserModal",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog",ref:"MarketplaceBrowserModal"},i().createElement("div",{className:"modal-dialog modal-lg marketplace-modal",role:"document"},i().createElement("div",{className:"marketplace-dialog"},i().createElement("div",{className:"marketplace-header"},i().createElement("span",{style:{flexGrow:"1"}},"Template Library"),i().createElement("button",{tabIndex:"-1",className:"close-button","data-dismiss":"modal","aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},""))),i().createElement("div",{className:"marketplace-description"},"Download overlay templates for all sorts of live shows including sport, news, education and much more. You can also download Resources like Composition Scripts, Compositions for learning advanced widgets and more."),P,i().createElement("div",{className:"search-area"},i().createElement("div",{className:"search-wrapper"},i().createElement("span",{className:"search-icon"},i().createElement("i",{className:U,onClick:this.clearSearchBox})),i().createElement("input",{autoFocus:!0,value:this.state.filter,className:O,type:"text",placeholder:"Search for templates",onChange:this.onSearchBoxFilterChanged,onKeyDown:this.onSearchBoxFilterKeyDown,style:{width:"100%",paddingLeft:"30px"}})),M,g),m,h,f)))}});var mt=a(10936),ht=a(9769),ft=a(82465);const gt=i().createClass({displayName:"AssetUploadElement",getInitialState:function(){return{}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!0},onAction:function(e){this.props.onAction&&this.props.onAction(e,this.props.element.id)},render:function(){var e=this.props.element,t=e.file,a=e.status,n=null,s=null,o={position:"relative",top:"-2px",left:"0px"};switch(a){case"ready":n=i().createElement("button",{onClick:this.onAction.bind(this,"remove"),className:"btn btn-white icon-only",style:{width:"20px",paddingLeft:"5px",paddingRight:"0px",height:"20px"}},i().createElement("i",{className:"fa fa-times",style:o})),s="Queued";break;case"uploading":s=i().createElement(mt.N1,{percent:e.progress,strokeWidth:"4",strokeColor:"#5395d2"}),n=i().createElement("button",{onClick:this.onAction.bind(this,"abort"),className:"btn btn-white icon-only",style:{width:"20px",paddingLeft:"5px",paddingRight:"0px",height:"20px"}},i().createElement("i",{className:"fa fa-times",style:o}));break;case"processing":s="Processing",n=null;break;case"error":case"cancelled":case"rejected":case"invalid":case"finished":switch(n=i().createElement("button",{onClick:this.onAction.bind(this,"clear"),className:"btn btn-white icon-only",style:{width:"20px",paddingLeft:"3px",paddingRight:"0px",height:"20px"}},i().createElement("i",{className:"fa fa-eraser",style:o})),a){case"error":s=e.message;break;case"finished":s="Finished";break;case"cancelled":s="Cancelled";break;case"rejected":s="Rejected",e.message&&(s=e.message);break;case"invalid":s="Invalid"}}return i().createElement("tr",{className:"dialog-row-item"},i().createElement("td",{style:{width:"40px",height:"40px"}},i().createElement("div",{style:{height:"40px",width:"40px",position:"relative"}},i().createElement(j.A,{imageUrl:t.preview,defaultImageUrl:ht.getDefaultIconFromBrowserShortType(ft.ASSET),style:{position:"absolute",transform:"translateX(-50%) translateY(-50%)",top:"50%",left:"50%"}}))),i().createElement("td",{style:{fontSize:"14px",color:"#616161",overflow:"hidden",height:"40px"}},t.name),i().createElement("td",{style:{fontSize:"14px",color:"#616161",overflow:"hidden",height:"40px",width:"170px"}},s),i().createElement("td",{style:{fontSize:"14px",color:"#616161",overflow:"hidden",height:"40px",width:"30px",textAlign:"right"}},n))}});var vt=a(10611),bt=a(9769),yt=a(50243),wt=a(85519);const Et=i().createClass({displayName:"AssetUploadManager",getInitialState:function(){return this.uploadQueue=[],this.numberOfActiveUploads=0,{uploadManagerMinimized:!1,closed:!1}},componentDidMount:function(){window.addEventListener("beforeunload",function(e){var t=null;return this.numberOfActiveUploads&&(this.setState({closed:!1}),e.preventDefault(),t="There are still "+this.numberOfActiveUploads+" files uploading.",(e||window.event).returnValue=t),t}.bind(this),!1)},shouldComponentUpdate:function(e,t){return!0},AddFile:function(e,t,a,n,i){null==a&&(a="ready"),this.setState({closed:!1}),this.getS3SignedRequest(e,function(s,o){var r=e;s||null==o?(a="error",i=s):(o.imageFileRemoveExif&&(r=o.imageFileRemoveExif),r.size>10485760&&(a="error",i="size over 10 MB limit")),this.uploadQueue.push({status:a,file:r,destination:t,id:vt.v4(),uploadReq:null,progress:0,message:i,s3Sign:o}),this.ProcessUploadQueue(n)}.bind(this))},ProcessUploadQueue:function(e){for(var t=0,a=this.uploadQueue.length;t<a;t++){if(this.numberOfActiveUploads>=2)return;e&&"ready"==this.uploadQueue[t].status&&this.StartDownload(this.uploadQueue[t],e)}this.forceUpdate()},StartDownload:function(e,t){var n=this;if("ready"==e.status){e.status="uploading";var i=e.s3Sign,s=c().put(e.s3Sign.signedRequest);s.set("Content-Type",e.file.type),e.s3Sign.enableContentDisposition&&s.set("Content-Disposition",'attachment; filename="'.concat(e.file.name,'"')),s.send(e.file);var o=a(47500);!function(a){var i=[function(t){a.on("progress",function(a){a&&a.srcElement&&!a.srcElement.response&&(e.status="processing",e.progress=a.percent,n.forceUpdate(function(){e.progress>=100&&t(null,{status:e.status,fid:e.id})}))})},function(e,a){t(e),a(null)}];o.waterfall(i,function(e){return e?console.error(e):_})}(s),function(a){var s=[function(e){return a.end(e)},function(t,a){t.headers.location?(window.location=t.headers.location,a(null)):(e.status="finished",a(null,{status:e.status,body:i}))},function(e,a){n.numberOfActiveUploads--,n.ProcessUploadQueue(t),a(null,e)},function(a,i){var s=a.body;delete s.signedRequest,s.folder=e.destination,n.updateMetadata(s,function(e,n){a&&t(a),i(null)})}];o.waterfall(s,function(a){a&&(n.numberOfActiveUploads--,e.status="error",e.message=a.response.body.error.message,t({status:e.status,fid:e.id}),n.forceUpdate())})}(s),e.uploadReq=s,this.numberOfActiveUploads++}},OnAction:function(e,t){for(var a=0,n=this.uploadQueue.length;a<n;a++){var i=this.uploadQueue[a];if(i.id==t&&("remove"==e||"abort"==e||"clear"==e))return"uploading"===i.status?(this.CancelUpload(i),this.ProcessUploadQueue(),void this.forceUpdate()):(this.uploadQueue.splice(a,1),void this.forceUpdate())}},CancelUpload:function(e){e.uploadReq.abort(),e.uploadReq=null,e.status="cancelled",this.numberOfActiveUploads--},ClearAll:function(){for(var e=0;e<this.uploadQueue.length;){var t=this.uploadQueue[e].status;"finished"==t||"error"==t||"cancelled"==t||"rejected"==t||"invalid"==t?this.uploadQueue.splice(e,1):e++}this.forceUpdate()},CancelAll:function(){for(var e=0;e<this.uploadQueue.length;e++)"uploading"==this.uploadQueue[e].status&&this.CancelUpload(this.uploadQueue[e]),"ready"==this.uploadQueue[e].status&&(this.uploadQueue[e].status="cancelled");this.forceUpdate()},onToggleMinimize:function(){this.setState({uploadManagerMinimized:!this.state.uploadManagerMinimized})},onClose:function(){this.setState({closed:!0})},getS3SignedRequest:function(e,t){var n=a(47500),i=e.name,s=new XMLHttpRequest,o=i.split(".").pop();o=o.toLowerCase();var r=new FileReader;n.waterfall([function(t){if("svg"===o)r.readAsDataURL(e),r.addEventListener("load",function(a){var n=a.target.result,s=atob(n.split(",")[1]),r=(new DOMParser).parseFromString(s,"image/svg+xml").documentElement,l=Math.round(r.viewBox.baseVal.width),d=Math.round(r.viewBox.baseVal.height);0==l&&0==d&&(l=Math.round(r.getAttribute("width").replace(/px$/,""))||0,d=Math.round(r.getAttribute("height").replace(/px$/,""))||0);var c={fileName:i,originalFileName:i,width:l,height:d,ext:o,fileType:e.type,fileSize:e.size};t(null,c)});else if("jpg"===o||"jpeg"===o||"png"===o||"apng"===o)r.readAsArrayBuffer(e),r.addEventListener("load",function(a){var n,s=new Image,l=r.result;if("jpg"===o||"jpeg"===o)n=wt.removeExifJPG(l);else if(("png"===o||"apng"===o)&&(n=wt.removeExifPNG(new Uint8Array(l)),wt.isAPNG(new Uint8Array(l)))){o="apng";var d=i.substr(0,i.lastIndexOf("."))||x;i=d+"."+o}var c=new Blob([n],{type:"image/"+o});s.src=URL.createObjectURL(c);var p=new File([c],i,{type:"image/"+o,lastModified:(new Date).getTime()});p.preview=s.src,s.onload=function(){var a={fileName:i,originalFileName:i,width:Math.round(s.width),height:Math.round(s.height),ext:o,imageFileRemoveExif:p,fileType:e.type,fileSize:c.size};t(null,a)}});else if("gif"===o||"webp"===o)r.readAsDataURL(e),r.addEventListener("load",function(a){var n=new Image;n.src=r.result,n.onload=function(){var a={fileName:i,originalFileName:i,width:Math.round(n.width),height:Math.round(n.height),ext:o,fileType:e.type,fileSize:e.size};t(null,a)}});else if("mp3"==o||"wav"==o||"ogg"==o)r.readAsArrayBuffer(e),r.onload=function(a){var n=a.target.result;yt.getAudioInfo(n,function(a,n){var s={fileName:i,originalFileName:i,duration:n.duration,numberOfChannels:n.numberOfChannels,sampleRate:n.sampleRate,ext:o,fileType:e.type,fileSize:e.size};t(null,s)})};else if("json"==o)r.readAsText(e),r.onload=function(a){var n=a.target.result;try{JSON.parse(n);var s={fileName:i,originalFileName:i,ext:o,fileType:e.type,fileSize:e.size};t(null,s)}catch(e){t("Invalid JSON file")}};else if("mp4"==o||"webm"==o)r.readAsDataURL(e),r.addEventListener("load",function(a){var n=document.createElement("video");n.src=r.result,n.preload="metadata",n.muted=!0,n.onloadedmetadata=function(){var e=n.duration,t=(Math.round(n.videoWidth),Math.round(n.videoHeight),e<1?.5*e:1);n.currentTime=t},n.onseeked=function(){var a=480,s=n.videoWidth,r=n.videoHeight;if(s>a||r>a){var l=s/r;s>r?(s=a,r=Math.round(a/l)):(r=a,s=Math.round(a*l))}var d=document.createElement("canvas");d.width=s,d.height=r,d.getContext("2d").drawImage(n,0,0,s,r),d.toBlob(function(a){if(a){var s=i.replace(/\.(mp4|webm)$/i,"_thumb.jpg"),r=new File([a],s,{type:"image/jpeg",lastModified:(new Date).getTime()}),l=new Image;l.onload=function(){var d={fileName:s,originalFileName:s,width:Math.round(l.width),height:Math.round(l.height),ext:"jpg",fileType:"image/jpeg",fileSize:a.size,enableContentDisposition:!0},c=new XMLHttpRequest;c.open("POST",bt.appendAccessTokenUrl("/apiv1/directtoS3/sign")),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var l=JSON.parse(c.response),d=new XMLHttpRequest;d.open("PUT",l.signedRequest),d.setRequestHeader("Content-Type","image/jpeg"),d.setRequestHeader("Content-Disposition",'attachment; filename="'.concat(s,'"')),d.onload=function(){if(200===d.status){var s=new File([e],e.name,{type:e.type,lastModified:e.lastModified});s.preview=URL.createObjectURL(a);var r={fileName:i,originalFileName:i,duration:n.duration,width:Math.round(n.videoWidth),height:Math.round(n.videoHeight),ext:o,fileType:e.type,fileSize:e.size,thumbnailUrl:l.url,videoFileWithPreview:s};t(null,r)}else{var c={fileName:i,originalFileName:i,duration:n.duration,width:Math.round(n.videoWidth),height:Math.round(n.videoHeight),ext:o,fileType:e.type,fileSize:e.size};t(null,c)}},d.onerror=function(){var a={fileName:i,originalFileName:i,duration:n.duration,width:Math.round(n.videoWidth),height:Math.round(n.videoHeight),ext:o,fileType:e.type,fileSize:e.size};t(null,a)},d.send(r)}else{var p={fileName:i,originalFileName:i,duration:n.duration,width:Math.round(n.videoWidth),height:Math.round(n.videoHeight),ext:o,fileType:e.type,fileSize:e.size};t(null,p)}},c.send(JSON.stringify(d))},l.src=URL.createObjectURL(a)}else{var d={fileName:i,originalFileName:i,duration:n.duration,width:Math.round(n.videoWidth),height:Math.round(n.videoHeight),ext:o,fileType:e.type,fileSize:e.size};t(null,d)}},"image/jpeg",.85)},n.onerror=function(){var a={fileName:i,originalFileName:i,ext:o,fileType:e.type,fileSize:e.size};t(null,a)}});else{var a=e.type;""===a&&(a="application/octet-stream");var n={fileName:i,originalFileName:i,ext:o,fileType:a,fileSize:e.size,enableContentDisposition:!0};t(null,n)}}],function(e,a){var n;e?t(e):a.fileSize>10485760?t("size over 10 MB limit",a):(a&&(n=a.imageFileRemoveExif||null),s.open("POST",bt.appendAccessTokenUrl("/apiv1/directtoS3/sign")),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=JSON.parse(s.response);e.imageFileRemoveExif=n,t(null,e)}else t("Cannot access S3 storage",null)},delete a.imageFileRemoveExif,s.send(JSON.stringify(a)))})},updateMetadata:function(e,t){c().post(bt.appendAccessTokenUrl("/apiv1/directtoS3/metadata")).send(e).set("Content-Type","application/json").end(function(e,a){t(e,a.body)})},render:function(){if(!this.uploadQueue.length||this.state.closed)return null;var e=function(e,t){return i().createElement(gt,{key:t,element:e,onAction:this.OnAction})}.bind(this),t="fa fa-caret-down";1==this.state.uploadManagerMinimized&&(t="fa fa-caret-up");var a,n={position:"relative",top:"-2px",left:"0px"},s=i().createElement("div",{className:"dialog-header",style:{display:"flex",alignContent:"center"}},i().createElement("span",{style:{flexGrow:"1"}},"Upload Manager"),i().createElement("button",{onClick:this.onToggleMinimize,className:"btn btn-white icon-only",style:{height:"20px",margin:"0px"}},i().createElement("i",{className:t,style:n})),i().createElement("button",{onClick:this.onClose,className:"btn btn-white icon-only",style:{height:"20px",margin:"0px 1px 0px 5px"}},i().createElement("i",{className:"fa fa-times",style:n}))),o={height:"300px",zIndex:"100"};if(1==this.state.uploadManagerMinimized){for(var r=0,l=0,d=this.uploadQueue.length;l<d;l++)switch(this.uploadQueue[l].status){case"error":case"finished":case"cancelled":case"rejected":case"invalid":r++}a=i().createElement("div",{style:{marginLeft:"5px",marginTop:"7px",color:"#616161"}},"Processed "+r+" of "+this.uploadQueue.length),o.height="60px"}else a=i().createElement("div",{style:{height:"calc(100% - 30px)",width:"100%",overflowY:"scroll",position:"relative"}},i().createElement("table",{style:{width:"100%"}},i().createElement("tbody",null,this.uploadQueue.map(e))));return i().createElement("div",{style:o,id:"uploadManager"},s,a)}});var It=a(86025),Nt=a(79988),St=a(39481);function Ct(e,t,a){return(t=function(e){var t=function(e){if("object"!=Dt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Dt(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dt(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function xt(e){return function(e){if(Array.isArray(e))return Ft(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ft(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ft(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function Dt(e){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dt(e)}var kt=a(73801),Tt=a(10611),Rt=a(17987).JY,At=a(9769),Mt=a(82465),Ot=a(18245);a(49612);var Ut=function(e){var t=e.hasMore||!1;e&&((e=e.filter(function(e){return e})).hasMore=t);var a=e||{length:0};return a.ready?e:Pt(a)},Pt=function(e){var t=function(e){return e.ready?e:e.length?function(e){return e.reduce(function(e,t){return e[t.fid]=t,e},{})}(e):[]}(e);return t.ready||(t.keys=function(){return Object.keys(t).filter(function(e){return t[e].fid&&!t[e].action})},t.map=function(e){return t.keys().map(function(a){return e(t[a])})},t.sort=function(e){return t.map(function(e){return e}).sort(e)},t.filter=function(e){return t.map(function(e){return e}).filter(e)},t.forEach=function(e){return t.map(function(e){return e}).forEach(e)},t.push=function(e){return t[e.fid]=e},t.merge=function(e){e.forEach(function(e){var a=t[e.fid]||{};$.extend(!0,a,e),t[e.fid]=a}),t.length+=e.length,t.hasMore=e.hasMore||!1},t.replace=function(e){t.forEach(function(e){return delete t[e.fid]}),t.merge(e)},t.remove=function(e){return delete t[e]},t.getByRefId=function(e){var a=t.keys().filter(function(a){return t[a].refId==e});a.length>1&&console.warn("Duplicate refId!!");var n=a[0];return t[n]},t.ready=!0),t.length=t.keys().length,t.hasMore=e.hasMore||!1,t},Bt=i().createClass({displayName:"Browser",mixins:[o()],getInitialState:function(){this.browserId=Tt.v1(),this.fetchCompositionInfoRequest=null;try{var e="currentFolder-"+window.singularUser.account.accountId;this.lastFolder=this.localStorageGetItem(e)||"root"}catch(e){this.lastFolder="root"}return this.sendToUserTasks=[],this.reloadingState=2,this.updatePropPool=[],this.modalPending=!0,this.scSendToEmailPreviousInputValue="",this.scSendToEmailCurrentInputValue="",this.isModal=null,this.loadingState=0,this.globalUserTable=null,this.xhrLoadItems=null,this.dLoadItems=h()(this.loadItems,1e3),{viewStyle:"list",toggleInspector:!1,showConfirmDelete:!1,confirmDeleteMessage:"",showConfirmFolderDelete:!1,confirmFolderMessage:"",confirmOpenMessage:void 0,showSelectCompMessage:!1,showMobileNav:!1,tree:{},selectedFolder:this.lastFolder,selectedItems:[],folderViewerErrorMsg:"",loadingItemIds:new Set,pendingItemIds:new Set,filter:"",filteredByType:"ALL",trashedFiles:[],breadcrumbStack:[{name:window.singularUser.account.accountName,fid:"fid"}],sendToUserEmail:0,sendToUserEmailMessage:"",emailValues:[],sendToUserItems:[],sendingInProgress:!1,numberOfItemsToSendLeft:0,exportCompositionName:"",exportCompInProcess:!1,exportCompProcessMsg:"",exportCompError:!1,exportCompositionButtonDisabled:!1,sortBy:Ot.SORT_BY.LAST_MODIFIED,sortDirection:Ot.SORT_DIRECTION.DESC,preparedNewItem:null,newItemDialogTitle:"",newItemDialogPlaceholder:"",busy:!1,splitPanePosition:199,browserRectWidth:0,showVideoPlayer:!1,currentVideoItem:null}},componentWillMount:function(){this.assignConfig(this.props);var e=this.state.selectedFolder;if("inbox"!=e&&!e.includes("recent")){var t=this.localStorageGetItem("dashboardSortBy");t&&this.changeSortBy(t)}var a=this.localStorageGetItem("dashboardSplitPane");this.onSplitResize(a||200)},componentDidMount:function(){var e=this,t=this.localStorageGetItem("dashboard_filter");if(t&&this.onChangeFilter(t),this.isModal){var a="modalPending";this.watchThis(a,function(t,n,i){t==a&&n&&!i&&(e.unwatchThis(a),e.loadPage())})}else this.loadPage();It.A.createShortcut("mod+a",function(){e.selectAllItems()},this.browserMain),window.addEventListener("resize",this.windowResized)},shouldComponentUpdate:function(e,t){if(!this.isUserTableIsReady())return!1;var a="inbox"!=this.state.selectedFolder&&"inbox"==t.selectedFolder,n="recent"!=this.state.selectedFolder&&"recent"==t.selectedFolder,i="myrecent"!=this.state.selectedFolder&&"myrecent"==t.selectedFolder,s=n||i;this.tmpSortBy||!a&&!s||(this.tmpSortBy=t.sortBy,t.sortBy="LAST_MODIFIED"),s&&(t.sortBy="LAST_MODIFIED");var o="inbox"==this.state.selectedFolder&&"inbox"!=t.selectedFolder,r="recent"==this.state.selectedFolder||"myrecent"==this.state.selectedFolder,l="recent"!=t.selectedFolder&&"myrecent"!=t.selectedFolder,d=r&&l;this.tmpSortBy&&(o&&!s||d&&!a)&&(t.sortBy=this.tmpSortBy,delete this.tmpSortBy);var c=t.treeTrigger!=this.state.treeTrigger,p=t.folderTrigger!=this.state.folderTrigger;if(c||p)return!0;if(t.filteredByType!=this.state.filteredByType)return this.reloadingState=0,!0;if(t.sortBy!=this.state.sortBy)return this.reloadingState=0,!0;var u={tree:void 0,folderViewerItems:void 0,treeTrigger:void 0,folderTrigger:void 0,filteredByType:void 0,sortBy:void 0},m=Object.assign({},t,u),h=Object.assign({},this.state,u);return!At.compareObject(m,h)||!At.compareObject(e,this.props)},componentDidUpdate:function(e,t){if(this.isUserTableIsReady()){if(0==this.reloadingState&&this.reloadFolders(function(e){e&&console.error(e)}),this.state.folderViewerItems&&this.state.folderViewerItems.ready&&this.state.tree!={}&&!this.state.selectedItems.length&&(this.state.selectedItems=this.folderViewerRef.state.selectedItems),this.folderViewerRef){var a=l().findDOMNode(this);this.folderViewerRef.browserRect=a.getBoundingClientRect()}this.refs.browserMain&&this.windowResized()}t&&this.state.showVideoPlayer&&!t.showVideoPlayer?document.addEventListener("keydown",this.handleVideoPlayerKeyDown):t&&!this.state.showVideoPlayer&&t.showVideoPlayer&&document.removeEventListener("keydown",this.handleVideoPlayerKeyDown)},componentWillUnmount:function(){window.removeEventListener("resize",this.windowResized),document.removeEventListener("keydown",this.handleVideoPlayerKeyDown)},isUserTableIsReady:function(){return null!=this.globalUserTable&&"string"!=typeof this.globalUserTable&&null!=this.globalUserTable&&"object"==Dt(this.globalUserTable)},showMarketplaceBrowser:function(e,t){var a=$("#MarketplaceBrowserModal");if(a){switch(e){case"item":this.refs.marketplaceBrowser.onCardSelect(t);break;case"tag":this.refs.marketplaceBrowser.onTagSelect(t)}a.modal("show")}},ldAdd:function(e){var t=this.state.loadingItemIds;return null==e?t:new Set([].concat(xt(t),xt(e)))},ldDel:function(e){null==e&&(e=new Set(this.state.loadingItemIds));var t=this.state.loadingItemIds,a=new Set(e);return new Set(xt(t).filter(function(e){return!a.has(e)}))},redrawTree:function(e,t){(e=e||{}).treeTrigger=!this.state.treeTrigger,this.setState(e,t&&t)},redrawFolder:function(e,t){(e=e||{}).folderTrigger=!this.state.folderTrigger,this.setState(e,t&&t)},redrawAll:function(e,t){(e=e||{}).treeTrigger=!this.state.treeTrigger,e.folderTrigger=!this.state.folderTrigger,this.setState(e,t&&t)},redrawFolderRawItems:function(e,t){this.redrawFolderStateRawItems({},e,t)},redrawFolderStateRawItems:function(e,t,a){var n=this;this.updatePropPool.forEach(function(e){return e.ref.off("value",e.listener)}),this.updatePropPool=[],null==t?(e=Object.assign(e,{folderViewerItems:void 0,busy:!1}),this.redrawFolder(e,a)):this.buildFolderViewerItems(t,function(t,i){t?a&&a(t):(e=Object.assign(e,{folderViewerItems:i,busy:!1}),n.redrawFolder(e,function(e){return a&&a(null,i)}))})},refresh:function(){this.loadPage()},buildFolderViewerItems:function(e,t){var a=this,n=function(e){e.owner=function(e){var t=a.globalUserTable;return null==e.user_id||null==e.user_id?"unknown":t[e.user_id]?t[e.user_id].firstName?t[e.user_id].firstName:t[e.user_id].lastName?t[e.user_id].lastName:t[e.user_id].email:"ID "+e.user_id}(e)};!function(e,t){(e=Pt(e)).forEach&&e.forEach(n);var i=e.map(function(t){return function(n){return function(t,n){if("d"==t.type&&t.firebaseUrl){window.singularRtdbCoreRef.toString();var i=window.singularRtdbCoreRef.child(t.firebaseUrl.replace(/http.*firebaseio.com\//gm,""));i.once("value",function(t){var a=t.val();if(a){var i=e.getByRefId(a.refId);a&&a.ts&&i&&(i.name=a.name,i.ts=a.ts),n&&n(null,i)}else n&&n()}),a.updatePropPool.push({fid:t.fid,ref:i})}else{var s=function(e,n,i,s){var o=75e3;if(e.ts&&e.activeKey){var r=function(e,i){var o=a.props.rtdbFolderRef.child("files").child(t.fid),r=s?o.child("scriptEditor"):o,l=s?n.seTimerId:n.timerId;clearTimeout(l);var d=setTimeout(function(){clearTimeout(l),r.child("activeKey").remove(),s?(delete n.seTimerId,delete n.seActiveUsers):(delete n.timerId,delete n.activeUsers),i&&i(null,n)},e);s?n.seTimerId=d:n.timerId=d},l=function(e){if(s){var t,a=e.activeKey[Object.keys(e.activeKey)[0]];return null!=e.userInfo&&null!=e.userInfo&&(t=e.userInfo[a]),t}return e.activeKey[Object.keys(e.activeKey)[0]]}(e),d=function(e){if(s){if(e.seActiveUsers&&e.seActiveUsers.length)return e.seActiveUsers[0]}else if(e.activeKey&&e.activeKey.length)return e.activeKey[0];return null}(n);l===d?Nt.A.database().ref("/.info/serverTimeOffset").once("value").then(function(t){var a=t.val()+Date.now(),l=e.ts?new Date(e.ts):a,d=(s?n.seTimerId:n.timerId)?a-l:0;d>o?(s?n.seActiveUsers:n.activeUsers,i&&i(null,n)):r(o-d,i)}):(null!=l&&(s?(Array.isArray(n.seActiveUsers)?n.seActiveUsers[0]:null)!=l&&(n.seActiveUsers=[l],i&&i(null,n)):(Array.isArray(n.activeUsers)?n.activeUsers[0]:null)!=l&&(n.activeUsers=[l],i&&i(null,n))),r(o))}else s?null!=n.seActiveUsers&&(delete n.seActiveUsers,i&&i(null,n)):null!=n.activeUsers&&(delete n.activeUsers,i&&i(null,n))},o=function(e,t){e?console.error(e):a.redrawFolder()},r=a.props.rtdbFolderRef.child("files").child(t.fid),l=r.on("value",function(n){if(null!=a.state.folderViewerItems){var i=e[t.fid],r=n.val();if(!r||!i)return;if(s(r,i,o),function(e,t,a){if(e.scriptEditor){var n=e.scriptEditor;s(n,t,a,!0)}}(r,i,o),r&&i&&(r.lastModifiedBy&&i.lastModifiedBy!==r.lastModifiedBy&&(i.lastModifiedBy=r.lastModifiedBy),null!=i.ts&&null!=r.updated_at)){var l=new Date(i.ts),d=new Date(r.updated_at);l.setSeconds(0,0),d.setSeconds(0,0),l.getTime()!=d.getTime()&&(i.ts=d.toISOString(),o(null))}}});a.updatePropPool.push({fid:t.fid,ref:r,listener:l}),n(null,t)}}(t,n)}});se().parallel(i,function(a,n){a?t&&t(a):t&&t(a,e)})}(e=Ut(e),t)},bindPropUpdater:function(e,t){e=new Set(e);var a=this.state.folderViewerItems.filter(function(t){return e.has(t.fid)});this.buildFolderViewerItems(a,t)},loadFoldersRawItems:function(e){var t=[],a=this.state.sortBy,n=this.state.sortDirection,i=this.state.filteredByType;"ALL"!=i&&t.push("type="+i);var s=Ct(Ct(Ct({},Ot.SORT_BY.LAST_MODIFIED,"updated_at"),Ot.SORT_BY.OWNER,"user_id"),Ot.SORT_BY.NAME,"name");t.push("sortby="+s[a]),t.push("sortdirection="+function(e,t){var a=Ot.SORT_DIRECTION.ASC,n=Ot.SORT_DIRECTION.DESC;return e=e||a,(e=t==Ot.SORT_BY.LAST_MODIFIED?n:e)!=a?"desc":"asc"}(n,a));var o=this.itemStartAt||0;t.push("includeFolder=true"),t.push("start="+o),t.push("length=101"),t.push("includeAppTemplate=true");var r={queryParam:t.join("&"),requestItemLength:101};this.dLoadItems(r,e)},loadItems:function(e,t){var a=e.queryParam,n=e.requestItemLength,i=this.state.selectedFolder;if(null!=this.xhrLoadItems||null!=this.xhrLoadItems)try{this.xhrLoadItems.abort()}catch(e){console.error(e)}this.xhrLoadItems=c().get(At.appendAccessTokenUrl("/dashboard/folder/"+i+"/elements?"+a),function(e,a){if(e)t&&t(e);else{var s=a.body.map(function(e){return e.parents=[i],e}),o=s.length==n;o&&(delete s[s.length-1],s.length--,s.hasMore=o),t&&t(null,s)}})},loadTree:function(e){var t=this;c().get(At.appendAccessTokenUrl("/apiv1/dashboard/folders")).end(function(a,n){if(a)t.props.onNotification("Failed to fetch dashboard folders","error",10,"tc");else{var i=n.body,s=function(e,t){return Ct({},t=t||e.replace(/\s/g,"").toLowerCase(),{fid:t,name:e,parents:{root:!0}})};i.root||(Object.assign(i,s(window.singularUser.account.accountName,"root")),delete i.root.parents,i.root.folders={},Object.keys(i).filter(function(e){return i[e].parents&&i[e].parents.root}).map(function(e){return i.root.folders[e]=!0})),Object.assign(i,s("Favorites")),Object.assign(i,s("My Recent")),Object.assign(i,s("Recent")),Object.assign(i,s("Inbox")),Object.assign(i,s("Trash")),e&&e(i)}})},loadPage:function(e){var t=this;if(this.loadingState>=1)return e&&e("Loadpage was already called.");this.loadingState=1,this.loadUserInfo(function(a,n){a?console.error(a):(t.globalUserTable=n,t.loadTree(function(a){return t.redrawTree({tree:a},function(a){t.gotoFolder(null,null,function(a){t.initTreeRealTimeUpdateMonitor(),t.initFolderRealTimeUpdateMonitor(),t.loadingState=2,e&&e()})})}))})},assignConfig:function(e){var t=this.props,a=null==t.browserStyle?"default":t.browserStyle,n=null==t.browserTitle?"Dashboard":t.browserTitle,i=null==t.useDefaultItemDoubleClick||t.useDefaultItemDoubleClick,s=null==t.autoSelectFirstItem||t.autoSelectFirstItem,o=null==t.showNewButton||t.showNewButton,r=null==t.showTypeSelection?!a.includes("modal"):t.showTypeSelection,l=null!=t.showRevisionSelection&&t.showRevisionSelection,d=null==t.showInspector||t.showInspector,c=t.onItemDoubleClick,p=null==t.showSearch||t.showSearch,u=null==t.filteredByType?"ALL":t.filteredByType;this.currentConfig={browserStyle:null==e.browserStyle?a:e.browserStyle,browserTitle:null==e.browserTitle?n:e.browserTitle,useDefaultItemDoubleClick:null==e.useDefaultItemDoubleClick?i:e.useDefaultItemDoubleClick,autoSelectFirstItem:null==e.autoSelectFirstItem?s:e.autoSelectFirstItem,showNewButton:null==e.showNewButton?o:e.showNewButton,showTypeSelection:null==e.showTypeSelection?r:e.showTypeSelection,showRevisionSelection:null==e.showRevisionSelection?l:e.showRevisionSelection,showInspector:null==e.showInspector?d:e.showInspector,onItemDoubleClick:e.onItemDoubleClick?e.onItemDoubleClick:c,showSearch:null==e.showSearch?p:e.showSearch,filteredByType:null==e.filteredByType?u:e.filteredByType},this.isModal=this.currentConfig.browserStyle.includes("modal")},reloadFolders:function(e){var t=this;if(1==this.reloadingState)return e&&e("Reload folders is busy.");this.reloadingState=1;var a=[function(e){return t.redrawFolderRawItems(void 0,e)},function(e){return t.loadFoldersRawItems(e)},function(e,a){return t.redrawFolderRawItems(e,a)}];se().waterfall(a,function(a,n){a?console.error(a):(t.reloadingState=2,e&&e(null,n))})},loadMoreFolders:function(e){var t=this,a=this.state.folderViewerItems.length;this.itemStartAt=a;var n=[function(e){return t.loadFoldersRawItems(e)},function(e,a){e.length;var n=t.globalUserTable;e.forEach(function(e){if(e&&null!=e.user_id){var t=n[e.user_id]||{};e.owner=t.firstName||""}});var i=t.state.folderViewerItems;i.merge(e),t.redrawFolder({folderViewerItems:i},function(n){var i=e.map(function(e){return e.fid});t.bindPropUpdater(i,a)})}];se().waterfall(n,function(a,n){delete t.itemStartAt,e&&(!a&&e(),a&&e(a))})},windowResized:function(){if(this.setState({browserRectWidth:l().findDOMNode(this.refs.browserMain).getBoundingClientRect().width}),this.state.breadcrumbStack&&this.state.breadcrumbStack.length>1&&this.refs.BreadcrumbParent){for(var e=this.refs.BreadcrumbParent.getBoundingClientRect(),t=this.refs["Breadcrumb-"+(this.state.breadcrumbStack.length-1)],a=0,n=this.state.breadcrumbStack.length;a<n;a++)if(this.refs["Breadcrumb-"+a].style.display="inline-block",1===a){var i=this.refs["Breadcrumb-"+a];i.getElementsByClassName("u-cursor-pointer")[0].style.display="inline-block",i.getElementsByClassName("elips")[0].style.display="none"}for(var s=1,o=this.state.breadcrumbStack.length;s<o;s++){var r=t.getBoundingClientRect();if(r&&void 0!==r.right){if(!(r.right>e.right))break;if(1===s){var d=this.refs["Breadcrumb-"+s];d.getElementsByClassName("u-cursor-pointer")[0].style.display="none",d.getElementsByClassName("elips")[0].style.display="inline-block"}else this.refs["Breadcrumb-"+s].style.display="none"}}}},selectAllItems:function(){this.folderViewerRef&&this.folderViewerRef.selectAllItems()},loadUserInfo:function(e){c().get(At.appendAccessTokenUrl("/apiv1/users/simple"),function(t,a){if(e)if(t)e(t);else{var n=a.body.reduce(function(e,t){return e[t.id]=t,e},{});e(null,n)}})},gotoLastFolder:function(){this.gotoFolder(this.lastFolder)},breadcrumbClicked:function(e){this.gotoFolder(e.currentTarget.id)},localStorageSetItem:function(e,t){try{localStorage.setItem(e,t)}catch(e){}},localStorageGetItem:function(e){try{return localStorage.getItem(e)}catch(e){}},gotoFolder:function(e,t,a){var n=this;if(e==this.state.selectedFolder)return a&&a();if(null==e)e=this.lastFolder;else{this.lastFolder=e;var i="currentFolder-"+window.singularUser.account.accountId;this.localStorageSetItem(i,e)}this.redrawFolder({filter:"",busy:!0},function(i){return function(e,a){var i=[],s=function(e,t){var a=n.state.tree[e];if(a){var o=a.name;i.push({name:o,fid:e}),"root"!==e?s(Object.keys(a.parents)[0],t):(i.reverse(),t&&t())}};s(e,function(s){i.length>0&&!At.isSpecialFolder(i[0].fid)&&n.localStorageSetItem("root","1");for(var o=0;o<i.length-1;o++)n.localStorageSetItem(i[o].fid,"1");(0==i.length||i.length>0&&!At.isSpecialFolder(i[0].fid))&&i.unshift({name:window.singularUser.account.accountName,fid:"root"}),n.redrawTree({selectedFolder:e},function(e){n.loadFoldersRawItems(function(e,s){if(e)console.error(e);else{var o={breadcrumbStack:i,selectedFolder:n.lastFolder,selectedItems:t||[],busy:!1};n.redrawFolderStateRawItems(o,s,function(e){e&&a?a(e):a&&a()})}})})})}(e,a)})},__preserveFidForFile:function(e,t,a){var n=e.type.substring(0,1);e.refId=e.id,t?(e.fid=t[e.id+"_"+n].fid,e.active=t[e.id+"_"+n].active,e.starred=t[e.id+"_"+n].starred,e.folders=t[e.id+"_"+n].folders):a?(e.fid=a.fid,e.active=a.active,e.starred=a.starred,e.folders=a.folders):e.fid=e.id+"_"+n},onGlobalSearch:function(e){var t=this;if(e){var a={name:window.singularUser.account.accountName+" - Search",fid:"root"},n=[function(e){return t.redrawTree({selectedFolder:void 0,breadcrumbStack:[a]},e)},function(e){return t.redrawFolderStateRawItems({folderViewerErrorMsg:""},void 0,e)},function(a){c().get(At.appendAccessTokenUrl("/apiv1/browser/search?q="+e)).set("Content-Type","application/json").end(function(e,t){var n=!1;if(e){var i=e.response.body.message||"";(n=i.startsWith("Please refine your search."))&&this.redrawFolder({folderViewerErrorMsg:i})}if(e&&0==n)a("Cannot search browser items");else{t.headers.location&&(window.location=t.headers.location);var s=[];0==n&&(s=t.body).forEach(function(e){e.type=Mt.BROWSERITEM_FULLNAME_MAP_REV[e.type],e.refId=e.id,e.ts=e.updated_at}),this.redrawFolderRawItems(s)}}.bind(t))},function(e,a){e.isSearchResult=!0,t.redrawFolderRawItems(e,a)}];se().waterfall(n,function(e,t){})}},onClearSearch:function(){this.gotoLastFolder()},toggleInspector:function(e){this.setState({toggleInspector:e})},toggleFilteredByOwner:function(e){this.setState({filteredByOwner:e})},toggleViewStyle:function(e){this.setState({viewStyle:e})},selectItems:function(e,t){var a=this;e=e.filter(function(e){return!a.state.loadingItemIds.has(e.fid)}),this.redrawFolder({selectedItems:e},t)},config:function(e){this.assignConfig(e)},updateConfig:function(e){this.currentConfig=At.extend(!0,this.currentConfig,e)},filterByType:function(e){this.setState({filteredByType:e}),this.currentConfig.saveSelectedFilter&&this.localStorageSetItem("dashboard_filter",e)},parseTreeCmd:function(e,t,a){var n,i=this,s=function(e,a){i.redrawTree({loadingItemIds:i.ldDel(function(e){return null!=e.fid?[e.fid]:null!=e.ids?e.ids:null!=e.sourceFids?e.sourceFids:[]}(e))},function(n){a&&a(null,Object.assign(e,{cmdType:t}))})},o=e.action,r=this.state.tree;switch(o){case"restoreFolder":e.dependFoIds||(e.dependFoIds=[]);var l=e.dependFoIds.filter(function(e){return"favorites"!=e.parent});l.forEach(function(e){var t=e.fid,a=e.parent,n=Ct({},a,!0),i={fid:t,name:e.name,type:"fo",parents:n},s=r[t]?r[t]:{};r[t]=Object.assign(s,i),r[a]||(r[a]={folders:Ct({},t,!0)}),r[a].folders||(r[a].folders=Ct({},t,!0)),r[a].folders[t]||(r[a].folders[t]=!0)}),r.action={type:"nops",fids:new Set(l.map(function(e){return e.id}))},Ct({},this.state.selectedFolder,!0),s(e,a);break;case"new":var d=e.fid,c=e.parent,p=Ct({},c,!0),u={fid:d,name:e.name,type:"fo",parents:p};r[d]=u,r[c]||(r[c]={}),r[c].folders||(r[c].folders={}),r[c].folders[d]=!0,s(e,a);break;case"res":case"del":case"removeFolder":var m=e.fid,h=e.fids||e.ids,f=this.state.tree,g=this.state.selectedFolder;m?(f.action={type:o,fids:new Set([m])},Object.keys(f[m].parents)[0],delete this.state.tree[m],s(e,a)):h?(f.action={type:o,fids:new Set(h)},h.forEach(function(e){delete f[e],g&&f[g]&&function(e,t){return f[e].folders&&f[e].folders[t]}(g,e)&&delete f[g].folders[e]}),Ct({},g,!0),s(e,a)):s(e,a);break;case"upt":case"ren":var v=e.fid;if(null==r[v])break;e.name&&(r[v].name=e.name),r.action={type:o,fid:v},Object.keys(r[v].parents)[0],s(e,a);break;case"mov":var b=e.sourceFids.filter(function(e){return null!=r[e]}),y=b.map(function(e){return r[e]}),w=e.targetFid,E=y.map(function(e){return e.fid}),I=(n=y.map(function(e){return Ct({},e.fid,!0)}))&&n.length?Object.assign.apply(Object,xt(n)):{};if(y.length&&y[0].parents){var N=Object.keys(y[0].parents)[0],S=r[N],C=r[w];S&&C&&(S.folders&&(E.forEach(function(e){return delete S.folders[e]}),!Object.keys(S.folders).length&&delete S.folders),C.folders=C.folders||{},Object.assign(C.folders,I),y.map(function(e){return e.parents=Ct({},w,!0)}),r.action={type:o,fids:new Set([].concat(xt(E),[w]))})}s(e,a);break;case"fav":e.byUserId===window.singularUser.id&&e.ids.forEach(function(e){r[e]&&(r[e].favorite=!0)}),s(e,a);break;case"ufv":e.byUserId===window.singularUser.id&&e.ids.forEach(function(e){r[e]&&delete r[e].favorite}),s(e,a)}},parseFolderCmd:function(e,t,a){var n=this,i=function(e){e||(e={}),Object.keys(e).forEach(function(t){e[t]&&"object"===Dt(e[t])?i(e[t]):null!=e[t]&&null!=e[t]||delete e[t]})};i(e);var s=window.singularUser.id,o=this.state.folderViewerItems=Ut(this.state.folderViewerItems);e.items&&e.items.length&&e.items.forEach(function(t){t.byUserIds&&t.byUserIds.length&&(new Set(t.byUserIds).has(window.singularUser.id)?(e.byUserId=s,t.favorite=!0):delete t.favorite)});var r,l,d=function(e){var t=function(e){return e.ids?new Set(e.ids):e.fids?new Set(e.fids):e.fid?new Set([e.fid]):e.items?new Set(e.items.map(function(e){return e.fid})):new Set([])}(e);return o.keys().filter(function(e){return t.has(e)}).length>0}(e),c=e.byUserId===s,p=this.state.selectedFolder,u=p===e.parent,m="favorites"===p,h="favorites"===e.parent,f="trash"===p,g=e.action,v=function(a,i){var s={loadingItemIds:n.ldDel(a)},o="new"==g?Object({busy:!1},s):s;n.redrawFolder(o,function(a){i&&i(null,Object.assign(e,{cmdType:t}))})};switch(g){case"new":u&&(d?v([e.fid],a):function(e){e.promptToRenameId&&(e.promptToRenameId==n.browserId&&(e.promptToRename=!0),delete e.promptToRenameId),o.cmd=e,v([e.fid],function(t){return n.bindPropUpdater([e.fid],function(t,n){a&&(t?a(t):a(null,e))})})}(e));break;case"res":var b=(l=p,e.items.filter(function(e){return e.parents[0]==l||m&&e.favorite})),y=p==e.parentFid,w=b.length>0;y&&(o.cmd=e,v(e.ids,a)),!e.targetFid&&b.length&&(e.targetFid=b[0].parents[0]),w&&(o.cmd=e,v(e.ids,function(t){return n.bindPropUpdater(e.ids,function(t,n){a&&(t?a(t):a(null,e))})}));break;case"mov":if(m||"recent"==p||"myrecent"==p)v(e.ids,a);else{var E=p==e.parentFid,I=p==e.targetFid;E&&(o.cmd=e,v(e.ids,a)),I&&(o.cmd=e,v(e.ids,a))}break;case"del":var N=function(t){o.cmd=e,v(e.ids,a);var i=new Set(e.ids);n.updatePropPool.filter(function(e){return i.has(e.fid)}).forEach(function(e){return e.ref.off("value",e.listener)}),n.updatePropPool=n.updatePropPool.filter(function(e){return!i.has(e.fid)})},S="trash"==e.parent;f&&S&&d&&N(),!f||S||d||(r=n.globalUserTable,e.action="new",e.items.map(function(e){return null!=e.user_id&&(e.owner=r[e.user_id].firstName),delete e.favorite,e}),o.cmd=e,v(e.ids,a)),f||!d||!m&&h||N();break;case"fav":case"ufv":c&&(m?("fav"!=g||d||(e.action="new",o.cmd=e,v(e.ids,function(t){return n.bindPropUpdater(e.ids,function(t,n){a&&(t?a(t):a(null,e))})})),"ufv"==g&&d&&(e.action="del",o.cmd=e,v(e.ids,a))):d&&(o.cmd=e,v(e.ids,a)));break;case"ren":case"upt":d&&(o.cmd=e,v([e.fid],a));break;case"emt":f&&this.reloadFolders(function(t){console.log("Empty trash",e.message),n.redrawFolder({busy:!1})})}},onTreeFolderAdd:function(e){var t,a=this;if(e)t=e,c().post(At.appendAccessTokenUrl("/dashboard/folder")).send(t).end(function(e,n){if(e){a.props.onNotification("Failed to create dashboard folder","error",10,"tc");var i={action:"del",ids:[t.fid]};a.parseFolderCmd(i,St.CmdType.BROWSER)}});else{var n={action:"new",fid:Tt.v4(),name:"New Folder",parent:!this.state.selectedFolder||At.isSpecialFolder(this.state.selectedFolder)?"root":this.state.selectedFolder,promptToRename:!0};this.parseFolderCmd(n,St.CmdType.BROWSER)}},onTreeFolderDelete:function(){var e=this.state.selectedFolder;this.removeSelectedItems(e)},warningOnTreeFolderRename:function(){this.setState({showConfirmFolderDelete:!0,confirmFolderMessage:"Are you sure you want to delete this folder?"})},onTreeFolderRename:function(e){var t=this;if(this.state.selectedFolder&&!At.isSpecialFolder(this.state.selectedFolder)){var a=this.state.selectedFolder;this.redrawTree({loadingItemIds:this.ldAdd([a])},function(){var a={action:"renameFolder",fid:t.state.selectedFolder,newName:e};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(a).end(function(e,a){e&&t.props.onNotification("Failed to rename dashboard folder","error",10,"tc")})})}},warningRemoveSelectedItems:function(){var e;this.state.selectedItems&&this.state.selectedItems.length&&(e=1==this.state.selectedItems.length?"Are you sure you want to move "+this.state.selectedItems[0].name+" into Trash?":"Are you sure you want to move these items into Trash?",this.setState({showConfirmDelete:!0,confirmDeleteMessage:e}))},removeSelectedItems:function(e){var t=this,a=e?[e]:this.state.selectedItems.map(function(e){return e.fid});this.redrawAll({loadingItemIds:this.ldAdd(a)},function(n){return t._deleteItems(a,function(n,i){var s=function(e){console.warn("Someting went wrong during deletion"),t.redrawTree({loadingItemIds:t.ldDel(a)})};i?(i.error_fid_list||[]).length&&s():n&&s();if(null!=e){var o=t.state.tree[e],r=Object.keys(o.parents);t.gotoFolder(r)}})})},onSplitResize:function(e){this.localStorageSetItem("dashboardSplitPane",e),this.setState({splitPanePosition:e}),this.props.onVerticalPaneChanged&&this.props.onVerticalPaneChanged(e)},__changeDeleteFlag:function(e,t,a){var n=t.filter(function(e){return e.refId}).map(function(e){return{refId:e.refId,type:e.type}});n.length&&c().post(At.appendAccessTokenUrl("/apiv1/browser/items?method="+e)).send(n).end(function(e,t){e?console.log("Cannot change delete status"):(t.headers.location&&(window.location=t.headers.location),a&&a())})},restoreSelectedItems:function(){var e=this,t=this.state.selectedItems,a=this.ldAdd(t.map(function(e){return e.fid}));this.redrawFolder({loadingItemIds:a},function(){t.map(function(e){return e.fid}),e._restoreItems(t)})},restoreSelectedItemsTo:function(e,t){var a=e.map(function(e){return e.fid}),n=this.ldAdd(a);this.redrawFolder({loadingItemIds:n},function(){var e={action:"restoreItemsTo",ids:a,to:t};a.length&&c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(e).end(function(e,t){})})},addSelectedItemsToFavorites:function(e,t){var a,n=this,i=e?(a=e,Object.assign({favorite:!0},a)):null,s=i?[i]:this.state.selectedItems,o=s.map(function(e){return e.fid}),r=o;i?i.parents[0]:this.state.selectedFolder,function(e){n.redrawAll({loadingItemIds:n.ldAdd(e)},function(e){return function(e,t){return n._addToFavorites(e,t)}(s,function(e){return e&&console.error(e)})})}(r)},removeSelectedItemsFromFavorites:function(e,t){var a=this;e&&delete e.favorite;var n=e?[e]:this.state.selectedItems,i=n.map(function(e){return e.fid});e?e.parents[0]:this.state.selectedFolder,function(e){a.redrawAll({loadingItemIds:a.ldAdd(e)},function(e){return function(e,t){return a._removeFromFavorites(e,t)}(n,function(e){return e&&console.error(e)})})}(i)},renameSelectedItems:function(e,t){var a=this;if(e)if(this.state.selectedItems.length>1)console.log("Multi selection is not supported for item rename");else{var n,i,s=t;i={loadingItemIds:a.ldAdd([s.fid])},"fo"==s.type?a.redrawAll(i,function(t){return function(t){var a={action:"renameFolder",fid:s.fid,newName:e};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(a).end(function(e,a){e?console.error(e):t&&t()})}(n)}):a.redrawFolder(i,function(t){return function(t){var a=At.appendAccessTokenUrl(At.getApiEndpointFromBrowserShortType(s.type)+s.refId+"/metadata");c().put(a).send({name:e}).set("Content-Type","application/x-www-form-urlencoded").end(function(e,a){e?console.error(e):t&&t()})}(n)})}},onTreeFolderAddToFavorites:function(){var e=this.state.selectedFolder,t=this.state.tree[e];this.addSelectedItemsToFavorites(t,function(e){return!e&&(t.favorite=!0)})},onTreeFolderRemoveToFavorites:function(){var e=this.state.selectedFolder,t=this.state.tree[e];this.removeSelectedItemsFromFavorites(t,function(e){return!e&&delete t.favorite})},onCompositionAdd:function(){this.newItem(Mt.COMPOSITION)},onJsonAdd:function(){this.newItem(Mt.JSON)},onChangeFilter:function(e){this.props.onChangeFilter?this.props.onChangeFilter(e):this.filterByType(e)},_addToFavorites:function(e,t){var a={action:"addToFavorites",ids:e.map(function(e){return e.fid}),userId:window.singularUser.id};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(a).end(function(e,a){e&&console.error(e),t&&t(e,a)})},_removeFromFavorites:function(e,t){var a={action:"removeFromFavorites",ids:e.map(function(e){return e.fid}),userId:window.singularUser.id};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(a).end(function(e,a){e&&console.error(e),t&&t(e,a)})},_deleteItems:function(e,t){if(e.length){var a={action:"removeItems",ids:e};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(a).end(t)}},_restoreItems:function(e){var t,a=e.filter(function(e){return"fo"===e.type}),n=e.filter(function(e){return"fo"!==e.type});(t={action:"restoreItems",foIds:a.map(function(e){return e.fid}),fiIds:n.map(function(e){return{refId:e.refId,type:e.type}})}).foIds.concat(t.fiIds).length&&t.action&&c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(t).end(function(e,t){})},initFolderRealTimeUpdateMonitor:function(e){var t=this,a=function(e,a,n){var i=e.val();if(null==i)return n&&n(null,"Cmd is undefined");t.parseFolderCmd(i,a,n)},n=this.props.rtdbFolderRef.child("notification_folders").child("changed");n.child("cmdServer").on("value",function(t){return a(t,St.CmdType.SERVER,e)}),n.child("cmdWorker").on("value",function(t){return a(t,St.CmdType.WORKER,e)})},initTreeRealTimeUpdateMonitor:function(e){var t=this,a=function(e,a,n){var i=e.val();if(null==i)return n&&n("Cmd is undefined");t.parseTreeCmd(i,a,n)},n=this.props.rtdbFolderRef.child("notification_tree_items").child("changed");n.child("cmdServer").on("value",function(t){return a(t,St.CmdType.SERVER,e)}),n.child("cmdWorker").on("value",function(t){return a(t,St.CmdType.WORKER,e)})},newItem:function(e){"folder"!=e?At.getApiEndpointFromBrowserShortType(e)&&this.showNewItemNameModal(e):this.onTreeFolderAdd()},showNewItemNameModal:function(e,t){var a;this.setState({preparedNewItem:{type:e,additionalFields:t},newItemDialogTitle:"New "+At.getNiceNameFromBrowserShortType(e),newItemDialogPlaceholder:"Please enter "+At.getNiceNameFromBrowserShortType(e)+" name"}),a=t&&t.defaultName?t.defaultName+" app":"New "+At.getNiceNameFromBrowserShortType(e),$(this.refs.newItemNameInput).val(a),$(this.refs.nameInputModal).modal("show"),$(this.refs.nameInputModal).off("show.bs.modal"),$(this.refs.nameInputModal).on("shown.bs.modal",function(){$(this.refs.newItemNameInput).select()}.bind(this))},onInputNameKeyPress:function(e){"Enter"===e.key&&(this.onNewItemNameEntered(),this.hideNewItemNameModal())},hideNewItemNameModal:function(){$(this.refs.nameInputModal).modal("hide")},onNewItemNameEntered:function(){this.postNewItem($(this.refs.newItemNameInput).val())},postNewItem:function(e,t){var a=this;if(this.state.preparedNewItem&&e){void 0===t&&(t=!0),this.setState({busy:!0});var n=this.state.preparedNewItem.additionalFields,i="myshows"==this.state.selectedFolder||!At.isSpecialFolder(this.state.selectedFolder),s={folder:this.state.selectedFolder&&i?this.state.selectedFolder:"root",name:e};n&&(s=$.extend(!0,s,n)),this.state.openAppWith&&this.setState({openAppWith:null});var o=this.state.preparedNewItem.type;c().post(At.appendAccessTokenUrl(At.getApiEndpointFromBrowserShortType(o)+"?updateDashboard=1")).send(s).end(function(e,t){if(e){var n="Failed to create "+At.getNiceNameFromBrowserShortType(o);"ai"==o&&(n+=". Make sure that control node IDs in composition do not include these characters . $ # [ ] /"),a.props.onNotification(n,"error",20,"tc"),a.setState({busy:!1})}})}},openItemInNewWindow:function(e){if(e||(e=this.state.selectedItems[this.state.selectedItems.length-1]),e.activeUsers&&this.currentConfig.useDefaultItemDoubleClick){var t=e.activeUsers[Object.keys(e.activeUsers)[0]],a="This composition is currently being edited by user "+t+". Clicking OK will close the composition editor for user "+t+" and allow you to edit this composition.";this.setState({confirmOpenMessage:a})}else"fo"!=e.type||this.props.dblClicktoSelectedFolder?this._openItem(e):this.gotoFolder(e.fid)},openScriptEditor:function(){var e=this.state.selectedItems[this.state.selectedItems.length-1];if(At.compareDashboardItemType(e.type,Mt.COMPOSITION)){var t=window.singularUrlBase+"compositions/"+e.refId+"/script";window.open(t)}},_openItem:function(e){e||(e=this.state.selectedItems[this.state.selectedItems.length-1]);var t=e.type,a="";if(At.compareDashboardItemType(t,Mt.DATANODE))a=window.singularUrlBase+"apiv1/datanodes/"+e.refId+"/data";else if(At.compareDashboardItemType(t,Mt.ASSET))a=window.singularUrlBase+"apiv1/mediatoS3/"+e.refId+"/content";else if(At.compareDashboardItemType(t,Mt.APPINSTANCE))a=window.singularUrlBase+"appinstances/"+e.refId+"/control";else if(At.compareDashboardItemType(t,Mt.DEVICE))a=window.singularUrlBase+"devices/"+e.refId+"/edit";else if(At.compareDashboardItemType(t,Mt.FOLDER))a="";else if(At.compareDashboardItemType(t,Mt.AUDIO))a=window.singularUrlBase+"apiv1/audios/"+e.refId+"/content";else if(At.compareDashboardItemType(t,Mt.JSON))a=window.singularUrlBase+"apiv1/jsons/"+e.refId+"/content";else if(At.compareDashboardItemType(t,Mt.DATA))a=e.url;else if(At.compareDashboardItemType(t,Mt.VIDEO)){if(this.currentConfig.useDefaultItemDoubleClick)return void this.showVideoPlayer(e);a=e.url}else a=window.singularUrlBase+"compositions/"+e.refId+"/edit";this.currentConfig.onItemDoubleClick&&this.currentConfig.onItemDoubleClick(e),this.currentConfig.useDefaultItemDoubleClick&&(window.open(a),this.props.rtdbFolderRef.child("files").child(e.fid).child("activeUsers").remove())},showVideoPlayer:function(e){this.setState({showVideoPlayer:!0,currentVideoItem:e})},closeVideoPlayer:function(){this.setState({showVideoPlayer:!1,currentVideoItem:null})},handleVideoPlayerKeyDown:function(e){"Escape"===e.key&&this.state.showVideoPlayer&&this.closeVideoPlayer()},duplicateItem:function(e){var t=this;if(this.state.selectedItems.length>1)console.log("Multi selected does not support for this menu");else{var a,n=this.state.selectedItems[0];a=this.state.selectedFolder?this.state.selectedFolder:Object.keys(n.folders)[0],this.redrawFolder({loadingItemIds:this.ldAdd([n.fid])},function(){return c().post(At.appendAccessTokenUrl(At.getApiEndpointFromBrowserShortType(n.type)+n.refId+"/duplicate")).send({folder:a,promptToRenameId:t.browserId}).end(function(e,t){e&&(this.props.onNotification("Cannot make a copy of selected item","error",10,"tc"),t&&console.log(t.body)),this.redrawFolder({loadingItemIds:this.ldDel([n.fid])})}.bind(t))})}},locateItem:function(){var e=this;if(1==this.state.selectedItems.length){var t=At.appendAccessTokenUrl("/dashboard/file/"+this.state.selectedItems[0].fid+"/folders");c().get(t,function(t,a){if(!t){for(var n,i=0;i<a.body.length;i++)if("favorites"!=a.body[i]){n=a.body[i];break}n?e.gotoFolder(n,[e.state.selectedItems[0]]):e.props.onNotification("Failed to locate parent folder of item","error",10,"tc")}})}},downloadUrl:function(e,t){var a=this;try{var n=document.createElement("a");return n.href=e,t&&(n.download=t),n.style.display="none",document.body.appendChild(n),n.click(),void document.body.removeChild(n)}catch(e){}fetch(e,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw new Error("Network response was not ok");return e.blob()}).then(function(e){var a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t||"download",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(function(){return URL.revokeObjectURL(a)},1e4)}).catch(function(e){a.props&&a.props.onNotification?a.props.onNotification("Failed to download file","error",10,"tc"):console.error("downloadUrl error",e)})},deleteForever:function(){var e=this,t=this.state.selectedItems.map(function(e){return e.fid});this.redrawFolder({loadingItemIds:this.ldAdd(t)},function(){t.length&&c().post(At.appendAccessTokenUrl("/apiv1/browser/items?method=deleteforever")).send(t).end(function(t,a){t&&e.props.onNotification("Failed to delete browser items","error",10,"tc")})})},toggleMobileNav:function(e){if(null==e)this.setState({showMobileNav:!this.state.showMobileNav});else{var t=!this.state.showMobileNav;this.setState({showMobileNav:t})}},renderBreadcrumb:function(){var e=this;return i().createElement("ul",{className:"singular-browser-breadcrumb",style:{display:"flex",whiteSpace:"nowrap"}},i().createElement("li",{className:"mobile-menu",onClick:this.toggleMobileNav.bind(this,!0)},i().createElement("i",{className:"fa fa-bars"})),this.state.breadcrumbStack.map(function(t,a){var n=t.fid,s=t.name;return i().createElement("li",{key:n,id:n,onClick:e.breadcrumbClicked,ref:"Breadcrumb-"+a},i().createElement("a",{className:"u-cursor-pointer"},s),1===a&&i().createElement("a",{className:"u-cursor-pointer elips",style:{display:"none"}},"..."))}))},_moveItems:function(e,t,a,n){if(e.length){var i={action:"movetofolder",itemFids:e.map(function(e){return e.fid}),from:t,to:a};c().put(At.appendAccessTokenUrl("/dashboard/elements")).send(i).end(function(t){t?n(t):(e.forEach(function(e){return e.parents[0]=a}),n())})}},dropItems:function(e){var t=this,a="trash"==this.state.selectedFolder,n="trash"==e.fid,i="favorites"==e.fid;if(this.state.selectedFolder,!n&&!i&&!a){var s=e.fid,o=this.state.selectedItems.map(function(e){return e.fid}),r=this.state.selectedFolder;!function(e){t.redrawAll({loadingItemIds:t.ldAdd(e)},function(e){return function(e,a,n,i){return t._moveItems(e,a,n,i)}(t.state.selectedItems,r,s,function(e){return e&&console.error(e)})})}(o)}n&&(this.removeSelectedItems(),this.redrawFolder()),i&&(this.addSelectedItemsToFavorites(),this.redrawFolder()),a&&this.restoreSelectedItemsTo(this.state.selectedItems,e.fid)},showSendItem:function(){if(this.state.selectedItems&&this.state.selectedItems.length){for(var e=[],t=0;t<this.state.selectedItems.length;t++)e.push({label:this.state.selectedItems[t].name,value:this.state.selectedItems[t]});this.setState({sendToUserItems:e}),$("#sendToUserModal").modal("show")}else this.setState({sendToUserItems:[]})},closeSendItem:function(){1==this.state.sendingInProgress&&(this.setState({sendingInProgress:!1}),this.sendToUserTasks=[]),$("#sendToUserModal").modal("hide")},submitSendItem:function(){if(this.state.sendToUserItems&&this.state.sendToUserItems.length)if(this.state.emailValues&&this.state.emailValues.length){this.setState({sendingInProgress:!0}),this.sendToUserTasks=[];for(var e=0;e<this.state.emailValues.length;e++)for(var t=0;t<this.state.sendToUserItems.length;t++)this.sendToUserTasks.push({user:this.state.emailValues[e].value,type:this.state.sendToUserItems[t].value.type,ID:this.state.sendToUserItems[t].value.refId});this.processSendElementsToUserTasks()}else this.props.onNotification("Please enter a valid email address","error",10,"tc");else this.props.onNotification("Select item to send","error",10,"tc")},showExportComposition:function(){var e=this.state.selectedItems.filter(function(e,t){return"ai"==e.type});if(e.length>0){var t=e[0];t.refId,this.setState({exportCompositionDefaultName:"",exportCompositionName:"",exportCompInProcess:!0,exportCompError:!1,exportCompProcessMsg:"Extracting composition from control app",exportCompositionButtonDisabled:!0}),$("#exportCompositionModal").modal("show"),this.setState({exportCompositionDefaultName:t.name,exportCompositionName:t.name,exportCompInProcess:!1,exportCompProcessMsg:"",exportCompositionButtonDisabled:!1})}},onExportCompositionChange:function(e){var t=!1;""==e.target.value.trim()&&(t=!0),this.setState({exportCompositionName:e.target.value,exportCompositionButtonDisabled:t})},onExportCompositionKeyPress:function(e){"Enter"===e.key&&0==this.state.exportCompositionButtonDisabled&&this.onExportComposition()},onExportComposition:function(){var e=this.state.selectedItems.filter(function(e,t){return"ai"==e.type});if(0==e.length)return this.props.onNotification("Please select a control app to extract from","error",10,"tc"),void this.closeExportComposition();this.setState({exportCompInProcess:!0,exportCompProcessMsg:"Extracting ...",exportCompositionButtonDisabled:!0});var t="myshows"==this.state.selectedFolder||!At.isSpecialFolder(this.state.selectedFolder),a=(this.state.selectedFolder&&t&&this.state.selectedFolder,e[0].refId),n=this.state.exportCompositionName||"";""==n&&(n=this.state.exportCompositionDefaultName);var i="/apiv1/appinstances/"+a+"/export";c().post(i).send({outputName:n}).then(function(e){this.closeExportComposition(),this.props.onNotification("Composition extracted successfully. When ready to operate, open into a brand new control app.","success",30,"tc")}.bind(this)).catch(function(e){this.setState({exportCompInProcess:!1,exportCompProcessMsg:e.response.body.error.message,exportCompError:!0})}.bind(this))},onEditComposition:function(){var e=this,t=this.state.selectedItems.filter(function(e,t){return"ai"==e.type})[0];this.setState({busy:!0}),kt.editComposition(t.refId,t.name,function(t,a){e.setState({busy:!1}),t?e.setState({showInfoMessage:!0,infoMessage:t}):window.open("/compositions/"+a.compId+"/edit")})},closeExportComposition:function(){this.setState({exportCompInProcess:!1,exportCompositionName:"",exportCompProcessMsg:"",exportCompositionButtonDisabled:!1}),$("#exportCompositionModal").modal("hide")},fetchCompositionInfo:function(e){this.fetchCompositionInfoRequest&&this.fetchCompositionInfoRequest.abort(),this.fetchCompositionInfoRequest=c().get("/apiv1/compositions/"+e).set("Content-Type","application/json").end(function(e,t){if(e)he.A.add(he.A.TYPE.ERROR,{title:"Cannot fetch composition details",description:e.message});else{var a=t.body;if(a.appTemplateId){this.setState({busy:!1});var n={id:a.appTemplateId};this.onSelectAppTemplate(n)}else this.setState({busy:!1}),this.refs.appTemplateBrowser&&$(l().findDOMNode(this.refs.appTemplateBrowser)).modal("show")}this.fetchCompositionInfoRequest=null}.bind(this))},showOpenWith:function(){this.state.selectedItems&&1==this.state.selectedItems.length&&"c"==this.state.selectedItems[0].type?(this.setState({openAppWith:this.state.selectedItems[0],busy:!0}),this.fetchCompositionInfo(this.state.selectedItems[0].refId)):this.setState({showSelectCompMessage:!0})},uploadAsset:function(){this.refs.assetUploadDropzone.open()},processSendElementsToUserTasks:function(){var e=this;if(!this.sendToUserTasks.length)return this.setState({sendingInProgress:!1}),void this.closeSendItem();var t={};this.state.sendToUserEmail&&(t.sendEmail=1,t.emailMessage=this.state.sendToUserEmailMessage);var a,n=this.sendToUserTasks.shift();if(this.setState({numberOfItemsToSendLeft:this.sendToUserTasks.length+1}),t.target_email=n.user,At.compareDashboardItemType(n.type,Mt.COMPOSITION))a="/apiv1/compositions/duplicateto",t.comp_id=n.ID;else{if(!At.compareDashboardItemType(n.type,Mt.APPINSTANCE))return void this.processSendElementsToUserTasks();a="/apiv1/appinstances/duplicateto",t.app_id=n.ID}var i=At.appendAccessTokenUrl(a);c().post(i).send(t).set("Content-Type","application/x-www-form-urlencoded").end(function(t,a){t&&e.props.onNotification("Failed to send item","error",10,"tc"),e.processSendElementsToUserTasks()})},sendToUserValueChanged:function(e,t){"sendEmail"==e?this.setState({sendToUserEmail:t.target.checked}):"sendEmailMessage"==e&&this.setState({sendToUserEmailMessage:t.target.value})},onFilterChange:function(e){this.setState({filter:e.target.value})},onFilterKeyPress:function(e){"Enter"===e.key&&this.onGlobalSearch(this.state.filter)},onFilterKeyDown:function(e){switch(e.key){case"Tab":this.onGlobalSearch(this.state.filter);break;case"Escape":this.clearFilter()}},clearFilter:function(){this.setState({filter:""}),this.gotoLastFolder()},handleSendElementChange:function(e){this.setState({sendToUserItems:e})},sendToUserEmailInvalid:function(){for(var e=0;e<this.state.emailValues.length;e++)if("invalid"==this.state.emailValues[e].className)return!0;return!1},handleEmailChange:function(e){var t=[];this.scSendToEmailPreviousInputValue="",this.scSendToEmailCurrentInputValue="";for(var a=0;a<e.length;a++)if("Select-create-option-placeholder"==e[a].className){t.push({className:"checking",label:e[a].label,value:e[a].value}),this.setState({checkingEmail:!0});var n=e[a].value;c().post(At.appendAccessTokenUrl("/apiv1/users/checkemail")).send({email:n}).set("Content-Type","application/x-www-form-urlencoded").end(function(e,t){var a="invalid";if(this.setState({checkingEmail:!1}),e&&400!=t.body.code)this.props.onNotification("Email verification failed","error",10,"tc");else{"yes"==t.body&&(a="valid");for(var i=[],s=0;s<this.state.emailValues.length;s++)this.state.emailValues[s].value==n?i.push({className:a,label:this.state.emailValues[s].label,value:this.state.emailValues[s].value}):i.push(this.state.emailValues[s]);this.setState({emailValues:i})}}.bind(this))}else t.push(e[a]);this.setState({emailValues:t})},handleInputEmailChange:function(e){return this.scSendToEmailPreviousInputValue=this.scSendToEmailCurrentInputValue,this.scSendToEmailCurrentInputValue=e,e},handleEmailBlur:function(e){var t=e.target.value;if(""==t&&""!=this.scSendToEmailPreviousInputValue&&""==this.scSendToEmailCurrentInputValue&&(t=this.scSendToEmailPreviousInputValue),t){var a=this.state.emailValues.slice();a.push({className:"Select-create-option-placeholder",label:t,value:t}),this.handleEmailChange(a)}},newItemLabel:function(e){return"Add "+e},toggleSendMessage:function(){this.setState({sendEmail:!this.state.sendEmail})},onSelectAppTemplate:function(e){var t={apptemplate_id:e.id};e.status&&(t.apptemplate_version_status=e.status),this.state.openAppWith&&(t.compositionList=[{name:this.state.openAppWith.name,composition:{refId:this.state.openAppWith.refId}}],t.defaultName=this.state.openAppWith.name),this.showNewItemNameModal(Mt.APPINSTANCE,t)},changeSortBy:function(e,t){var a=this;this.setState({sortBy:e,sortDirection:t},function(t){var n=a.state.selectedFolder;"inbox"!=n&&!n.includes("recent")&&a.localStorageSetItem("dashboardSortBy",e)})},dragStarted:function(){this.setState({isDragging:!0})},dragFinished:function(){this.setState({isDragging:!1})},onDropFilesIntoFolderViewer:function(e,t){var a,n=this,i=(a=!At.isSpecialFolder(n.state.selectedFolder),n.state.selectedFolder&&a?n.state.selectedFolder:"root"!==n.state.selectedFolder?null:"root");if(i){var s=function(e){e.status};!function(e,t){!function(e,t){var a=[],o=[];e.forEach(function(e){var t;"jpg"==(t=e.name.split(".").pop())||"jpeg"==t||"png"==t||"apng"==t||"webp"==t||"gif"==t||"svg"==t?a.push(e):o.push(e)}),function(e,t,a){a=a.filter(function(e){return"DataTransferItem"!=e.constructor.name}),e.validate=function(t){var a=e.length;e.forEach(function(n,i){!function(e){e.preview=window.URL.createObjectURL(e)}(n);var s=new Image;s.onload=function(){a-1==i&&t&&t(e)},s.onerror=function(){n.invalid=!0,a-1==i&&t&&t(e)},s.src=n.preview})};var o=0,r=function(e){setTimeout(function(){e.invalid?n.refs.AssetUploadManager.AddFile(e,i,"error",s):n.refs.AssetUploadManager.AddFile(e,i,null,s)},200*o),o++};e.validate(function(e){e.forEach(function(e){r(e)})}),t.forEach(function(e){e.invalid&&(e.preview="/images/broken-file.png");var t,a=e.name.split(".").pop();"json"==(a=a.toLowerCase())&&(e.preview="/images/default-json-icon.png"),("mp3"==(t=a)||"wav"==t||"ogg"==t)&&(e.preview="/images/default-audio-icon.png")}),t.forEach(function(e){r(e)}),a.forEach(function(e){return n.refs.AssetUploadManager.AddFile(e,i,"invalid",s)})}(a,o,t)}(e,t)}(e,t)}},modalClose:function(e){$("#".concat(e)).modal("toggle")},exportToCSV:function(){var e,t,a,n=this,i=this.state.selectedItems.map(function(e){return e.fid}),s=this.state.folderViewerItems;e=i.filter(function(e){return"ai"==s[e].type}).map(function(e){return s[e].refId}),t=function(e,t){if(e)return console.error(e);var a=i.map(function(e){return{updated_at:(a=s[e]).updated_at,created_at:a.created_at,url:a.url&&0!==a.url.length?a.url:t[a.refId]?t[a.refId]:"",name:a.name,type:(n=a.type,Mt.BROWSERITEM_FULLNAME_MAP[n])};var a,n}),o=n.state.selectedFolder,r=n.state.tree[o].name,l="data:text/csv;charset=utf-8,"+(0,kt.obj2csv)(a),d=encodeURI(l),c=document.createElement("a");c.setAttribute("href",d),c.setAttribute("download","dashboard items "+r+".csv"),document.body.appendChild(c),c.click()},a={},se().every(e,function(e,t){c().get("/apiv1/appinstances/"+e).set("Content-Type","application/json").end(function(n,i){if(n)t&&t(n);else{var s=i.body.onair_url;a[e]=s,t&&t(null,!0)}})},function(e,n){return n?t(null,a):t(e)})},emptyTrash:function(e){var t=this;this.redrawFolder({busy:!0},function(e){return c().post(At.appendAccessTokenUrl("/dashboard/folder/trash/emptytrash")).end(function(e,a){e&&t.props.onNotification("Failed to Empty Trash","error",10,"tc")})})},updateItems:function(e){var t=e.reduce(function(e,t){return Object.assign(e,Ct({},t.fid,t))},{}),a=new Set(Object.keys(t)),n=this.state.selectedItems.filter(function(e){return a.has(e.fid)});n.length&&n.forEach(function(e){e.parents[0]=t[e.fid].parents[0]})},render:function(){var e=this,t=this.isModal;if(!this.state.tree)return!1;var a,n,s=this.state.filter?"portal-form-control search dirty":"portal-form-control search",o=this.state.filter?"fa fa-times search-clear-icon":"fa fa-search search-clear-icon",r=(this.state.toggleInspector,{width:"100%",height:"100%"}),l="inspector-out",d={height:"100%",right:"-330px",opacity:"0"},c="";if(1==this.state.toggleInspector){r.width="calc(100% - 330px)",l="inspector-in",d={height:"100%",right:"5px",opacity:"1"},c="active";var p=this.state.folderViewerItems,m=!!p&&p.length>0;a=i().createElement(st,{selectedItems:this.state.selectedItems,renameSelectedItems:this.renameSelectedItems,hasItems:m,onNotification:this.props.onNotification})}t&&!this.props.showSearch||(n=i().createElement("div",{role:"search",className:"portal-search-bar",style:{height:"33px",position:"relative",left:"-2px"}},i().createElement("div",{className:"input-group",style:{width:"100%",paddingRight:"10px"}},i().createElement("span",{className:"search-icon"},i().createElement("i",{className:o,onClick:this.clearFilter})),i().createElement("input",{placeholder:"Search your folders, compositions and apps",className:s,style:{width:"100%"},type:"text",onChange:this.onFilterChange,onKeyPress:this.onFilterKeyPress,onKeyDown:this.onFilterKeyDown,value:this.state.filter}))));var h=!1;this.state.sendToUserItems&&this.state.sendToUserItems.length&&this.state.emailValues&&this.state.emailValues.length&&!this.state.sendingInProgress&&!this.state.checkingEmail&&!this.sendToUserEmailInvalid()||(h=!0);var g="";this.state.sendingInProgress&&(g=1==this.state.numberOfItemsToSendLeft?this.state.numberOfItemsToSendLeft+" item left to send":this.state.numberOfItemsToSendLeft+" items left to send");var b="Kind";this.state.sortBy==Ot.SORT_BY.NAME?b="Name":this.state.sortBy==Ot.SORT_BY.LAST_MODIFIED?b="Last Modified":this.state.sortBy==Ot.SORT_BY.OWNER&&(b="Owner");var w={height:"calc(100% - 120px)",backgroundColor:"#FFF",top:"0px"};this.props.showHeader||(w={height:"100%"});var E="";this.state.showMobileNav&&(E="in");var I=this.state.filteredByType,N=!!this.state.tree.root,S=this.state.selectedFolder,C=At.isSpecialFolder(S),x=!C||"root"===S,F="root"!==S&&C,D=!C&&!t&&!this.props.enableMarketplace,k="i"===I||"ALL"===I,T="j"===I||"ALL"===I,R="da"===I||"ALL"===I,A="v"===I||"ALL"===I,M=i().createElement("li",null,i().createElement("div",{style:{width:"100%",borderBottom:"1px solid #d6d6d6"}})),O=i().createElement("li",null,i().createElement("a",{className:"dropdown-item uploadAsset",onClick:this.uploadAsset},i().createElement("i",{className:"fa fa-upload"})," Upload")),U=i().createElement("li",null,i().createElement("a",{className:"dropdown-item composition",onClick:this.onCompositionAdd},i().createElement("i",{className:"fa fa-object-group"})," Composition")),P=i().createElement("li",null,i().createElement("a",{className:"dropdown-item folder",onClick:this.newItem.bind(this,"folder")},i().createElement("i",{className:"fa fa-folder-o"})," Folder")),V=i().createElement("li",{onClick:this.showOpenWith},i().createElement("a",null,i().createElement("i",{className:"fa fa-window-restore"})," Control App")),L=i().createElement("li",null,i().createElement("a",{className:"dropdown-item json",onClick:this.onJsonAdd},i().createElement("i",{className:"fa fa-file-code-o"})," JSON")),j="Open Template Library";F&&(j="You cannot use the template library in activity folders,\nplease select your account folder");var W=i().createElement("button",{className:"btn btn-white icon-only","data-toggle":"modal","data-target":"#MarketplaceBrowserModal",title:j,style:{marginLeft:"10px",padding:"5px 10px"},disabled:F},i().createElement("i",{className:"fa fa-book"}),i().createElement("span",{style:{marginLeft:"5px"}},"Templates"));t&&(W=D?W:null,M=null,O=k||T||R||A?O:null,U=null,V=null,L=null);var _="";x||(_="You cannot create anything in activity folders,\nplease select your account folder");var q=i().createElement("div",{className:"dropdown dropdown-white",style:{display:"flex",width:"100%",justifyContent:"center",paddingLeft:"10px",paddingRight:"10px"}},i().createElement("button",{id:"btn-DropNewItem",type:"button",tabIndex:"-1",title:_,className:"btn btn-white create-asset dropdown-toggle"+(x?"":" disabled"),style:{paddingLeft:"3px",minWidth:"1px",flexGrow:"1"},"data-toggle":"dropdown","aria-expanded":"false"},"New"),i().createElement("ul",{className:"dropdown-menu",style:{minWidth:"179px"}},P,U,V,L,M,O,M),W),G=i().createElement("div",null,"");t&&this.currentConfig.showNewButton?G=q:t||(G=q);var Y=i().createElement("nav",{className:"singular-browser-nav "+E+(this.currentConfig.showNewButton?"":" upper"),style:{top:"auto",width:"100%"}},i().createElement(B,{trigger:this.state.treeTrigger,tree:this.state.tree,rootId:"root",selectedFolder:this.state.tree[this.state.selectedFolder],gotoFolder:this.gotoFolder,onFolderAdd:this.onTreeFolderAdd,onFolderDelete:this.warningOnTreeFolderRename,addToFavorites:this.onTreeFolderAddToFavorites,removeFromFavorites:this.onTreeFolderRemoveToFavorites,dropItems:this.dropItems,renameFolder:this.onTreeFolderRename,userFolders:this.state.userFolders,loadingItemIds:this.state.loadingItemIds,pendingItemIds:this.state.pendingItemIds,emptyTrash:this.emptyTrash})),$=N?i().createElement("div",{key:"folderTree",className:"folder-tree "+E},Y):i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},i().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})),J=i().createElement(me,{isModal:t,users:this.globalUserTable,trigger:this.state.folderTrigger,dblClicktoSelectedFolder:this.props.dblClicktoSelectedFolder,showFolderOnly:this.props.showFolderOnly,ref:function(t){e.folderViewerRef=t},rtdbFolderRef:this.props.rtdbFolderRef,folderId:this.state.selectedFolder,treeReady:!!Object.keys(this.state.tree).length,viewStyle:this.state.viewStyle,filteredByType:I,filteredByOwner:this.state.filteredByOwner,currentConfig:this.currentConfig,selectedItems:this.state.selectedItems,updateItems:this.updateItems,items:this.state.folderViewerItems,selectItems:this.selectItems,gotoFolder:this.gotoFolder,restoreSelectedItems:this.restoreSelectedItems,removeSelectedItems:this.warningRemoveSelectedItems,renameSelectedItems:this.renameSelectedItems,errorMessage:this.state.folderViewerErrorMsg,addSelectedItemsToFavorites:this.addSelectedItemsToFavorites,onFolderAdd:this.onTreeFolderAdd,onCompositionAdd:this.onCompositionAdd,onJsonAdd:this.onJsonAdd,openItemInNewWindow:this.openItemInNewWindow,openScriptEditor:this.openScriptEditor,duplicateItem:this.duplicateItem,locateItem:this.locateItem,deleteForever:this.deleteForever,removeSelectedItemsFromFavorites:this.removeSelectedItemsFromFavorites,showSendItem:this.showSendItem,showOpenWith:this.showOpenWith,showExportComposition:this.showExportComposition,onEditComposition:this.onEditComposition,dropItems:this.dropItems,exportToCSV:this.exportToCSV,showRevisionSelection:this.currentConfig.showRevisionSelection,sortBy:this.state.sortBy,sortDirection:this.state.sortDirection,loadingItemIds:this.state.loadingItemIds,pendingItemIds:this.state.pendingItemIds,loadMoreFolders:this.loadMoreFolders,busy:this.state.busy}),z=i().createElement("div",{key:"browserBody",className:"singular-browser-content",style:{left:"0px",width:"100%",height:"100%"}},i().createElement("div",{className:"singular-browser-content-scroll",style:{overflowY:"auto",height:"100%"}},i().createElement("div",{className:"singular-browser-content-wrapper "+l,style:r},function(t,a){return t?i().createElement(u(),{onDrop:e.onDropFilesIntoFolderViewer,ref:"assetUploadDropzone",disableClick:!0,disablePreview:!0,style:{height:"100%",width:"100%"}},a):a}(x,J)),this.currentConfig.showInspector&&i().createElement("div",{className:"inspector-wrapper",style:d},this.state.folderViewerItems&&a))),H=t?{height:"100%"}:{height:"calc(100% - 180px)"},K=this.state.isDragging?"dragging":"",Q=i().createElement(f.A,{split:"vertical",minSize:199,maxSize:500,defaultSize:this.state.splitPanePosition+"px",onChange:this.onSplitResize,onDragStarted:this.dragStarted,onDragFinished:this.dragFinished,style:H,className:K},$,z),X={};return this.state.exportCompProcessMsg&&(this.state.exportCompError?X.color="red":X.color="#999c9e"),i().createElement("div",{ref:"browserMain",id:"portal-browser"},void 0,i().createElement("div",{className:"singular-browser-body ",style:w},i().createElement("section",{className:"nav-bar"},i().createElement("div",{className:"left-area"},this.currentConfig.browserTitle),i().createElement("div",{className:"right-area"},i().createElement("div",{style:{width:"calc(100% - 50px)"},ref:"BreadcrumbParent"},this.renderBreadcrumb()),this.props.showClose&&i().createElement("div",{style:{fontSize:"18px",cursor:"pointer"},onClick:this.modalClose.bind(this,this.props.modalId)},i().createElement("i",{className:"fa fa-times"})))),i().createElement("section",{className:"secondary nav-bar"},i().createElement("div",{className:"left-area"},G),i().createElement("div",{className:"right-area"},i().createElement("div",{style:{flex:"0 1 400px"}},n),i().createElement("div",{style:{flexGrow:"0",flexShrink:"0"}},this.currentConfig.showInspector&&i().createElement("div",{className:"singular-browser-filters",style:{marginRight:"0px"}},i().createElement("button",{className:"btn btn-white icon-only inspector-toggle "+c,onClick:this.toggleInspector.bind(this,!this.state.toggleInspector),title:"Show inspector",style:{width:"30px"}},i().createElement("i",{className:"fa fa-info"}))),!this.currentConfig.showInspector&&i().createElement("div",{className:"singular-browser-filters"}),"recent"!=this.state.selectedFolder&&"myrecent"!=this.state.selectedFolder&&i().createElement("div",{className:"dropdown dropdown-white singular-browser-filters modifier-toggle"},i().createElement("button",{className:"btn btn-white dropdown-toggle ",type:"button","data-toggle":"dropdown",style:{width:"135px"}},i().createElement("i",{className:"fa fa-sort-amount-desc"})," ",b),i().createElement("ul",{className:"dropdown-menu dropdown-menu-right"},i().createElement("li",null,i().createElement("a",{onClick:this.changeSortBy.bind(this,Ot.SORT_BY.NAME,Ot.SORT_DIRECTION.ASC)},"Name")),i().createElement("li",null,i().createElement("a",{onClick:this.changeSortBy.bind(this,Ot.SORT_BY.LAST_MODIFIED,Ot.SORT_DIRECTION.DEC)},"Last Modified")),i().createElement("li",null,i().createElement("a",{onClick:this.changeSortBy.bind(this,Ot.SORT_BY.OWNER,Ot.SORT_DIRECTION.ASC)},"Owner")))),this.currentConfig.showTypeSelection?i().createElement("div",{className:"dropdown dropdown-white singular-browser-filters"},i().createElement("button",{className:"btn btn-white dropdown-toggle ",type:"button","data-toggle":"dropdown",style:{width:"135px"}},i().createElement("i",{className:"fa fa-filter"})," ","ALL"!=this.state.filteredByType?At.getNiceNameFromBrowserShortType(this.state.filteredByType):"All"),i().createElement("ul",{className:"dropdown-menu dropdown-menu-right"},i().createElement("li",{style:{textAlign:"center"}},i().createElement("a",{onClick:this.onChangeFilter.bind(this,"ALL")},"All")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.COMPOSITION)},i().createElement("i",{className:"fa fa-object-group"})," Composition")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.APPINSTANCE)},i().createElement("i",{className:"fa fa-window-restore"})," Control App")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.ASSET)},i().createElement("i",{className:"fa fa-file-o"})," Asset")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.JSON)},i().createElement("i",{className:"fa fa-file-code-o"})," JSON")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.DATANODE)},i().createElement("i",{className:"fa fa-database"})," Datanode")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.AUDIO)},i().createElement("i",{className:"fa fa-file-audio-o"})," Audio")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.VIDEO)},i().createElement("i",{className:"fa fa-file-video-o"})," Video")),i().createElement("li",null,i().createElement("a",{onClick:this.onChangeFilter.bind(this,Mt.DATA)},i().createElement("i",{className:"fa fa-file"})," Data")))):null)),i().createElement("div",null)),Q,i().createElement(Et,{ref:"AssetUploadManager"}),i().createElement("div",{id:"sendToUserModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"vertical-alignment-helper"},i().createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-header"},i().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeSendItem},i().createElement("span",{"aria-hidden":"true"},i().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),i().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Send copy of item(s) to users")),i().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},i().createElement("table",{className:"table",style:{maxWidth:"1200px",backgroundColor:"#FFF",marginBottom:"0px"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},i().createElement("div",{className:"singular-text-label",style:{color:"#808080",width:"120px"}},"Dashboard Elements")),i().createElement("td",null,i().createElement(v(),{className:"singularSelect",backspaceToRemoveMessage:"",multi:!0,onChange:this.handleSendElementChange,options:this.state.selectedItems,value:this.state.sendToUserItems,placeholder:"No composition selected",onInputKeyDown:function(e){"Backspace"!=e.key&&e.preventDefault()},disabled:this.state.sendingInProgress,clearable:!1,arrowRenderer:function(){},menuRenderer:function(){}}))),i().createElement("tr",null,i().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},i().createElement("div",{className:"singular-text-label",style:{color:"#808080"}},"Send to")),i().createElement("td",{className:this.state.checkingEmail?"validating":"",style:{position:"relative"}},i().createElement(v().Creatable,{className:"singularSelect creatable",multi:!0,backspaceToRemoveMessage:"",onChange:this.handleEmailChange,onBlur:this.handleEmailBlur,onInputChange:this.handleInputEmailChange,value:this.state.emailValues,placeholder:"Enter the user's email address",promptTextCreator:this.newItemLabel,arrowRenderer:function(){},menuRenderer:function(){},disabled:this.state.sendingInProgress}),i().createElement("img",{src:"/images/loading-oval.svg",className:"loader-oval",style:{top:"11px"}}))),i().createElement("tr",null,i().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",paddingBottom:"0px"}},i().createElement("div",{className:"singular-text-label",style:{color:"#808080"}},"Send email")),i().createElement("td",{className:"field-col"},i().createElement("div",{className:"checkbox",style:{position:"relative"}},i().createElement("div",{className:"bar",style:{height:"10px"}},i().createElement("input",{type:"checkbox",id:"chkWatermark",disabled:this.state.sendingInProgress,checked:this.state.sendToUserEmail,onChange:this.sendToUserValueChanged.bind(this,"sendEmail")}),i().createElement("label",{htmlFor:"chkWatermark",className:"checkbox-label",style:{background:"#FFF",border:"solid 1px #dadada",boxShadow:"none",color:"#808394",borderRadius:"2px"}}))))),i().createElement("tr",null,i().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",paddingTop:"5px",paddingBottom:"0px"}},i().createElement("div",{className:"singular-text-label",style:{color:"#808080"}},"Email Message")),i().createElement("td",{style:{paddingTop:"5px",paddingBottom:"0px"}},i().createElement("textarea",{rows:"5",className:"form-control",disabled:this.state.sendingInProgress||!this.state.sendToUserEmail,onChange:this.sendToUserValueChanged.bind(this,"sendEmailMessage")}))))),i().createElement("div",{style:{verticalAlign:"middle",textAlign:"center",color:"rgb(128, 128, 128)",height:"20px"}},g)),i().createElement("div",{className:"modal-footer"},i().createElement("button",{tabIndex:"-1",onClick:this.submitSendItem,className:"btn btn-primary",disabled:h},"Send"),i().createElement("button",{tabIndex:"-1",onClick:this.closeSendItem,className:"btn btn-secondary",disabled:!1},"Cancel")))))),this.props.enableAppTemplateBrowser&&i().createElement(lt.A,{filterSpecificComps:!0,onSelect:this.onSelectAppTemplate,ref:"appTemplateBrowser"}),this.props.enableMarketplace&&i().createElement(ut,{rtdbFolderRef:this.props.rtdbFolderRef,selectedFolder:this.state.selectedFolder,onNotification:this.props.onNotification,ref:"marketplaceBrowser"}),i().createElement("div",{id:"compNameModal",ref:"nameInputModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"modal-dialog modal-lg",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-header"},i().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.hideNewItemNameModal},i().createElement("span",{"aria-hidden":"true"},i().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),i().createElement("h4",{className:"modal-title",id:"myModalLabel"},this.state.newItemDialogTitle)),i().createElement("div",{className:"modal-body"},i().createElement("input",{ref:"newItemNameInput",className:s,type:"text",placeholder:this.state.newItemDialogPlaceholder,onKeyPress:this.onInputNameKeyPress,style:{borderRadius:"4px",width:"100%"}}),i().createElement("div",{style:{textAlign:"center"}},i().createElement("button",{className:"btn btn-primary","data-dismiss":"modal",onClick:this.onNewItemNameEntered},"Create"),i().createElement("button",{className:"btn btn-secondary","data-dismiss":"modal"},"Cancel")))))),i().createElement("div",{id:"exportCompositionModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"modal-dialog modal-lg",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-body"},i().createElement("label",{style:{marginBottom:"15px"}},"Extract Composition"),i().createElement("input",{className:s,type:"text",value:this.state.exportCompositionName,onChange:this.onExportCompositionChange,onKeyPress:this.onExportCompositionKeyPress,disabled:this.state.exportCompInProcess,style:{borderRadius:"4px",width:"100%"}}),"hide this for now"==!this.state.exportCompInProcess&&i().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{position:"relative",top:"-32px",float:"left"}}),i().createElement("div",{style:{textAlign:"center",height:"30px",padding:"10px",position:"relative",top:"5px"}},i().createElement("span",{style:X},this.state.exportCompProcessMsg)),i().createElement("div",{style:{textAlign:"center"}},i().createElement("button",{className:"btn btn-primary",disabled:this.state.exportCompositionButtonDisabled,onClick:this.onExportComposition},"Save"),i().createElement("button",{className:"btn btn-secondary",onClick:this.closeExportComposition},"Cancel")))))),i().createElement(y(),{show:null!=this.state.confirmOpenMessage,title:"",text:this.state.confirmOpenMessage,showCancelButton:!0,onConfirm:function(){e.setState({confirmOpenMessage:void 0}),e._openItem()},onCancel:function(){e.setState({confirmOpenMessage:void 0})},onEscapeKey:function(){e.setState({confirmOpenMessage:void 0})},onOutsideClick:function(){e.setState({confirmOpenMessage:void 0})}}),i().createElement(y(),{show:this.state.showConfirmDelete,title:"",text:this.state.confirmDeleteMessage,showCancelButton:!0,onConfirm:function(){e.setState({showConfirmDelete:!1},e.removeSelectedItems)},onCancel:function(){e.setState({showConfirmDelete:!1})},onEscapeKey:function(t){e.setState({showConfirmDelete:!1})},onOutsideClick:function(){e.setState({showConfirmDelete:!1})}}),i().createElement(y(),{show:this.state.showSelectCompMessage,title:"",text:"Please select a composition to create a control app.",onConfirm:function(){e.setState({showSelectCompMessage:!1})},onCancel:function(){e.setState({showSelectCompMessage:!1})},onEscapeKey:function(t){e.setState({showSelectCompMessage:!1})},onOutsideClick:function(){e.setState({showSelectCompMessage:!1})}}),i().createElement(y(),{show:this.state.showConfirmFolderDelete,title:"",text:this.state.confirmFolderMessage,showCancelButton:!0,onConfirm:function(){e.onTreeFolderDelete(),e.setState({showConfirmFolderDelete:!1})},onCancel:function(){e.setState({showConfirmFolderDelete:!1})},onEscapeKey:function(){return e.setState({showConfirmFolderDelete:!1})},onOutsideClick:function(){return e.setState({showConfirmFolderDelete:!1})}}),i().createElement(y(),{show:this.state.showCannotDelete,title:"",text:this.state.cannotDeleteMessage,onConfirm:function(){return e.setState({showCannotDelete:!1})},onEscapeKey:function(){return e.setState({showCannotDelete:!1})},onOutsideClick:function(){return e.setState({showCannotDelete:!1})}}),i().createElement(y(),{show:this.state.showInfoMessage,title:"",text:this.state.infoMessage,onConfirm:function(){return e.setState({showInfoMessage:!1})},onEscapeKey:function(){return e.setState({showInfoMessage:!1})},onOutsideClick:function(){return e.setState({showInfoMessage:!1})}}),this.state.showVideoPlayer&&this.state.currentVideoItem&&i().createElement("div",{className:"modal fade u-displaynone singular-modal-white show",tabIndex:"-1",role:"dialog",onClick:function(e){e.target===e.currentTarget&&this.closeVideoPlayer()}.bind(this),style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.8)"}},i().createElement("div",{className:"modal-dialog",role:"document",style:{width:"90%",maxWidth:"1000px",height:"90%",maxHeight:"1000px",margin:"0px auto",position:"relative",top:"5%"}},i().createElement("div",{className:"modal-content",style:{height:"100%",display:"flex",flexDirection:"column"}},i().createElement("div",{className:"modal-header",style:{flexShrink:0}},i().createElement("button",{tabIndex:"-1",type:"button",className:"close",onClick:this.closeVideoPlayer,"aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},i().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),i().createElement("h4",{className:"modal-title"},this.state.currentVideoItem.name||"Video Player")),i().createElement("div",{className:"modal-body",style:{flex:1,padding:0,overflow:"hidden",display:"flex",flexDirection:"column"}},i().createElement(ot,{videoUrl:this.state.currentVideoItem.url,videoName:this.state.currentVideoItem.name,videoRefId:this.state.currentVideoItem.refId,onClose:this.closeVideoPlayer})))))))}});const Vt=Rt(rt.Ay)(Bt)},26201:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(40927),i=a.n(n),s=a(70470);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}a(80952),a(20047),a(4708),a(51289),a(87874),a(55208),a(22981);var r=a(9769);ace.config.set("basePath","/build/ace-builds"),ace.config.set("workerPath","/build/ace-builds"),ace.config.set("modePath","/build/ace-builds"),ace.config.set("themePath","/build/ace-builds");const l=i().createClass({displayName:"JsonInput",getInitialState:function(){return{isJsonValid:!1,JsonValue:""}},componentWillMount:function(){this.componentWillReceiveProps(this.props)},componentDidMount:function(){},componentWillReceiveProps:function(e){var t=e.value;"object"===o(t)&&null!==t&&(t=JSON.stringify(t,null,2)),void 0===t&&(t=""),this.setState({isJsonValid:this.IsJsonString(t),JsonValue:t})},shouldComponentUpdate:function(e,t){return!r.compareObject(e,this.props)||!r.compareObject(t,this.state)},componentDidUpdate:function(){var e=this;this.refs.aceEditor&&this.state.isJsonValid&&this.refs.aceEditor.editor.session.getAnnotations()&&setTimeout(function(){e.refs.aceEditor.editor.session.setAnnotations([])},300)},onChange:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e),this.setState({isJsonValid:this.IsJsonString(e),JsonValue:e})},onFocus:function(e){e.target.select()},IsJsonString:function(e){if(""==e)return!0;try{JSON.parse(e)}catch(e){return!1}return!0},render:function(){var e=this,t={};this.state.isJsonValid||(t.outline="1px solid red");var a="100%",n="400px";this.props.width&&(a=this.props.width),this.props.height&&(n=this.props.height),t.width=a,t.height=n,t.marginTop="1px",t.marginBottom="1px",t.marginRight="1px";var o="monokai";this.props.theme&&"light"==this.props.theme&&(o="xcode");var r="active";this.props.disabled&&(r="disabled",t.opacity=.5);var l=[{name:"Save",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(){e.props.onSave&&e.props.onSave()}}];return i().createElement("div",{className:"form-inline",style:t},i().createElement(s.Ay,{id:"jsonEditor-"+this.props.id,mode:"json",theme:o,onChange:this.onChange,name:"jsonEditor-"+this.props.id,width:a,height:n,readOnly:this.props.disabled,showPrintMargin:!1,highlightActiveLine:!0,wrapEnabled:!0,tabSize:2,editorProps:{$blockScrolling:1/0},value:String(this.state.JsonValue),className:r,commands:l,ref:"aceEditor"}))}})},39481:e=>{e.exports={CmdType:{BROWSER:"browser",SERVER:"server",WORKER:"worker"},cmdValue:function(e,t){var a={cmd:e};return t?(a.cmd.uuid=t,a):a},cmdServerValue:function(e,t){var a={cmdServer:e};return t?(a.cmdServer.uuid=t,a):a},cmdWorkerValue:function(e,t){var a={cmdWorker:e};return t?(a.cmdWorker.uuid=t,a):a}}},45261:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var n=a(40927),i=a.n(n),s=a(15734),o=a.n(s),r=a(13023),l=a(9769),d=a(82465);const c=i().createClass({displayName:"AppTemplateBrowser",getInitialState:function(){return this.xhrRequestHandler=null,{appTemplateList:[],filteredAppTemplates:[],appTemplateCategories:[],selectedCategory:"",filter:"",isDevelopmentMode:!1,showBusyIcon:!1}},getAppTemplates:function(e){var t=d.API_ENDPOINTS.at;t&&(this.setState({showBusyIcon:!0}),t+="json",e&&(t+="?status="+e),this.xhrRequestHandler&&this.xhrRequestHandler.abort(),this.xhrRequestHandler=o().get(t).set("Content-Type","application/json").end(function(e,t){if(e)this.setState({showBusyIcon:!1}),r.A.add(r.A.TYPE.ERROR,{title:"Cannot get "+d.BROWSERITEM_NICENAME_MAP.at+" from database",description:e.message});else{if(t.headers.location)return void(window.location=t.headers.location);var a="My Account",n="Shared with my account",i=[],s=[],o=t.body;for(var l in this.props.filterSpecificComps&&(o=o.filter(function(e){return!e.use_specific_comp}.bind(this))),o.forEach(function(e,t){if(e.category){var i=parseInt(window.singularUser.account.accountId);i==e.account_id&&(e.category+="|"+a),i!=e.account_id&&0!=e.account_id&&(e.category+="|"+n),e.category.split("|").forEach(function(e){s[e]?s[e]++:s[e]=1})}}),s)i.push({name:l});i.sort(function(e,t){return(e.name>t.name)-.5}),i.forEach(function(e,t){e.name===n&&(i.splice(t,1),i.unshift(e))}),i.forEach(function(e,t){e.name===a&&(i.splice(t,1),i.unshift(e))}),i.unshift({name:"All"}),o.sort(function(e,t){return(e.name>t.name)-.5}),this.setState({appTemplateList:o,appTemplateCategories:i,selectedCategory:"All"}),this.applyFilter({name:"All"}),this.setState({showBusyIcon:!1})}this.xhrRequestHandler=null}.bind(this)))},componentDidMount:function(){this.getAppTemplates("")},componentWillUnmount:function(){this.xhrRequestHandler&&this.xhrRequestHandler.abort()},developmentModeChanged:function(e){var t=e.target.checked;this.setState({isDevelopmentMode:t}),this.getAppTemplates(t?"development":null)},onSearchBoxFilterChanged:function(e){this.setState({filter:e.target.value})},onSearchBoxFilterKeyDown:function(e){"Escape"==e.key&&""!=this.state.filter&&(this.setState({filter:""}),e.preventDefault(),e.stopPropagation())},clearSearchBox:function(){this.setState({filter:""})},onSelect:function(e){this.props.onSelect&&this.props.onSelect(e)},render:function(){var e=function(e,t){if(""!=this.state.filter.trim()&&!(e.name.toLowerCase().indexOf(this.state.filter.trim().toLowerCase())>-1))return null;var a=l.getDefaultIconFromBrowserShortType("at");return e.thumbnail&&(a=e.thumbnail),i().createElement("div",{className:"singular-card",key:e.id},i().createElement("div",{className:"card__tile",onClick:this.onSelect.bind(this,e),"data-dismiss":"modal"},i().createElement("img",{className:"image",src:a})),i().createElement("div",{className:"card__title"},i().createElement("div",{className:"card__label"},e.name)))}.bind(this),t=function(e,t){var a="category-list-item";return e.name==this.state.selectedCategory&&(a+=" selected"),i().createElement("li",{key:t,className:a},i().createElement("div",{onClick:this.applyFilter.bind(this,e)},e.name))}.bind(this),a=null;window.singularUser.account.permission.permDevTool&&(a=i().createElement("div",{className:"dev-toggle"},"Show Developer Versions",i().createElement("div",{style:{top:"3px",position:"relative",paddingLeft:"10px"}},i().createElement("label",{className:"switch"},i().createElement("input",{className:"switch-input",style:{visibility:"inherit"},type:"checkbox",checked:this.state.isDevelopmentMode,onChange:this.developmentModeChanged}),i().createElement("span",{className:"switch-label","data-on":"On","data-off":"Off"}),i().createElement("span",{className:"switch-handle"})))));var n,s,o=this.state.filter,r=this.state.filter;0==this.state.showBusyIcon?n=i().createElement("div",{className:"panel-body"},i().createElement("div",{className:"item-header"},a),i().createElement("div",{className:"item-list"},this.state.filteredAppTemplates.map(e))):(this.state.packageDownloadMessage&&(s=i().createElement("div",{style:{top:"40%",position:"relative",color:"#4e5b68"}},this.state.packageDownloadMessage)),n=i().createElement("div",{className:"panel-body"},i().createElement("div",{className:"item-header"},a),i().createElement("div",{className:"row browser-tree component-tree font-tree",style:{width:"100%",height:"100%",alignItems:"center",flexDirection:"column"}},s,i().createElement("img",{style:{position:"relative",top:"40%"},src:"/images/loading-bubbles-blue.svg",className:"loader"}))));var c=d.BROWSERITEM_NICENAME_MAP.at;return o=this.state.filter?"search-box form-control dirty":"search-box form-control",r=this.state.filter?"fa fa-times":"fa fa-search",i().createElement("div",{id:"appTemplateModal",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"modal-dialog modal-lg",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-header"},i().createElement("div",{className:"header-bar"},i().createElement("div",{className:"title-area"},i().createElement("span",null,c),i().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},""))))),i().createElement("div",{className:"modal-body store-front"},i().createElement("section",{className:"navigation"},i().createElement("div",{className:"search-area"},i().createElement("div",{className:"modal-search-wrapper"},i().createElement("span",{className:"search-icon"},i().createElement("i",{className:r,onClick:this.clearSearchBox})),i().createElement("input",{autoFocus:!0,value:this.state.filter,className:o,type:"text",placeholder:"Search...",onChange:this.onSearchBoxFilterChanged,onKeyDown:this.onSearchBoxFilterKeyDown}))),i().createElement("div",{className:"nav-menu"},i().createElement("ul",{className:"category-list"},this.state.appTemplateCategories.map(t)))),i().createElement("section",{className:"modal-content"},n)))))},applyFilter:function(e){var t=this.state.appTemplateList.filter(function(t,a){var n=t.category?t.category.split("|"):"";if("All"===e.name||-1!==n.indexOf(e.name))return t});this.setState({filteredAppTemplates:t,selectedCategory:e.name})}})},49612:()=>{Object.prototype.watchThis||Object.defineProperty(Object.prototype,"watchThis",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var a=this[e],n=a;delete this[e]&&Object.defineProperty(this,e,{get:function(){return n},set:function(i){return a=n,n=t.call(this,e,a,i)},enumerable:!0,configurable:!0})}}),Object.prototype.unwatchThis||Object.defineProperty(Object.prototype,"unwatchThis",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}})},50243:(e,t,a)=>{a(47500),e.exports={copyArrayBuffer:function(e){var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},mp3Info:function(e){function t(e,t,a){return(e&4294967295>>>32-a<<32-a-t)>>>32-a-t}for(var a,n={raw:{}},i=new Uint8Array(e),s=i.length,o=0;o<=s;o+=1){if(i[o]==s)return!1;if(255==i[o]){a=o;break}}for(;o<=s;o+=1){if(i[o]==s)return!1;if(224==i[o])break}var r=n.raw.header=i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3],l=n.raw.version=t(r,11,2);n.version=["MPEG 2.5","reserved","MPEG 2.0","MPEG 1.0"][l];var d=n.raw.layer=t(r,13,2);n.layer=["reserved","layer 3","layer 2","layer 1"][d];var c=n.raw.crc=t(r,15,1);n.crc=!c;var p,u=n.raw.bitrateIndex=t(r,16,4);p=3==l?3-d:3==d?3:4,n.bitrate=n.raw.bitrate=[[0,0,0,0,0],[32e3,32e3,32e3,32e3,8e3],[64e3,48e3,4e4,48e3,16e3],[96e3,56e3,48e3,56e3,24e3],[128e3,64e3,56e3,64e3,32e3],[16e4,8e4,64e3,8e4,4e4],[192e3,96e3,8e4,96e3,48e3],[224e3,112e3,96e3,112e3,56e3],[256e3,128e3,112e3,128e3,64e3],[288e3,16e4,128e3,144e3,8e4],[32e4,192e3,16e4,16e4,96e3],[352e3,224e3,192e3,176e3,112e3],[384e3,256e3,224e3,192e3,128e3],[416e3,32e4,256e3,224e3,144e3],[448e3,384e3,32e4,256e3,16e4],[-1,-1,-1,-1,-1]][u][p];var m=n.raw.sampleRateIndex=t(r,20,2);n.sampleRate=n.raw.sampleRate=[[44100,22050,11025],[48e3,24e3,12e3],[32e3,16e3,8e3],[-1,-1,-1]][m][3-l];var h=n.raw.padded=t(r,22,1);n.padded=1==h;var f=n.raw.private=t(r,23,1);n.private=1==f;var g=n.raw.channelMode=t(r,24,2);if(n.channelMode=["Stereo","Joint Stereo","Dual Channel","Single Channel"][g],1==g){var v=n.raw.channelsExtension=t(r,26,2);n.channelExtension=1==d?{bands:[[4,31],[8,31],[12,31],[16,31]][v]}:{msStereo:[!1,!1,!0,!0][v],intensityStereo:[!1,!0,!1,!0][v]}}var b=n.raw.copyrighted=t(r,28,1);n.copyrighted=1==b;var y=n.raw.original=t(r,29,1);n.original=1==y;var w=n.raw.emphasis=t(r,30,2);return n.emphasis=["None","50/15 ms","Reserved","CCIT J.17"][w],n},audioInfo:function(e,t){(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(e,function(e){var a={duration:e.duration,sampleRate:e.sampleRate,numberOfChannels:e.numberOfChannels};t(a)})},getAudioInfo:function(e,t){var a=this.copyArrayBuffer(e);this.audioInfo(a,function(e){console.log("getAudioInfo = ",e),t(null,e)})}}},50456:(e,t,a)=>{"use strict";a.r(t)},52271:(e,t,a)=>{"use strict";a.r(t)},59862:(e,t,a)=>{"use strict";a.d(t,{A:()=>c});var n=a(40927),i=a.n(n),s=a(72761),o=a.n(s),r=a(99547),l=a(9769),d=a(17334);const c=i().createClass({displayName:"Image",getInitialState:function(){return this.firstClick=!0,this.dDisplayPreviewImageStyle=d(this.displayPreviewImageStyle,100),this.dUpdateField=d(this.updateField,500),{currentImageUrl:this.props.value,status:"",checkerBoardRenderer:""}},componentDidMount:function(){this.dDisplayPreviewImageStyle(this.props.value),this.setState({currentImageUrl:this.props.value,checkerBoardRenderer:o()(this.refs.imageBackground).viewbox(-14,-14,28,28)})},shouldComponentUpdate:function(e,t){var a=!l.compareObject(t,this.state),n=!l.compareObject(e,this.props);return!(!a&&!n||(n&&this.dDisplayPreviewImageStyle(e.value),0))},openImageBrowserModal:function(){this.props.disabled||(this.props.onImageBrowserClicked?this.props.onImageBrowserClicked(this.props.name):(r.A.imageSingleton.config({onUpload:this.onUpload,onInsertFromWeb:this.onInsertFromWeb,onSelect:this.onSelect}),$("#"+r.A.imageModalId).modal("show")))},onTextInputFocus:function(e){e.target.select()},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},displayPreviewImageStyle:function(e){var t=e||"";if(this.refs.divImagePreview)if(""!=t){var a=l.addFitInToImageURL(t,150,150);this.refs.divImagePreview.style.backgroundImage="url('".concat(a,"')")}else this.refs.divImagePreview.style.backgroundImage="";this.state.currentImageUrl!=t&&this.setState({currentImageUrl:t})},render:function(){var e=this.state.currentImageUrl,t="rgb(95, 95, 95) ",a="#393939",n="input-group-addon image-browser-picker-wrapper",s=this.props.disabled;s&&(t="#4b4b4b",a="#393939",n+=" disabled");var o=this.state.checkerBoardRenderer;if(void 0!==o&&""!=o){o.clear();var r=o.pattern(16,16,function(e){e.rect(16,16).fill(t),e.rect(8,8).fill(a),e.rect(8,8).fill(a).move(8,8)});o.rect("28","28").move(-14,-14).fill(r)}return i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group image-picker"},i().createElement("div",{className:n,onClick:this.openImageBrowserModal,disabled:s},i().createElement("svg",{ref:"imageBackground",className:"image-browser-picker"}),i().createElement("div",{className:"image-container",ref:"divImagePreview",style:{height:"28px",width:"28px",backgroundSize:"contain",backgroundRepeat:"no-repeat",top:"0px",left:"0px",position:"absolute",backgroundPosition:"center"}})),i().createElement("input",{type:"text",className:"form-control",value:e,onFocus:this.onTextInputFocus,disabled:s,onChange:this.handleValueChange,onMouseDown:this.onMouseDown}))))},updateField:function(e){this.props.onValueChanged&&("string"==typeof e&&e.length>2048&&(e=e.substring(0,2048)),this.props.onValueChanged(this.props.name,e))},handleValueChange:function(e){this.setState({currentImageUrl:e.target.value}),this.dUpdateField(e.target.value)},onSelect:function(e){this.updateField(e.url)},onUpload:function(e){this.updateField(e.url)},onInsertFromWeb:function(e){this.updateField(e)}})},74199:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var n=a(88534),i=a.n(n),s=a(16918),o=a.n(s);a(9769);const r={currentDataNodeSources:{},keyNames:new Set,callbacks:[],add:function(e,t,a){var n=e,s=t.dataNode;if(!this.keyNames.has(s)){var r=function(e){var t=this;a&&a(e),e&&(this.currentDataNodeSources[s]=e,this.callbacks.forEach(function(e){e&&e(t.currentDataNodeSources)}))}.bind(this);if(t.datastore){var l=new(o())(null,"".concat(t.datastore));new(i())(l,t.datastore).then(function(e){l.on("value",function(e){r(e.val())})})}else"public"==t.type?n&&n.root.child("publicDataNodes").child(t.userId).child(t.dataNode).on("value",function(e){var t=e.val();r(t)}.bind(this)):n&&n.root.child("users").child(t.userId).child("dataNodes").child(t.dataNode).on("value",function(e){var t=e.val();r(t)}.bind(this));this.keyNames.add(s)}},get:function(e){return this.currentDataNodeSources[e]},onChange:function(e){this.callbacks.push(e),e(this.currentDataNodeSources)},offChange:function(e){if(e){var t=this.callbacks.indexOf(e);-1!=t&&this.callbacks.splice(t,1)}else this.callbacks=[]}}},76716:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=null;const i={onSetSelectedFieldId:function(e){n=e},onControlNodeAdd:function(e,t,a,i,s,o){o||(o=n),e&&e.item&&(e=e.item);var r={};e&&e.name&&e.model?($.extend(!0,r,e),r.model||(r.model={}),r.model.fields||(r.model.fields={}),r.payload||(r.payload={}),r[".key"]&&delete r[".key"]):r={id:"controlNode",thumbnail:"/images/noimage.png",name:"Control Node",model:{fields:{}},payload:{}};var l=-1;if(e&&e.model&&e.model.fields){var d=!0;for(var c in e.model.fields)null!=(I=e.model.fields[c]).index&&(l=Math.max(l,parseInt(I.index))),null!=I.index&&(d=!1);if(d){var p=[];for(var c in r.model.fields)p.push(r.model.fields[c]);p.sort(function(e,t){return(e.title.toLowerCase()>t.title.toLowerCase())-.5}),p.forEach(function(e,t){for(var a in r.model.fields)if(r.model.fields[a].id==e.id){r.model.fields[a].index=t;break}}),l=p.length}}var u=!1;if("timecontrol"!==a&&"button"!==a||(u=!0),o){var m=null;r.model.fields[o]&&(m=r.model.fields[o].id);var h,f=null;if(r.model.groups&&r.model.groups.length>0)for(var g=0;g<r.model.groups.length;g++){var v=r.model.groups[g];if(m){if(v.childIds&&v.childIds.includes(m)){f=v;break}}else if(v.id===o){f=v;break}}if(f)if(f.childIds&&0!==f.childIds.length)if(m){var b=f.childIds.indexOf(m);f.childIds.splice(b+1,0,t),h=m}else f.childIds.unshift(t);else f.childIds=[t];else r.model.fields[o]&&(h=r.model.fields[o].id);if(void 0!==h){var y=0;for(var w in r.model.fields){var E=r.model.fields[w];E.index+=y,E.id==h&&(l=E.index+1,y=1)}}}var I={id:t,title:t,type:a,index:l,defaultValue:null,resetValue:null,immediateUpdate:u};if(s)r.payload[t]=s;else switch(a){case"text":case"textarea":case"image":case"audio":case"video":case"data":case"jsonfile":default:r.payload[t]="";break;case"number":I.step=.1,r.payload[t]=0;break;case"normalizednumber":I.low=0,I.high=100,I.resetValue=50,I.defaultValue=50,r.payload[t]=0,I.step=.1;break;case"color":r.payload[t]={r:255,g:255,b:255,a:1};break;case"json":I.height="100px",r.payload[t]="{}";break;case"checkbox":r.payload[t]=!0;break;case"gradient":r.payload[t]={type:"solid",solidColor:{r:204,g:204,b:204,a:1},stops:[{offset:0,color:"#ff0000",opacity:1},{offset:.5,color:"#00ff00",opacity:1},{offset:1,color:"#0000ff",opacity:1}],offset:0,angle:0,scale:100,spreadMethod:"pad",keepAspect:!1,centerX:50,centerY:50,radius:50,focalAngle:0,focalDistance:0};break;case"selection":I.selections=[{id:"id1",title:"Title 1"},{id:"id2",title:"Title 2"}],I.useFilter=!0,r.payload[t]="id1";break;case"button":r.payload[t]={__singularButton:!0,ts:0};break;case"datanode":r.payload[t]={dataNode:"",refId:"",userId:""};break;case"timecontrol":r.payload[t]={value:0,UTC:0,isRunning:!1};break;case"datetime":r.payload[t]=Date.now();break;case"location":r.payload[t]={text:"",long:0,lat:0};break;case"infotext":I.mode="static",I.text="Text including <b>HTML</b> tags",r.payload[t]="";break;case"counter":I.s1="0",I.m1="-1",I.m2="1",r.payload[t]=0}if(I.resetValue=I.defaultValue=r.payload[t],i){var N={};$.extend(!0,N,i,I),I=N}var S=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode"),C=S.push().key;return r.model.fields[C]=I,S.update(r),C}}},80765:(e,t,a)=>{"use strict";a.d(t,{A:()=>h});var n=a(40927),i=a.n(n),s=a(40961),o=a.n(s);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function l(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}var m=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=function(e,t,a){return t=p(t),function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,a||[],p(e).constructor):t.apply(e,a))}(this,t,[e])).startEditing=a.startEditing.bind(a),a.finishEditing=a.finishEditing.bind(a),a.textChanged=a.textChanged.bind(a),a.isInputValid=a.isInputValid.bind(a),a.componentDidUpdate=a.componentDidUpdate.bind(a),a.commitEditing=a.commitEditing.bind(a),a.keyDown=a.keyDown.bind(a),a.state={editing:!1,text:a.props.text,minLength:a.props.minLength||1,maxLength:a.props.maxLength||256},a.isInputValid=a.props.validate||a.isInputValid.bind(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),a=t,n=[{key:"startEditing",value:function(e){this.setState({editing:!0,text:this.props.text}),e.preventDefault(),e.stopPropagation(),this.props.startEditing&&this.props.startEditing()}},{key:"finishEditing",value:function(e){this.props.force&&this.isInputValid(this.state.text)||this.isInputValid(this.state.text)&&this.props.text!=this.state.text?this.commitEditing(e):this.props.text!==this.state.text&&this.isInputValid(this.state.text)||this.cancelEditing(),this.props.finishEditing&&this.props.finishEditing()}},{key:"cancelEditing",value:function(){this.setState({editing:!1,text:this.props.text}),this.props.onNavigate&&this.props.onNavigate(""),this.props.cancelEditing&&this.props.cancelEditing()}},{key:"commitEditing",value:function(e){this.setState({editing:!1,text:this.state.text});var t={};t[this.props.paramName]=this.state.text,t.oldName=this.state.prvText,e&&e.isCancel&&(t.isCancel=!0),this.props.change(t)}},{key:"isInputValid",value:function(e){return e.length>=this.state.minLength&&e.length<=this.state.maxLength}},{key:"keyDown",value:function(e){var t={isCancel:!0},a="";switch(e.key){case"Tab":case"Enter":a=this.state.text.length?"filled":"",t.isCancel=!1;case"Escape":this.finishEditing(t),this.props.onNavigate&&this.props.onNavigate(a),e.preventDefault(),e.stopPropagation();break;case"ArrowUp":this.finishEditing(),this.props.onNavigate&&this.props.onNavigate("previous"),e.preventDefault(),e.stopPropagation();break;case"ArrowDown":this.finishEditing(),this.props.onNavigate&&("Tab"==e.key&&1==e.shiftKey?this.props.onNavigate("previous"):this.props.onNavigate("next")),e.preventDefault(),e.stopPropagation()}}},{key:"textChanged",value:function(e){this.setState({text:e.target.value.trim()})}},{key:"componentWillReceiveProps",value:function(e){e.editing&&this.setState({editing:!0,prvText:this.state.text}),e.editing||this.state.editing?e.text!=this.state.text&&this.setState({text:e.text}):this.setState({text:e.text})}},{key:"componentDidUpdate",value:function(e,t){var a,n=o().findDOMNode(this.refs.input);this.state.editing&&!t.editing?(n.focus(),a=n,window.setTimeout(function(){a.setSelectionRange(0,a.value.length)},0)):this.state.editing&&e.text!=this.props.text&&this.finishEditing()}},{key:"onMouseDown",value:function(e){window.getSelection().removeAllRanges()}},{key:"render",value:function(){if(this.state.editing){var e=this.props.element||"input";return i().createElement(e,{className:this.props.activeClassName,onKeyDown:this.keyDown,onBlur:this.finishEditing,ref:"input",placeholder:this.props.placeholder,defaultValue:this.state.text,onChange:this.textChanged,onMouseDown:this.onMouseDown,onDoubleClick:function(e){e.preventDefault(),e.stopPropagation()}})}return 1==this.props.preventDoubleClickEditing?i().createElement("div",{className:this.props.className,style:{whiteSpace:"pre"}},this.state.text||this.props.placeholder):i().createElement("div",{className:this.props.className,onDoubleClick:this.startEditing,style:{whiteSpace:"pre"}},this.state.text||this.props.placeholder)}}],n&&l(a.prototype,n),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,n}(i().Component);m.propTypes={text:i().PropTypes.string.isRequired,paramName:i().PropTypes.string.isRequired,change:i().PropTypes.func.isRequired,placeholder:i().PropTypes.string,activeClassName:i().PropTypes.string,minLength:i().PropTypes.number,maxLength:i().PropTypes.number,validate:i().PropTypes.func,onNavigate:i().PropTypes.func,element:i().PropTypes.string};const h=m},85519:(e,t,a)=>{var n=a(48287).Buffer;a(47500),e.exports={copyArrayBuffer:function(e){var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},toBuffer:function(e){for(var t=n.alloc(e.byteLength),a=new Uint8Array(e),i=0;i<t.length;++i)t[i]=a[i];return t},toArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),n=0;n<e.length;++n)a[n]=e[n];return t},removeExifJPG:function(e,t){var a=this.toBuffer(e);if(!(null==a||a.length<2)){if(null==t&&(t={}),"ffd8"!==a[0].toString(16)+a[1].toString(16))throw new Error("Not a JPEG");for(var i=[],s=0,o=0;o+1<a.length&&(bytePortion=a[o].toString(16)+a[o+1].toString(16),"ffda"!==bytePortion);o++)switch(bytePortion){case"ffe1":offsetSize=256*a[o+2]+a[o+3];var r=o;if(t.keepMarker&&(a[o+2]=0,a[o+3]=2,r=o+4),i.push({start:s,end:r}),s=o+offsetSize+2,t.verbose&&(o=s),t.verbose)break}i.push({start:s,end:a.length}),t.verbose&&i.forEach(function(e){});var l=i.map(function(e){return a.slice(e.start,e.end)});return n.concat(l)}},parsePNG:function(e){var t=this.toBuffer(e),a=[],n=8,i=t.length;if(this.isPng(t))for(;n<i;){var s=t.readUIntBE(n,4),o=n+s+12,r=t.slice(n,o),l={};l.size=s,l.type=r.toString("utf8",4,8),l.data=r.slice(8,8+s),l.crc=r.readUIntBE(8+s,4),a.push(l),n=o}return a},removeExifPNG:function(e){var t=this.toBuffer(e),a=[],i=8,s=t.length;if(this.isPng(t)){var o=t.slice(0,8);for(a.push(o);i<s;){var r=t.readUIntBE(i,4),l=i+r+12,d=t.slice(i,l),c={};c.size=r,c.type=d.toString("utf8",4,8),c.data=d.slice(8,8+r),-1===c.type.toUpperCase().indexOf("TXT")&&-1===c.type.toUpperCase().indexOf("PHYS")&&a.push(d),i=l}}return n.concat(a)},isPng:function(e){return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]},isAPNG:function(e){var t=this.toBuffer(e),a=8,n=t.length,i=!1;if(this.isPng(t))for(;a<n;){var s=t.readUIntBE(a,4),o=a+s+12,r=t.slice(a,o),l={};if(l.size=s,l.type=r.toString("utf8",4,8),l.data=r.slice(8,8+s),-1!=l.type.toUpperCase().indexOf("ACTL"))return i=!0;a=o}return i}}},86025:(e,t,a)=>{"use strict";a.d(t,{A:()=>n}),a(6411);const n={shortcuts:[],currentDomElement:null,combos:[],registeredDomElements:[],createShortcut:function(e,t,a){if(""!=e)if(t){var n={combo:e,callback:t,domElement:a};this.shortcuts.push(n),a&&null==this.registeredDomElements.find(function(e){return e===a})&&(a.addEventListener("mouseenter",function(e){this.currentDomElement=a}.bind(this)),a.addEventListener("mouseleave",function(e){this.currentDomElement=null}.bind(this)),this.registeredDomElements.push(a)),null==this.combos.find(function(t){return t===e})&&(Mousetrap.bind(e,function(e,t){return this.masterCallback(e,t),!1}.bind(this)),this.combos.push(e))}else console.error("callback cannot be empty");else console.error("combo cannot be empty")},masterCallback:function(e,t){e.preventDefault(),e.stopPropagation();var a=this.shortcuts.find(function(e){return(null==e.domElement||e.domElement==this.currentDomElement)&&e.combo===t}.bind(this));a&&a.callback()}}},89634:(e,t,a)=>{"use strict";e.exports=a(92007),e.exports.Panel=a(46784)},94108:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(40927),i=a.n(n),s=a(82327),o=a.n(s),r=a(9769);const l=i().createClass({displayName:"CheckboxInput",getInitialState:function(){return{guid:o().guid()}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!r.compareObject(t,this.state)||!r.compareObject(e,this.props)},onValueChanged:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e.target.checked,e)},render:function(){return i().createElement("div",{className:"form-inline",style:{height:this.props.height?this.props.height:"auto"}},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"checkbox"},i().createElement("div",{className:"bar",style:{position:"relative"}},i().createElement("input",{type:"checkbox",id:this.state.guid,onChange:this.onValueChanged,checked:this.props.value,disabled:this.props.disabled}),i().createElement("label",{htmlFor:this.state.guid,className:"checkbox-label"})))))}})},94768:(e,t,a)=>{"use strict";a.d(t,{A:()=>Xe});var n=a(40927),i=a.n(n),s=a(2774),o=a(9769);const r=i().createClass({displayName:"TextAreaInput",getInitialState:function(){return this.firstClick=!0,{}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!o.compareObject(e,this.props)||!o.compareObject(t,this.state)},onChange:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e.target.value)},onKeyDown:function(e){if("PageUp"==e.key&&(window.scrollTo(0,window.scrollY),e.preventDefault(),e.target.setSelectionRange(0,0),e.target.scrollTop=0),"PageDown"==e.key){window.scrollTo(0,window.scrollY),e.preventDefault();var t=e.target.value.length;e.target.setSelectionRange(t,t),e.target.scrollTop=999999}},onFocus:function(e){e.target.select()},onBlur:function(e){this.firstClick=!0},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},render:function(){var e=3;this.props.rows&&(e=this.props.rows);var t=40;return this.props.cols&&(t=this.props.cols),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group bootstrap-touchspin textarea-wrapper",style:{height:"auto"}},i().createElement("textarea",{dir:"auto",className:"form-control",value:this.props.value,onChange:this.onChange,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,rows:e,cols:t,disabled:this.props.disabled}))))}});var l=a(66828),d=a(59862),c=a(99547),p=a(9769);const u=i().createClass({displayName:"Audio",getInitialState:function(){return this.firstClick=!0,{}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!p.compareObject(t,this.state)||!p.compareObject(e,this.props)},openAudioBrowserModal:function(){this.props.disabled||(this.props.onAudioBrowserClicked?this.props.onAudioBrowserClicked(this.props.name):(c.A.audioSingleton.config({onUpload:this.onUpload,onInsertFromWeb:this.onInsertFromWeb,onSelect:this.onSelect}),$("#"+c.A.audioModalId).modal("show")))},onTextInputFocus:function(e){e.target.select()},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},render:function(){var e="input-group-addon image-browser-picker-wrapper",t=this.props.disabled;return t&&(e+=" disabled"),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group image-picker"},i().createElement("div",{className:e,onClick:this.openAudioBrowserModal,disabled:t},i().createElement("i",{className:"fa fa-music"})),i().createElement("input",{type:"text",className:"form-control",value:this.props.value,onFocus:this.onTextInputFocus,disabled:t,onChange:this.handleValueChange,onMouseDown:this.onMouseDown}))))},updateField:function(e){this.props.onValueChanged&&("string"==typeof e&&e.length>2048&&(e=e.substring(0,2048)),this.props.onValueChanged(this.props.name,e))},handleValueChange:function(e){this.updateField(e.target.value)},onSelect:function(e){this.updateField(e.url)},onUpload:function(e){this.updateField(e.url)},onInsertFromWeb:function(e){this.updateField(e)}});var m=a(9769);const h=i().createClass({displayName:"Video",getInitialState:function(){return this.firstClick=!0,{}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!m.compareObject(t,this.state)||!m.compareObject(e,this.props)},openVideoBrowserModal:function(){this.props.disabled||(this.props.onVideoBrowserClicked?this.props.onVideoBrowserClicked(this.props.name):(c.A.videoSingleton.config({onUpload:this.onUpload,onInsertFromWeb:this.onInsertFromWeb,onSelect:this.onSelect}),$("#"+c.A.videoModalId).modal("show")))},onTextInputFocus:function(e){e.target.select()},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},render:function(){var e="input-group-addon image-browser-picker-wrapper",t=this.props.disabled;return t&&(e+=" disabled"),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group image-picker"},i().createElement("div",{className:e,onClick:this.openVideoBrowserModal,disabled:t},i().createElement("i",{className:"fa fa-video-camera"})),i().createElement("input",{type:"text",className:"form-control",value:this.props.value,onFocus:this.onTextInputFocus,disabled:t,onChange:this.handleValueChange,onMouseDown:this.onMouseDown}))))},updateField:function(e){this.props.onValueChanged&&("string"==typeof e&&e.length>2048&&(e=e.substring(0,2048)),this.props.onValueChanged(this.props.name,e))},handleValueChange:function(e){this.updateField(e.target.value)},onSelect:function(e){this.updateField(e.url)},onUpload:function(e){this.updateField(e.url)},onInsertFromWeb:function(e){this.updateField(e)}});var f=a(9769);const g=i().createClass({displayName:"Json",getInitialState:function(){return this.firstClick=!0,{}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!f.compareObject(t,this.state)||!f.compareObject(e,this.props)},openJsonBrowserModal:function(){this.props.disabled||(this.props.onJsonBrowserClicked?this.props.onJsonBrowserClicked(this.props.name):(c.A.jsonSingleton.config({onUpload:this.onUpload,onInsertFromWeb:this.onInsertFromWeb,onSelect:this.onSelect}),$("#"+c.A.jsonModalId).modal("show")))},onTextInputFocus:function(e){e.target.select()},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},render:function(){var e="input-group-addon image-browser-picker-wrapper",t=this.props.disabled;return t&&(e+=" disabled"),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group image-picker"},i().createElement("div",{className:e,onClick:this.openJsonBrowserModal,disabled:t},i().createElement("i",{className:"fa fa-file-code-o"})),i().createElement("input",{type:"text",className:"form-control",value:this.props.value,onFocus:this.onTextInputFocus,disabled:t,onChange:this.handleValueChange,onMouseDown:this.onMouseDown}))))},updateField:function(e){this.props.onValueChanged&&("string"==typeof e&&e.length>2048&&(e=e.substring(0,2048)),this.props.onValueChanged(this.props.name,e))},handleValueChange:function(e){this.updateField(e.target.value)},onSelect:function(e){this.updateField(e.url)},onUpload:function(e){this.updateField(e.url)},onInsertFromWeb:function(e){this.updateField(e)}});var v=a(9769);const b=i().createClass({displayName:"Data",getInitialState:function(){return this.firstClick=!0,{status:"",checkerBoardRenderer:""}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!v.compareObject(t,this.state)||!v.compareObject(e,this.props)},openDataBrowserModal:function(){this.props.disabled||(this.props.onDataBrowserClicked?this.props.onDataBrowserClicked(this.props.name):(c.A.dataSingleton.config({onUpload:this.onUpload,onInsertFromWeb:this.onInsertFromWeb,onSelect:this.onSelect}),$("#"+c.A.dataModalId).modal("show")))},onTextInputFocus:function(e){e.target.select()},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},render:function(){var e="rgb(95, 95, 95) ",t="#393939",a="input-group-addon image-browser-picker-wrapper",n=this.props.disabled;n&&(e="#4b4b4b",t="#393939",a+=" disabled");var s=this.state.checkerBoardRenderer;if(void 0!==s&&""!=s){s.clear();var o=s.pattern(16,16,function(a){a.rect(16,16).fill(e),a.rect(8,8).fill(t),a.rect(8,8).fill(t).move(8,8)});s.rect("28","28").move(-14,-14).fill(o)}return i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group image-picker"},i().createElement("div",{className:a,onClick:this.openDataBrowserModal,disabled:n},i().createElement("i",{className:"fa fa-database"})),i().createElement("input",{type:"text",className:"form-control",value:this.props.value,onFocus:this.onTextInputFocus,disabled:n,onChange:this.handleValueChange,onMouseDown:this.onMouseDown}))))},updateField:function(e){this.props.onValueChanged&&("string"==typeof e&&e.length>2048&&(e=e.substring(0,2048)),this.props.onValueChanged(this.props.name,e))},handleValueChange:function(e){this.updateField(e.target.value)},onSelect:function(e){this.updateField(e.url)},onUpload:function(e){this.updateField(e.url)},onInsertFromWeb:function(e){this.updateField(e)}});var y=a(18093),w=a.n(y),E=a(15734),I=a.n(E),N=a(13023);const S=i().createClass({displayName:"FileUpload",getInitialState:function(){return{status:""}},componentWillMount:function(){},onDrop:function(e){this.setState({status:"Uploading..."});var t=I().post("/fileuploads");t.field("path","files"),t.field("type","binary"),t.attach("file",e[0]),t.end(function(t,a){if(t)N.A.add(N.A.TYPE.ERROR,{title:"Cannot upload file "+e[0],description:t.message});else{if(a.headers.location)return void(window.location=a.headers.location);this.props.onValueChanged&&this.props.onValueChanged(this.props.name,a.body.url),this.setState({status:""})}}.bind(this))},render:function(){var e;return this.props.value&&(e=i().createElement("a",{href:this.props.value,title:this.props.value,target:"_blank"},"Download")),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement(w(),{onDrop:this.onDrop,style:{width:"70px",height:"20px",border:"solid 1px",cursor:"pointer",display:"inline-block",textAlign:"center",marginRight:"10px"}},"Browse..."),this.state.status,e))}});var C=a(31486),x=a(94108),F=a(91605),D=a(87195),k=a.n(D),T=a(58776),R=a.n(T),A=a(10036);function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}var U=a(87021),P=a(10611),B=a(9769);const V=i().createClass({displayName:"PresetSelectionInput",getInitialState:function(){return this.controller=null,this.signal=null,this.uuid=P.v4(),{dropDownOpen:!1,filterValue:"",fetchDataBusy:!1,fetchDataError:"",urlData:[]}},componentWillMount:function(){},componentDidMount:function(){var e=this;if("url"==this.props.source){var t=A.A.register(this.props.sourceUrl,this.uuid,this.onReceivedJsonUrlData);this.onReceivedJsonUrlData(t)}this.refs.dropdownInput&&($(this.refs.dropdownInput).on("show.bs.dropdown",function(){e.setState({dropDownOpen:!0},function(){var e=this;setTimeout(function(){$(e.refs.filterInputField).focus()},250)})}),$(this.refs.dropdownInput).on("hide.bs.dropdown",function(){e.setState({dropDownOpen:!1,filterValue:""})}))},componentWillUnmount:function(){"url"==this.props.source&&A.A.unregister(this.props.sourceUrl,this.uuid)},shouldComponentUpdate:function(e,t){return!B.compareObject(e,this.props)||!B.compareObject(t,this.state)},componentWillReceiveProps:function(e){if((e.source!=this.props.source||e.sourceUrl!=this.props.sourceUrl)&&("url"==this.props.source&&A.A.unregister(this.props.sourceUrl,this.uuid),"url"==e.source)){var t=A.A.register(e.sourceUrl,this.uuid,this.onReceivedJsonUrlData);this.onReceivedJsonUrlData(t)}},onReceivedJsonUrlData:function(e){var t=this;"fetching"===e.status?this.setState({fetchDataBusy:!0,urlData:[],fetchDataError:""}):"ok"===e.status?(this.setState({fetchDataBusy:!1,urlData:e.data,fetchDataError:""}),0===e.data.filter(function(e){return t.comparePayloadAndValue(e.payload,t.props.value)}).length?this.props.onPresetCustomization(!0):this.props.onPresetCustomization(!1)):"error"===e.status?(this.setState({fetchDataBusy:!1,urlData:[],fetchDataError:e.message}),this.props.onPresetCustomization(!0)):(console.log("onReceivedJsonUrlData. Should not happen",e),this.setState({fetchDataBusy:!1,urlData:[],fetchDataError:""}),this.props.onPresetCustomization(!0))},onClick:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e.payload)},onFilterValueChanged:function(e){this.setState({filterValue:e.target.value})},onFilterKeyDown:function(e){return"Escape"==e.key?(this.setState({filterValue:""}),e.preventDefault(),void e.stopPropagation()):"Enter"!=e.key&&"Tab"!=e.key?" "==e.key?(this.setState({filterValue:this.state.filterValue+" "}),e.preventDefault(),void e.stopPropagation()):void 0:void(this.props.onEnterKey&&this.props.onEnterKey(this.props.name,this.state.filterValue))},comparePayloadAndValue:function(e,t){if(void 0===e||"object"!==O(e))return!1;var a=!1;for(var n in e)if(void 0!==e[n]&&void 0!==t[n]){if(!1===B.compareObject2(e[n],t[n]))return!1;a=!0}return a},render:function(){var e=this,t=this.props.format||"text",a=this.state.filterValue.trim().toLowerCase(),n="110px",s="0px";"url"==this.props.source&&this.props.useReload&&(s="24px");var o,r=function(e){var a="5px",n="20px";"large"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"large")&&(a="0px",n="30px");var s=e.title;if(void 0===s&&(s=void 0===e.id?"invalid":e.id),"image"===t||e.icon)return i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"left",maxWidth:"100%",marginLeft:a,marginRight:a}},i().createElement("img",{style:{width:n,height:n,objectFit:"contain",visibility:"hidden"},src:e.icon?e.icon:e.id,onLoad:function(e){e.target.style.visibility="visible"},onError:function(e){e.target.style.visibility="hidden"},alt:"selection icon"}),i().createElement("div",{style:{marginLeft:"5px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},s));if("color"===t){var o=U(e.id);return o.isValid()||(o=U("transparent")),i().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"left",maxWidth:"100%",marginLeft:a,marginRight:a}},i().createElement("div",{style:{width:"20px",height:"20px",backgroundColor:o}}),i().createElement("div",{style:{marginLeft:"5px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},s))}return i().createElement("div",{style:{maxWidth:"100%",marginLeft:a,marginRight:a,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",textAlign:"left"}},s)},l=this.props.selections;if(this.props.options&&(l=this.props.options),"string"==typeof l)try{l=JSON.parse(l)}catch(e){l=[]}"url"==this.props.source&&(l=this.state.fetchDataError?[]:[].concat([{id:"--customize--",title:"Edit"},{id:"--divider--",title:"--divider--"}],function(e){if(Array.isArray(e))return M(e)}(o=this.state.urlData)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?M(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));var d,c="Selection empty",p="Selection empty",u=null,m=this.props.disabled,h=" dropdown-toggle",f={height:"24px",width:n,padding:"0px"};if(l&&l.length){var g=l.filter(function(t){return e.comparePayloadAndValue(t.payload,e.props.value)});!this.props.isCustomize&&g.length?(p=this.props.valueRenderer?this.props.valueRenderer(g[0]):r(g[0],"center"),c=g[0].title):c=p=i().createElement("span",{style:{marginLeft:"5px"}},"Edit"),u=i().createElement("ul",{className:"dropdown-menu",style:{minWidth:n,maxHeight:"240px",overflowY:"auto"}},l.map(function(t,n){var s,o=t.title;return""==a||-1!==o.toLowerCase().indexOf(a)&&"--divider--"!=o?"object"===O(s=e.props.valueRenderer?e.props.valueRenderer(t):r(t))&&"divider"==s.props.className||"--divider--"==o?i().createElement("li",{key:n,className:"divider"}):i().createElement("li",{key:n},i().createElement("a",{onClick:e.onClick.bind(e,t),style:{maxWidth:"350px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"}},s)):null}))}else m=!0,h="",f.width=n,u=i().createElement("ul",{className:"dropdown-menu",style:{opacity:0}});this.state.fetchDataBusy&&(p=i().createElement("div",{style:{width:"100%",textAlign:"center"}},i().createElement("img",{style:{position:"relative",height:"24px"},src:"/images/loading-bubbles.svg",className:"loader"}))),"url"==this.props.source&&this.state.fetchDataError&&(p=i().createElement(k(),{placement:"top",delayShow:500,overlay:i().createElement(R(),{id:"error-info"},this.state.fetchDataError)},i().createElement("div",{style:{display:"flex",textAlign:"center",justifyContent:"center",gap:"10px",width:"100%",color:"#f7892e"}},i().createElement("span",null,"Error"),i().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"14px",position:"relative",top:"1px"}})))),d=this.props.useFilter&&this.state.dropDownOpen?i().createElement("input",{type:"text",className:"form-control",value:this.state.filterValue,placeholder:c,onChange:this.onFilterValueChanged,onKeyDown:this.onFilterKeyDown,style:{left:"0px",top:"0px",width:"calc(100% - 20px)",height:"20px",minHeight:"27px",position:"absolute",textAlign:"center"},ref:"filterInputField"}):i().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:"calc(100% - 30px)",textAlign:"left"}},p);var v="";v=this.props.dropup?" dropup":" dropdown";var b="btn-default";this.props.theme&&"light"==this.props.theme&&(v+=" dropdown-white",b="btn-white");var y,w,E="";if(this.props.dropDownDataDisplay&&(E=this.props.dropDownDataDisplay),"url"==this.props.source&&this.props.useReload&&!this.state.fetchDataBusy&&(y=i().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-url-reload",onClick:function(){var t=A.A.get(e.props.sourceUrl,!1);e.onReceivedJsonUrlData(t)},disabled:m||this.state.fetchDataBusy,style:{height:"24px",right:"-24px"}},i().createElement("i",{className:"fa fa-refresh"}))),this.props.inline&&1==this.props.inline)w=i().createElement("span",{className:"inline-dropdown",ref:"dropdownInput"},i().createElement("button",{type:"button",className:"btn timeline-control"+h+" "+b,"data-toggle":"dropdown","data-display":E,"aria-haspopup":"true","aria-expanded":"false",disabled:m,tabIndex:"-1",style:f},d),y,u);else{var I=(this.props.className||"")+v;w=i().createElement("div",{className:I,style:{maxWidth:n,marginRight:s},ref:"dropdownInput"},i().createElement("button",{type:"button",className:"btn timeline-control"+h+" "+b,"data-toggle":"dropdown","data-display":E,"aria-haspopup":"true","aria-expanded":"false",disabled:m,tabIndex:"-1",style:f},d),y,u)}return w}});var L=a(11341),j=a.n(L);const W=i().createClass({displayName:"RangeInput",getInitialState:function(){return{}},componentWillMount:function(){},onChange:function(e,t){var a=[];a.push(Number(e[0])),a.push(Number(e[1])),this.props.onValueChanged&&this.props.onValueChanged(this.props.name,a)},render:function(){return null==this.props.value?i().createElement("div",null):i().createElement("div",null,i().createElement("div",null,i().createElement("table",null,i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",null,i().createElement("div",{className:"input-group bootstrap-touchspin"},i().createElement("input",{type:"text",className:"form-control",value:this.props.value[0],disabled:!0}),i().createElement("span",{className:"input-group-btn-vertical"},i().createElement("button",{className:"btn btn-default bootstrap-touchspin-up",tabIndex:"-1",type:"button"},i().createElement("i",{className:"fa fa-chevron-up"}," disabled=",this.props.disabled," ")),i().createElement("button",{className:"btn btn-default bootstrap-touchspin-down",tabIndex:"-1",type:"button"},i().createElement("i",{className:"fa fa-chevron-down"}," disabled=",this.props.disabled," "))))),i().createElement("td",null,i().createElement(j(),{onChange:this.onChange,range:{min:this.props.min,max:this.props.max},step:this.props.step,margin:this.props.margin,connect:!0,behaviour:"tap-drag",start:this.props.value})),i().createElement("td",null,i().createElement("div",{className:"input-group bootstrap-touchspin"},i().createElement("input",{type:"text",className:"form-control",value:this.props.value[1],disabled:!0}),i().createElement("span",{className:"input-group-btn-vertical"},i().createElement("button",{className:"btn btn-default bootstrap-touchspin-up",tabIndex:"-1",type:"button"},i().createElement("i",{className:"fa fa-chevron-up"}," disabled=",this.props.disabled," ")),i().createElement("button",{className:"btn btn-default bootstrap-touchspin-down",tabIndex:"-1",type:"button"},i().createElement("i",{className:"fa fa-chevron-down"}," disabled=",this.props.disabled," "))))))))))}});var _=a(84348),q=a(31018),G=a.n(q),Y=a(17334),J=a.n(Y),z=a(9769),H=[];const K=i().createClass({displayName:"SingularFontBrowser",mixins:[G()],filter:"",sort:"popularity",category:"all",getInitialState:function(){return this.debounceUpdateDisplayFont=J()(this.updateDisplayFont,300),{fontToLoad:50,filterValue:"",displayFont:[],selectedFont:[],fontFilterOptions:[{id:"popularity",title:"Popularity"},{id:"alpha",title:"Alphabetical"},{id:"date",title:"Date Added"},{id:"trending",title:"Trending"}],fontCategoryOptions:[{id:"all",title:"All"},{id:"display",title:"Display"},{id:"handwriting",title:"Handwriting"},{id:"monospace",title:"Monospace"},{id:"serif",title:"Serif"},{id:"sans-serif",title:"Sans-serif"}]}},componentWillMount:function(){},componentWillReceiveProps:function(e){this.setState({selectedFont:e.fonts})},componentDidMount:function(){this.setState({selectedFont:this.props.fonts}),this.loadFonts(),this.loadSelectedFonts()},shouldComponentUpdate:function(e,t){return!z.compareObject(e,this.props)||!z.compareObject(t,this.state)},loadSelectedFonts:function(){for(var e=0;e<this.state.selectedFont.length;e++){var t={family:this.state.selectedFont[e].family,weight:"400"};_.A.LoadFont(t)}},loadFonts:function(){if(0==H.length){var e="https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyCkDXDC_Oo2K7SAUM0UCbNBy8c6mWmMwS0&sort="+this.sort;I().get(e).end(function(e,t){var a=JSON.parse(t.text);H=a.items,this.updateDisplayFont()}.bind(this))}},updateDisplayFont:function(){var e=H.slice(0,this.state.fontToLoad);this.filter.trim().length>0&&(e=e.filter(function(e){var t=this.filter.toLowerCase();return-1!=e.family.toLowerCase().indexOf(t)}.bind(this))),"all"!=this.category&&(e=e.filter(function(e){return this.category.toLowerCase()==e.category.toLowerCase()}.bind(this)));for(var t=e.map(function(e){return e.family}),a=0;a<t.length;a++){var n={family:t[a],weight:"400"};_.A.LoadFont(n)}this.setState({filterValue:this.filter,displayFont:e})},onSelect:function(e){this.props.onSelect&&this.props.onSelect(e)},onSortChange:function(e,t){this.sort=t,this.loadFonts()},onCategoryChange:function(e,t){this.category=t,this.updateDisplayFont()},categoryRenderer:function(e){return i().createElement("div",null,e.title)},onSearchChange:function(e){this.filter=e.target.value,this.setState({filterValue:this.filter}),this.debounceUpdateDisplayFont()},clearSearchBox:function(){this.filter="",this.updateDisplayFont()},loadMore:function(){this.setState({fontToLoad:this.state.fontToLoad+=1e3}),this.updateDisplayFont()},toggleFontSelection:function(e){var t=this.state.selectedFont.filter(function(t){return e.family==t.family});if(t.length>0){var a=this.state.selectedFont.indexOf(t[0]);(n=this.state.selectedFont.slice(0)).splice(a,1),this.setState({selectedFont:n})}else{var n;(n=this.state.selectedFont.slice(0)).push(e),this.setState({selectedFont:n})}},removeFontSelection:function(e){var t=this.state.selectedFont.indexOf(e);if(t>-1){var a=this.state.selectedFont.slice(0);a.splice(t,1),this.setState({selectedFont:a})}},onOkay:function(){this.props.onClose&&this.props.onClose(!0,this.state.selectedFont)},onCancel:function(){this.props.onClose&&this.props.onClose(!1,this.state.selectedFont)},render:function(){var e=this.filter?"fa fa-times input-clear-icon-font":"fa fa-search input-clear-icon-font",t=function(e){var t=e.family,a=new RegExp("\\+","g"),n=t.replace(a," "),s=n.split(":"),o={fontFamily:'"'+(n=s[0])+'"',fontWeight:s[1]?s[1]:400};return i().createElement("li",{key:t,className:"fontBrowser-font-box",onClick:this.removeFontSelection.bind(this,e)},i().createElement("span",{className:"fontBrowser-font-name",style:o},n))}.bind(this),a=function(e){var t,a=e.family,n=new RegExp("\\+","g"),s=a.replace(n," "),o=s.split(":"),r={fontFamily:'"'+(s=o[0])+'"',fontWeight:o[1]?o[1]:400};return this.state.selectedFont.filter(function(e){return e.family==a}).length>0&&(t=i().createElement("i",{className:"fa fa-check pull-right"})),i().createElement("li",{key:a,className:"fontBrowser-loaded-box",onClick:this.toggleFontSelection.bind(this,e)},i().createElement("span",{className:"fontBrowser-loaded-name",style:r},s),t)}.bind(this);return i().createElement("div",{id:"fontBrowserModal",className:"modal fade u-displaynone singular-modal",style:{overflow:"hidden"},tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"modal-dialog",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-header"},i().createElement("button",{type:"button",tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close"},i().createElement("span",{"aria-hidden":"true"},i().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),i().createElement("h4",{className:"modal-title"},"Font Browser")),i().createElement("div",{className:"modal-body"},i().createElement("div",{className:"row fontBrowserOptions"},i().createElement("div",{className:"col-md-4"},i().createElement("i",{className:e,onClick:this.clearSearchBox}),i().createElement("input",{type:"text",className:"form-control",onChange:this.onSearchChange,value:this.state.filterValue,style:{paddingLeft:"20px"}})),i().createElement("div",{className:"col-md-8"},i().createElement("div",{className:"relative dropdown-wrapper"},i().createElement(F.A,{key:"fontCategories",name:"fontCategories",title:"fontCategories",selections:this.state.fontCategoryOptions,value:this.category,onValueChanged:this.onCategoryChange,valueRenderer:this.categoryRenderer})),i().createElement("div",{className:"pull-right"},i().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.loadMore},"Load all fonts")))),i().createElement("div",{className:"row lists-wrapper"},i().createElement("div",{className:"col-sm-6 list-wrapper"},i().createElement("div",{className:"panel"},i().createElement("div",{className:"panel-header"},"Available Fonts  ",i().createElement("span",null,"(",this.state.displayFont.length,")"),i().createElement(k(),{placement:"top",delayShow:500,overlay:i().createElement(R(),{id:"position"},"Click on a font to add/remove")},i().createElement("i",{className:"fa fa-info-circle pull-right"}))),i().createElement("div",{className:"panel-body"},i().createElement("ul",{className:"browser-tree font-tree"},this.state.displayFont.map(a))))),i().createElement("div",{className:"col-sm-6 list-wrapper"},i().createElement("div",{className:"panel"},i().createElement("div",{className:"panel-header"},"My Fonts ",i().createElement("span",null,"(",this.state.selectedFont.length,")"),i().createElement(k(),{placement:"top",delayShow:500,overlay:i().createElement(R(),{id:"position"},"Click on a font to remove")},i().createElement("i",{className:"fa fa-info-circle pull-right"}))),i().createElement("div",{className:"panel-body"},i().createElement("ul",{className:"browser-tree font-tree"},this.state.selectedFont.map(t))))))),i().createElement("div",{className:"modal-footer"},i().createElement("button",{tabIndex:"-1",className:"btn btn-default","data-dismiss":"modal",onClick:this.onOkay},"Save"),i().createElement("button",{tabIndex:"-1",className:"btn btn-default","data-dismiss":"modal",onClick:this.onCancel},"Cancel")))))}});a(47500);var Q=[],X=[],Z=[{family:"Open Sans",weight:"400",variants:["300","400","600","700","800"]}];const ee=i().createClass({displayName:"SingularFont",getInitialState:function(){return{userFonts:[],accountFonts:[]}},loadAccountFonts:function(){var e=this;this.state.accountFonts.length||(X.length?this.setState({accountFonts:X}):I().get("/apiv1/fonts/account").end(function(t,a){if(t)N.A.add(N.A.TYPE.ERROR,{title:"Cannot load account fonts",description:t.message});else{var n=a.body;n.sort(function(e,t){return(e.family>t.family)-.5}),e.setState({accountFonts:n}),X=n;for(var i=0;i<n.length;i++){var s=n[i].variants;if(s)for(var o=0;o<s.length;o++)s[o]=e.convertNameToId(s[o]);_.A.LoadFont(n[i])}}}))},loadUserFonts:function(e){var t=this;this.state.userFonts.length||(Q.length?this.setState({userFonts:Q}):I().get("/apiv1/fonts").end(function(e,a){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot load user fonts",description:e.message});else{var n=a.body;n.length||(n=Z),t.setState({userFonts:a.body}),Q=n;for(var i=0;i<n.length;i++){var s=n[i].variants;if(s)for(var o=0;o<s.length;o++)s[o]=t.convertNameToId(s[o]);_.A.LoadFont(n[i])}}}))},saveUserFonts:function(e,t){I().put("/apiv1/fonts").send({name:JSON.stringify(e)}).set("Content-Type","application/x-www-form-urlencoded").end(function(e,a){e?N.A.add(N.A.TYPE.ERROR,{title:"Cannot save user fonts",description:e.message}):t&&t(a.body)}.bind(this))},componentWillMount:function(){this.loadUserFonts(),this.loadAccountFonts()},onToggleButton:function(e,t){if(this.props.onValueChanged){var a={};$.extend(!0,a,this.props.value),a[e]=!this.props.value[e],this.props.onValueChanged(this.props.name,a)}},setAlignment:function(e){if(this.props.onValueChanged){var t={};$.extend(!0,t,this.props.value),t.alignment=e,this.props.onValueChanged(this.props.name,t)}},onFontChanged:function(e,t){if(-1!=t)if(-2==t)$("#fontBrowserModal").appendTo("body").modal("show");else if(this.props.onValueChanged){var a,n=t.charAt(0),i=Number(t.substring(1));if("U"==n&&Q[i]&&(a=Q[i]),"A"==n&&X[i]&&(a=X[i]),!a)return;var s={};$.extend(!0,s,this.props.value),s.fontData={},s.fontData.family=a.family,"A"==n?(s.fontData.custom=!0,s.fontData.url=a.url,a.metrics&&(s.fontData.metrics=a.metrics)):(delete s.fontData.custom,delete s.fontData.url);var o=a.variants,r=this.props.value.fontData.weight,l=void 0;o.length>0&&(void 0===l&&void 0!==o.find(function(e){return e===r})&&(l=r),void 0===l&&void 0!==o.find(function(e){return"400"===e})&&(l="400"),void 0===l&&void 0!==o.find(function(e){return"300"===e})&&(l="300"),void 0===l&&void 0!==o.find(function(e){return"500"===e})&&(l="500"),void 0===l&&(l=o[0])),s.fontData.weight=this.convertNameToId(l),this.props.onValueChanged(this.props.name,s)}},fontRenderer:function(e){var t=e.title;return"More fonts ..."==t?i().createElement("div",null,t):"-divider-"==t?i().createElement("div",{className:"divider"}):i().createElement("div",{style:{fontFamily:'"'+t+'"',fontWeight:400}},t)},weightRenderer:function(e){return i().createElement("div",{style:{fontFamily:'"'+this.props.value.fontData.family+'"',fontWeight:e.id}},e.title)},onWeightChanged:function(e,t){if(this.props.onValueChanged){var a={};$.extend(!0,a,this.props.value),a.fontData.weight=t,a.bold=0,this.props.onValueChanged(this.props.name,a)}},convertIdToName:function(e){return e.replace("100","Thin").replace("200","Extra-Light").replace("300","Light").replace("normal","Regular").replace("regular","Regular").replace("400","Regular").replace("500","Medium").replace("600","Semi-Bold").replace("700","Bold").replace("800","Extra-Bold").replace("900","Black").trim()},convertNameToId:function(e){switch(e){case"regular":case"normal":return"400";case"bold":return"700"}return e},convertVariantToSelection:function(e){var t=[];if(e&&e.length)for(var a=0;a<e.length;a++)-1==e[a].indexOf("italic")&&t.push({id:this.convertNameToId(e[a]),title:this.convertIdToName(e[a])});return t},render:function(){var e,t,a,n=null;(e=this.state.userFonts.find(function(e){return e.family==this.props.value.fontData.family}.bind(this)))||(e=this.state.accountFonts.find(function(e){return e.family==this.props.value.fontData.family}.bind(this)));var s=[];if(e||(s.push({id:"-1",title:this.props.value.fontData.family}),t="-1",a=this.props.value.fontData.weight,n=[{id:this.convertNameToId(a),title:this.convertIdToName(a)}],(this.state.userFonts.length||this.state.accountFonts.length)&&s.push({id:"-1",title:"-divider-"})),this.state.accountFonts.length&&(this.state.accountFonts.map(function(a,n){s.push({id:"A"+n,title:a.family}),e==a&&(t="A"+n)}),s.push({id:"-1",title:"-divider-"})),this.state.userFonts.length&&(this.state.userFonts.map(function(a,n){s.push({id:"U"+n,title:a.family}),e==a&&(t="U"+n)}),s.push({id:"-1",title:"-divider-"})),s.push({id:"-2",title:"More fonts ..."}),e&&e.variants&&(n=this.convertVariantToSelection(e.variants)).length>0){var o=this.props.value.fontData.weight;void 0===a&&void 0!==n.find(function(e){return e.id===o})&&(a=o),void 0===a&&void 0!==n.find(function(e){return"400"===e.id})&&(a="400"),void 0===a&&void 0!==n.find(function(e){return"300"===e.id})&&(a="300"),void 0===a&&void 0!==n.find(function(e){return"500"===e.id})&&(a="500"),void 0===a&&(a=n[0].id)}var r,l,d={width:"90px",float:"left"},c={width:"auto"};return this.props.item&&this.props.item.hideUI&&(this.props.item.hideUI.style&&(d={display:"none"}),this.props.item.hideUI.bold,this.props.item.hideUI.italic&&(r={display:"none"}),this.props.item.hideUI.underline&&(l={display:"none"}),this.props.item.hideUI.alignment&&(c.display="none")),i().createElement("div",null,i().createElement("div",{style:{width:"140px",float:"left"}},i().createElement(F.A,{key:"font",useFilter:!0,selections:s,value:t,onValueChanged:this.onFontChanged,valueRenderer:this.fontRenderer,disabled:this.props.disabled})),i().createElement("div",{style:{width:"140px",float:"left"}},i().createElement(F.A,{key:"weight",selections:n,value:a,onValueChanged:this.onWeightChanged,valueRenderer:this.weightRenderer,disabled:this.props.disabled})),i().createElement("div",{style:d},i().createElement("div",{className:"btn-group font-formatting-options"},i().createElement("button",{style:r,className:(this.props.value.italic?"active ":"")+"btn btn-default",tabIndex:"-1",onClick:this.onToggleButton.bind(this,"italic"),disabled:this.props.disabled},i().createElement("i",{className:"fa fa-italic"})),i().createElement("button",{style:l,className:(this.props.value.underline?"active ":"")+"btn btn-default",tabIndex:"-1",onClick:this.onToggleButton.bind(this,"underline"),disabled:this.props.disabled},i().createElement("i",{className:"fa fa-underline"})),i().createElement("div",{style:c,className:"btn-group"},i().createElement("button",{className:"btn btn-default dropdown-toggle small-dropdown","data-toggle":"dropdown",tabIndex:"-1","aria-haspopup":"true","aria-expanded":"false",disabled:this.props.disabled},i().createElement("i",{className:"fa fa-align-"+this.props.value.alignment})),i().createElement("ul",{className:"dropdown-menu small-dropdown ",disabled:this.props.disabled},i().createElement("li",{className:"dropdown-item",onClick:this.setAlignment.bind(this,"left")},i().createElement("a",{style:{color:"#d6d6d6"}},i().createElement("i",{className:"fa fa-align-left"}))),i().createElement("li",{className:"dropdown-item",onClick:this.setAlignment.bind(this,"center")},i().createElement("a",{style:{color:"#d6d6d6"}},i().createElement("i",{className:"fa fa-align-center"}))),i().createElement("li",{className:"dropdown-item",onClick:this.setAlignment.bind(this,"right")},i().createElement("a",{style:{color:"#d6d6d6"}},i().createElement("i",{className:"fa fa-align-right"}))),i().createElement("li",{className:"dropdown-item",onClick:this.setAlignment.bind(this,"justify")},i().createElement("a",{style:{color:"#d6d6d6"}},i().createElement("i",{className:"fa fa-align-justify"}))))))),i().createElement(K,{fonts:Q,onClose:this.onCloseFontBrowser}))},onCloseFontBrowser:function(e,t){1==e&&(this.saveUserFonts(t),0==t.length&&(t=Z.slice()),this.setState({userFonts:t}),Q=t)}});var te=a(40961),ae=a.n(te);function ne(e,t){if(e){if("string"==typeof e)return ie(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}var se=i().createClass({displayName:"self",mixins:[],colorChanged:!1,presets:[{title:"Assign Preset",id:"assign"},{title:"Glass",id:"glass",grips:[{pos:"0.0%",color:"rgb(0, 0, 0)",alpha:0,id:0},{pos:"50%",color:"rgb(0, 0, 0)",alpha:.3,id:1},{pos:"50.1%",color:"rgb(255, 255, 255)",alpha:.2,id:2},{pos:"100%",color:"rgb(0, 0, 0)",alpha:0,id:3},{pos:"100%",color:"rgb(0, 0, 0)",alpha:.2,id:4}],data:{angle:"-90.0"}},{title:"Drop Shadow",id:"dropShadow",grips:[{pos:"0.0%",color:"rgb(0, 0, 0)",alpha:0,id:0},{pos:"100%",color:"rgb(0, 0, 0)",alpha:1,id:1}],data:{angle:"-90.0"}},{title:"Light Gloss",id:"lightGloss",grips:[{pos:"0.0%",color:"rgb(0, 0, 0)",alpha:.45,id:0},{pos:"100%",color:"rgb(0, 0, 0)",alpha:0,id:1}],data:{angle:"-90.0"}},{title:"Heavy Gloss",id:"heavyGloss",grips:[{pos:"0%",color:"rgb(0, 0, 0)",alpha:.25,id:0},{pos:"30.0%",color:"rgb(0, 0, 0)",alpha:0,id:1},{pos:"100%",color:"rgb(0, 0, 0)",alpha:.65,id:2}],data:{angle:"90.0"}},{title:"Horizontal divider",id:"horizontalDivider",grips:[{pos:"50.0%",color:"rgb(0, 0, 0)",alpha:1,id:0},{pos:"50.1%",color:"rgb(255, 255, 255)",alpha:1,id:1}],data:{angle:"90.0"}},{title:"Vertical divider",id:"verticalDivider",grips:[{pos:"50.0%",color:"rgb(0, 0, 0)",alpha:1,id:0},{pos:"50.1%",color:"rgb(255, 255, 255)",alpha:1,id:1}],data:{angle:"0.0"}}],getInitialState:function(){return{dimensions:null,pickedId:null,value:0,grips:[{pos:"0%",color:"rgb(0, 0, 0)",alpha:1,id:0},{pos:"50%",color:"rgb(0, 255, 0)",alpha:1,id:1},{pos:"100%",color:"rgb(255, 0, 0)",alpha:1,id:2}]}},componentWillMount:function(){se.helper(this).loadGrips()},componentWillUnmount:function(){},componentDidMount:function(){},componentDidUpdate:function(){var e=se.helper(this);e.retrieveContainer(),e.fireColorChanged()},shouldComponentUpdate:function(e,t){var a=this.state,n=a.pickedId!==t.pickedId,i="number"==typeof a.pickedId;if(!this.props.needReload&&e.needReload)return se.helper(this).loadGrips(),this.state.pickedId=e.selectedGrip.id,!0;if(n)return!0;if(i){var s=this.findGripIndexById(a.pickedId),o=a.grips[s],r=a.pickedId!==e.selectedGrip.id,l=o.color!==e.selectedGrip.color,d=o.alpha!==e.selectedGrip.alpha;if(o.pos,e.selectedGrip.pos,r)return!1;if(l){var c=e.selectedGrip.color;o.color=c}if(d){var p=e.selectedGrip.alpha;o.alpha=p}this.colorChanged=l||d}return!0},findGripIndexById:function(e){var t=this.state.grips.findIndex(function(t){return t.id===e});return-1===t?0:t},renderContent:function(){var e=this,t=this.props.id+"-container",a=se.helper(this),n=a.fireGripChanged,s=function(t){var a=t.target.id.split("-")[1],i=parseInt(a);if(i!==e.state.pickedId){var s=e.state.grips[e.findGripIndexById(i)];e.setState({pickedId:i},function(){n(null,i,s)})}},o=function(i){var s=i.pickedId;if("number"==typeof s){var o=document.getElementById(t).getBoundingClientRect(),r=e.findGripIndexById(s),l=e.state.grips,d=l[r],c=a.limiter(i.clientX-o.x);d.pos=a.toPercent(c),l.sort(function(e,t){return parseFloat(e.pos)-parseFloat(t.pos)}),e.setState({pickedId:s,grips:l},function(){return n(l,s,d)})}},r=0,d=!1,c=this.state.grips.map(function(t,n){"number"!=typeof e.state.pickedId&&(e.state.pickedId=0);var l=t.id===e.state.pickedId,c={left:a.recalcPercent(t.pos),background:t.color,border:l?"2px inset #80bdff":"0px"};return l&&(r=t.pos,d=!0),i().createElement("div",{key:"grip-"+n,id:"grip-"+t.id,className:"gradientColorGrip",onMouseDown:function(e){return se.handleMouseDown(e,o)},onClick:s,style:c})}),p=function(t){var a=e.findGripIndexById(e.state.pickedId)+t;a<0&&(a=e.state.grips.length-1),a>=e.state.grips.length&&(a=0);var i=e.state.grips[a],s=i.id;e.setState({pickedId:s},function(){n(null,s,i)})},u=this.state.grips.map(function(e){return e.color+" "+a.toPercent(e.pos)}),m=function(e){return parseFloat(e.split(" ")[3])},h="-webkit-linear-gradient(left, "+u.sort(function(e,t){return m(e)-m(t)}).join(",")+")",f="number"==typeof this.state.pickedId&&this.state.grips.length>2;return i().createElement("div",null,i().createElement("div",{className:"gradientGripControl"},i().createElement("button",{className:"btn btn-default v2",style:{display:"flex"},onClick:function(){return p(-1)}},i().createElement("i",{className:"fa fa-arrow-left"})),i().createElement("div",{style:{width:"20px",textAlign:"center"}},this.findGripIndexById(this.state.pickedId)+1),i().createElement("button",{className:"btn btn-default v2",style:{display:"flex"},onClick:function(){return p(1)}},i().createElement("i",{className:"fa fa-arrow-right"})),i().createElement("div",{style:{width:"15px"}}),i().createElement(l.A,{name:"value",resetValue:0,step:1,format:"0.0",min:0,max:100,value:r,unit:"%",onValueChanged:function(t,a){var i=e.state.pickedId,s=e.state.grips,o=e.findGripIndexById(i),r=s[o];r.pos=a+"%",s.sort(function(e,t){return parseFloat(e.pos)-parseFloat(t.pos)}),e.setState({grips:s},function(){return n(s,i,r)})},width:"87px",disabled:!d}),i().createElement("div",{className:"gradientDeleteGrip",onClick:function(t){var i=e.state.pickedId,s=e.state.grips.filter(function(e){return e.id!==i}),o=e.findGripIndexById(i),r=a.getGripSelection(s,e.state.grips[o]),l=s[r];e.setState({pickedId:l.id,grips:s},function(){return n(s,l.id,l)})}},f?i().createElement("i",{className:"fa fa-times"}):null),i().createElement("div",{style:{flexGrow:1}}),i().createElement(F.A,{name:"presets",selections:this.presets,defaultValue:"assign",value:"assign",onValueChanged:function(t,a){return function(t){if("assign"!==t){var a=e.presets.find(function(e){return e.id===t}),i=JSON.parse(JSON.stringify(a.grips)),s=i[0];e.setState({grips:i,pickedId:s.id},function(){n(i,s.id,s),a.data&&Object.entries(a.data).forEach(function(t){var a,n,i=(n=2,function(e){if(Array.isArray(e))return e}(a=t)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,s,o,r=[],l=!0,d=!1;try{if(s=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(n=s.call(a)).done)&&(r.push(n.value),r.length!==t);l=!0);}catch(e){d=!0,i=e}finally{try{if(!l&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(d)throw i}}return r}}(a,n)||ne(a,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=i[0],o=i[1];e.props.onValueChanged(s,o)})})}}(a)}})),i().createElement("div",{className:"gradientLinear",onClick:function(i){var s,o=document.getElementById(t).getBoundingClientRect(),r=e.props.selectedGrip.color,l=e.props.selectedGrip.alpha,d=e.state.grips.reduce(function(e,t){return t.id>e?t.id:e},0)+1,c={pos:a.toPercent(i.clientX-o.x),color:r,alpha:l,id:d},p=[].concat(function(e){if(Array.isArray(e))return ie(e)}(s=e.state.grips)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||ne(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[c]);p.sort(function(e,t){return parseFloat(e.pos)-parseFloat(t.pos)}),e.setState({pickedId:d,grips:p},function(){return n(e.state.grips,d,c)})},style:{backgroundImage:h}}),c)},render:function(){var e=this,t=se.helper(this);return i().createElement("div",{id:this.props.id+"-container",className:"gradientContainer",ref:function(t){return e.container=t}},t.validDimension()&&this.renderContent())}});se.handleMouseDown=function(e,t){var a=function(e){e.preventDefault(),e.pickedId=se.pickedId,t&&t(e)},n=function(e){document.removeEventListener("mouseup",n,!0),document.removeEventListener("mousemove",a,!0),e.preventDefault()};if(e.target.id){var i=e.target.id.split("-")[1];se.pickedId=parseInt(i),function(e){e.target.focus(),document.addEventListener("mouseup",n,!0),document.addEventListener("mousemove",a,!0),e.preventDefault(),e.stopPropagation()}(e)}},se.hexToRGB=function(e){var t=function(e){return"#"==e.charAt(0)?e.substring(1,7):e},a=se.hexToRGB.hexToR=function(e){return parseInt(t(e).substring(0,2),16)},n=se.hexToRGB.hexToG=function(e){return parseInt(t(e).substring(2,4),16)},i=se.hexToRGB.hexToB=function(e){return parseInt(t(e).substring(4,6),16)};return function(e){return"rgb("+a(e)+", "+n(e)+", "+i(e)+")"}(e)},se.rgbToHex=function(e){return"#"+e.split("(")[1].split(")")[0].split(",").map(function(e){return 1==(e=parseInt(e).toString(16)).length?"0"+e:e}).join("")},se.helper=function(e){return{loadGrips:function(){var t=e.props.stops;e.state.grips=t.map(function(e,t){return{pos:100*e.offset+"%",color:se.hexToRGB(e.color),alpha:e.opacity,id:t}})},validDimension:function(){return!!e.state.dimensions&&e.state.dimensions.width&&e.state.dimensions.parentWidth},getGripSelection:function(e,t){return function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE,n=arguments.length>2?arguments[2]:void 0;return e.forEach(function(e,i){var s=Math.abs(parseFloat(e.pos)-parseFloat(t.pos));s<a&&(a=s,n=i)}),n}(t)},retrieveContainer:function(t){e.container||t("container not ready!");var a=se.helper(e);e.props.needReload&&!a.validDimension()&&e.setState({dimensions:{width:e.container.offsetWidth,parentWidth:e.container.parentNode.offsetWidth}},function(){return t&&t(null,e.state.dimensions)})},toPercent:function(t){var a=e.state.dimensions.width;return"number"==typeof t?parseFloat(t/a*100)+"%":t},recalcPercent:function(t){var a=e.state.dimensions,n=a.width,i=a.parentWidth;return"string"==typeof t?parseFloat(t)*(n/i)+"%":t},toStops:function(t){if(!t)return t;var a=se.helper(e);return e.state.grips.map(function(e){return{offset:(t=e.pos,parseFloat(a.toPercent(t))/100),color:se.rgbToHex(e.color),opacity:e.alpha};var t}).sort(function(e,t){return e.offset-t.offset})},limiter:function(t){var a=e.state.dimensions.width;return t<0?0:t>a?a:t},fireGripChanged:function(t,a,n){var i=se.helper(e);e.props.onGripChanged(function(e,t){return"number"==typeof e&&t?{id:e,color:t.color,pos:t.pos,alpha:t.alpha}:null}(a,n),i.toStops(t))},fireColorChanged:function(){var t=se.helper(e);e.colorChanged&&t.fireGripChanged(e.state.grips)}}};const oe=se;var re=a(89634),le=a(9769),de=a.n(le);function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}var pe=a(80448);a(50456);const ue=i().createClass({displayName:"GradientEditor",mixins:[],getCrPicker:function(){var e=pe.convertToGradient(this.props.value);if("solid"===e.type){var t=oe.rgbToHex,a=e.solidColor;return t("rgb("+a.r+", "+a.g+", "+a.b+")")}return this.state&&"number"==typeof this.state.selectedGrip.id?e.stops[this.state.selectedGrip.id].color:e.stops[0].color},getCrPickerAlpha:function(){var e=pe.convertToGradient(this.props.value);return"solid"===e.type?100*e.solidColor.a:this.state&&"number"==typeof this.state.selectedGrip.id?100*e.stops[this.state.selectedGrip.id].opacity:100*e.stops[0].opacity},getInitialState:function(){var e=oe.hexToRGB,t=this.getCrPicker(),a=this.getCrPickerAlpha();return{type:pe.convertToGradient(this.props.value).type,crPicker:t,crPickerAlpha:a,selectedGrip:{id:0,pos:null,color:e(t),alpha:a/100}}},getDefaultProps:function(){return{}},componentWillMount:function(){},componentWillUnmount:function(){},onGripChanged:function(e,t){var a=this,n=oe.rgbToHex,i=function(e){return e&&a.GradientChanged(e)};e?this.setState({crPicker:n(e.color),crPickerAlpha:100*e.alpha,selectedGrip:e},function(){return i(t)}):this.setState({},function(){return i(t)})},onCrPicker:function(e){var t=this,a=oe.hexToRGB;if(this.props.value.type&&"solid"!==this.props.value.type){var n=this.state.selectedGrip,i=e.color,s=e.alpha;n.color=a(i),n.alpha=s/100,this.setState({crPicker:i,crPickerAlpha:s,selectedGrip:n})}else{var o=a.hexToR(e.color),r=a.hexToG(e.color),l=a.hexToB(e.color),d=e.alpha/100,c=e.alpha,p=pe.convertToGradient(this.props.value);p.solidColor={r:o,g:r,b:l,a:d},this.setState({crPicker:this.getCrPicker(),crPickerAlpha:c},function(){return t.ValueChanged("solidColor",p.solidColor)})}},GradientChanged:function(e,t){this.updateValue("stops",e)},ValueChanged:function(e,t){this.updateValue(e,t)},TabChanged:function(e){var t=this;this.setState({type:e},function(){var e=t.getCrPicker(),a=t.getCrPickerAlpha();t.setState({crPicker:e,crPickerAlpha:a})}),this.updateValue("type",e)},updateValue:function(e,t){var a=this.props.value;"object"!==ce(a)&&(a={}),a[e]=t,this.props.onValueChanged&&this.props.onValueChanged(a)},render:function(){var e=de().extend(!0,{},de().defaultGradient,pe.convertToGradient(this.props.value));this.props.title&&this.props.title;var t=[{id:"pad",title:"Pad"},{id:"reflect",title:"Reflect"},{id:"repeat",title:"Repeat"}];return i().createElement("div",{className:"tab-area gradientEditorWrapper"+("solid"==this.state.type?" modelSolid":"")},i().createElement("div",{className:"btn-group btn-group-justified gradient-button-tabs",role:"group"},i().createElement("span",{"data-toggle":"tab",className:"solid"==this.state.type?"btn btn-default active":"btn btn-default",onClick:this.TabChanged.bind(this,"solid"),role:"button"},"Solid"),i().createElement("span",{"data-toggle":"tab",className:"linear"==this.state.type?"btn btn-default active":"btn btn-default",onClick:this.TabChanged.bind(this,"linear"),role:"button"},"Linear"),i().createElement("span",{"data-toggle":"tab",className:"radial"==this.state.type?"btn btn-default active":"btn btn-default",onClick:this.TabChanged.bind(this,"radial"),role:"button"},"Radial")),i().createElement("div",{className:"tab-content"},i().createElement("div",{role:"tabpanel",className:"tab-pane "+("solid"==this.state.type?"active":""),id:"solid"},i().createElement("div",{className:"panel panel-default panel-element popover-panel-element",style:{margin:"0px"}},i().createElement("div",{className:"panel-body"},i().createElement("table",null,i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",{style:{width:"99px"}}),i().createElement("td",null,i().createElement(re.Panel,{className:"rc-colorpicker-inline",key:"solid-color-picker",enableAlpha:!0,color:this.state.crPicker,alpha:this.state.crPickerAlpha,onChange:this.onCrPicker})))))))),i().createElement("div",{role:"tabpanel",className:"tab-pane "+("linear"==this.state.type?"active":""),id:"linear"},i().createElement("div",{className:"panel panel-default panel-element popover-panel-element",style:{margin:"0px"}},i().createElement("div",{className:"panel-body"},i().createElement("table",{style:{width:"100%",tableLayout:"fixed"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",null),i().createElement("td",null,i().createElement(re.Panel,{className:"rc-colorpicker-inline",key:"linear-color-picker",enableAlpha:!0,onChange:this.onCrPicker,color:this.state.crPicker,alpha:this.state.crPickerAlpha}))),i().createElement("tr",null,i().createElement("td",{colSpan:4},i().createElement("div",{className:"gradientWrapper"},i().createElement(oe,{id:"gradientWrapper-linear",needReload:"linear"===this.state.type,colorSpace:"RGB",stops:e.stops,selectedGrip:this.state.selectedGrip,onGripChanged:this.onGripChanged,onValueChanged:this.ValueChanged})))),i().createElement("tr",null,i().createElement("td",null,"Offset"),i().createElement("td",null,i().createElement(l.A,{name:"offset",resetValue:0,step:1,format:"0.0",value:e.offset,unit:"%",onValueChanged:this.ValueChanged,width:"87px"})),i().createElement("td",{style:{paddingLeft:"10px"}},"Angle"),i().createElement("td",null,i().createElement(l.A,{name:"angle",resetValue:0,step:1,format:"0.0",min:-9999,max:9999,value:e.angle,unit:"deg",onValueChanged:this.ValueChanged,width:"87px"}))),i().createElement("tr",null,i().createElement("td",null,"Scale"),i().createElement("td",null,i().createElement(l.A,{name:"scale",resetValue:100,step:1,format:"0.0",min:0,max:1e4,value:e.scale,unit:"%",onValueChanged:this.ValueChanged,width:"87px"})),i().createElement("td",{style:{paddingLeft:"10px"}},"Spread"),i().createElement("td",null,i().createElement(F.A,{name:"spreadMethod",selections:t,defaultValue:"pad",dropup:"1",value:e.spreadMethod,onValueChanged:this.ValueChanged}))),i().createElement("tr",null,i().createElement("td",null,"Keep Aspect"),i().createElement("td",null,i().createElement(x.A,{name:"keepAspect",value:e.keepAspect,onValueChanged:this.ValueChanged})))))))),i().createElement("div",{role:"tabpanel",className:"tab-pane "+("radial"==this.state.type?"active":""),id:"radial"},i().createElement("div",{className:"panel panel-default panel-element popover-panel-element",style:{margin:"0px"}},i().createElement("div",{className:"panel-body"},i().createElement("table",{style:{width:"100%",tableLayout:"fixed"}},i().createElement("tbody",null,i().createElement("tr",null,i().createElement("td",null),i().createElement("td",null,i().createElement(re.Panel,{className:"rc-colorpicker-inline",key:"radial-color-picker",enableAlpha:!0,onChange:this.onCrPicker,color:this.state.crPicker,alpha:this.state.crPickerAlpha}))),i().createElement("tr",null,i().createElement("td",{colSpan:4},i().createElement("div",{className:"gradientWrapper"},i().createElement(oe,{id:"gradientWrapper-radial",needReload:"radial"===this.state.type,colorSpace:"RGB",stops:e.stops,selectedGrip:this.state.selectedGrip,onGripChanged:this.onGripChanged,onValueChanged:this.ValueChanged})))),i().createElement("tr",null,i().createElement("td",null,"Center X"),i().createElement("td",null,i().createElement(l.A,{name:"centerX",resetValue:50,step:1,format:"0.0",value:e.centerX,unit:"%",onValueChanged:this.ValueChanged,width:"87px"})),i().createElement("td",{style:{paddingLeft:"10px"}},"Center Y"),i().createElement("td",null,i().createElement(l.A,{name:"centerY",resetValue:50,step:1,format:"0.0",value:e.centerY,unit:"%",onValueChanged:this.ValueChanged,width:"87px"}))),i().createElement("tr",null,i().createElement("td",null,"Radius"),i().createElement("td",null,i().createElement(l.A,{name:"radius",resetValue:25,step:1,format:"0.0",min:0,max:1e4,value:e.radius,unit:"%",onValueChanged:this.ValueChanged,width:"87px"})),i().createElement("td",{style:{paddingLeft:"10px"}},"Spread"),i().createElement("td",null,i().createElement(F.A,{name:"spreadMethod",title:"Spread",selections:t,defaultValue:"pad",dropup:"1",value:e.spreadMethod,onValueChanged:this.ValueChanged}))),i().createElement("tr",null,i().createElement("td",null,"Focal Angle"),i().createElement("td",null,i().createElement(l.A,{name:"focalAngle",resetValue:0,step:1,format:"0.0",min:0,max:360,value:e.focalAngle,unit:"deg",onValueChanged:this.ValueChanged,width:"87px"})),i().createElement("td",{style:{paddingLeft:"10px"}},"Focal Distance"),i().createElement("td",null,i().createElement(l.A,{name:"focalDistance",resetValue:0,step:.1,format:"0.0",min:0,max:100,value:e.focalDistance,unit:"%",onValueChanged:this.ValueChanged,width:"87px"}))),i().createElement("tr",null,i().createElement("td",null,"Keep Aspect"),i().createElement("td",null,i().createElement(x.A,{name:"keepAspect",value:e.keepAspect,onValueChanged:this.ValueChanged}))))))))))}});var me=a(72761),he=a.n(me),fe=a(50942),ge=a.n(fe),ve=(a(9769),a(80448));a(52271);const be=i().createClass({displayName:"GradientInput",getInitialState:function(){return{placement:"bottom",showGradientEditor:!1}},getDefaultProps:function(){return{}},componentWillMount:function(){this.gradientRenderer=null,this.gradientPreviewRef=null},componentWillUnmount:function(){},componentDidMount:function(){null==this.gradientRenderer&&null!=this.gradientPreviewRef&&(this.gradientRenderer=he()(ae().findDOMNode(this.gradientPreviewRef)).viewbox(-25,-25,50,50),this.forceUpdate())},showGradientEditor:function(){this.setState({showGradientEditor:!this.state.showGradientEditor})},onOverlayEnter:function(){var e=event.clientX,t=event.clientY,a="top",n=window.innerHeight-t-470,i=t-470,s=window.innerWidth-e-420,o=e-420;n>0?a="bottom":i>0?a="top":s>0?a="right":o>0?a="left":(n>=i&&n>=s&&n>=o&&(a="bottom"),i>=n&&i>=s&&i>=o&&(a="top"),s>=n&&s>=i&&s>=o&&(a="right"),o>=i&&o>=s&&o>=n&&(a="left")),this.setState({placement:a})},onGradientEditorChanged:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e)},render:function(){var e=this,t=this.gradientRenderer,a=this.props.value;if(null!=t){t.clear();var n=t.pattern(16,16,function(e){e.rect(16,16).fill("#fff"),e.rect(8,8).fill("#ccc"),e.rect(8,8).fill("#ccc").move(8,8)});t.rect("48","48").move(-24,-24).fill(n);var s=t.rect("48","48").move(-24,-24),o=ve.generateGradient(t,a,48,48);s.fill(o)}var r=i().createElement(ge(),{id:"popover"},i().createElement(ue,{value:a,onValueChanged:this.onGradientEditorChanged})),l=this.props.disabled,d={borderRadius:"2px",border:"1px solid #272727",boxShadow:"0 1px 0 #535353"},c="click";return l&&(c=null,d.cursor="auto"),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"gradientPreviewWrapper",style:d},i().createElement(k(),{key:"gradientOverlay",trigger:c,rootClose:!0,onEnter:this.onOverlayEnter,placement:this.state.placement,overlay:r},i().createElement("svg",{ref:function(t){e.gradientPreviewRef=t},disabled:l})))))}}),ye=i().createClass({displayName:"CompositionInput",onEditCompStandalone:function(){1!=this.props.disabled&&this.props.onEditCompStandalone(this.props.name,this.props.value)},clearComp:function(){this.props.onValueChanged(this.props.name,void 0)},render:function(){var e=!0;return 0==this.props.disabled&&this.props.value&&""!=this.props.value&&(e=!1),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group",style:{display:"flex",flexWrap:"nowrap"}},i().createElement("span",{className:"input-group-btn",style:{width:"90px"}},i().createElement("button",{onClick:this.onEditCompStandalone,type:"button",tabIndex:"-1",disabled:this.props.disabled,className:"btn btn-default btn-sm",style:{width:"100%"}},"Edit")),i().createElement("span",{className:"input-group-btn"},i().createElement("button",{onClick:this.clearComp,type:"button",tabIndex:"-1",disabled:e,className:"btn btn-default btn-sm btn-narrow"},i().createElement("i",{className:"fa fa-trash"}))))))}});var we=a(26201),Ee=a(76716),Ie=a(74199);function Ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}const Se=i().createClass({displayName:"DataFieldBrowser",mixins:[Ee.A],getInitialState:function(){return this.currentStores={},{availableNodes:[],availableFields:[],selectedDataNode:null,selectedNodeName:null,selectedFieldName:null,newFieldName:"",disableAddButton:!0,dropDownOpen:!1,filterValue:""}},componentWillMount:function(){this.getAvailableNodes()},componentDidMount:function(){this.refs.dropdownInput&&($(this.refs.dropdownInput).on("show.bs.dropdown",function(){this.setState({dropDownOpen:!0},function(){setTimeout(function(){$(this.refs.filterInputField).focus()}.bind(this),250)})}.bind(this)),$(this.refs.dropdownInput).on("hide.bs.dropdown",function(){this.setState({dropDownOpen:!1,filterValue:""})}.bind(this)))},componentWillUnmount:function(){},onFilterValueChanged:function(e){this.setState({filterValue:e.target.value})},onFilterKeyDown:function(e){if("Escape"==e.key&&this.setState({filterValue:""}),e.key,"Tab"===e.key)return e.preventDefault(),void e.stopPropagation()},getAvailableNodes:function(){if(this.props.enableDataLink){var e=function(e,t){var a=e.child(t).val();return 0===Object.entries(a).length&&a.constructor===Object?null:a},t=this.props.sbCompositionRef.child("dataSources").child("composition");this.currentStores.compositionControlNode=e(t,"controlNode"),this.currentStores.compositionWidgetNode=e(t,"widgetNode"),this.currentStores.compositionDataNodes=e(t,"dataNodes"),this.currentStores.dataLink=e(this.props.sbCompositionRef.child("dataLinks"),this.props.sbRef.key);var a=this.currentStores,n=[],i=null;a.dataLink&&a.dataLink[this.props.item.id]&&(i=a.dataLink[this.props.item.id]);var s=function(e,t,a,s){if(""==a.dataNode)return!1;var o={};if(o.dataLinkInfo=t,o.index=0,o.name=e,"string"==typeof a.dataNode){var r=Ie.A.get(a.dataNode);if(!r)return!1;"public"==a.type?o.type="publicDataNode":o.type="dataNode",o.item=r,o.index=a.id,o.payload=r.payload,o.name+=r.name}else{if(!a.payload)return!1;o.item=a,o.type=s||"controlNode",o.payload=a.payload,o.name+=a.name}return i&&i.location==t.location&&i.locationId==t.locationId&&i.index==o.index&&i.type==o.type&&this.showFieldInDataNode(o,!0,i),n.push({node:o,dataLinkInfo:t}),!0}.bind(this);if(a.compositionDataNodes)for(var o in a.compositionDataNodes)s("",{location:"composition",locationId:"self"},a.compositionDataNodes[o]);if(this.props.compositionStack&&this.props.compositionStack.length>1){var r,l,d="root",c=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return Ne(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ne(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,r=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){r=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(r)throw s}}}}(this.props.compositionStack);try{for(c.s();!(l=c.n()).done;){var p=l.value;if(p.inheritedProps.compositionDataNodes)for(var u in p.inheritedProps.compositionDataNodes)s(r+" / ",{location:"composition",locationId:d},p.inheritedProps.compositionDataNodes[u]);p.inheritedProps.compositionControlNode&&s(r+" / ",{location:"composition",locationId:d},p.inheritedProps.compositionControlNode),p.inheritedProps.compositionWidgetNode&&s(r+" / ",{location:"composition",locationId:d},p.inheritedProps.compositionWidgetNode,"widgetNode"),d=p.compId,r=void 0===r?"Root":p.name}}catch(e){c.e(e)}finally{c.f()}}var m=!1;a.compositionControlNode&&(m=s("",{location:"composition",locationId:"self"},a.compositionControlNode)),0==m&&n.push({node:{name:"Control Node"}}),a.compositionWidgetNode&&s("",{location:"composition",locationId:"self"},a.compositionWidgetNode,"widgetNode"),this.setState({availableNodes:n},function(){if(!i){var e=null;n.length&&(e=n[n.length-1].node),e&&this.showFieldInDataNode(e,!0)}}.bind(this))}},showFieldInDataNode:function(e,t,a){var n=null,i=null;if(e&&e.item){a?n=a:this.currentStores.dataLink&&this.currentStores.dataLink[this.props.item.id]&&(n=this.currentStores.dataLink[this.props.item.id]);var s=[],o=e.item.model.fields,r=0;for(var l in e.payload){var d=l,c="",p="",u=r++;for(var m in o)if(l==o[m].id){(d=o[m].title)!=o[m].id&&(d+=" ("+o[m].id+")"),c=o[m].type,void 0!==o[m].index&&(u=o[m].index),p=m;break}"infotext"!=c&&(s.push({id:{location:e.dataLinkInfo.location,locationId:e.dataLinkInfo.locationId,index:e.index,sortIndex:u,key:l,keyId:p,type:e.type},name:l,title:d}),n&&t&&n.key==l&&(i=d))}var h=s.sort(function(e,t){return e.id.sortIndex>t.id.sortIndex?1:e.id.sortIndex<t.id.sortIndex?-1:0});this.setState({selectedDataNode:e,selectedNodeName:e.name,selectedFieldName:i,availableFields:h},this.setNewFieldName)}else this.setState({selectedDataNode:e,selectedNodeName:e.name,selectedFieldName:null,availableFields:[]},this.setNewFieldName)},selectDataField:function(e){if(e){var t={};t[this.props.item.id]=e,this.props.sbCompositionRef.child("dataLinks").child(this.props.sbRef.key).update(t)}else this.props.sbCompositionRef.child("dataLinks").child(this.props.sbRef.key).child(this.props.item.id).remove();this.getAvailableNodes()},unlinkDataField:function(e){this.selectDataField(""),this.setState({selectedNodeName:null,selectedFieldName:null,availableFields:[]},this.getAvailableNodes)},addAutoControlNode:function(){if("string"!=typeof this.state.newFieldName)return"";for(var e=this.state.newFieldName.replace(/[\/\.\[\]\#\$\\"'`]/g,""),t=0;t<e.length;t++)(e.charCodeAt(t)<31||127==e.charCodeAt(t))&&(e=e.slice(0,t)+e.slice(t+1),t--);e=e.trim();var a=/^\d+$/.test(e);if(""==e||a)return"";for(var n=1,i=e;this.isDuplicateControlName(i);)i=e+" "+n,n++;var s={};$.extend(!0,s,this.props.item),delete s.hideTitle,"textarea"==s.type&&1032===this.props.widgetId&&(s.type="text");var o=this.onControlNodeAdd(this.state.selectedDataNode,i,s.type,s,this.props.value);this.selectDataField({location:"composition",locationId:"self",index:0,key:i,keyId:o,type:"controlNode"}),this.getAvailableNodes()},isDuplicateControlName:function(e){if(this.state.selectedDataNode&&this.state.selectedDataNode.item){var t=this.state.selectedDataNode.item.model;if(e&&t&&t.fields)for(var a in t.fields)if(t.fields[a]&&t.fields[a].id==e)return!0}return!1},setNewFieldName:function(e){void 0===e&&this.props.widgetName&&(e=this.props.widgetName);var t=!0;""!=e&&(t=this.isDuplicateControlName(e)),this.setState({newFieldName:e,disableAddButton:t})},onNewFieldNameChange:function(e){this.setNewFieldName(e.target.value)},handleKeyDown:function(e){if(".[]#$/\\\"'`".includes(e.key))return e.preventDefault(),void e.stopPropagation();"Enter"===e.key&&this.addAutoControlNode()},render:function(){if(!this.props.enableDataLink)return null;var e,t=function(e,t){var a;switch(e.node.type){case"dataNode":a=i().createElement("i",{className:"fa fa-database",style:{width:"15px",textAlign:"center"}});break;case"widgetNode":a=i().createElement("i",{className:"fa fa-wrench",style:{width:"15px",textAlign:"center"}});break;default:a=i().createElement("i",{className:"fa fa-gamepad",style:{width:"15px",textAlign:"center"}})}return i().createElement("li",{key:t,onClick:this.showFieldInDataNode.bind(this,e.node,!1)},i().createElement("a",null,a," ",e.node.name))}.bind(this),a=this.state.filterValue.trim().toLowerCase(),n=function(e,t){return""!=a&&-1===e.title.toLowerCase().indexOf(a)||"__internalCompTime"==e.title?null:i().createElement("li",{key:t,onClick:this.selectDataField.bind(this,e.id)},i().createElement("a",null,e.title))}.bind(this);this.currentStores.dataLink&&this.currentStores.dataLink[this.props.item.id]?e=i().createElement("button",{type:"button",className:"btn btn-danger width160",tabIndex:"-1",onClick:this.unlinkDataField},"Unlink"):(this.state.selectedDataNode&&"controlNode"==this.state.selectedDataNode.type&&this.state.selectedDataNode.dataLinkInfo&&"self"==this.state.selectedDataNode.dataLinkInfo.locationId&&!this.state.selectedFieldName||this.state.selectedDataNode&&void 0===this.state.selectedDataNode.item)&&(e=i().createElement("div",{style:{display:"flex"}},i().createElement("input",{type:"text",style:{top:"1px",marginRight:"3px"},placeholder:"enter unique name",className:"form-control",onChange:this.onNewFieldNameChange,onKeyDown:this.handleKeyDown,value:this.state.newFieldName}),i().createElement("button",{className:"btn btn-default",style:{flex:"0 1 50px"},tabIndex:"-1",onClick:this.addAutoControlNode,disabled:this.state.disableAddButton},"Add")));var s,o,r=i().createElement("div",{className:"selector",style:{width:"250px",marginLeft:"10px"}},e),l="Select a field";this.state.selectedFieldName&&(l=this.state.selectedFieldName),s=this.state.dropDownOpen?i().createElement("input",{type:"text",className:"form-control",value:this.state.filterValue,placeholder:l,onChange:this.onFilterValueChanged,onKeyDown:this.onFilterKeyDown,style:{left:"-1px",top:"-2px",width:"calc(100% + 2px)",height:"100%",position:"absolute"},ref:"filterInputField"}):i().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},l),o=this.state.availableFields.length?i().createElement("div",{className:"selector",ref:"dropdownInput"},i().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160 h-100","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},s,i().createElement("span",{className:"caret"})),i().createElement("ul",{className:"dropdown-menu"},this.state.availableFields.map(n))):i().createElement("div",{className:"selector",ref:"dropdownInput"},i().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160",disabled:!0,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"No fields exist",i().createElement("span",{className:"caret"})));var d,c="Select a node";return this.state.selectedNodeName&&(c=this.state.selectedNodeName),d=this.state.availableNodes.length?i().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},c),i().createElement("span",{className:"caret"})):i().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160",disabled:!0,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"No nodes exist",i().createElement("span",{className:"caret"})),i().createElement("div",{className:"row datanode-browser-inline"},i().createElement("div",{className:"col-12"},i().createElement("div",{className:"panel singular-panel"},i().createElement("div",{className:"panel-header"},"Link Browser"),i().createElement("div",{className:"panel-body",style:{display:"flex",flexDirection:"row"}},i().createElement("div",{className:"selector"},d,i().createElement("ul",{className:"dropdown-menu"},this.state.availableNodes.map(t))),o,r))))}}),Ce=i().createClass({displayName:"ButtonInput",getInitialState:function(){return{showMenu:!1}},componentWillMount:function(){},onChange:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.item.id)},onMouseEnter:function(e){this.props.menu&&this.setState({showMenu:!0})},onMouseLeave:function(e){this.setState({showMenu:!1})},render:function(){var e,t;if(this.props.menu){var a={position:"relative",left:"-12px",width:"11px",height:"10px",margin:"0px",padding:"0px",top:"-8px",visibility:"hidden",lineHeight:"6px",overflow:"hidden"};this.state.showMenu&&0==this.props.disabled&&(a.visibility="visible"),e=i().createElement("button",{className:"btn btn-default",style:a,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.props.menu.title)}var n=this.props.disabled;return this.props.menu&&"linked"==this.props.menu.className&&(t={color:"#6ab18c"},n=!0),i().createElement("span",{className:this.props.className?this.props.className:""},i().createElement("button",{className:"btn btn-default",style:t,onClick:this.onChange,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,disabled:n,tabIndex:"-1"},this.props.item.title),e)}}),xe=i().createClass({displayName:"DataNodeInput",getInitialState:function(){return this.firstClick=!0,{initialValue:this.props.value,textValue:this.props.value.refId}},onChange:function(e){this.setState({textValue:e.target.value})},onFocus:function(e){e.target.select()},onBlur:function(e){this.validateDataNodeId(e.target.value)},onKeyDown:function(e){13===e.keyCode&&this.validateDataNodeId(e.target.value)},onMouseDown:function(e){this.firstClick||window.getSelection().removeAllRanges(),this.firstClick=!1},validateDataNodeId:function(e){e!=this.state.initialValue.refId&&I().get("/apiv1/datanodes/"+e).set("Content-Type","application/json").end(function(t,a){if(t)console.log("Unknown data node id: "+e),this.setState({textValue:this.state.initialValue.refId});else{var n=a.body,i={dataNode:n.firebaseUrl.substr(n.firebaseUrl.lastIndexOf("/")+1),refId:n.id,userId:n.user_id};this.setState({initialValue:i}),this.props.onValueChanged&&this.props.onValueChanged(this.props.name,i)}}.bind(this))},render:function(){return i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group bootstrap-touchspin"},i().createElement("input",{type:"text",className:"form-control align-left",disabled:this.props.disabled,onMouseDown:this.onMouseDown,onChange:this.onChange,onFocus:this.onFocus,onKeyDown:this.onKeyDown,onBlur:this.onBlur,value:this.state.textValue}))))}});var Fe=a(78450),De=a.n(Fe);a(9769);const ke=i().createClass({displayName:"TimeControl",getInitialState:function(){return{}},shouldComponentUpdate:function(e,t){return!0},onPlay:function(e){if(this.props.onValueChanged){var t=this.props.value,a={UTC:De().ServerDate.now(),isRunning:!0,value:t&&t.value?t.value:0};this.props.onValueChanged(this.props.item.id,a)}},onPause:function(e){if(this.props.onValueChanged){var t=De().ServerDate.now(),a=this.props.value,n=!1,i=0,s=t;a&&(n=a.isRunning,i=a.value,s=a.UTC),n&&(i+=t-s);var o={UTC:t,isRunning:!1,value:i};this.props.onValueChanged(this.props.item.id,o)}},onReset:function(e){if(this.props.onValueChanged){var t={UTC:De().ServerDate.now(),isRunning:!1,value:0};this.props.onValueChanged(this.props.item.id,t)}},render:function(){var e,t=this.props.disabled;return e=this.props.value&&this.props.value.isRunning?i().createElement(k(),{placement:"right",delayShow:500,overlay:i().createElement(R(),{id:"play"},"Stop")},i().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.onPause,disabled:t},i().createElement("i",{className:"fa fa-pause",style:{width:"25px"}}))):i().createElement(k(),{placement:"right",delayShow:500,overlay:i().createElement(R(),{id:"reset"},"Start")},i().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.onPlay,disabled:t},i().createElement("i",{className:"fa fa-play",style:{width:"25px"}}))),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group bootstrap-touchspin"},e,i().createElement(k(),{placement:"right",delayShow:500,overlay:i().createElement(R(),{id:"reset"},"Stop and Reset")},i().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.onReset,disabled:t},i().createElement("i",{className:"fa fa-step-backward",style:{width:"25px"}}))))))}});var Te=a(95093),Re=a.n(Te),Ae=a(45465),Me=a.n(Ae),Oe=a(9769);const Ue=i().createClass({displayName:"DateTimeInput",getInitialState:function(){return this.firstClick=!0,{}},shouldComponentUpdate:function(e,t){return!Oe.compareObject(e,this.props)||!Oe.compareObject(t,this.state)},onDateChanged:function(e){this.props.onValueChanged(this.props.name,Re()(e).valueOf())},render:function(){var e={};return void 0!==this.props.width&&(e.width=this.props.width),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group",style:e},i().createElement("div",{className:"input-group bootstrap-touchspin",style:e},i().createElement("div",{style:{minWidth:"120px",display:"inline-block"}},i().createElement(Me(),{value:this.props.value,disabled:this.props.disabled,className:"singular-date-time",inputProps:{placeholder:"Date / Time",readOnly:"false"},dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm:ss",onChange:this.onDateChanged,onClose:this.onDateChanged})))))}});var Pe=a(15915),Be=a.n(Pe);function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}var Le=a(9769);const je=i().createClass({displayName:"LocationInput",getInitialState:function(){return this.geocoder=void 0,{geocoderVisible:!1}},shouldComponentUpdate:function(e,t){return!Le.compareObject(e,this.props)||!Le.compareObject(t,this.state)},componentDidMount:function(){var e=this;this.geocoder=new(Be())({accessToken:"pk.eyJ1IjoiaHViZXJ0b2VobSIsImEiOiJja3V4dTNnbDUyZGcyMnVwam52Nmx4ZjBqIn0.S9jmNrORyvkyIGa0y04wuQ"}),this.geocoder.on("result",function(t){if(e.props.onValueChanged){var a={text:t.result.text,long:t.result.center[0],lat:t.result.center[1]};e.props.onValueChanged(e.props.name,a)}e.setState({geocoderVisible:!1})});var t=ae().findDOMNode(this.refs.geocoder);t&&this.geocoder.addTo(t)},onBrowse:function(e){this.setState({geocoderVisible:!0},this.geocoder.clear)},closeGeocoder:function(){this.setState({geocoderVisible:!1}),this.geocoder.setInput("")},onKeyDown:function(e){"Escape"==e.key&&this.closeGeocoder()},render:function(){var e=this,t={height:"auto",maxWidth:"400px"};void 0!==this.props.width&&(t.width=this.props.width);var a={width:"100%",position:"absolute",top:"0px",left:"0px",display:"none",zIndex:"10"};this.state.geocoderVisible&&(a.display="inline");var n=this.props.value,s="",o=0,r=0;n&&"object"===Ve(n)&&(s=n.text||"",o=n.long||0,r=n.lat||0);var l="";return s&&(l+=s),r&&o&&(l+=" ("+r+", "+o+")"),i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group",style:t},i().createElement("div",{className:"input-group bootstrap-touchspin",style:t},i().createElement("input",{type:"text",dir:"auto",className:"form-control",disabled:!0,placeholder:this.props.placeholder,value:l,style:{textAlign:"initial"}}),i().createElement("btn",{className:"btn btn-default",onClick:this.onBrowse,disabled:this.props.disabled,style:{padding:"5px 4px 2px 4px"}},i().createElement("i",{className:"fa fa-globe",style:{fontSize:"18px"}})),i().createElement("div",{className:"geocoder",style:a,ref:"geocoder",onKeyDown:this.onKeyDown,onBlur:function(){setTimeout(function(){e.closeGeocoder()},250)}}))))}});var We=a(9769);const _e=i().createClass({displayName:"CounterInput",getInitialState:function(){return{focusValue:"",hasFocus:!1}},shouldComponentUpdate:function(e,t){return!We.compareObject(e,this.props)||!We.compareObject(t,this.state)},parseNumber:function(e){"string"==typeof e&&(e=e.replace(/[^\d-]/g,""));var t=parseInt(e);return isNaN(t)?void 0!==this.props.item.resetValue?this.props.item.resetValue:0:t},onChangeValue:function(e){if(this.props.onValueChanged){var t=this.parseNumber(this.props.value);return t+="-"===e?-1:"+"===e?1:this.parseNumber(e),void 0!==this.props.item.min&&t<Number(this.props.item.min)&&(t=Number(this.props.item.min)),void 0!==this.props.item.max&&t>Number(this.props.item.max)&&(t=Number(this.props.item.max)),this.props.onValueChanged(this.props.name,t),t}},onSetValue:function(e){if(this.props.onValueChanged){var t=this.parseNumber(e);return this.props.onValueChanged(this.props.name,t),t}},willBeOutOfRange:function(e){return!1},render:function(){var e=this,t=this.props.disabled,a=function(a){return void 0===a?null:i().createElement("button",{tabIndex:"-1",className:"btn btn-default",style:{height:"28px",width:"32px",padding:"0px"},onClick:function(){return e.onSetValue(a)},disabled:t},String(a))},n=function(a){return void 0===a?null:i().createElement("button",{tabIndex:"-1",className:"btn btn-default",style:{height:"28px",width:"32px",padding:"0px",borderRadius:"10px"},onClick:function(){return e.onChangeValue(a)},disabled:t||e.willBeOutOfRange(a)},"-"===(n=a)?i().createElement("i",{className:"fa fa-minus"}):"+"===n?i().createElement("i",{className:"fa fa-plus"}):n>0?"string"==typeof n&&"+"===n[0]?n:"+"+n:n);var n},s=this.props.value;this.state.hasFocus&&(s=this.state.focusValue);var o=void 0!==this.props.item.s1||void 0!==this.props.item.s2||void 0!==this.props.item.s3||void 0!==this.props.item.s4||void 0!==this.props.item.s5||void 0!==this.props.item.s6||void 0!==this.props.item.s7;return i().createElement("div",{className:"form-inline"},i().createElement("div",{className:"form-group"},i().createElement("div",{className:"input-group bootstrap-touchspin",style:{flexFlow:"wrap",gap:"5px",height:"auto"}},o&&i().createElement("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"flex-start"}},a(this.props.item.s1),a(this.props.item.s2),a(this.props.item.s3),a(this.props.item.s4),a(this.props.item.s5),a(this.props.item.s6),a(this.props.item.s7)),i().createElement("input",{type:"text",className:"form-control",style:{flex:"1 1 40px",textAlign:"center",alignContent:"flex-start",padding:"0px",minWidth:"30px",maxWidth:"60px"},step:"1",value:s,disabled:t,onChange:function(t){e.setState({focusValue:t.target.value})},onKeyDown:function(t){var a;"Enter"===t.key&&e.onSetValue(t.target.value),"ArrowUp"===t.key&&(a=e.onChangeValue(1)),"ArrowDown"===t.key&&(a=e.onChangeValue(-1)),"r"===t.key&&(null!==e.props.item.resetValue&&(a=e.onSetValue(e.props.item.resetValue)),t.preventDefault()),void 0!==a&&e.setState({focusValue:a})},onBlur:function(t){e.onSetValue(t.target.value),e.setState({focusValue:"",hasFocus:!1})},onFocus:function(t){e.setState({focusValue:s,hasFocus:!0}),t.target.select()}}),i().createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n(this.props.item.m1),n(this.props.item.m2),n(this.props.item.m3),n(this.props.item.m4),n(this.props.item.m5),n(this.props.item.m6),n(this.props.item.m7)))))}});var qe=a(56027),Ge=a(24316),Ye=a(5876),$e=a(97376),Je=a(25897),ze=a(9769),He=a(10611),Ke={},Qe={};const Xe=i().createClass({displayName:"SingularForm",mixins:[Ge.A,G(),Ye.A],getInitialState:function(){return{placement:"bottom",forceRender:0}},onDataChange:function(e){var t=e.val();this.setState({fields:t})},componentWillMount:function(){this.props.sbFieldsRef?this.sBindAsObject(this.props.sbFieldsRef,"fields"):this.props.fields&&this.setState({fields:this.props.fields}),this.props.sbRef&&this.sBindAsObject(this.props.sbRef,"widget"),this.props.sbCompositionRef&&this.props.sbRef&&this.props.enableDataLink&&this.sBindAsObject(this.props.sbCompositionRef.child("dataLinks").child(this.props.sbRef.key),"compositionDataLinks")},componentWillReceiveProps:function(e){e.fields&&this.setState({fields:e.fields})},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!0},PropValueChanged:function(e,t){var a=this;if(this.props.onChanged&&this.props.onChanged(e,t,this.state.fields),this.props.sbFieldsRef){var n,i=this.getModelDef();if(i&&i.fields.constructor===Array&&(c=i.fields.filter(function(t){return t.id==e&&"composition"==t.type})).length>0&&(n=c[0].id),n&&this.props.sbRootRef){if(this.state.fields&&this.state.fields[n]){var s=this.props.sbRootRef.child("compositions"),o=s.val();if(o){var r=[];qe.A.getCompositionChildren(this.state.fields[n],o,r),r.forEach(function(e){s.child(e).remove(),a.props.sbRootRef.child("compositionStates").child(e).remove(),qe.A.COMPOSITION_PROPS.forEach(function(t){a.props.sbRootRef.child("compositionProps").child(t).child(e).remove()})})}var l=this.state.fields[n];s.child(l).remove(),this.props.sbRootRef.child("compositionStates").child(l).remove(),qe.A.COMPOSITION_PROPS.forEach(function(e){a.props.sbRootRef.child("compositionProps").child(e).child(l).remove()})}t?window.singularRtdbCoreRef.child(t.replace(window.singularRtdbCoreRef.toString(),"")).once("value",function(e){var i=t.split("/"),s=i[i.length-1],o=e.val(),r=He.v4(),l=qe.A.importComposition(o,r,s);a.props.sbRootRef.child("compositions").update(l),a.props.sbRootRef.child("compositionStates").child(r).set("In");var d=qe.A.copyCompositionStatesWithIdMapping(o.compositionStates);a.props.sbRootRef.child("compositionStates").update(d);var c=qe.A.copyCompositionPropsWithIdMapping(o.compositionProps);a.props.sbRootRef.child("compositionProps").update(c),a.props.sbFieldsRef.child(n).set(r)}):this.props.sbFieldsRef.child(n).set("")}else if(!ze.compareObject(this.props.sbFieldsRef.child(e).val(),t)&&(this.props.sbFieldsRef.child(e).set(t),this.props.updateDefaultValueRef&&i&&i.fields))for(var d in i.fields)if(i.fields[d].id==e){this.props.updateDefaultValueRef.child("fields").child(d).child("defaultValue").set(t);break}}else if(this.props.enableLocalChange){var c={};$.extend(!0,c,this.state.fields),c[e]=t,this.setState({fields:c})}},onGroupPresetChanged:function(e,t){if(!t)return Ke[e]=!0,Qe[e]=!1,void this.setState({forceRender:this.state.forceRender+1});for(var a in Ke[e]&&(Ke[e]=!1,this.setState({forceRender:this.state.forceRender+1})),void 0===Qe[e]&&(Qe[e]=!0,this.setState({forceRender:this.state.forceRender+1})),t)this.PropValueChanged(a,t[a])},onHideGroupContent:function(e,t){Qe[e]=t,this.setState({forceRender:this.state.forceRender+1})},getGroupPayload:function(e){var t=this,a={};return e.childIds&&e.childIds.forEach(function(e){var n=t.props.model;for(var i in n.fields){var s=n.fields[i];s&&s.id==e&&"timecontrol"!==s.type&&"button"!==s.type&&"composition"!==s.type&&void 0!==t.state.fields[e]&&(a[s.id]=t.state.fields[e])}}),a},onOverlayEnter:function(){var e=event.clientY,t=window.innerHeight-(e+80)>0?"bottom":"top";this.state.placement!=t&&this.setState({placement:t})},getLinkableInfo:function(e,t,a){var n=t||e.title;if(!this.props.enableDataLink)return{className:"",title:n};var s="";switch(e.type){case"color":case"image":case"audio":case"video":case"jsonfile":case"data":case"json":case"number":case"normalizednumber":case"counter":case"datanode":case"text":case"textarea":case"gradient":case"selection":case"checkbox":case"button":case"timecontrol":case"datetime":s="linkable"}if(this.props.sbCompositionRef){var o=this.props.sbCompositionRef.child("dataLinks").child(this.props.sbRef.key).val();o&&o[e.id]&&(s="linked")}if(!s)return{className:"",title:n};var r,l=this.state.widget?this.state.widget.name:"",d=this.state.widget?this.state.widget.widget:0;r=this.state.fields&&void 0!==this.state.fields[e.id]?this.state.fields[e.id]:e.resetValue;var c=s,p=i().createElement(ge(),{id:"popover"},i().createElement(Se,{sbCompositionRef:this.props.sbCompositionRef,sbRef:this.props.sbRef,enableDataLink:this.props.enableDataLink,item:e,compositionStack:this.props.compositionStack,widgetName:l,widgetId:d,value:r}));return{className:c,title:i().createElement(k(),{trigger:"click",rootClose:!0,placement:this.state.placement,onEnter:this.onOverlayEnter,overlay:p},i().createElement("span",null,n))}},buttonClicked:function(e){this.props.sbButtonsRef?this.props.sbButtonsRef.set({id:e,ts:(new Date).valueOf()}):this.props.controlNodeButtonMode&&this.props.sbFieldsRef?this.props.sbFieldsRef.child(e).set({__singularButton:!0,ts:(new Date).valueOf()}):this.props.onLocalButtonClicked&&this.props.onLocalButtonClicked(e)},fieldsWithoutButtons:function(e){return e.filter(function(e){return"button"!=e.type})},fieldsOnlyButtons:function(e){return e.filter(function(e){return"button"==e.type})},onEditCompStandalone:function(e,t,a){this.props.onEditCompStandalone(e,t,a,this.state.widget.id,this.props.sbCompositionRef.key)},getModelDef:function(){var e=null;if(this.state.widget&&"widget"==this.state.widget.type&&(this.state.widget.customWidgetModel&&(e=this.state.widget.customWidgetModel),!e)){var t=Je.A.getWidgetById(this.state.widget.widget,this.state.widget.version);t?e=t.model:console.error("WIDGET NOT FOUND IN MEMORY: ",this.state.widget)}return e||(e=this.props.model),e},PropertyPaste:function(e){var t=this.onFetchClipBoardData("widget",this.state.widget.widget);if(t){var a,n=this.getModelDef();if(n&&n.groups){if(a=n.groups.find(function(t){if(t.id==e)return t})){var i={};for(var s in a.childIds){var o=a.childIds[s];i[o]=t[o]}return a.activeId&&(i[a.activeId]=t[a.activeId]),void this.props.sbFieldsRef.update(i)}if("miscGroup"==e){var r=[];n.groups.map(function(e){groupPanels.push(e),e.activeId&&r.push(e.activeId),e.childIds&&e.childIds.length&&e.childIds.map(function(e){r.push(e)})});var l={};n.fields.map(function(e){for(var a=0,n=r.length;a<n;a++)if(e.id==r[a])return;l[e.id]=t[e.id]}),0!=Object.entries(l).length&&this.props.sbFieldsRef.update(l)}}}},onClipboardDataValid:function(e){return!!this.onFetchClipBoardData("widget",this.state.widget.widget)&&!!this.getModelDef()&&void 0},render:function(){var e=this.getModelDef();if(!e)return i().createElement("div",null);var t=function(e,t,a){var n,o=this,c=function(){return e.id===o.props.highlightItem?i().createElement("tr",{key:e.id,className:"field-highlight"}):i().createElement("tr",{key:e.id})};if(e.hidden||void 0===e.id)return c();if(void 0!==e.style&&void 0!==this.props.showStyle&&!0===e.style&&!1===this.props.showStyle)return c();void 0!==this.props.disabled?t=this.props.disabled:void 0===t&&(t=!1),void 0===a&&(a=!0),null==e.resetValue&&(e.resetValue=""),n=this.state.fields&&void 0!==this.state.fields[e.id]?this.state.fields[e.id]:e.resetValue;var p=function(e){if(o.props.sbCompositionRef){var t=o.props.sbCompositionRef.child("dataLinks").child(o.props.sbRef.key).val();return!(!t||!t[e])}return!1},m=null;if("number"==e.type){var f=e.step||1,v=e.format||"";""==v&&(v=f.toString());var y=e.unit||"",w=e.unitCollection||"",E=e.unitName||"";this.state.fields&&E&&this.state.fields[E]&&(y=this.state.fields[E]),m=i().createElement(l.A,{onValueChanged:this.PropValueChanged,unitName:E,unit:y,disabled:t||p(e.id),value:n,min:e.min,max:e.max,showSlider:e.showSlider||!1,step:f,format:v,resetValue:e.resetValue,unitCollection:w,name:e.id,theme:this.props.theme,tabIndex:this.props.tabIndex})}else if("normalizednumber"==e.type)m=i().createElement(l.A,{onValueChanged:this.PropValueChanged,unit:"%",disabled:t||p(e.id),value:n,min:0,max:100,showSlider:e.showSlider||!1,step:"0.1",format:"0.1",resetValue:e.resetValue,name:e.id,theme:this.props.theme,tabIndex:this.props.tabIndex});else if("image"==e.type)m=i().createElement(d.A,{disabled:t||p(e.id),onImageBrowserClicked:this.props.onImageBrowserClicked,name:e.id,value:n,onValueChanged:this.PropValueChanged});else if("file"==e.type)m=i().createElement(S,{onValueChanged:this.PropValueChanged,name:e.id,value:n});else if("color"==e.type)m=i().createElement(C.A,{disabled:t||p(e.id),value:n,onValueChanged:this.PropValueChanged,name:e.id});else if("checkbox"==e.type)m=i().createElement(x.A,{onValueChanged:this.PropValueChanged,name:e.id,disabled:t||p(e.id),value:n});else if("selection"==e.type)m=i().createElement(F.A,{className:this.props.className,onValueChanged:this.PropValueChanged,name:e.id,selections:e.selections,options:e.options,useFilter:e.useFilter,useReload:e.useReload,source:e.source,sourceUrl:e.sourceUrl,format:e.format,disabled:t||p(e.id),value:n,theme:this.props.theme,inline:this.props.inline,dropDownStyle:{maxHeight:"240px",overflowY:"auto"}});else if("json"==e.type)m=i().createElement(we.A,{className:"singular-form-json",onValueChanged:this.PropValueChanged,name:e.id,width:e.width,height:e.height,theme:this.props.theme,disabled:t||p(e.id),id:"SF"+e.id,value:n});else if("textarea"==e.type)m=i().createElement(r,{onValueChanged:this.PropValueChanged,name:e.id,rows:e.rows,cols:e.cols,value:n,disabled:t||p(e.id)});else if("range"==e.type)m=i().createElement(W,{onValueChanged:this.PropValueChanged,name:e.id,value:n,disabled:t,min:e.min,max:e.max,step:e.step,margin:e.margin});else if("font"==e.type)m=i().createElement(ee,{onValueChanged:this.PropValueChanged,value:n,name:e.id,item:e,disabled:t});else if("gradient"==e.type)m=i().createElement(be,{onValueChanged:this.PropValueChanged,name:e.id,value:n,disabled:t||p(e.id)});else if("audio"==e.type)m=i().createElement(u,{disabled:t||p(e.id),onAudioBrowserClicked:this.props.onAudioBrowserClicked,name:e.id,value:n,onValueChanged:this.PropValueChanged});else if("jsonfile"==e.type)m=i().createElement(g,{disabled:t||p(e.id),onJsonBrowserClicked:this.props.onJsonBrowserClicked,name:e.id,value:n,onValueChanged:this.PropValueChanged});else if("video"==e.type)m=i().createElement(h,{disabled:t||p(e.id),onVideoBrowserClicked:this.props.onVideoBrowserClicked,name:e.id,value:n,onValueChanged:this.PropValueChanged});else if("data"==e.type)m=i().createElement(b,{disabled:t||p(e.id),onDataBrowserClicked:this.props.onDataBrowserClicked,name:e.id,value:n,onValueChanged:this.PropValueChanged});else if("infotext"==e.type){var I={whiteSpace:"break-spaces",wordBreak:"break-word",paddingTop:"11px",paddingBottom:"10px"};e.hideTitle||(I.width="100%"),"static"===e.mode&&(n=e.text||""),m=i().createElement("div",{className:"from-control-label",style:I,name:e.id,dangerouslySetInnerHTML:{__html:n}})}else if("composition"==e.type)m=i().createElement(ye,{key:e.id,onValueChanged:this.PropValueChanged,name:e.id,sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,disabled:t,onEditCompStandalone:this.onEditCompStandalone.bind(this,e.id),value:n});else{var N;if("button"==e.type)return this.props.enableDataLink&&(N=this.getLinkableInfo(e,"v",t)),i().createElement(Ce,{key:e.id+"b",menu:N,className:this.props.highlightItem===e.id?"field-highlight":"",onValueChanged:this.buttonClicked,item:e,disabled:t});m="datanode"==e.type?i().createElement(xe,{value:n,onValueChanged:this.PropValueChanged,name:e.id,disabled:t||p(e.id)}):"timecontrol"==e.type?i().createElement(ke,{onValueChanged:this.PropValueChanged,value:n,item:e,disabled:t||p(e.id)}):"datetime"==e.type?i().createElement(Ue,{onValueChanged:this.PropValueChanged,name:e.id,value:n,disabled:t||p(e.id)}):"location"==e.type?i().createElement(je,{onValueChanged:this.PropValueChanged,name:e.id,value:n,disabled:t||p(e.id)}):"counter"==e.type?i().createElement(_e,{onValueChanged:this.PropValueChanged,name:e.id,value:n,item:e,disabled:t||p(e.id)}):i().createElement(s.A,{onValueChanged:this.PropValueChanged,name:e.id,onBlur:this.props.onBlur,onKeyDown:this.props.onKeyDown,disabled:t||p(e.id),value:n})}var D="";if(this.props.highlightItem===e.id&&(D=" field-highlight"),1==a){var k,T=this.getLinkableInfo(e,e.title,t);return e.hideTitle?i().createElement("tr",{id:e.id,key:e.id,className:D},i().createElement("td",{colSpan:2,className:"field-col"},m)):(k=i().createElement("td",{className:T.className+" label-col"},i().createElement("div",{style:{maxWidth:"90px",minWidth:"20px",display:"inline-block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",height:"17px",marginTop:"6px"}},T.title)),i().createElement("tr",{id:e.id,key:e.id,className:D},k,i().createElement("td",{className:"field-col"},m)))}return i().createElement("div",{key:e.id,className:D},e.hideTitle?null:i().createElement("span",null,e.title),m)}.bind(this);if(e.fields){var a=e.fields;if(!Array.isArray(a))for(var n in a=[],e.fields){var o={};$.extend(!0,o,e.fields[n]),a.push(o)}var c=!1;a.forEach(function(e){c|=null!=e.index}),c?(a.forEach(function(e){null==e.index&&(e.index=9999)}),a.sort(function(e,t){return parseInt(e.index)-parseInt(t.index)})):a.sort(function(e,t){return e.title?t.title?(e.title.toLowerCase()>t.title.toLowerCase())-.5:-1:1});var p=[],m=[];if(e.groups&&e.groups.map(function(e){p.push(e),e.activeId&&m.push(e.activeId),e.childIds&&e.childIds.length&&e.childIds.map(function(e){m.push(e)})}),p.length>0){var f=[];a.map(function(e){for(var t=0,a=m.length;t<a;t++)if(e.id==m[t])return;f.push(e.id)}),f.length>0&&p.push({id:"miscGroup",type:"groupPanel",title:"Not in any node container",childIds:f})}var v=function(e,n){var s,o=this,r=function(e){return!!e.hidden||void 0!==e.style&&void 0!==o.props.showStyle&&!0===e.style&&!1===o.props.showStyle},l=!0;if(e.childIds&&e.childIds.length&&e.childIds.map(function(e){for(var t=0,n=a.length;t<n;t++)if(a[t].id==e&&!1===r(a[t])){l=!1;break}}),e.activeId)for(var d=0,c=a.length;d<c;d++)if(a[d].id==e.activeId&&!1===r(a[d])){l=!1;break}if(l)return null;e.toolTip&&(s=i().createElement(k(),{delayShow:500,overlay:i().createElement(R(),{id:"position"},e.toolTip)},i().createElement("i",{className:"fa fa-info-circle pull-right",style:{top:"1px",position:"relative"}})));var p="panel panel-default panel-element panel-widget-properties grouped-properties";e.width&&"double"==e.width&&(p+=" double");var u=null,m=!1;if(e.activeId)for(d=0,c=a.length;d<c;d++)if(a[d].id==e.activeId){if("checkbox"==a[d].type){0==(this.state.fields&&void 0!==this.state.fields[a[d].id]?this.state.fields[a[d].id]:a[d].resetValue)&&(m=!0);var h=!1;e.usePreset&&!Ke[e.id]&&(h=!0),u=i().createElement("div",{className:"panel-active-toggle"},t(a[d],h,!1))}break}var f,g={className:"",title:e.title};if(e.childIds&&1==e.childIds.length){var v=a.filter(function(t){return t.id==e.childIds[0]});v.length&&(""==v[0].title||v[0].hideTitle)&&(g=this.getLinkableInfo(v[0],e.title,!1))}this.props.enableDataLink&&(f=i().createElement($e.A,{onClipboardDataValid:this.onClipboardDataValid.bind(this,e.id),onPaste:this.PropertyPaste.bind(this,e.id)}));var b,y=[];e.childIds&&e.childIds.length&&e.childIds.map(function(e){for(var t=0,n=a.length;t<n;t++)a[t].id==e&&"button"==a[t].type&&y.push(a[t])}),y.length&&(b=i().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"5px"}},y.map(function(e){return t(e,m,!0)})));var w=function(){var t=g.className+" panel-clipboard";!0!==o.props.enableDataLink&&(t+=" preset-header");var a=function(){!0!==o.props.enableDataLink&&(o.onHideGroupContent(e.id,!Qe[e.id]),o.setState({forceRender:o.state.forceRender+1}))},n={textOverflow:"ellipsis",whiteSpace:"pre",overflow:"hidden",height:"100%",display:"flex",alignItems:"center"};return!0===o.props.enableDataLink&&(n.position="relative",n.top="-2px"),i().createElement("h3",{className:t},f,i().createElement("span",{className:"panel-label",style:n,onClick:a},g.title||""),i().createElement("span",{className:"panel-filler",onClick:a}),e.usePreset&&i().createElement(V,{className:o.props.className,onValueChanged:function(e,t){return o.onGroupPresetChanged(e,t)},onPresetCustomization:function(t){Qe[e.id]=!t,Ke[e.id]=t,o.setState({forceRender:o.state.forceRender+1})},payload:o.state.fields,name:e.id,options:[],useFilter:e.usePresetFilter,useReload:e.usePresetReload,source:"url",sourceUrl:e.presetSourceUrl,isCustomize:Ke[e.id],disabled:!1,value:o.getGroupPayload(e),theme:o.props.theme,inline:o.props.inline}),u,s,!0===o.props.enableDataLink?null:i().createElement("i",{className:"fa "+(Qe[e.id]?"fa-chevron-up":"fa-chevron-down"),style:{paddingLeft:"5px"},onClick:a}))},E="";return this.props.highlightItem===e.id&&(E+=" group-highlight"),e.usePreset&&(Ke[e.id]||(m=!0)),Qe[e.id]?i().createElement("div",{key:n,className:p},i().createElement("div",{className:"panel-body"+E},w())):i().createElement("div",{key:n,className:p},i().createElement("div",{className:"panel-body"+E},w(),i().createElement("table",{className:"singular-form"},i().createElement("tbody",null,e.childIds&&e.childIds.length?e.childIds.map(function(n){for(var i=0,s=a.length;i<s;i++)if(a[i].id==n&&a[i].id!=e.activeId&&"button"!=a[i].type)return t(a[i],m,!0)}):null)),b))}.bind(this),y="";if(0==p.length||0==m.length){var w;this.fieldsOnlyButtons(a).length&&(w=i().createElement("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"5px"}},this.fieldsOnlyButtons(a).map(function(e){return t(e,!1,!0)}))),y=i().createElement("div",null,i().createElement("div",{className:"singular-form-toplevel"},i().createElement("div",{className:"panel panel-default panel-element panel-widget-properties grouped-properties",style:{width:"100%"}},i().createElement("div",{className:"panel-body"},i().createElement("table",{className:"singular-form"},i().createElement("tbody",null,this.fieldsWithoutButtons(a).map(function(e){return t(e,!1,!0)}))),w))))}else{var E={};!0!==this.props.enableDataLink&&(E={alignItems:"flex-start"}),y=i().createElement("div",{className:"singular-form-group-level",style:E},p.map(v))}return i().createElement("div",{className:"singular-form-property-level"},y)}return null}})},97376:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var n=a(40927),i=a.n(n),s=a(5876);const o=i().createClass({displayName:"PanelClipboardUI",mixins:[s.A],render:function(){var e=!1;return this.props.onClipboardDataValid?0==this.props.onClipboardDataValid(this.props.property)&&(e=!0):void 0===this.onFetchClipBoardData(this.props.checkProperty)&&(e=!0),i().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2 panel-clipboard-button",disabled:e,onClick:this.props.onPaste},i().createElement("i",{className:"fa fa-clipboard"}))}})},99547:(e,t,a)=>{"use strict";a.d(t,{A:()=>N});var n=a(40927),i=a.n(n),s=a(15734),o=a.n(s),r=a(18654);const l=i().createClass({displayName:"SingularImageBrowser",getInitialState:function(){return{insertFromWebUrl:"",filter:"",layoutStyle:"row browser-tree component-tree font-tree small-grid",layoutStyleIcon:"fa fa-th",status:"",isUploading:!1,selectedFolder:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!0},componentDidMount:function(){var e=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("i"),this.browserRef.config({useDefaultItemDoubleClick:!1,autoselectFirstItem:!1,onFolderSelected:function(e){this.setState({selectedFolder:e})}.bind(this),onItemDoubleClick:function(e){o().get("/apiv1/mediatoS3/"+e.refId).set("Content-Type","application/json").end(function(e,t){if(e)console.log("error while reading image: "+e);else{if(t.headers.location)return void(window.location=t.headers.location);this.onSelect(t.body)}}.bind(this))}.bind(this)}),$("#"+this.props.modalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+this.props.modalId).on("shown.bs.modal",function(){e.refs.browser.refs.child.modalPending&&(e.refs.browser.refs.child.modalPending=!1)})},onSelect:function(e){this.props.onSelect&&(this.props.onSelect(e),$("#"+this.props.modalId).modal("toggle"))},render:function(){return i().createElement("div",{id:this.props.modalId,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},i().createElement("div",{id:"imageBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-body"},i().createElement(r.A,{rtdbFolderRef:this.props.rtdbFolderRef,showHeader:!0,browserStyle:"image-selector-modal",browserTitle:"Image",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:this.props.modalId})))))}});var d=a(40927);const c=d.createClass({displayName:"SingularAudioBrowser",getInitialState:function(){return{insertFromWebUrl:"",filter:"",layoutStyle:"row browser-tree component-tree font-tree small-grid",layoutStyleIcon:"fa fa-th",status:"",isUploading:!1,selectedFolder:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!0},componentDidMount:function(){var e=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("au"),this.browserRef.config({useDefaultItemDoubleClick:!1,autoselectFirstItem:!1,onFolderSelected:function(e){this.setState({selectedFolder:e})}.bind(this),onItemDoubleClick:function(e){this.onSelect(e)}.bind(this)}),$("#"+this.props.modalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+this.props.modalId).on("shown.bs.modal",function(){e.refs.browser.refs.child.modalPending&&(e.refs.browser.refs.child.modalPending=!1)})},onSelect:function(e){this.props.onSelect&&(this.props.onSelect(e),$("#"+this.props.modalId).modal("toggle"))},render:function(){return d.createElement("div",{id:this.props.modalId,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},d.createElement("div",{id:"audioBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},d.createElement("div",{className:"modal-content"},d.createElement("div",{className:"modal-body"},d.createElement(r.A,{rtdbFolderRef:this.props.rtdbFolderRef,showHeader:!0,browserStyle:"image-selector-modal",browserTitle:"Audio",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:this.props.modalId})))))}});var p=a(40927);const u=p.createClass({displayName:"SingularJsonBrowser",getInitialState:function(){return{insertFromWebUrl:"",filter:"",layoutStyle:"row browser-tree component-tree font-tree small-grid",layoutStyleIcon:"fa fa-th",status:"",isUploading:!1,selectedFolder:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!0},componentDidMount:function(){var e=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("j"),this.browserRef.config({useDefaultItemDoubleClick:!1,autoselectFirstItem:!1,onFolderSelected:function(e){this.setState({selectedFolder:e})}.bind(this),onItemDoubleClick:function(e){this.onSelect(e)}.bind(this)}),$("#"+this.props.modalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+this.props.modalId).on("shown.bs.modal",function(){e.refs.browser.refs.child.modalPending&&(e.refs.browser.refs.child.modalPending=!1)})},onSelect:function(e){this.props.onSelect&&(this.props.onSelect(e),$("#"+this.props.modalId).modal("toggle"))},render:function(){return p.createElement("div",{id:this.props.modalId,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},p.createElement("div",{id:"jsonBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},p.createElement("div",{className:"modal-content"},p.createElement("div",{className:"modal-body"},p.createElement(r.A,{rtdbFolderRef:this.props.rtdbFolderRef,showHeader:!0,browserStyle:"image-selector-modal",browserTitle:"JSON",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:this.props.modalId})))))}});var m=a(40927);const h=m.createClass({displayName:"SingularVideoBrowser",getInitialState:function(){return{insertFromWebUrl:"",filter:"",layoutStyle:"row browser-tree component-tree font-tree small-grid",layoutStyleIcon:"fa fa-th",status:"",isUploading:!1,selectedFolder:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!0},componentDidMount:function(){var e=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("v"),this.browserRef.config({useDefaultItemDoubleClick:!1,autoselectFirstItem:!1,onFolderSelected:function(e){this.setState({selectedFolder:e})}.bind(this),onItemDoubleClick:function(e){this.onSelect(e)}.bind(this)}),$("#"+this.props.modalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+this.props.modalId).on("shown.bs.modal",function(){e.refs.browser.refs.child.modalPending&&(e.refs.browser.refs.child.modalPending=!1)})},onSelect:function(e){this.props.onSelect&&(this.props.onSelect(e),$("#"+this.props.modalId).modal("toggle"))},render:function(){return m.createElement("div",{id:this.props.modalId,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},m.createElement("div",{id:"videoBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},m.createElement("div",{className:"modal-content"},m.createElement("div",{className:"modal-body"},m.createElement(r.A,{rtdbFolderRef:this.props.rtdbFolderRef,showHeader:!0,browserStyle:"image-selector-modal",browserTitle:"Video",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:this.props.modalId})))))}});var f=a(40927);const g=f.createClass({displayName:"SingularDataBrowser",getInitialState:function(){return{insertFromWebUrl:"",filter:"",layoutStyle:"row browser-tree component-tree font-tree small-grid",layoutStyleIcon:"fa fa-th",status:"",isUploading:!1,selectedFolder:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!0},componentDidMount:function(){var e=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("da"),this.browserRef.config({useDefaultItemDoubleClick:!1,autoselectFirstItem:!1,onFolderSelected:function(e){this.setState({selectedFolder:e})}.bind(this),onItemDoubleClick:function(e){this.onSelect(e)}.bind(this)}),$("#"+this.props.modalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+this.props.modalId).on("shown.bs.modal",function(){e.refs.browser.refs.child.modalPending&&(e.refs.browser.refs.child.modalPending=!1)})},onSelect:function(e){this.props.onSelect&&(this.props.onSelect(e),$("#"+this.props.modalId).modal("toggle"))},render:function(){return f.createElement("div",{id:this.props.modalId,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},f.createElement("div",{id:"dataBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},f.createElement("div",{className:"modal-content"},f.createElement("div",{className:"modal-body"},f.createElement(r.A,{rtdbFolderRef:this.props.rtdbFolderRef,showHeader:!0,browserStyle:"image-selector-modal",browserTitle:"Data",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:this.props.modalId})))))}});var v,b,y,w,E,I={rtdbFolderRef:function(e){return window.singularRtdbCoreRef.child("accounts").child(window.singularUser.account.accountId).child("assets")},imageModalId:"imageBrowserModal",imageSingleton:(v={},b=function(e){v.onUpload&&v.onUpload(e)},y=function(e){v.onSelect&&v.onSelect(e)},w=function(e){v.onInsertFromWeb&&v.onInsertFromWeb(e)},E=i().createClass({displayName:"BrowserSingleton",componentDidMount:function(){},render:function(){return i().createElement(l,{key:I.imageModalId,modalId:I.imageModalId,guid:I.imageModalId,rtdbFolderRef:I.rtdbFolderRef(),onUpload:b,onInsertFromWeb:w,onSelect:y})}}),E.config=function(e){v.onUpload=e.onUpload,v.onInsertFromWeb=e.onInsertFromWeb,v.onSelect=e.onSelect},E),compositionInputModalId:"compositionInputBrowserModal",compositionInputSingleton:function(){var e={},t=i().createClass({displayName:"BrowserSingleton",componentDidMount:function(){var t=this;this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("c"),this.browserRef.config({useDefaultItemDoubleClick:!1,browserStyle:"modal",onItemDoubleClick:function(t){o().get("/apiv1/compositions/"+t.refId).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading composition: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);!function(t){e.onSelectComp&&e.onSelectComp(t)}(a.body),$("#"+I.compositionInputModalId).modal("hide")}}.bind(this))}.bind(this)}),$("#"+I.compositionInputModalId).on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),$("#"+I.compositionInputModalId).on("shown.bs.modal",function(){t.refs.browser.refs.child.modalPending&&(t.refs.browser.refs.child.modalPending=!1)})},render:function(){return i().createElement("div",{id:I.compositionInputModalId,className:"modal fade u-displaynone compBrowserModal",tabIndex:"-1",role:"dialog"},i().createElement("div",{className:"modal-dialog modal-lg",role:"document"},i().createElement("div",{className:"modal-content"},i().createElement("div",{className:"modal-body"},i().createElement(r.A,{rtdbFolderRef:I.rtdbFolderRef(),ref:"browser",showHeader:!0,browserTitle:"Composition",showInspector:!1,showSearch:!0,browserStyle:"modal"})))))}});return t.config=function(t){e.onSelectComp=t.onSelectComp},t}(),audioModalId:"audioBrowserModal",audioSingleton:function(){var e=i().createClass({displayName:"self",componentDidMount:function(){},render:function(){return i().createElement(c,{key:I.audioModalId,modalId:I.audioModalId,guid:I.audioModalId,rtdbFolderRef:I.rtdbFolderRef(),onUpload:t,onInsertFromWeb:n,onSelect:a})}});e.config=function(t){e.config.onUpload=t.onUpload,e.config.onInsertFromWeb=t.onInsertFromWeb,e.config.onSelect=t.onSelect};var t=function(t){e.config.onUpload&&e.config.onUpload(t)},a=function(t){e.config.onSelect&&e.config.onSelect(t)},n=function(t){e.config.onInsertFromWeb&&e.config.onInsertFromWeb(t)};return e}(),jsonModalId:"jsonBrowserModal",jsonSingleton:function(){var e=i().createClass({displayName:"self",componentDidMount:function(){},render:function(){return i().createElement(u,{key:I.jsonModalId,modalId:I.jsonModalId,guid:I.jsonModalId,rtdbFolderRef:I.rtdbFolderRef(),onUpload:t,onInsertFromWeb:n,onSelect:a})}});e.config=function(t){e.config.onUpload=t.onUpload,e.config.onInsertFromWeb=t.onInsertFromWeb,e.config.onSelect=t.onSelect};var t=function(t){e.config.onUpload&&e.config.onUpload(t)},a=function(t){e.config.onSelect&&e.config.onSelect(t)},n=function(t){e.config.onInsertFromWeb&&e.config.onInsertFromWeb(t)};return e}(),videoModalId:"videoBrowserModal",videoSingleton:function(){var e=i().createClass({displayName:"self",componentDidMount:function(){},render:function(){return i().createElement(h,{key:I.videoModalId,modalId:I.videoModalId,guid:I.videoModalId,rtdbFolderRef:I.rtdbFolderRef(),onUpload:t,onInsertFromWeb:n,onSelect:a})}});e.config=function(t){e.config.onUpload=t.onUpload,e.config.onInsertFromWeb=t.onInsertFromWeb,e.config.onSelect=t.onSelect};var t=function(t){e.config.onUpload&&e.config.onUpload(t)},a=function(t){e.config.onSelect&&e.config.onSelect(t)},n=function(t){e.config.onInsertFromWeb&&e.config.onInsertFromWeb(t)};return e}(),dataModalId:"dataBrowserModal",dataSingleton:function(){var e=i().createClass({displayName:"self",componentDidMount:function(){},render:function(){return i().createElement(g,{key:I.dataModalId,modalId:I.dataModalId,guid:I.dataModalId,rtdbFolderRef:I.rtdbFolderRef(),onUpload:t,onInsertFromWeb:n,onSelect:a})}});e.config=function(t){e.config.onUpload=t.onUpload,e.config.onInsertFromWeb=t.onInsertFromWeb,e.config.onSelect=t.onSelect};var t=function(t){e.config.onUpload&&e.config.onUpload(t)},a=function(t){e.config.onSelect&&e.config.onSelect(t)},n=function(t){e.config.onInsertFromWeb&&e.config.onInsertFromWeb(t)};return e}()};const N=I}}]);