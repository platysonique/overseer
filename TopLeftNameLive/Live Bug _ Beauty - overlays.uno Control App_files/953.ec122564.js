(self.webpackChunkSingular=self.webpackChunkSingular||[]).push([[953],{49007:()=>{},70187:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(40927),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),LZUTF8=__webpack_require__(95474),AdaptationUtil=__webpack_require__(25160),ErrorStackParser=__webpack_require__(14263);function createOverlayInstance(e){return function(e){var t=[];return{addListener:function(e){t.push(e)},removeListener:function(e){if(e)for(var i=0,r=t.length;i<r;i++)t[i]===e&&t.splice(i,1);else t=[]},removeAllListener:function(){t=[]},dispatchEvent:function(e,i){for(var r in t)t.hasOwnProperty(r)&&t[r].call(window,e,i)},error:function(t){window.SingularOverlayErrorHandler?window.SingularOverlayError(t):e("overlay_error",t)},message:function(t){window.SingularOverlayMessageHandler?window.SingularOverlayMessageHandler(t):e("overlay_message",t)},transformElement:function(t){window.SingularOverlayTransformElementHandler?window.SingularOverlayTransformElementHandler(t):e("overlay_transformElement",t)},controlVideo:function(t){window.SingularOverlayControlVideoHandler?window.SingularOverlayControlVideoHandler(t):e("overlay_controlVideo",t)},controlAudio:function(t){window.SingularOverlayControlAudioHandler?window.SingularOverlayControlAudioHandler(t):e("overlay_controlAudio",t)}}}(e)}var OnairInteractive=react__WEBPACK_IMPORTED_MODULE_0___default().createClass({displayName:"OnairInteractive",getInitialState:function(){return this.playerInstance=null,this.overlayInstance=null,this.overlayScriptObject=null,{unmount:!1,outputOK:!0}},onCompositionReady:function(e){this.props.onCompositionReady&&this.props.onCompositionReady(e)},onStateChanged:function(e,t){this.props.onStateChanged&&this.props.onStateChanged(e,t)},unmount:function(){this.setState({unmount:!0})},sendMessage:function(e,t){window.parent.postMessage({type:e,params:t},"*")},sendScriptEditorMessage:function(e,t){if(e&&"error"==e.type)if(e.message){var i=e.scriptName;i||(i=""),console.log("Composition Script Status "+i+":",e.type+" - "+e.message,e.line)}else console.log("Composition Script Status: ",e.type);window.parent.postMessage({type:"CompositionScriptEditorMessage",params:e},"*")},parseStackTrace:function(e){var t=ErrorStackParser.parse(e);if(!t||!t.length)return{compId:null,line:null};var i=function(e){if("SingularOverlayScript.js"==e)return"overlay";if(-1!==e.indexOf("SingularGlobalScript"))return"global";var t=e.lastIndexOf("/")+1;return e.substr(t,e.length-t-3)},r=function(e){if("SingularOverlayScript.js"==e)return"Overlay Script";if(-1!==e.indexOf("SingularGlobalScript"))return"Global Script";var t=e.indexOf("SingularCompScript/");if(-1!=t){t+=19;var i=e.lastIndexOf("/");if(-1!=i)return e.substr(t,i-t)}},n=t[0],a=i(n.fileName),s=r(n.fileName);if("singularplayer"==a||"OnairScript"==a){if(!(n=t[1]))return{compId:null,line:null};a=i(n.fileName),s=r(n.fileName)}return{compId:a,scriptName:s,line:{line:n.lineNumber,col:n.columnNumber}}},reportRunTimeError:function(e){var t=this.parseStackTrace(e);t.compId&&window.parent.postMessage({event:"_singular_composition_script_event",params:{type:"error",compId:t.compId,scriptName:t.scriptName,message:e.message,line:t.line}},"*")},parseOverlayScript:function(e){return"string"==typeof e?LZUTF8.decompress(e,{inputEncoding:"StorageBinaryString"}):""},instanciateOverlayScript:function(e){e&&e.trim().length>0?(this.evalOverlayScript(e),this.initOverlayScript(this.overlayScriptObject,this.playerInstance,this.overlayInstance)):this.closeOverlayScript()},evalOverlayScript:function evalOverlayScript(script){this.sendScriptEditorMessage({type:"eval",message:""},null),this.closeOverlayScript();try{script+="//# sourceURL=SingularOverlayScript.js",this.overlayScriptObject=eval(script)}catch(e){var result=this.parseStackTrace(e);this.sendScriptEditorMessage({type:"error",compId:result.compId,scriptName:result.scriptName,message:e.name+": "+e.message,line:result.line},e)}},initOverlayScript:function(e,t,i){if(!e)return this.overlayScriptObject=null,void this.sendScriptEditorMessage({type:"error",message:"Script object not found"},null);if(e.init&&"function"==typeof e.init)if(e.close&&"function"!=typeof e.close)this.sendScriptEditorMessage({type:"error",message:"Close is not a function"},null);else{var r=!1;try{e.init(t,i),r=!0}catch(e){var n=this.parseStackTrace(e);n.compId&&this.sendScriptEditorMessage({type:"error",compId:n.compId,scriptName:n.scriptName,message:e.name+": "+e.message,line:n.line},e),n.compId&&"overlay"===n.compId||(r=!0)}r?(this.sendMessage("overlay_ready"),this.sendScriptEditorMessage({type:"ok"},null)):this.overlayScriptObject=null}else this.sendScriptEditorMessage({type:"error",message:"Init function not found"},null)},closeOverlayScript:function(){if(this.overlayScriptObject&&this.overlayScriptObject.close&&"function"==typeof this.overlayScriptObject.close)try{this.overlayScriptObject.close(),this.sendScriptEditorMessage({type:"ok"},null)}catch(t){var e=this.parseStackTrace(t);this.sendScriptEditorMessage({type:"error",compId:e.compId,scriptName:e.scriptName,message:t.name+": "+t.message,line:e.line},t)}this.overlayScriptObject&&(this.playerInstance.removeAllListener(),this.overlayInstance.removeAllListener(),this.registerDefaultPlayerListeners(),delete this.overlayScriptObject),this.overlayScriptObject=null},registerDefaultPlayerListeners:function(){var e=this;this.playerInstance.addListener("message",function(t,i){"mousedown"==i.type&&i.params&&"background"==i.params.type&&e.sendMessage("overlay_message",{type:"backgroundClick",params:i.params}),"focus"==i.type&&e.sendMessage("overlay_message",{type:"focus",params:i.params}),"blur"==i.type&&e.sendMessage("overlay_message",{type:"blur",params:i.params})}),this.playerInstance.addListener("composition_script_event",function(t,i){e.sendScriptEditorMessage({type:i.type,line:i.line,message:i.message,compId:i.compId,scriptName:i.scriptName},null)})},componentDidMount:function(){var e=this;try{document.getElementById("SingularPlayer").contentWindow.singularRtdbCoreApp=window.singularRtdbCoreApp,document.getElementById("SingularPlayer").contentWindow.singularAppInstanceDataStoreSBRef=window.singularAppInstanceDataStoreSBRef,document.getElementById("SingularPlayer").contentWindow.rwms=this.props.showWatermark}catch(e){}window.addEventListener("error",function(t){return e.reportRunTimeError(t.error)},!1),this.overlayInstance=createOverlayInstance(this.sendMessage),window.addEventListener("message",function(e){if(e.data.type&&0==e.data.type.indexOf("_overlay_send_")){var t=e.data.params;switch(this.overlayInstance.dispatchEvent(e.data.type.substr(14),t),e.data.type){case"_overlay_send_videoSegment":this.playerInstance.videoCommand("videoSegment",t.time);break;case"_overlay_send_videoPlaying":this.playerInstance.videoCommand("videoPlaying");break;case"_overlay_send_videoPaused":this.playerInstance.videoCommand("videoPaused");break;case"_overlay_send_videoStopped":this.playerInstance.videoCommand("videoStopped");break;case"_overlay_send_setDelay":this.playerInstance.videoCommand("setDelay",t.time);break;case"_overlay_send_focus":try{document.getElementById("SingularPlayer").contentWindow.focus()}catch(e){}}}else if(e.data&&null==e.data.type&&"string"==typeof e.data&&-1!==e.data.indexOf("_singular_setScript")){var i=JSON.parse(e.data);i&&i.params&&i.params.script&&this.instanciateOverlayScript(this.parseOverlayScript(i.params.script))}}.bind(this),!1),this.playerInstance=SingularPlayer("SingularPlayer"),this.playerInstance.setConfig({graphicsDelay:parseInt(window.singularScene.graphicsDelay),syncGraphics:window.singularScene.syncGraphics}),this.playerInstance.noTrack(),this.registerDefaultPlayerListeners(),window.SingularPlayerInstance=this.playerInstance;var t=this.parseOverlayScript(this.props.sbRef.child("script").val()),i=!1;if(this.props.rtdbRef.child("script").on("value",function(t){0==i?i=!0:t.exists()&&e.instanciateOverlayScript(e.parseOverlayScript(t.val()))}),this.props.sbRef.child("compositionProps/scripts").exists()||t||"compositionPreview"==window.onairMode){var r=function(e){"appinstance"==this.props.interactiveMode?this.playerInstance.renderAppOutput(window.singularAppInstanceId,window.singularAppInstanceOutputInfo,function(t){e?this.initOverlayScript(e,this.playerInstance,this.overlayInstance):this.sendMessage("overlay_ready")}.bind(this)):this.playerInstance.loadComposition(-1==window.singularCompId?window.singularCompUrl:window.singularCompId,function(t){e?this.initOverlayScript(e,this.playerInstance,this.overlayInstance):this.sendMessage("overlay_ready")}.bind(this))}.bind(this);t&&t.trim().length>0?(this.evalOverlayScript(t),r(this.overlayScriptObject)):r(null)}else(window.singularScene&&window.singularScene.forceinteractivelayer||"compurl"===window.onairMode)&&("appinstance"==this.props.interactiveMode?this.playerInstance.renderAppOutput(window.singularAppInstanceId,window.singularAppInstanceOutputInfo,function(e){this.sendMessage("overlay_ready")}.bind(this)):this.playerInstance.loadComposition(-1==window.singularCompId?window.singularCompUrl:window.singularCompId,function(e){this.sendMessage("overlay_ready")}.bind(this)))},componentWillUnmount:function(){this.closeOverlayScript()},render:function(){if(this.state.unmount)return null;var e="/singularplayer/output?";if(window.singularScene){var t=window.singularScene;e+="bgcolor="+t.bgcolor+"&width="+t.width+"&height="+t.height+"&aspect="+t.aspect+"&",1==window.multipleDBs&&(e+="fbdb="+new URL(window.singularCoreDb.databaseURL).hostname+"&")}if(window.singularAdaptationGlobals&&AdaptationUtil.getQuery(window.singularAdaptationGlobals).forEach(function(t){e+=t+"&"}),window.singularDisplayVariant){var i=window.singularBrand,r=window.singularAccountSubscriptionPlan;"singular"==i||"uno"==i&&("unoplus"==r||"unopro"==r)?e+="variant="+window.singularDisplayVariant+"&":"[disable_display_variant]"!=window.singularDisplayVariant?console.log("Ignoring variant="+window.singularDisplayVariant+" because of missing license. Switching to default display variant"):e+="variant=[disable_display_variant]&"}return e=e.substring(0,e.length-1),react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div",null,react__WEBPACK_IMPORTED_MODULE_0___default().createElement("iframe",{title:"Singular Player",id:"SingularPlayer",ref:"singularPlayer",style:{position:"absolute",left:"0px",top:"0px",width:"0px",height:"0px",maxWidth:"100%",maxHeight:"100%",minWidth:"100%",minHeight:"100%",overflow:"hidden",border:"solid 0px white"},src:e}))}});const __WEBPACK_DEFAULT_EXPORT__=OnairInteractive},84433:(e,t,i)=>{var r=i(15734),n="assets.singular.live";e.exports={readFromS3OrFirebase:function(e,t){var i=function(e,t){var i=function(e,t){delete e.reloadPageAfterWritten,delete e.saveScript,e.compositionProps||(e.compositionProps={}),e.compositionProps.scripts||(e.compositionProps.scripts={}),t(null,e)};1==window.singularScene.s3_script?r.get("//".concat(n,"/").concat(window.singularUser.account.accountUId,"/compositions/").concat(window.singularScene.id||window.singularCompId,".script?r=").concat(Math.random())).end(function(r,n){if(!r){var a=JSON.parse(n.text);if(e.script=a.overlayScript,e.compositionProps.scripts)for(var s in a.subCompScripts)e.compositionProps.scripts[s]=a.subCompScripts[s];else e.compositionProps.scripts=a.subCompScripts;if(e.compositionProps.scripts)for(var o in a.noScripts)delete e.compositionProps.scripts[o]}i(e,t)}):i(e,t)};1==window.singularScene.s3_comp?r.get("//".concat(n,"/").concat(window.singularUser.account.accountUId,"/compositions/").concat(window.singularScene.id||window.singularCompId,"?r=").concat(Math.random())).end(function(e,r){e?t("Cannot load composition"):i(JSON.parse(r.text),t)}):e.once("value",function(e){i(e.val(),t)})}}},97909:(e,t,i)=>{e.exports={polyfill:function(){i(86964).polyfill(),Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],a=0;a<r;a++)if(t=i[a],e.call(n,t,a,i))return t}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,i=window.getComputedStyle(t,null),r=parseInt(i.getPropertyValue("border-top-width")),n=parseInt(i.getPropertyValue("border-left-width")),a=this.offsetTop-t.offsetTop<t.scrollTop,s=this.offsetTop-t.offsetTop+this.clientHeight-r>t.scrollTop+t.clientHeight,o=this.offsetLeft-t.offsetLeft<t.scrollLeft,l=this.offsetLeft-t.offsetLeft+this.clientWidth-n>t.scrollLeft+t.clientWidth,c=a&&!s;(a||s)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-r+this.clientHeight/2),(o||l)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-n+this.clientWidth/2),(a||s||o||l)&&!e&&this.scrollIntoView(c)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)})}}}}]);