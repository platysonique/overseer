/*! For license information please see app.53efd7b3.js.LICENSE.txt */
(()=>{var e,t={228:(e,t,a)=>{"use strict";a.r(t)},16524:(e,t,a)=>{var i=a(25499);e.exports=i({ANIMATION:null,CONTROL:null,TRANSFORM:null,EFFECT:null,UPDATE:null,BEHAVIOR:null,ADAPTIVE:null,EVENT:null})},28866:(e,t,a)=>{"use strict";a.r(t)},33738:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(40927),n=a.n(i),s=(a(15734),a(57453)),o=a(9769);const l=n().createClass({displayName:"ThumbnailWrapper",getInitialState:function(){return{status:""}},shouldComponentUpdate:function(e,t){return!o.compareObject(t,this.state)||!o.compareObject(e,this.props)},componentWillMount:function(){},componentDidMount:function(){},handleResizeThumbnail:function(){var e=this.refs.thumbnailIMG;e.displayImage.naturalWidth>e.displayImage.naturalHeight?this.setState({class:"thumbnail-image-wide"}):this.setState({class:"thumbnail-image"})},render:function(){var e=this.props.imageUrl;e||(e=this.props.defaultImageUrl);var t="/images/loading-bubbles.svg";return this.props.initialImage&&(t=this.props.initialImage),n().createElement(s.A,{src:e,fallbackImage:this.props.defaultImageUrl,initialImage:t,className:this.state.class,onLoad:this.handleResizeThumbnail,ref:"thumbnailIMG",style:this.props.style})}})},37507:e=>{function t(){var e,i,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function l(t,n,s,o){var l=n&&n.prototype instanceof c?n:c,d=Object.create(l.prototype);return a(d,"_invoke",function(t,a,n){var s,o,l,c=0,d=n||[],p=!1,m={p:0,n:0,v:e,a:u,f:u.bind(e,4),d:function(t,a){return s=t,o=0,l=e,m.n=a,r}};function u(t,a){for(o=t,l=a,i=0;!p&&c&&!n&&i<d.length;i++){var n,s=d[i],u=m.p,h=s[2];t>3?(n=h===a)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=u&&((n=t<2&&u<s[1])?(o=0,m.v=a,m.n=s[1]):u<h&&(n=t<3||s[0]>a||a>h)&&(s[4]=t,s[5]=a,m.n=h,o=0))}if(n||t>1)return r;throw p=!0,a}return function(n,d,h){if(c>1)throw TypeError("Generator is already running");for(p&&1===d&&u(d,h),o=d,l=h;(i=o<2?e:l)||!p;){s||(o?o<3?(o>1&&(m.n=-1),u(o,l)):m.n=l:m.v=l);try{if(c=2,s){if(o||(n="next"),i=s[n]){if(!(i=i.call(s,l)))throw TypeError("iterator result is not an object");if(!i.done)return i;l=i.value,o<2&&(o=0)}else 1===o&&(i=s.return)&&i.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),o=1);s=e}else if((i=(p=m.n<0)?l:t.call(a,m))!==r)break}catch(t){s=e,o=1,l=t}finally{c=1}}return{value:i,done:p}}}(t,s,o),!0),d}var r={};function c(){}function d(){}function p(){}i=Object.getPrototypeOf;var m=[][s]?i(i([][s]())):(a(i={},s,function(){return this}),i),u=p.prototype=c.prototype=Object.create(m);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,a(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return d.prototype=p,a(u,"constructor",p),a(p,"constructor",d),d.displayName="GeneratorFunction",a(p,o,"GeneratorFunction"),a(u),a(u,o,"Generator"),a(u,s,function(){return this}),a(u,"toString",function(){return"[object Generator]"}),(t=function(){return{w:l,m:h}})()}function a(e,t,i,n){var s=Object.defineProperty;try{s({},"",{})}catch(e){s=0}a=function(e,t,i,n){function o(t,i){a(e,t,function(e){return this._invoke(t,i,e)})}t?s?s(e,t,{value:i,enumerable:!n,configurable:!n,writable:!n}):e[t]=i:(o("next",0),o("throw",1),o("return",2))},a(e,t,i,n)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}function n(e,t,a,i,n,s,o){try{var l=e[s](o),r=l.value}catch(e){return void a(e)}l.done?t(r):Promise.resolve(r).then(i,n)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(){var e;return e=t().m(function e(){var a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/singular-scripting-doc.md");case 1:if(!(a=e.v).ok){e.n=3;break}return e.n=2,a.text();case 2:return e.a(2,e.v);case 3:return e.a(2,"");case 4:return e.p=4,e.v,e.a(2,"")}},e,null,[[0,4]])}),o=function(){var t=this,a=arguments;return new Promise(function(i,s){var o=e.apply(t,a);function l(e){n(o,i,s,l,r,"next",e)}function r(e){n(o,i,s,l,r,"throw",e)}l(void 0)})},o.apply(this,arguments)}e.exports={extractModelsDataLinksNodeRefs:function(e){var t=[],a={},i=e.compositions||{};for(var n in i){var o=i[n];if(o&&o.tiles)for(var l in o.tiles){var r=o.tiles[l];r&&"composition"===r.type&&(a[r.id]=r.name||r.id)}}for(var c in i){var d=i[c];d&&d.name&&(a[c]=d.name)}for(var p in i){var m=i[p],u=m&&m.dataSources&&m.dataSources.composition&&m.dataSources.composition.controlNode,h=u&&u.model&&u.model.fields,f=[];if(h&&"object"===s(h))for(var g in h){var v=h[g];f.push({id:v&&(v.id||g),title:v&&(v.title||v.id||g),type:v&&(v.type||null)})}var b=[];if(m.dataLinks&&"object"===s(m.dataLinks))for(var y in m.dataLinks){var E=m.dataLinks[y];if(E&&"object"===s(E))for(var w in E){var S=E[w];b.push({tileId:y,property:w,link:S})}}var N=[];if(m.nodeRefs&&"object"===s(m.nodeRefs))for(var C in m.nodeRefs){var x=m.nodeRefs[C];if(x&&"object"===s(x))for(var I in x){var k=x[I];N.push({tileId:C,refId:I,ref:k})}}if(f.length>0||b.length>0||N.length>0){var D=p===(e&&e.mainComposition)?"Root Composition":a[p]||p;t.push({compName:D,compId:p,models:f,datalinks:b,noderefs:N})}}return t},extractCompositionStructure:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return null;!e.mainComposition&&t&&(e.mainComposition=t);var a=e.compositions||{},i={};for(var n in a){var o=a[n];if(o&&o.tiles)for(var l in o.tiles){var r=o.tiles[l];r&&"composition"===r.type&&r.id&&(i[r.id]=r.name||i[r.id]||r.id)}o&&o.name&&(i[n]=o.name)}var c=new Set,d=e.mainComposition;return d?function t(n){var o=n===e.mainComposition;if(!n||!a[n])return{compName:i[n]||(o?"Root Composition":n),compId:n,children:[],groups:[],tiles:[]};if(c.has(n))return{compName:i[n]||(o?"Root Composition":n),compId:n,children:[],groups:[],tiles:[]};c.add(n);var l=a[n],r={compName:o?"Root Composition":i[n]||l.name||n,compId:n,children:[],groups:[],tiles:[]};if(l&&l.tiles)for(var d in l.tiles){var p=l.tiles[d];p&&"composition"===p.type&&p.id&&r.children.push(t(p.id))}if(l&&l.tiles)for(var m in l.tiles){var u=l.tiles[m];u&&u.id&&r.tiles.push({id:u.id,name:u.name||i[u.id]||u.id,type:u.type||null,widgetId:u.widget||null})}if(l&&l.groups)for(var h in l.groups){var f=l.groups[h];if(f&&f.id){var g={id:f.id,name:f.name||f.id,tiles:[]};if(f.items&&"object"===s(f.items))for(var v in f.items){var b=f.items[v];if(b&&b.id){var y=l.tiles&&l.tiles[b.id]||null;g.tiles.push({id:b.id,name:y&&y.name||i[b.id]||b.id})}}r.groups.push(g)}}return r}(d):null},getSingularScriptingDocument:function(){return o.apply(this,arguments)},getScriptName:function e(t,a){if("overlay"===t)return"Overlay Script";if("global"===t)return"Global Script";if(a.compId===t)return a.compName;if(a.children){var n,s=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return i(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,s=function(){};return{s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,r=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){r=!0,o=e},f:function(){try{l||null==a.return||a.return()}finally{if(r)throw o}}}}(a.children);try{for(s.s();!(n=s.n()).done;){var o=e(t,n.value);if(o)return o}}catch(e){s.e(e)}finally{s.f()}}return null},getModelsDataLinksNodeRefsPrompt:function(){return"<Models_DataLinks_NodeRefs_Explanation>\n  Given the Models_DataLinks_NodeRefs:\n  <JSON>\n".concat(JSON.stringify([{compName:"Root Composition",compId:"-NAwfzg2L5DIPhcbLtJc",models:[{id:"rootText",title:"rootText",type:"text"}],datalinks:[],noderefs:[]},{compName:"Comp1",compId:"a12e43a5-8e11-3b61-be5b-77d9f095c327",models:[{id:"Text",title:"Text",type:"text"},{id:"Circle_Color",title:"Circle_Color",type:"color"}],datalinks:[{tileId:"21dd8d83-1f30-79c3-b7a2-b7070d36b93f",property:"fillGradient",link:{location:"composition",locationId:"self",index:0,sortIndex:-1,key:"Circle_Color",keyId:"1787bf44-c67d-b4ee-b8af-dac1dcbeee23",type:"controlNode"}}],noderefs:[]},{compName:"Comp1_child1",compId:"d0d4f803-37f1-a151-a42e-81b804a574ff",models:[{id:"Text_Child",title:"Text_Child",type:"text"}],datalinks:[{tileId:"7f86c481-8c11-8c20-e4ff-82bb4798c29e",property:"text",link:{location:"composition",locationId:"self",index:0,key:"Text_Child",keyId:"4f9cac45-92df-a927-a80f-d814ad4aff2b",type:"controlNode"}}],noderefs:[]},{compName:"Comp1_child2",compId:"a8ea2467-3b86-0a5a-c44a-d27c01478315",models:[],datalinks:[{tileId:"65fec9dd-4181-4fea-a6b6-d5d52a371e68",property:"text",link:{location:"composition",locationId:"root",index:0,sortIndex:-1,key:"rootText",keyId:"32165f1a-418a-3d0a-53cb-1d3b6b70a7b8",type:"controlNode"}}],noderefs:[]},{compName:"Comp1_child3",compId:"def57ebb-9cf2-5103-0d2f-89e87a12e3cb",models:[{id:"Circle_Radius",title:"Circle_Radius",type:"number"},{id:"Circle_Visibility",title:"Circle_Visibility",type:"checkbox"}],datalinks:[{tileId:"13e0c2da-bad6-e8e2-275d-5778add0de20",property:"radius",link:{location:"composition",locationId:"self",index:0,key:"Circle_Radius",keyId:"bdbf2003-b4c8-038c-034e-53a7633bde3a",type:"controlNode"}}],noderefs:[{tileId:"13e0c2da-bad6-e8e2-275d-5778add0de20",refId:"acfb16692abd4efbe46f33b8fcefcee2",ref:{sourceIndex:0,sourceKey:"Circle_Visibility",sourceKeyId:"241cea7a-4574-9ad1-f36d-478327d9cba8",sourceType:"controlNode",sourceLocation:["<selfCompId>","dataSources","composition"],targetLocation:["<selfCompId>","tiles","<objId>","layout","visible"]}}]}]),'\n</JSON>\n<Explantion>\nControl node id "rootText" is in the composition "Root". It links to the element in "Comp1_child2", property "text".\nControl node id "Text" is in the composition "Comp1". But it does not link to any element, so it is unused. Comp1.setPayload({Text: "Hello"}) alone will not visually change anything, unless there is some code that reads the value of this control node and does something with it.\nControl node id "Circle_Color" is in the composition "Comp1". It links the element in itself, property "fillGradient".\nControl node id "Text_Child" is in the composition "Comp1_child". It links the element in itself, property "text".\nControl node id "Circle_Radius" is in the composition "Comp1_child3". It links the element in itself, property "radius".\nControl node id "Circle_Visibility" is in the composition "Comp1_child3". It links the element in itself, property, property "layout.visible".\n\nThe models define properties of composition/sub-composition that can be set or read via scripting. \n```Javascript\nComp1_child1.setPayload({Text_Child: "Hello"});\n```\n\nSetting payload that is not linked to any element will not produce any visual change.\n```Javascript\nComp1.setPayload({Text: "Hello"}); // This will not produce any visual change because \'Text\' is not linked to any element\n```\n\nFor model type = \'color\', the value can be:\n```Javascript\nComp1.setPayload({Circle_Color: "#ff0000"}); // Set to red\nComp1.setPayload({Circle_Color: "blue"}); // Set to blue\nComp1.setPayload({Circle_Color: {r: 0, g: 255, b: 0}}); // Set to green\nComp1.setPayload({Circle_Color: "rgb(255,255,0)"}); // Set to yellow\nComp1.setPayload({Circle_Color: "rgba(255,255,0,0.5)"}); // Set to yellow with 50% opacity\nComp1.setPayload({Circle_Color: "0xaabbcc"}); // using hex number\n```\n\n[CRITICAL] Setting a widget property directly linked with a control node will produce error\n```Javascript\nconst text = Comp1_child1.findWidget(\'Text\')[0];\ntext.setPayload({text: "Hello"}); // This will produce error because \'text\' is linked to control node \'Text_Child\'\n```\n\n\n</Explantion>\n</Models_DataLinks_NodeRefs_Explanation>')},getWidgetsPrompt:function(){return"<Widgets_Explanation>\nGiven the Widgets:\n<JSON>\n".concat(JSON.stringify([{name:"Rectangle",id:1022,version:4,model:{fields:[{id:"bevelSize",type:"number",title:"Bevel Size",min:0,max:1e3,step:.1,format:"0.0",unit:"%",unitName:"bevelSizeUnit",unitCollection:[{unit:"%",step:.1,defaultValue:"0.0",format:"0.0",min:"0.0",max:"100"},{unit:"px",step:1,defaultValue:"0",format:"0",min:"0",max:"10000"}],resetValue:0},{id:"bevelStyle",type:"selection",title:"Bevel Style",selections:[{id:"flat",title:"Flat"},{id:"outside",title:"Outside"},{id:"inside",title:"Inside"}],resetValue:"flat"},{id:"fillGradient",type:"gradient",title:"Fill",resetValue:""},{id:"height",type:"number",title:"Height",min:0,max:100,step:.1,format:"0.0",unit:"%",resetValue:100},{id:"outlineWidth",type:"number",title:"Outline Width",min:0,max:1e3,step:.1,format:"0.0",unit:"%",unitName:"outlineWidthUnit",unitCollection:[{unit:"%",step:.1,defaultValue:"0.0",format:"0.0",min:"0.0",max:"50.0"},{unit:"px",step:1,defaultValue:"0",format:"0",min:"0",max:"10000"}],resetValue:0},{id:"pivotX",type:"selection",title:"X",selections:[{id:"left",title:"Left"},{id:"center",title:"Center"},{id:"right",title:"Right"}],resetValue:"center"},{id:"pivotY",type:"selection",title:"Y",selections:[{id:"top",title:"Top"},{id:"center",title:"Center"},{id:"bottom",title:"Bottom"}],resetValue:"center"},{id:"renderStyle",type:"selection",title:"Render Style",selections:[{id:"filled",title:"Filled"},{id:"outline",title:"Outline"}],resetValue:"filled"},{id:"strokeGradient",type:"gradient",title:"Stroke",resetValue:""},{id:"strokeWidth",type:"number",title:"Stroke Width",min:0,max:1e3,step:1,format:"0",unit:"px",resetValue:0},{id:"width",type:"number",title:"Width",min:0,max:100,step:.1,format:"0.0",unit:"%",resetValue:100}],groups:[{id:"shapeGroup",title:"Shape",toolTip:"",activeId:"",childIds:["width","height","bevelStyle","bevelSize","renderStyle","outlineWidth"]},{id:"styleGroup",title:"Style",toolTip:"",activeId:"",childIds:["fillGradient","strokeWidth","strokeGradient"]},{id:"pivotGroup",title:"Pivot Point",toolTip:"",activeId:"",childIds:["pivotX","pivotY"]}]}}]),"</JSON>\n<Explantion> The model fields define the properties of the widget that can be set or read via scripting.\n\n```Javascript\nconst rect = Comp1.findWidget('Rectangle')[0];\nrect.setPayload({width: 50, height: 50);\n```\n  \n</Explantion></Widgets_Explanation>")}}},38057:(e,t)=>{"use strict";e.exports=function(){return["<input>","alwaysShowCalendars","applyClass","autoApply","autoUpdateInput","buttonClasses","cancelClass","dateLimit","drops","endDate","isCustomDate","isInvalidDate","linkedCalendars","locale","maxDate","minDate","opens","parentEl","ranges","showCustomRangeLabel","showDropdowns","showISOWeekNumbers","showWeekNumbers","singleDatePicker","startDate","template","timePicker","timePicker24Hour","timePickerIncrement","timePickerSeconds"]}},48766:e=>{e.exports={EffectSelections:[{id:"none",title:"None",property:[{id:"none",title:"None"}]},{id:"fade",title:"Fade",property:[{id:"none",title:"None"}]},{id:"translateNoFade",title:"Translate",property:[{id:"left",title:"Left"},{id:"right",title:"Right"},{id:"up",title:"Up"},{id:"down",title:"Down"}]},{id:"translate",title:"Translate & Fade",property:[{id:"left",title:"Left"},{id:"right",title:"Right"},{id:"up",title:"Up"},{id:"down",title:"Down"}]},{id:"rotate",title:"Rotate",property:[{id:"x+",title:"X+"},{id:"x-",title:"X-"},{id:"y+",title:"Y+"},{id:"y-",title:"Y-"}]},{id:"scale",title:"Scale",property:[{id:"xAndY",title:"X and Y"},{id:"x",title:"X"},{id:"y",title:"Y"}]},{id:"widget",title:"Widget",property:[{id:"none",title:"None"}]}],EffectSelectionsUpdateAnimation:[{id:"none",title:"None",property:[{id:"none",title:"None"}]},{id:"fade",title:"Fade",property:[{id:"none",title:"None"}]},{id:"translate",title:"Translate",property:[{id:"left",title:"Left"},{id:"right",title:"Right"},{id:"up",title:"Up"},{id:"down",title:"Down"}]},{id:"rotate",title:"Rotate",property:[{id:"x+",title:"X+"},{id:"x-",title:"X-"},{id:"y+",title:"Y+"},{id:"y-",title:"Y-"}]},{id:"scale",title:"Scale",property:[{id:"xAndY",title:"X and Y"},{id:"x",title:"X"},{id:"y",title:"Y"}]}]}},56027:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var i=a(25897),n=a(10611),s={};const o={COMPOSITION_PROPS:["logicLayers","timeline2Active","scripts","durations","snapshot"],importTile:function(e,t){var a=JSON.parse(JSON.stringify(e.tile));a.id=t,a.name=e.tile.name;var o={};e.data&&(o=JSON.parse(JSON.stringify(e.data)));var l={};e.dataLinks&&(l=JSON.parse(JSON.stringify(e.dataLinks)));var r={};e.nodeRefs&&(r=JSON.parse(JSON.stringify(e.nodeRefs)));var c={};if("composition"==e.tile.type&&e.comp){var d=this.importComposition2(e.comp,e.compositions,t,e.tile.id);$.extend(!0,c,d)}var p={},m={};for(var u in this.COMPOSITION_PROPS.forEach(function(e){m[e]={}}),c){var h;for(var f in s)if(s[f]==u){h=f;break}h&&e.compositionStates&&e.compositionStates[h]&&(p[u]=e.compositionStates[h]),this.COMPOSITION_PROPS.forEach(function(t){h&&e.compositionProps&&e.compositionProps[t]&&void 0!==e.compositionProps[t][h]&&(m[t][u]=e.compositionProps[t][h])})}var g=[],v={},b={},y=i.A.getWidgetById(e.tile.widget,e.tile.version);for(var E in y&&y.model&&y.model.fields&&Array.isArray(y.model.fields)&&y.model.fields.forEach(function(t){if("composition"==t.type&&""!=e.data[t.id]){var a=e.data[t.id],i=n.v4();g.push(a),v[t.id]=i,b[a]=i}}.bind(this)),g.forEach(function(t){var a=b[t];if(e.compositions[t]){var i=this.importComposition2(e.compositions[t],e.compositions,a,t);$.extend(!0,c,i)}}.bind(this)),v)o[E]=v[E];return{tile:a,data:o,dataLinks:l,nodeRefs:r,compositions:c,compositionStates:p,compositionProps:m}},importGroup:function(e,t){var a=JSON.parse(JSON.stringify(e.group));a.id=t,a.name=e.group.name;var i={group:a,tiles:[],data:{},dataLinks:{},nodeRefs:{},compositions:{},compositionStates:{},compositionProps:{}},s=a.items;for(var o in a.items={},s){var l=e.tiles.filter(function(e){return e.id==o})[0],r=n.v4(),c={tile:l,data:e.data[o],dataLinks:e.dataLinks[o],nodeRefs:e.nodeRefs[o],comp:e.compositions[o],compositions:e.compositions,compositionStates:e.compositionStates,compositionProps:e.compositionProps},d=this.importTile(c,r,!1);a.items[r]={id:r,priority:s[o].priority},i.tiles=i.tiles.concat(d.tile);var p={};p[r]=d.data,$.extend(!0,i.data,p);var m={};m[r]=d.dataLinks,$.extend(!0,i.dataLinks,m);var u={};u[r]=d.nodeRefs,$.extend(!0,i.nodeRefs,u),$.extend(!0,i.compositions,d.compositions),$.extend(!0,i.compositionStates,d.compositionStates),$.extend(!0,i.compositionProps,d.compositionProps)}return i},pasteTileTo:function(e,t,a,i,n,o){s={};var l=void 0,r=[];for(var c in t.items)r.push(t.items[c]);r.sort(function(e,t){return e.priority-t.priority-.5});for(var d=0;d<r.length;d++)if((m=r[d]).id==n){l=m.priority;for(var p=d;p<r.length;p++){var m,u=(m=r[p]).priority+1;a.child("groups").child(t.id).child("items").child(m.id).update({priority:u}),a.child("tiles").child(m.id).child("layout").child("zindex").set(u)}break}l||(l=0);var h={};$.extend(!0,h,e.tile),h.layout.zindex=l;var f=h.id;i.update(e.compositions),i.parent.child("compositionStates").update(e.compositionStates),i.parent.child("compositionProps").update(e.compositionProps),a.child("tiles").child(f).set(h),a.child("data").child(f).set(e.data),a.child("dataLinks").child(f).set(this.__remapDataLinks(e.dataLinks,a,o)),a.child("nodeRefs").child(f).set(e.nodeRefs),a.child("groups").child(t.id).child("items").child(f).set({id:f,priority:l})},__remapDataLinks:function(e,t,a){var i={};if(e)for(var n in e){var s=e[n];s&&("root"==s.locationId?(t.key==a.key&&(s.locationId="self"),i[n]=s):"self"==s.locationId||(i[n]=s))}return i},pasteGroupTo:function(e,t,a,i,n){s={};var o=void 0,l=void 0,r=Number.MIN_VALUE;t.sort(function(e,t){return e.priority-t.priority-.5});for(var c=0;c<t.length;c++)if(r=Math.max(r,t[c].priority),null==o&&t[c].id==n&&(l=o=t[c].priority),null!=o){o++;var d=a.child("groups").child(t[c].id);d.update({priority:o}),d.child("layout").child("zindex").set(o)}l||(l=r?r+1:0);var p={};$.extend(!0,p,e.group),p.layout.zindex=l,i.update(e.compositions),i.parent.child("compositionStates").update(e.compositionStates),i.parent.child("compositionProps").update(e.compositionProps),e.tiles.forEach(function(e){a.child("tiles").child(e.id).set(e)}),a.child("data").update(e.data),a.child("dataLinks").update(e.dataLinks),a.child("nodeRefs").update(e.nodeRefs),a.child("groups").child(p.id).set(p)},importComposition2:function(e,t,a,i){s[i]=a;var n={},o=[],l=this._importComposition(n,e),r={};r[a]=n,n={};do{l.forEach(function(e){o=o.concat(this._importComposition(n,t[e]));var a=s[e];r[a]=n,n={}}.bind(this)),l=o.slice(),o=[]}while(l.length>0);return this._remapParentComp(r),r},importComposition:function(e,t,a){a||console.error("importComposition: oldId must be vaild"),s[a]=t;var i={},n=[],o=this._importComposition(i,e),l={};l[t]=i,i={},e.tiles||o.push(a);do{o.forEach(function(t){if(e.compositions[t]){n=n.concat(this._importComposition(i,e.compositions[t]));var a=s[t];l[a]=i,i={}}}.bind(this)),o=n.slice(),n=[]}while(o.length>0);return this._remapParentComp(l),l},_remapParentComp:function(e){for(var t in e)if((i=e[t]).settings&&i.settings.linkTimeline&&i.settings.parentTimeline){var a=s[i.settings.parentTimeline];a&&(i.settings.parentTimeline=a)}for(var t in e){var i;if((i=e[t])&&i.dataLinks)for(var n in i.dataLinks){var o=i.dataLinks[n];for(var l in o)(c=o[l])&&("root"==c.locationId||"self"==c.locationId||(p=s[c.locationId])&&(c.locationId=p))}if(i&&i.nodeRefs)for(var n in i.nodeRefs){var r=i.nodeRefs[n];for(var l in r){var c;if((c=r[l])&&c.sourceLocation&&c.sourceLocation.length){var d=c.sourceLocation[0];if("<rootCompId>"==d);else if("<selfCompId>"==d);else{var p;(p=s[d])&&(c.sourceLocation[0]=p)}}}}}},_importComposition:function(e,t){var a={};$.extend(!0,a,t);var o=e,l=[];if(a.tiles)for(var r in a.tiles)"composition"==a.tiles[r].type&&l.push(a.tiles[r].id);var c=function(e){if(o[e]||(o[e]={}),a[e])for(var t in a[e]){var r;s[t]?r=s[t]:(r=n.v4(),s[t]=r);var c=JSON.parse(JSON.stringify(a[e][t]));if("tiles"!=e&&"groups"!=e&&"data"!=e||(c.id=r),"groups"==e){var d={};for(var p in c.items)d[s[p]]={id:s[p],priority:c.items[p].priority};c.items=d}var m,u=[];if("tiles"==e&&a.data){var h=a.tiles[t],f=a.data[t];h&&f&&(m=i.A.getWidgetById(h.widget,h.version))&&m.model&&m.model.fields&&Array.isArray(m.model.fields)&&m.model.fields.forEach(function(e){if("composition"==e.type){var t=s[f[e.id]];t||(t=n.v4(),s[f[e.id]]=t),u.push(f[e.id])}}),l=l.concat(u)}if("data"==e&&a.tiles)h=a.tiles[t],f=a.data[t],h&&f&&(m=i.A.getWidgetById(h.widget,h.version))&&m.model&&m.model.fields&&Array.isArray(m.model.fields)&&m.model.fields.forEach(function(e){if("composition"==e.type){var t=s[f[e.id]];t||(t=n.v4(),s[f[e.id]]=t),c[e.id]=t}});o[e][r]=c}},d=function(e){a[e]&&(o[e]=JSON.parse(JSON.stringify(a[e])))};return c("tiles"),c("data"),c("dataLinks"),c("groups"),c("nodeRefs"),d("selections"),d("settings"),d("dataSources"),l},getCompositionChildren:function(e,t,a,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t[e]){var o=t[e].tiles,l=t[e].data;o&&Object.keys(o).forEach(function(e){var r=o[e];"composition"==r.type&&(a.push(r.id),s||this.getCompositionChildren(r.id,t,a,n));var c=i.A.getWidgetById(r.widget,r.version);c&&c.model&&c.model.fields&&Array.isArray(c.model.fields)&&c.model.fields.forEach(function(i){"composition"==i.type&&""!=l[e][i.id]&&(a.push(l[e][i.id]),s||this.getCompositionChildren(l[e][i.id],t,a,n),n&&(n[l[e][i.id]]=[r.name,c,r.id,i.id]))}.bind(this))}.bind(this))}},getCompositionTree:function(e,t){var a={},i=[];return this.getCompositionChildren(e,t,i,void 0,!0),i.forEach(function(e){a[e]=this.getCompositionTree(e,t)}.bind(this)),a},getParentChildren:function(e,t){var a={},i=[e],n={};do{var s=[];i.forEach(function(e){var i=[];this.getCompositionChildren(e,t,i,n,!0),a[e]=i.slice(),s=s.concat(i.slice())}.bind(this)),i=s.slice()}while(i.length>0);return[a,n]},copyCompositionStatesWithIdMapping:function(e){var t={};if(e)for(var a in e){var i=s[a];i&&(t[i]=e[a])}return t},copyCompositionPropsWithIdMapping:function(e){var t={};return e&&this.COMPOSITION_PROPS.forEach(function(a){for(var i in t[a]={},e[a]){var n=s[i];n&&(t[a][n]=e[a][i])}}),t}}},59018:(e,t,a)=>{"use strict";a(94151);var i=a(40927),n=a(40961),s=a(45228),o=a(38057),l=a(5556),r=a(52306);e.exports=r({displayName:"exports",$picker:null,options:o(),makeEventHandler:function(e){return function(t,a){"function"==typeof this.props.onEvent&&this.props.onEvent(t,a),"function"==typeof this.props[e]&&this.props[e](t,a)}.bind(this)},getOptionsFromProps:function(e){var t;return e=e||this.props,this.options.forEach(function(a){e.hasOwnProperty(a)&&((t=t||{})[a]=e[a])}),t||{}},setOptionsFromProps:function(e){var t=Object.keys(e),a=this;a.$picker&&e&&t.forEach(function(t){"startDate"===t?a.$picker.data("daterangepicker").setStartDate(e[t]):"endDate"===t?a.$picker.data("daterangepicker").setEndDate(e[t]):"locale"===t?$.extend(a.$picker.data("daterangepicker")[t],e[t]):a.$picker.data("daterangepicker")[t]=e[t]})},componentWillReceiveProps:function(e){var t=this;if(t.$picker){var a=t.getOptionsFromProps(),i=t.getOptionsFromProps(e),n={};t.options.forEach(function(e){a[e]!==i[e]&&(n[e]=i[e])}),t.setOptionsFromProps(n)}},componentDidMount:function(){this.initializeDateRangePicker()},componentWillUnmount:function(){this.removeDateRangePicker()},removeDateRangePicker:function(){this.$picker.data("daterangepicker").remove()},initializeDateRangePicker:function(){var e=this;$=window.jQuery&&window.jQuery.fn.daterangepicker?window.jQuery:$,e.$picker=$(n.findDOMNode(this.refs.picker)),e.$picker.daterangepicker(this.getOptionsFromProps()),["Show","Hide","ShowCalendar","HideCalendar","Apply","Cancel"].forEach(function(t){var a=t.toLowerCase();e.$picker.on(a+".daterangepicker",e.makeEventHandler("on"+t))})},propTypes:{"<input>":l.any,alwaysShowCalendars:l.bool,applyClass:l.string,autoApply:l.bool,autoUpdateInput:l.bool,buttonClasses:l.array,cancelClass:l.string,dateLimit:l.object,drops:l.oneOf(["down","up"]),endDate:l.oneOfType([l.object,l.string]),isCustomDate:l.func,isInvalidDate:l.func,linkedCalendars:l.bool,locale:l.object,maxDate:l.oneOfType([l.object,l.string]),minDate:l.oneOfType([l.object,l.string]),onApply:l.func,onCancel:l.func,onEvent:l.func,onHide:l.func,onHideCalendar:l.func,onShow:l.func,onShowCalendar:l.func,opens:l.oneOf(["left","right","center"]),parentEl:l.any,ranges:l.object,showCustomRangeLabel:l.bool,showDropdowns:l.bool,showISOWeekNumbers:l.bool,showWeekNumbers:l.bool,singleDatePicker:l.bool,startDate:l.oneOfType([l.object,l.string]),template:l.any,timePicker:l.bool,timePickerIncrement:l.number,timePicker24Hour:l.bool,timePickerSeconds:l.bool},render:function(){var e=s({ref:"picker"},this.props);return Object.keys(this.constructor.propTypes).forEach(function(t){delete e[t]}),i.cloneElement(this.props.children,{ref:"picker"})}})},70782:e=>{e.exports=["#e53935","#5e35b1","#1e88e5","#8e24aa","#00897b","#d81b60","#3949ab","#c0ca33","#81c784","#00acc1","#fb8c00","#43a047","#7cb342","#c2185b","#fdd835","#ffb300","#303f9f","#f4511e","#d32f2f","#0097a7","#7b1fa2","#512da8","#689f38","#1976d2","#0288d1","#ffa000","#00796b","#388e3c","#c62828","#afb42b","#fbc02d","#4527a0","#f57c00","#e64a19","#00838f","#ad1457","#6a1b9a","#558b2f","#1565c0","#0277bd","#ff8f00","#00695c","#2e7d32","#b71c1c","#9e9d24","#f9a825","#311b92","#ef6c00","#d84315","#01579b","#880e4f","#4a148c","#1b5e20","#1a237e","#0d47a1","#006064","#004d40","#f57f17","#33691e","#827717","#bf360c","#ff6f00","#e65100"]},71906:(e,t,a)=>{"use strict";"undefined"==typeof window?e.exports=function(){return null}:e.exports=a(10062)},88170:e=>{e.exports={CATEGORY_NAME_MAP:{spark:"Spark",studio:"Studio",dashboard:"Dashboard",composer:"Composer",api:"API"},STATUS_NAME_MAP:{draft:"Draft",published:"Published"},TYPE_NAME_MAP:{update:"Update","new-feature":"New Feature","bug-fix":"Bug Fix"}}},91605:(e,t,a)=>{"use strict";a.d(t,{A:()=>v});var i=a(40927),n=a.n(i),s=a(87195),o=a.n(s),l=a(58776),r=a.n(l),c=a(10036);function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach(function(t){m(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function m(e,t,a){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=u(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}var h=a(87021),f=a(10611),g=a(9769);const v=n().createClass({displayName:"SelectionInput",getInitialState:function(){return this.controller=null,this.signal=null,this.uuid=f.v4(),{dropDownOpen:!1,filterValue:"",fetchDataBusy:!1,fetchDataError:"",urlData:[]}},componentWillMount:function(){},componentDidMount:function(){var e=this;if("url"==this.props.source){var t=c.A.register(this.props.sourceUrl,this.uuid,this.onReceivedJsonUrlData);this.onReceivedJsonUrlData(t)}this.refs.dropdownInput&&($(this.refs.dropdownInput).on("show.bs.dropdown",function(){e.setState({dropDownOpen:!0},function(){var e=this;setTimeout(function(){$(e.refs.filterInputField).focus()},250)})}),$(this.refs.dropdownInput).on("hide.bs.dropdown",function(){e.setState({dropDownOpen:!1,filterValue:""})}))},componentWillUnmount:function(){"url"==this.props.source&&c.A.unregister(this.props.sourceUrl,this.uuid)},shouldComponentUpdate:function(e,t){return!g.compareObject(e,this.props)||!g.compareObject(t,this.state)},componentWillReceiveProps:function(e){if((e.source!=this.props.source||e.sourceUrl!=this.props.sourceUrl)&&("url"==this.props.source&&c.A.unregister(this.props.sourceUrl,this.uuid),"url"==e.source)){var t=c.A.register(e.sourceUrl,this.uuid,this.onReceivedJsonUrlData);this.onReceivedJsonUrlData(t)}},onReceivedJsonUrlData:function(e){"fetching"===e.status?this.setState({fetchDataBusy:!0,urlData:[],fetchDataError:""}):"ok"===e.status?this.setState({fetchDataBusy:!1,urlData:e.data,fetchDataError:""}):"error"===e.status?this.setState({fetchDataBusy:!1,urlData:[],fetchDataError:e.message}):(console.log("onReceivedJsonUrlData. Should not happen",e),this.setState({fetchDataBusy:!1,urlData:[],fetchDataError:""}))},onClick:function(e){this.props.onValueChanged&&this.props.onValueChanged(this.props.name,e.id)},onFilterValueChanged:function(e){this.setState({filterValue:e.target.value})},onFilterKeyDown:function(e){return"Escape"==e.key?(this.setState({filterValue:""}),e.preventDefault(),void e.stopPropagation()):"Enter"!=e.key&&"Tab"!=e.key?" "==e.key?(this.setState({filterValue:this.state.filterValue+" "}),e.preventDefault(),void e.stopPropagation()):void 0:void(this.props.onEnterKey&&this.props.onEnterKey(this.props.name,this.state.filterValue))},render:function(){var e=this,t=this.props.format||"text",a=this.state.filterValue.trim().toLowerCase(),i=function(e){var a="5px",i="20px";"large"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"large")&&(a="0px",i="30px");var s=e.title;if(void 0===s&&(s=void 0===e.id?"invalid":e.id),"image"===t||e.icon)return n().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"left",maxWidth:"100%",marginLeft:a,marginRight:a}},n().createElement("img",{style:{width:i,height:i,objectFit:"contain",visibility:"hidden"},src:e.icon?e.icon:e.id,onLoad:function(e){e.target.style.visibility="visible"},onError:function(e){e.target.style.visibility="hidden"},alt:"selection icon"}),n().createElement("div",{style:{marginLeft:"5px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},s));if("color"===t){var o=h(e.id);return o.isValid()||(o=h("transparent")),n().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"left",maxWidth:"100%",marginLeft:a,marginRight:a}},n().createElement("div",{style:{width:"20px",height:"20px",backgroundColor:o}}),n().createElement("div",{style:{marginLeft:"5px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},s))}return n().createElement("div",{style:{maxWidth:"100%",marginLeft:a,marginRight:a,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",textAlign:"left"}},s)},s=0,l=this.props.selections;if(this.props.options&&(l=this.props.options),"string"==typeof l)try{l=JSON.parse(l)}catch(e){l=[]}"url"==this.props.source&&(l=this.state.urlData);var d,m="Selection empty",f="Selection empty",g=null,v=this.props.disabled,b=" dropdown-toggle",y={height:"28px",padding:"0px"};if(this.props.width&&(y.width=this.props.width),l&&l.length){var E=l.filter(function(e){return this.props.value==e.id}.bind(this));E.length?(f=this.props.valueRenderer?this.props.valueRenderer(E[0]):i(E[0],"small"),m=E[0].title):m=f=this.props.value||"empty";var w=p({},this.props.dropDownStyle);this.props.width&&(w.minWidth=this.props.width),w.opacity=1,g=n().createElement("ul",{className:"dropdown-menu",style:w},l.map(function(t,o){var l,r=t.title;return""==a||-1!==r.toLowerCase().indexOf(a)&&"--divider--"!=r?(s++,"object"===u(l=e.props.valueRenderer?e.props.valueRenderer(t):i(t))&&"divider"==l.props.className||"--divider--"==r?n().createElement("li",{key:o,className:"divider"}):n().createElement("li",{key:o},n().createElement("a",{onClick:e.onClick.bind(e,t),style:{maxWidth:"350px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"}},l))):null}),function(){if(0===s)return n().createElement("li",null,n().createElement("a",{style:{cursor:"default"}},"No options available"))}())}else{v=!0,b="",this.props.width||(y.width="calc(100% - 10px)");var S=p({},this.props.dropDownStyle);S.opacity=0,g=n().createElement("ul",{className:"dropdown-menu",style:S})}this.state.fetchDataBusy&&(f=n().createElement("div",{style:{width:"100%",textAlign:"center"}},n().createElement("img",{style:{position:"relative",height:"24px"},src:"/images/loading-bubbles.svg",className:"loader"}))),"url"==this.props.source&&this.state.fetchDataError&&(f=n().createElement(o(),{placement:"top",delayShow:500,overlay:n().createElement(r(),{id:"error-info"},this.state.fetchDataError)},n().createElement("div",{style:{display:"flex",textAlign:"center",justifyContent:"center",gap:"10px",width:"100%",color:"#f7892e"}},n().createElement("span",null,"Error"),n().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"14px",position:"relative",top:"1px"}})))),d=this.props.useFilter&&this.state.dropDownOpen?n().createElement("input",{type:"text",className:"form-control",value:this.state.filterValue,placeholder:m,onChange:this.onFilterValueChanged,onKeyDown:this.onFilterKeyDown,style:{left:"0px",top:"0px",width:"calc(100% - 20px)",height:"20px",minHeight:"27px",position:"absolute",textAlign:"left",paddingLeft:"5px",paddingRight:"5px"},ref:"filterInputField"}):n().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",width:"calc(100% - 10px)",marginRight:"auto"}},f);var N="";N=this.props.dropup?" dropup":" dropdown";var C="btn-default";this.props.theme&&"light"==this.props.theme&&(N+=" dropdown-white",C="btn-white");var x,I,k="";if(this.props.dropDownDataDisplay&&(k=this.props.dropDownDataDisplay),"url"==this.props.source&&this.props.useReload&&!this.state.fetchDataBusy&&(x=n().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-url-reload",onClick:function(){var t=c.A.get(e.props.sourceUrl,!1);e.onReceivedJsonUrlData(t)},disabled:v||this.state.fetchDataBusy},n().createElement("i",{className:"fa fa-refresh"}))),this.props.inline)I=n().createElement("span",{className:"inline-dropdown",ref:"dropdownInput"},n().createElement("button",{type:"button",className:"btn timeline-control"+b+" "+C,"data-toggle":"dropdown","data-display":k,"aria-haspopup":"true","aria-expanded":"false",disabled:v,tabIndex:"-1",style:y},d),x,g);else{var D=(this.props.className||"")+N;I=n().createElement("div",{className:D,style:{maxWidth:this.props.width?this.props.width:"140px"},ref:"dropdownInput"},n().createElement("button",{type:"button",className:"btn timeline-control"+b+" "+C,"data-toggle":"dropdown","data-display":k,"aria-haspopup":"true","aria-expanded":"false",disabled:v,tabIndex:"-1",style:y},d),x,g)}return I}})},92643:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var i=a(40927),n=a.n(i),s=(a(31018),a(66828)),o=a(91605),l=a(94108),r=a(59862),c=a(99227),d=a.n(c),p=a(9769);const m=n().createClass({displayName:"MaskProperties",localData:{lockSizeFactor:0},getInitialState:function(){return{}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!p.compareObject(this.props,e)||!p.compareObject(this.state,t)},render:function(){var e=this.props.value;null==e&&(e={}),0==e.hasOwnProperty("active")&&(e.active=!1),0==e.hasOwnProperty("image")&&(e.image=""),0==e.hasOwnProperty("imageType")&&(e.imageType="alpha"),0==e.hasOwnProperty("sizeMethod")&&(e.sizeMethod="fill"),0==e.hasOwnProperty("sizeX")&&(e.sizeX=100),0==e.hasOwnProperty("sizeY")&&(e.sizeY=100),0==e.hasOwnProperty("lockSize")&&(e.lockSize=!0),0==e.hasOwnProperty("centerX")&&(e.centerX=50),0==e.hasOwnProperty("centerY")&&(e.centerY=50),0==e.hasOwnProperty("repeat")&&(e.repeat="no-repeat");var t=!1;0==e.active&&(t=!0);var a="constrain-proportion-selector";return 1==e.lockSize&&(a+=" locked"),1==t&&(a+=" disabled"),n().createElement("div",{className:"panel-body"},n().createElement("div",null,n().createElement("h3",null,"Mask",n().createElement("div",{className:"group-panel-options pull-right"},n().createElement("span",null,"Active"),n().createElement(l.A,{name:"active",value:e.active,onValueChanged:this.onValueChanged})))),n().createElement("table",null,n().createElement("tbody",null,n().createElement("tr",null,n().createElement("td",{nowrap:!0},"Image"),n().createElement("td",null,n().createElement(r.A,{name:"image",value:e.image,onValueChanged:this.onValueChanged,disabled:t}))),null,n().createElement("tr",null,n().createElement("td",null,"Size Method"),n().createElement("td",null,n().createElement(o.A,{name:"sizeMethod",selections:[{id:"contain",title:"Contain"},{id:"cover",title:"Cover"},{id:"fill",title:"Fill"},{id:"percentage",title:"Percentage"}],value:e.sizeMethod,onValueChanged:this.onValueChanged,disabled:t}))),n().createElement("tr",null,n().createElement("td",null,"Size X"),n().createElement("td",null,n().createElement(s.A,{name:"sizeX",resetValue:100,step:.1,unit:"%",format:"0.0",min:0,max:1e4,value:e.sizeX,showSlider:!1,onValueChanged:this.SizeValueChanged,disabled:t||"percentage"!=e.sizeMethod}))),n().createElement("tr",null,n().createElement("td",null,"Size Y"),n().createElement("td",null,n().createElement(s.A,{name:"sizeY",resetValue:100,step:.1,unit:"%",format:"0.0",min:0,max:1e4,value:e.sizeY,showSlider:!1,onValueChanged:this.SizeValueChanged,disabled:t||"percentage"!=e.sizeMethod}),n().createElement("div",{onClick:this.lockSizeClicked,className:a}))),n().createElement("tr",null,n().createElement("td",null,"Repeat"),n().createElement("td",null,n().createElement(o.A,{name:"repeat",selections:[{id:"no-repeat",title:"None"},{id:"repeat-x",title:"X"},{id:"repeat-y",title:"Y"},{id:"repeat",title:"Both"}],value:e.repeat,onValueChanged:this.onValueChanged,disabled:t||"percentage"!=e.sizeMethod}))),n().createElement("tr",null,n().createElement("td",null,"Center X"),n().createElement("td",null,n().createElement(s.A,{name:"centerX",resetValue:50,step:.1,unit:"%",format:"0.0",min:0,max:100,value:e.centerX,showSlider:!1,onValueChanged:this.onValueChanged,disabled:t||"fill"==e.sizeMethod}))),n().createElement("tr",null,n().createElement("td",null,"Center Y"),n().createElement("td",null,n().createElement(s.A,{name:"centerY",resetValue:50,step:.1,unit:"%",format:"0.0",min:0,max:100,value:e.centerY,showSlider:!1,onValueChanged:this.onValueChanged,disabled:t||"fill"==e.sizeMethod}))))))},onValueChanged:function(e,t){this.props.onValueChanged&&this.props.onValueChanged(e,t)},SizeValueChanged:function(e,t,a){var i=this.props.value;if(1==i.lockSize&&("sizeX"==e||"sizeY"==e)){var n=Number(t);if(t===i[e])return;var s={};return"sizeX"==e?(0==this.localData.lockSizeFactor?s.sizeY=n:s.sizeY=d()(n/this.localData.lockSizeFactor).format(a.toString()),s.sizeX=t):(0==this.localData.lockSizeFactor?s.sizeX=n:s.sizeX=d()(n*this.localData.lockSizeFactor).format(a.toString()),s.sizeY=t),void(this.props.onValueChanged&&(void 0!==s.sizeX&&this.props.onValueChanged("sizeX",s.sizeX),void 0!==s.sizeY&&this.props.onValueChanged("sizeY",s.sizeY)))}this.props.onValueChanged&&this.props.onValueChanged(e,t)},lockSizeClicked:function(){if(0!=this.props.value.active&&"percentage"==this.props.value.sizeMethod){var e=!this.props.value.lockSize;this.props.onValueChanged&&this.props.onValueChanged("lockSize",e),this.calculateLockSizeFactor(e)}},calculateLockSizeFactor:function(e){0==e||0==Number(this.props.value.sizeY)?this.localData.lockSizeFactor=0:this.localData.lockSizeFactor=Number(this.props.value.sizeX)/Number(this.props.value.sizeY)*1}})},93381:(e,t,a)=>{"use strict";var i=a(40961),n=a.n(i),s=a(40927),o=a.n(s),l=a(14794),r=a(16918),c=a.n(r),d=a(17334),p=a.n(d),m=a(79988),u=a(74316),h=a(25897),f=a(25160),g=a.n(f),v=a(88534),b=a.n(v),y=a(47500),E=a.n(y),w=a(15734),S=a.n(w),N=a(13023),C=a(24510),x=a(79378),I=a(34357),k=a(31018),D=a.n(k),A=a(3808);a(17604);const R=o().createClass({displayName:"BoundingBox",getInitialState:function(){return{}},setWidgetTreeSelection:function(e,t){this.widgetTreeSelectedGroup=e,this.widgetTreeSelectedTile=t,e&&(this.movementOriginBBoxStyle=null)},drawMovementOrigin:function(e){if(e){var t;this.currentWidgetId=e.id;var a=$("#onairPreview"),i=$("#onair"+e.id);if(i.length>0){t=$.extend(!0,{},i[0].getBoundingClientRect());var n=a[0].getBoundingClientRect(),s=t.right-t.left,o=t.bottom-t.top,l=Math.max(-3,n.top-t.top),r=Math.max(-3,n.left-t.left),c=Math.min(s+3,s-(t.right-n.right)-1),d=Math.min(o+3,o-(t.bottom-n.bottom)-1);s>0&&o>0&&(this.movementOriginBBoxStyle={left:t.left,top:t.top,width:s,height:o,display:"inline",pointerEvents:"none",clip:"rect( "+l+"px,"+c+"px,"+d+"px,"+r+"px)"})}}else this.movementOriginBBoxStyle=null},render:function(){var e={left:0,top:0,width:0,height:0,display:"none"},t=null,a=null;if(this.widgetTreeSelectedGroup&&!this.widgetTreeSelectedTile){var i=this.props.sbRef.child("tiles").val();for(var n in this.widgetTreeSelectedGroup.items)if(!i[n]||i[n].layout.visible){var s=$("#onair"+n);if(s.length>0){var l=$.extend(!0,{},s[0].getBoundingClientRect());a?(a.left=Math.min(a.left,l.left),a.right=Math.max(a.right,l.right),a.top=Math.min(a.top,l.top),a.bottom=Math.max(a.bottom,l.bottom)):a=l}}}var r=$("#onair"+this.props.item.id);r.length>0&&(t=$.extend(!0,{},r[0].getBoundingClientRect()));var c,d=$("#onairPreview");if(d&&t){var p=d[0].getBoundingClientRect(),m=t.right-t.left,u=t.bottom-t.top,h=Math.max(-3,p.top-t.top),f=Math.max(-3,p.left-t.left),g=Math.min(m+3,m-(t.right-p.right)-1),v=Math.min(u+3,u-(t.bottom-p.bottom)-1);m>0&&u>0&&(e={left:t.left,top:t.top,width:m,height:u,display:"inline",clip:"rect( "+h+"px,"+g+"px,"+v+"px,"+f+"px)"},m<12&&(c=!0),u<12&&(c=!0))}a&&t&&(a.left=Math.min(a.left,t.left),a.right=Math.max(a.right,t.right),a.top=Math.min(a.top,t.top),a.bottom=Math.max(a.bottom,t.bottom));var b=null,y={left:0,top:0,width:0,height:0,display:"none",pointerEvents:"none"};if(a){var E=d[0].getBoundingClientRect(),w=a.right-a.left,S=a.bottom-a.top,N=Math.max(-3,E.top-a.top),C=Math.max(-3,E.left-a.left),x=Math.min(w+3,w-(a.right-E.right)-1),I=Math.min(S+3,S-(a.bottom-E.bottom)-1);w>0&&S>0&&(y={left:a.left,top:a.top,width:w,height:S,display:"inline",pointerEvents:"none",clip:"rect( "+N+"px,"+x+"px,"+I+"px,"+C+"px)"}),b=o().createElement("div",{className:"selection-outline-additional",style:y})}var k=null;if(this.movementOriginBBoxStyle&&(k=o().createElement("div",{id:"movementOrigin",className:"selection-outline-additional",style:this.movementOriginBBoxStyle})),this.props.item&&this.props.visible){var D,A=this.props.sbRef.child("tiles").val()[this.props.item.id];D=A?this.props.sbRef.child("groups").val()[this.props.item.groupId]:this.props.sbRef.child("groups").val()[this.props.item.id];var R={anchor:{x:50,y:50}};A?R=A.layout:D&&(R=D.layout);var P="calc("+R.anchor.x+"% - 3px)",T="calc("+R.anchor.y+"% - 3px)";return o().createElement("div",null,o().createElement("div",{className:"selection-outline",id:"handle body",style:e},o().createElement("div",{className:"selection-outline-label"},""),o().createElement("div",{className:"handle center",id:"handle center",style:{visibility:c?"hidden":"visible",left:P,top:T}})),b,k)}return null}});var P=a(80765),T=a(99227),M=a.n(T);a(228);var O=a(48766).EffectSelections,L=o().createClass({displayName:"RangeSlider",isMouseDown:!1,selection:"",sliderHost:null,firstSnap:-1,offsetToBody:0,getInitialState:function(){return{begin:this.props.begin,end:this.props.end}},componentDidMount:function(){this.sliderHost=n().findDOMNode(this.refs.sliderHost),this.sliderBody=n().findDOMNode(this.refs.sliderBody),$(document).on("mousemove",this.onMouseMove),$(document).on("mouseup",this.onMouseUp)},componentWillUnmount:function(){$(document).off("mousemove",this.onMouseMove),$(document).off("mouseup",this.onMouseUp)},setBeginAndEnd:function(e,t){null!=e&&e<this.state.end&&this.setState({begin:Math.max(0,e)}),null!=t&&t>this.state.begin&&this.setState({end:Math.max(0,t)})},componentWillReceiveProps:function(e){this.setState({begin:e.begin,end:e.end});var t=this.props.snapPoints.concat([]),a=t.indexOf(e.begin);a>-1&&t.splice(a,1),(a=t.indexOf(e.end))>-1&&t.splice(a,1),this.setState({snapPoints:t})},onMouseDown:function(e){this.selection=e.target.id,this.isMouseDown=!0,this.mouseDownScreenX=e.screenX;var t=this.getPosition(this.sliderBody);this.offsetToBody=e.clientX-t.x,this.selection||(this.selection="handle-body")},getPosition:function(e){for(var t=0,a=0;e;)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,a+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{x:t,y:a}},onMouseMove:function(e){var t=this;if(this.isMouseDown)if(e.stopPropagation(),e.preventDefault(),"none"==this.props.snap){var a=e.screenX-this.mouseDownScreenX;if(this.mouseDownScreenX=e.screenX,"handle-left"==this.selection){var i=this.state.begin+a;this.setBeginAndEnd(i)}else if("handle-right"==this.selection){var n=this.state.end+a;this.setBeginAndEnd(null,n)}else if("handle-body"==this.selection){var s=this.state.end-this.state.begin;i=Math.max(0,this.state.begin+a),this.setBeginAndEnd(i,i+s)}}else if("object"==this.props.snap){if(0==this.state.snapPoints.length)return;var o=this.getPosition(this.sliderHost),l=e.clientX-o.x,r=[];"handle-left"==this.selection||"handle-right"==this.selection?(this.state.snapPoints.map(function(e){var t=Math.abs(l-e,e);r.push({dist:t,snap:e})}),c=r.sort(function(e,t){return e.dist-t.dist})[0].snap,"handle-left"==this.selection?this.setBeginAndEnd(c):"handle-right"==this.selection&&this.setBeginAndEnd(null,c)):"handle-body"==this.selection&&(this.state.snapPoints.map(function(e){var a=Math.abs(l-e-t.offsetToBody,e);r.push({dist:a,snap:e})}),c=r.sort(function(e,t){return e.dist-t.dist})[0].snap,s=this.state.end-this.state.begin,this.setBeginAndEnd(c,c+s))}else{o=this.getPosition(this.sliderHost),l=e.clientX-o.x;var c=Math.floor(l/this.props.snap)*this.props.snap;"handle-left"==this.selection?this.setBeginAndEnd(c):"handle-right"==this.selection?this.setBeginAndEnd(null,c):"handle-body"==this.selection&&(s=this.state.end-this.state.begin,c=Math.floor((l-this.offsetToBody)/this.props.snap)*this.props.snap,c=Math.max(0,c),this.setBeginAndEnd(c,c+s))}},onMouseUp:function(e){this.isMouseDown&&(this.isMouseDown=!1,this.selection="",this.props.onChange&&this.props.onChange({begin:this.state.begin,end:this.state.end}))},onContextMenu:function(e){$(this.refs.animPanelTrigger).children().click(),e.stopPropagation(),e.preventDefault()},render:function(){var e,t,a,i=this.state.end-this.state.begin,n={left:this.state.begin+"px",width:i+"px"};return e=i>=120?o().createElement("div",{className:"anim-info",onMouseDown:this.onMouseDown},o().createElement("span",{className:"anim-edit button",ref:"animPanelTrigger"},this.props.animPanel.panelOverlay),o().createElement("span",{className:"anim-type"},(t=this.props.anim.effect,(a=O.find(function(e){return e.id===t}))?a.title:t)),o().createElement("span",{className:"anim-duration"},M()(this.props.anim.duration).format("0.00")+"s")):o().createElement("div",{className:"anim-info",onMouseDown:this.onMouseDown},o().createElement("span",{className:"anim-edit button",ref:"animPanelTrigger"},this.props.animPanel.panelOverlay)),o().createElement("div",{className:"range-slider",onContextMenu:this.onContextMenu,ref:"sliderHost"},o().createElement("div",{id:"handle-body",className:"range-slider-body",ref:"sliderBody",style:n,onMouseDown:this.onMouseDown,disabled:this.props.disabled},e,o().createElement("div",{id:"handle-left",className:"range-slider-handle-left",onMouseDown:this.onMouseDown,disabled:this.props.disabled}),o().createElement("div",{id:"handle-right",className:"range-slider-handle-right",onMouseDown:this.onMouseDown,disabled:this.props.disabled})))}});const V=L;var _=a(45659),F=a(9769);const B=o().createClass({displayName:"TimelineRow",getInitialState:function(){return{}},componentWillMount:function(){},callSetSnapShot:function(e,t,a){var i=_.getRulerSecToPixel(e,t),n=_.getRulerSecToPixel(e,a);this.props.onSetSnapPoints&&this.props.onSetSnapPoints(this.props.ownerId,[i,n])},componentWillReceiveProps:function(e){this.props.zoom!=e.zoom&&this.callSetSnapShot(e.zoom,e.begin,e.end)},componentDidMount:function(){this.callSetSnapShot(this.props.zoom,this.props.begin,this.props.end)},shouldComponentUpdate:function(e,t){return!F.compareObject(this.props,e)},onChange:function(e){if(this.props.onChange){var t={begin:_.getRulerPixelToSec(this.props.zoom,e.begin),end:_.getRulerPixelToSec(this.props.zoom,e.end)};this.props.onChange(t)}this.props.onSetSnapPoints&&this.props.onSetSnapPoints(this.props.ownerId,[e.begin,e.end])},render:function(){var e=_.getRulerSecToPixel(this.props.zoom,this.props.begin),t=_.getRulerSecToPixel(this.props.zoom,this.props.end),a=_.getRuler(this.props.zoom).hSpace;"none"!=this.props.snap&&"object"!=this.props.snap||(a=this.props.snap);var i={};return this.props.animItem&&this.props.animationPanel&&(i.duration=this.props.animItem.keyframes[this.props.animationPanel][1]-this.props.animItem.keyframes[this.props.animationPanel][0],i.easing=this.props.animItem.effects[this.props.animationPanel].easing,i.effect=this.props.animItem.effects[this.props.animationPanel].effect,i.property=this.props.animItem.effects[this.props.animationPanel].property),o().createElement(V,{begin:e,end:t,snap:a,snapPoints:this.props.snapPoints,onChange:this.onChange,anim:i,animPanel:this.props.animPanel,onAnimationStateMoveTo:this.props.onAnimationStateMoveTo,onAnimEffectChanged:this.props.onAnimEffectChanged,onAnimValueChanged:this.props.onAnimValueChanged})}}),U=o().createClass({displayName:"HScroller",render:function(){var e={left:this.props.position};return o().createElement("div",{className:"h-scroller"},o().createElement("div",{className:"children",style:e},this.props.children))}});var W=a(24316),j=a(87195),Y=a.n(j),H=a(58776),z=a.n(H),G=a(16524),K=a(83384),q=a(9769);const J=o().createClass({displayName:"WidgetTreeItem",mixins:[W.A],getInitialState:function(){return{}},componentDidMount:function(){var e=this;$(document).mouseup(function(t){var a=n().findDOMNode(e.refs.dropdownMenu),i=$(a);q.getMouseEventType(t)!=K.MOUSE_RIGHT_CLICK&&(i.is(t.target)||0!==i.has(t.target).length||i.removeClass("show"))})},componentWillMount:function(){this.sBindAsObject(this.props.sbRef.parent.child(this.props.tileId).child("settings/linkTimeline"),"linkTimeline"),this.sBindAsObject(this.props.sbRef.child("tiles").child(this.props.tileId),"tile"),this.sBindAsObject(this.props.sbRootRef.child("compositionProps").child("snapshot").child(this.props.tileId),"snapshotUrl")},shouldComponentUpdate:function(e,t){return this.state.tile.id==e.selection.id||this.props.selection.id!=e.selection.id&&this.state.tile.id==this.props.selection.id||this.props.uiSettings.timelineSnap!=e.uiSettings.timelineSnap||this.props.uiSettings.timelineZoom!=e.uiSettings.timelineZoom||!(q.compareObject(this.state,t)&&this.state.tile.thumbnail==t.tile.thumbnail&&this.state.tile.name==t.tile.name&&this.state.tile.layout.visible==t.tile.layout.visible&&this.props.showTimeline==e.showTimeline&&this.props.hScrollerPositions==e.hScrollerPositions&&this.props.animationPanel==e.animationPanel&&this.props.filter==e.filter&&q.compareObject(this.state.tile.effects,t.tile.effects)&&q.compareObject(this.state.tile.keyframes,t.tile.keyframes)&&q.compareObject(this.props.adaptationGlobals,e.adaptationGlobals))},nameChanged:function(e){this.props.onWidgetNameChange&&this.props.onWidgetNameChange(this.state.tile.id,e.name),this.finishEditing()},onVisibleToggle:function(e){e.stopPropagation(),this.props.onWidgetVisibleToggle&&this.props.onWidgetVisibleToggle(this.state.tile.id)},onKeyframesChange:function(e,t){this.props.onKeyframesChange({id:this.state.tile.id,begin:t.begin,end:t.end,timeline:e})},onSetSnapPoints:function(e,t,a){this.props.onSetSnapPoints&&this.props.onSetSnapPoints(e,t,a)},startEditing:function(){try{$(".widget-tree-item").sortable("disable"),$(".widget-tree-group").sortable("disable")}catch(e){}},finishEditing:function(){try{$(".widget-tree-item").sortable("enable"),$(".widget-tree-group").sortable("enable")}catch(e){}},render:function(){if(this.props.filter&&-1==this.state.tile.name.toLowerCase().indexOf(this.props.filter.toLowerCase()))return!1;if(!this.state.tile.layout)return!1;var e=this.state.tile.thumbnail;e||(e="/widgets/"+this.state.tile.widget+"/icon.png");var t,a,i,n,s,l,r,c=g().executeAdaptation(this.props.adaptationGlobals,this.state.tile.layout.adaptations),d="list-group-item";if(!1===this.state.tile.layout.visible||0==c?(d+=" disabled",t=!0===this.state.tile.layout.visible?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"adaptiveHidden"},"Hidden by Adaptive")},o().createElement("i",{className:"fa fa-eye-slash adaptive eye-icon",onMouseDown:this.onVisibleToggle})):o().createElement("i",{className:"fa fa-eye-slash eye-icon",onMouseDown:this.onVisibleToggle})):t=o().createElement("i",{className:"fa fa-eye eye-icon",onMouseDown:this.onVisibleToggle}),"composition"==this.state.tile.type)a="fa fa-cube",s=this.state.snapshotUrl,i=o().createElement("i",{className:"fa fa-arrow-circle-o-right",onClick:this.gotoComp});else switch(this.state.tile.widget){case 1032:a="fa fa-font";break;case 642:a="fa fa-picture-o";break;case 1022:a="fa fa-square";break;case 1052:a="fa fa-circle";break;case 812:a="fa fa-video-camera";break;default:a="fa fa-puzzle-piece"}q.isInteractivityEnabled(this.state.tile.layout,!0)&&(l=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"interactivityEnabled"},"Interactivity Enabled")},o().createElement("i",{className:"fa fa-crosshairs eye-icon"})));var p=this.props.uiSettings;p||(p={timelineZoom:0,timelineSnap:"grid"}),this.props.showTimeline&&this.state.tile.effects&&this.state.tile.keyframes&&(r="none"!=this.state.tile.effects[this.props.animationPanel].effect?o().createElement(B,{onChange:this.onKeyframesChange.bind(this,this.props.animationPanel),key:this.props.animationPanel,animationPanel:this.props.animationPanel,animPanel:this.props.animPanel,animItem:this.state.tile,ownerId:this.state.tile.id,begin:this.state.tile.keyframes[this.props.animationPanel][0],end:this.state.tile.keyframes[this.props.animationPanel][1],zoom:p.timelineZoom,snap:p.timelineSnap,snapPoints:this.props.snapPoints[this.props.animationPanel],onSetSnapPoints:this.onSetSnapPoints.bind(this,this.props.animationPanel),onAnimEffectChanged:this.props.onAnimEffectChanged,onAnimValueChanged:this.props.onAnimValueChanged}):o().createElement("div",null,this.props.animPanel.panelOverlay)),"composition"==this.state.tile.type&&"none"==this.state.tile.effects[this.props.animationPanel].effect&&(r=void 0),this.props.selection.id==this.state.tile.id&&(d+=" active");var m=!1;this.props.renameItem&&this.props.renameItem.id==this.state.tile.id&&(m=!0);var u=function(e,t,a){return o().createElement("li",{style:{borderTop:"1px solid #3c3c3c"}},o().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer",onClick:a},o().createElement("span",null,e," ",o().createElement("span",{className:"shortcut-description"},t))))},h="",f=null;if("composition"==this.state.tile.type){var v="Link Timeline",b=this.props.sbRef.parent.child(this.state.tile.id).child("settings/linkTimeline").get(),y="timeline-full ";b&&(v="Unlink Timeline",y="timeline-full linkedTimeline",h="linked-timeline"),n=u(v,"",this.linkTimeline.bind(this,this.state.tile.id,!b));var E=this.props.sbRootRef.child("compositionProps").child("logicLayers").child(this.props.tileId).val();E&&E.tag&&(f=o().createElement("div",{style:{width:"8px",height:"8px",backgroundColor:E.tag,position:"absolute",left:"6px",top:"7px",borderRadius:"4px"}}))}var w,S="Ctrl";return navigator.platform.toUpperCase().indexOf("MAC")>=0&&(S="CMD"),w=s&&"string"==typeof s?o().createElement("i",{className:a+" subcomp-popover",onClick:this.selectWidget.bind(this,G.PROPERTIES)},o().createElement("img",{src:s,className:"subcomp-snapshot"})):o().createElement("i",{className:a,onClick:this.selectWidget.bind(this,G.PROPERTIES)}),o().createElement("li",{className:d,id:this.state.tile.id,onContextMenu:this.contextMenu,onMouseDown:this.selectWidget.bind(this,null),onDoubleClick:this.gotoComp,"data-group":this.props.group.id},f,o().createElement("span",{className:"list-group-item-panel "+h},o().createElement("span",{className:"pull-right widget-tools"},l,i,t,o().createElement("div",{className:"btn-group"},o().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),o().createElement("ul",{id:"context-menu-widget-item-"+this.state.tile.id,ref:"dropdownMenu",className:"dropdown-menu",role:"menu"},u("Cut","("+S+" + x)",this.cutItem),u("Copy","("+S+" + c)",this.copyItem),u("Paste","("+S+" + v)",this.pasteItem),u("Delete","(DEL)",this.deleteItem),u("Duplicate","("+S+" + d)",this.duplicateItem),n))),o().createElement("i",{className:"fa"}),w,o().createElement("span",{className:"item-label",style:{display:"inline-block",width:"120px"}},o().createElement(P.A,{key:this.state.tile.name,text:this.state.tile.name,paramName:"name",className:"inline-label",activeClassName:"inline-edit",change:this.nameChanged,onNavigate:this.onNavigate,editing:m,startEditing:this.startEditing,finishEditing:this.finishEditing,cancelEditing:this.finishEditing}))),o().createElement("span",{className:this.state.tile.type+" list-group-item-timeline"},o().createElement("span",{className:y},o().createElement(U,{position:this.props.hScrollerPositions[this.props.animationPanel]},r))))},onNavigate:function(e,t){this.props.onNavigateItem&&this.props.onNavigateItem(this.state.tile.id,e,t)},gotoComp:function(e){if(e.stopPropagation(),-1==e.target.className.toString().indexOf("eye-icon")&&this.props.onGotoComp){var t=this.props.sbRootRef.child("compositions").val(),a=this.props.sbCompositionRef.key,i=!1;for(var n in t){var s=t[n];if(s.tiles){for(var o in s.data)if(s.data[o].composition==a){i=!0;break}if(i)break}}i?this.props.onGotoComp(this.state.tile,{compositionDataNodes:[],compositionControlNode:{},compositionWidgetNode:{}}):this.props.onGotoComp(this.state.tile,{compositionDataNodes:this.props.sbCompositionRef.child("dataSources").child("composition").child("dataNodes").val(),compositionControlNode:this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").val(),compositionWidgetNode:this.props.sbCompositionRef.child("dataSources").child("composition").child("widgetNode").val()})}},selectWidget:function(e,t){this.props.onWidgetSelect&&this.props.onWidgetSelect(e,this.state.tile,this.props.group),document.activeElement&&document.activeElement.blur(),t.stopPropagation()},contextMenu:function(e){n().findDOMNode(this.refs.dropdownTrigger);var t=n().findDOMNode(this.refs.dropdownMenu);q.dropdownClearAllContextExceptCurrentElement($(t)),q.dropDownFixPosition($(t),e),$(t).toggleClass("show"),e.stopPropagation(),e.preventDefault()},deleteItem:function(e){this.props.onWidgetDelete&&this.props.onWidgetDelete(this.state.tile,this.props.group),this.closeContextMenu(),e.stopPropagation()},duplicateItem:function(e){this.props.onWidgetDuplicate&&this.props.onWidgetDuplicate(this.state.tile,this.props.group),this.closeContextMenu(),e.stopPropagation()},linkTimeline:function(e,t){this.props.onLinkTimeline&&this.props.onLinkTimeline(e,t),this.closeContextMenu()},copyItem:function(e){this.props.onCopy&&this.props.onCopy(),this.closeContextMenu(),e.stopPropagation()},cutItem:function(e){this.copyItem(e),this.deleteItem(e)},pasteItem:function(e){this.props.onPaste&&this.props.onPaste(),this.closeContextMenu(),e.stopPropagation()},closeContextMenu:function(){var e=n().findDOMNode(this.refs.dropdownMenu);$(e).removeClass("show")}});function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},X.apply(null,arguments)}var Z=a(9769),Q=a(83384);const ee=o().createClass({displayName:"GroupTreeItem",mixins:[W.A],pendingModified:[],getInitialState:function(){return{}},componentDidMount:function(){var e=this;$(document).mouseup(function(t){var a=n().findDOMNode(e.refs.dropdownMenu),i=$(a);Z.getMouseEventType(t)!=Q.MOUSE_RIGHT_CLICK&&(i.is(t.target)||0!==i.has(t.target).length||i.removeClass("show"))})},componentWillMount:function(){this.sBindAsObject(this.props.sbRef.child("groups").child(this.props.groupId),"group")},shouldComponentUpdate:function(e,t){return this.state.group.id==e.selection.id||this.props.selection.id!=e.selection.id&&this.state.group.id==this.props.selection.id||this.state.group.id==e.selection.groupId||this.state.group.id==this.props.selection.groupId||this.props.uiSettings.timelineSnap!=e.uiSettings.timelineSnap||this.props.uiSettings.timelineZoom!=e.uiSettings.timelineZoom||!Z.compareObject(this.state,t)||this.props.showTimeline!=e.showTimeline||this.props.hScrollerPositions!=e.hScrollerPositions||this.props.animationPanel!=e.animationPanel||this.props.filter!=e.filter||!Z.compareObject(this.props.adaptationGlobals,e.adaptationGlobals)||!Z.compareObject(this.props.renameItem,e.renameItem)},componentDidUpdate:function(){var e=this;$(".widget-tree-item").sortable({connectWith:".widget-tree-item",cancel:".list-group-item-timeline",delay:150,axis:"y",update:function(t,a){var i=$(this).sortable("toArray"),n=$(this).attr("id"),s=$(this).data("zindex"),o=a.item.parent().attr("id"),l="last",r=a.item.next("li");if(r.length>0&&(l=$(r[0]).attr("id")),o&&o!=n){$(this).sortable("cancel");var c=a.item.data("group"),d=a.item.attr("id");e.props.onWidgetRemoveFromGroup&&e.props.onWidgetRemoveFromGroup(d,c),e.pendingModified.push({tileId:d,cursor:l})}else{var p=e.pendingModified.pop();if(p)if("last"==p.cursor)i.push(p.tileId);else{var m=i.indexOf(p.cursor);-1!=m&&i.splice(m,0,p.tileId)}else $(this).sortable("cancel")}var u=[];i.forEach(function(e,t){if(e){var a=s+t;u.push({id:e,priority:a})}}),e.props.onWidgetSort&&e.props.onWidgetSort(u,n)}}).disableSelection()},nameChanged:function(e){this.props.onGroupNameChange&&this.props.onGroupNameChange(this.state.group.id,e.name),this.finishEditing()},onVisibleToggle:function(e){e.stopPropagation(),this.props.onGroupVisibleToggle&&this.props.onGroupVisibleToggle(this.state.group.id)},onKeyframesChange:function(e,t){this.props.onKeyframesChange({id:this.state.group.id,begin:t.begin,end:t.end,timeline:e})},onSetSnapPoints:function(e,t,a){this.props.onSetSnapPoints&&this.props.onSetSnapPoints(e,t,a)},onNavigateItem:function(e,t,a){this.props.onNavigateItem&&this.props.onNavigateItem(e,t,a)},onNavigate:function(e,t){this.onNavigateItem(this.state.group.id,e,t)},startEditing:function(){try{$(".widget-tree-item").sortable("disable"),$(".widget-tree-group").sortable("disable")}catch(e){}},finishEditing:function(){try{$(".widget-tree-item").sortable("enable"),$(".widget-tree-group").sortable("enable")}catch(e){}},render:function(){var e=this,t=function(t,a){return o().createElement(J,X({key:t.tile.id,tileId:t.tile.id,group:t.group},e.props,{hScrollerPositions:e.props.hScrollerPositions,animationPanel:e.props.animationPanel,navigateItem:this.navigateItem,adaptationGlobals:this.props.adaptationGlobals}))}.bind(this),a=[];for(var i in this.state.group.items){var n=this.state.group.items[i];a.push({tile:this.state.group.items[n.id],priority:n.priority,group:this.state.group})}a.sort(function(e,t){return(e.priority>t.priority)-.5}),this.props.selection&&this.props.selection.id==this.state.group.id&&this.props.selection.type;var s,l,r={},c="list-group-item group-item";0==a.length?(s="fa fa-fw",0==this.state.group.expand?(l="fa fa-folder",c+=" group-close"):(l="fa fa-folder-open",c+=" group-open")):0==this.state.group.expand?(r={maxHeight:"0px"},s="fa fa-caret-right caret",l="fa fa-folder",c+=" group-close"):(s="fa fa-caret-down caret",l="fa fa-folder-open",c+=" group-open"),this.props.selection.id==this.state.group.id&&(c+=" active");var d,p,m,u=g().executeAdaptation(this.props.adaptationGlobals,this.state.group.layout.adaptations);if(!1===this.state.group.layout.visible||0==u?(c+=" disabled",d=!0===this.state.group.layout.visible?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"adaptiveHidden"},"Hidden by Adaptive")},o().createElement("i",{className:"fa fa-eye-slash adaptive eye-icon",onMouseDown:this.onVisibleToggle})):o().createElement("i",{className:"fa fa-eye-slash eye-icon",onMouseDown:this.onVisibleToggle})):d=o().createElement("i",{className:"fa fa-eye eye-icon",onMouseDown:this.onVisibleToggle}),Z.isInteractivityEnabled(this.state.group.layout,!0)&&(p=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"interactivityEnabled"},"Events Enabled")},o().createElement("i",{className:"fa fa-crosshairs interactive-icon"}))),this.props.showTimeline&&this.state.group.effects&&this.state.group.keyframes){var h=this.props.uiSettings;h||(h={timelineZoom:0,timelineSnap:"grid"}),m="none"!=this.state.group.effects[this.props.animationPanel].effect?o().createElement(B,{onChange:this.onKeyframesChange.bind(this,this.props.animationPanel),key:this.props.animationPanel,animationPanel:this.props.animationPanel,animPanel:this.props.animPanel,animItem:this.state.group,ownerId:this.state.group.id,begin:this.state.group.keyframes[this.props.animationPanel][0],end:this.state.group.keyframes[this.props.animationPanel][1],zoom:h.timelineZoom,snap:h.timelineSnap,snapPoints:this.props.snapPoints[this.props.animationPanel],onSetSnapPoints:this.onSetSnapPoints.bind(this,this.props.animationPanel)}):o().createElement("div",null,this.props.animPanel.panelOverlay)}var f=!1;this.props.renameItem&&this.props.renameItem.id==this.state.group.id&&(f=!0);var v=function(e,t,a){return o().createElement("li",{style:{borderTop:"1px solid #3c3c3c"}},o().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer",onClick:a},o().createElement("span",null,e," ",o().createElement("span",{className:"shortcut-description"},t))))},b="Ctrl";return navigator.platform.toUpperCase().indexOf("MAC")>=0&&(b="CMD"),o().createElement("li",{className:c,id:this.state.group.id,onMouseDown:this.selectGroup,onDoubleClick:this.toggleExpand,onContextMenu:this.contextMenu},o().createElement("span",{className:"list-group-item-panel"},o().createElement("span",{className:"pull-right widget-tools"},p,d,o().createElement("div",{className:"btn-group"},o().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),o().createElement("ul",{id:"context-menu-group-item-"+this.state.group.id,ref:"dropdownMenu",className:"dropdown-menu",role:"menu"},v("Cut","("+b+" + x)",this.cutItem),v("Copy","("+b+" + c)",this.copyItem),v("Paste","("+b+" + v)",this.pasteItem),v("Delete","(DEL)",this.deleteItem),v("Duplicate","("+b+" + d)",this.duplicateItem)))),o().createElement("i",{className:s,onClick:this.toggleExpand}),o().createElement("i",{className:l,onClick:this.toggleExpand}),o().createElement(P.A,{key:this.state.group.name,text:this.state.group.name,paramName:"name",className:"inline-label",activeClassName:"group-inline-edit",change:this.nameChanged,onNavigate:this.onNavigate,editing:f,startEditing:this.startEditing,finishEditing:this.finishEditing,cancelEditing:this.finishEditing})),o().createElement("span",{className:"group list-group-item-timeline"},o().createElement("span",{className:"timeline-full"},o().createElement(U,{position:this.props.hScrollerPositions[this.props.animationPanel]},m))),o().createElement("span",null,o().createElement("ul",{className:"widget-tree-item list-group composition-tree-subgroup",id:this.state.group.id,"data-zindex":this.state.group.layout.zindex,style:r},a.map(t))))},selectGroup:function(){this.props.onGroupSelect&&this.props.onGroupSelect(this.state.group),document.activeElement&&document.activeElement.blur()},toggleExpand:function(e){e.stopPropagation(),-1==e.target.className.toString().indexOf("eye-icon")&&this.props.onGroupExpandToggle&&this.props.onGroupExpandToggle(this.state.group.id)},contextMenu:function(e){n().findDOMNode(this.refs.dropdownTrigger);var t=n().findDOMNode(this.refs.dropdownMenu);Z.dropdownClearAllContextExceptCurrentElement($(t)),Z.dropDownFixPosition($(t),e),$(t).toggleClass("show"),e.stopPropagation(),e.preventDefault()},deleteItem:function(e){this.props.onGroupDelete&&this.props.onGroupDelete(this.state.group),this.closeContextMenu(),e.stopPropagation()},duplicateItem:function(e){this.props.onGroupDuplicate&&this.props.onGroupDuplicate(this.state.group),this.closeContextMenu(),e.stopPropagation()},copyItem:function(e){this.props.onCopy&&this.props.onCopy(),this.closeContextMenu(),e.stopPropagation()},cutItem:function(e){this.copyItem(e),this.deleteItem(e)},pasteItem:function(e){this.props.onPaste&&this.props.onPaste(),this.closeContextMenu(),e.stopPropagation()},closeContextMenu:function(){var e=n().findDOMNode(this.refs.dropdownMenu);$(e).removeClass("show")}});var te=a(66828),ae=a(91605),ie=a(72761),ne=a.n(ie),se=a(94108),oe=a(52871);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}const re=o().createClass({displayName:"EasingGizmo",mixins:[oe.A],localData:{gradientRenderer:"",previewWidth:231,previewHeight:231,easePath:""},easingSelections:[{id:"linear",title:"Linear"},{id:"power1",title:"Power1"},{id:"power2",title:"Power2"},{id:"power3",title:"Power3"},{id:"power4",title:"Power4"},{id:"back",title:"Back"},{id:"elastic",title:"Elastic"},{id:"bounce",title:"Bounce"},{id:"rough",title:"Rough"},{id:"slowmo",title:"Slow Motion"},{id:"stepped",title:"Stepped"},{id:"circ",title:"Circ"},{id:"expo",title:"Expo"},{id:"sine",title:"Sine"}],inOutSelection:[{id:"in",title:"In"},{id:"inOut",title:"In and Out"},{id:"out",title:"Out"}],roughTemplateSelections:[{id:"linear",title:"Linear"},{id:"power1",title:"Power1"},{id:"power2",title:"Power2"},{id:"power3",title:"Power3"},{id:"power4",title:"Power4"},{id:"back",title:"Back"},{id:"elastic",title:"Elastic"},{id:"bounce",title:"Bounce"},{id:"slowmo",title:"Slow Motion"},{id:"stepped",title:"Stepped"},{id:"circ",title:"Circ"},{id:"expo",title:"Expo"},{id:"sine",title:"Sine"}],roughEasingSelections:[{id:"in",title:"In"},{id:"out",title:"Out"},{id:"inOut",title:"In and Out"}],roughTaperSelections:[{id:"none",title:"None"},{id:"in",title:"In"},{id:"out",title:"Out"},{id:"inOut",title:"In and Out"}],getInitialState:function(){return{selectedEase:""}},componentWillMount:function(){},componentWillUnmount:function(){},componentWillReceiveProps:function(e){},componentDidMount:function(){this.localData.gradientRenderer=ne()(this.refs.gradientPreview).size("100%","100%"),this.setState({selectedEase:this.props.value.easing}),this.drawEasingPreview(this.props.value)},onTweenUpdate:function(){},componentDidUpdate:function(){},PropValueChanged:function(e,t,a){"easing"==e&&this.setState({selectedEase:t});var i={};$.extend(!0,i,this.props.value),i[e]=t,this.props.onValueChanged(this.props.name,i)},render:function(){var e=this.props.value;switch(void 0!==e&&"object"===le(e)||(e={}),0==e.hasOwnProperty("easing")&&(e.easing="power1"),e.easing){case"back":0==e.hasOwnProperty("parBack")&&(e.parBack=1.7);break;case"elastic":0==e.hasOwnProperty("parElastic1")&&(e.parElastic1=1.2),0==e.hasOwnProperty("parElastic2")&&(e.parElastic2=.3);break;case"slowmo":0==e.hasOwnProperty("parSlowmo1")&&(e.parSlowmo1=.3),0==e.hasOwnProperty("parSlowmo2")&&(e.parSlowmo2=.7);break;case"stepped":0==e.hasOwnProperty("parStepped")&&(e.parStepped=10);break;case"rough":0==e.hasOwnProperty("parRoughTemplate")&&(e.parRoughTemplate="power1"),0==e.hasOwnProperty("parRoughEasing")&&(e.parRoughEasing="in"),0==e.hasOwnProperty("parRoughStrength")&&(e.parRoughStrength=.2),0==e.hasOwnProperty("parRoughPoints")&&(e.parRoughPoints=10),0==e.hasOwnProperty("parRoughTaper")&&(e.parRoughTaper="inOut"),0==e.hasOwnProperty("parRoughRandomize")&&(e.parRoughRandomize=!0),0==e.hasOwnProperty("parRoughClamp")&&(e.parRoughClamp=!1)}""!=this.localData.gradientRenderer&&(this.drawEasingPreview(e),""!=this.localData.easePath&&TweenLite.fromTo("#"+this.localData.easePath,5,{drawSVG:"0%"},{drawSVG:"100%"}));var t,a=function(e){return o().createElement("li",{key:e.id,onClick:this.PropValueChanged.bind(this,"easing",e.id),className:this.state.selectedEase==e.id?"active":""},e.title)}.bind(this),i=null;switch(e.easing){case"back":i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Overshoot"),o().createElement("td",null,o().createElement(te.A,{name:"parBack",resetValue:1.7,step:.01,format:"0.01",min:0,max:10,value:e.parBack,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))));break;case"elastic":i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Amplitude"),o().createElement("td",null,o().createElement(te.A,{name:"parElastic1",resetValue:1.2,step:.01,format:"0.01",min:.05,max:3,value:e.parElastic1,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Period"),o().createElement("td",null,o().createElement(te.A,{name:"parElastic2",resetValue:.3,step:.01,format:"0.01",min:.05,max:2,value:e.parElastic2,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))));break;case"rough":i=o().createElement("div",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Template"),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement(ae.A,{name:"parRoughTemplate",selections:this.roughTemplateSelections,value:e.parRoughTemplate,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Easing"),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement(ae.A,{name:"parRoughEasing",selections:this.roughEasingSelections,value:e.parRoughEasing,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Strength"),o().createElement("td",null,o().createElement(te.A,{name:"parRoughStrength",resetValue:.2,step:.01,format:"0.01",min:0,max:2,value:e.parRoughStrength,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Points"),o().createElement("td",null,o().createElement(te.A,{name:"parRoughPoints",resetValue:10,step:1,format:"1",min:1,max:300,value:e.parRoughPoints,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Taper"),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement(ae.A,{name:"parRoughTaper",selections:this.roughTaperSelections,value:e.parRoughTaper,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Randomize"),o().createElement("td",null,o().createElement(se.A,{name:"parRoughRandomize",value:e.parRoughRandomize,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Clamp"),o().createElement("td",null,o().createElement(se.A,{name:"parRoughClamp",value:e.parRoughClamp,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))))));break;case"slowmo":i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Linear Ratio"),o().createElement("td",null,o().createElement(te.A,{name:"parSlowmo1",resetValue:.3,step:.01,format:"0.01",min:.05,max:1,value:e.parSlowmo1,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Power"),o().createElement("td",null,o().createElement(te.A,{name:"parSlowmo2",resetValue:.7,step:.01,format:"0.01",min:.05,max:3,value:e.parSlowmo2,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))));break;case"stepped":i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Steps"),o().createElement("td",null,o().createElement(te.A,{name:"parStepped",resetValue:10,step:1,format:"1",min:1,max:1e3,value:e.parStepped,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))))}return t="linear"==e.easing||"stepped"==e.easing||"rough"==e.easing||"slowmo"==e.easing?null:o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Type:"),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement(ae.A,{key:"inOut",name:"inOut",selections:this.inOutSelection,value:e.inOut,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})))))),o().createElement("div",{className:"easingGizmo"},o().createElement("div",{className:"singular-panel easing-list"},o().createElement("div",{className:"panel"},o().createElement("div",{className:"panel-header"},"Effects"),o().createElement("div",{className:"panel-body"},o().createElement("ul",{className:"singular-list"},this.easingSelections.map(a))))),o().createElement("div",{className:"easingPreview",ref:"gradientPreview",style:{width:this.localData.previewWidth+"px",height:this.localData.previewHeight+"px"}}),o().createElement("div",{className:"easing-options"},o().createElement("div",{className:"easing-type-selectors"},t),o().createElement("div",{className:"easing-properties"},i)))},drawEasingPreview:function(e){var t=this.localData.gradientRenderer;if(void 0!==t&&""!=t){for(var a=this.generateGreensockEasing(e),i=this.localData.previewWidth,n=(this.localData.previewHeight,9999),s=-9999,o=[],l=0;l<=i;l++){var r=1-a.getRatio(l/i);r<n&&(n=r),r>s&&(s=r),o.push(r)}var c=1/(s-n),d=[];for(l=0;l<=i;l++)d.push([l,(o[l]-n)*c*this.localData.previewHeight]);t.clear(),t.viewbox(-10,-15,this.localData.previewWidth+20,this.localData.previewHeight+30);for(var p,m=t.polyline(d).fill("none").stroke({width:2,color:"#dcdee3"}),u=(d.length,0),h=0;h<m.node.points.numberOfItems;h++){var f=m.node.points.getItem(h);h>0&&(u+=Math.sqrt(Math.pow(f.x-p.x,2)+Math.pow(f.y-p.y,2))),p=f}t.polyline([d]).fill("none").stroke({width:4,color:"#4279AC",dasharray:u,dashoffset:u}).animate(3e3).during(function(e,t){this.attr({"stroke-dashoffset":t(u,0)})});var g=(1-n)*c*this.localData.previewHeight;t.line(0,g,this.localData.previewWidth,g).fill("none").stroke({width:1,color:"#000"}),t.text("0 %").move(0,g+2).fill("#fff");var v=(0-n)*c*this.localData.previewHeight;t.line(0,v,this.localData.previewWidth,v).fill("none").stroke({width:1,color:"#000"}),t.text("100 %").move(0,v+2).fill("#fff")}}});var ce=a(50942),de=a.n(ce),pe=a(5876),me=a(9769),ue=a(48766);const he=o().createClass({displayName:"AnimationPanel",mixins:[pe.A],shouldComponentUpdate:function(e,t){return!me.compareObject(this.props,e)},AnimationPaste:function(){var e=this.onFetchClipBoardData("effects");if(e&&void 0!==this.props.state){var t=e[this.props.state];if(t){var a=this.onFetchClipBoardData("keyframes");if(a){var i=a[this.props.state];i&&(this.props.showWidgetAnimation||"widget"!=t.effect)&&(this.props.onEffect("effect",t.effect),this.props.onValueChanged("property",t.property),this.props.onValueChanged("easing",t.easing),this.props.onValueChanged("begin",i[0]),this.props.onValueChanged("duration",i[1]-i[0]))}}}},render:function(){if($.isEmptyObject(this.props.anim))return o().createElement("tr",null);if(!this.props.anim.effect)return o().createElement("tr",null);var e=[],t=ue.EffectSelections;this.props.isUpdateAnimation&&(t=ue.EffectSelectionsUpdateAnimation),t.map(function(t){t.id==this.props.anim.effect&&(e=t.property)}.bind(this));var a=!1;e.map(function(e){e.id==this.props.anim.property&&(a=!0)}.bind(this));var i=this.props.disabled,n=!1;0==a&&(this.props.anim.property=e[0].id,"none"==this.props.anim.property&&(n=!0));var s=o().createElement(de(),{id:"popover"},o().createElement(re,{name:"easing",value:this.props.anim.easing,onValueChanged:this.props.onValueChanged})),l="dropdown";"dropup"==this.props.menuStyle&&(l="dropup");var r,c=ue.EffectSelections;return this.props.isUpdateAnimation?c=ue.EffectSelectionsUpdateAnimation:this.props.showWidgetAnimation||(c=ue.EffectSelections.slice(0,-1)),this.props.showPasteButton&&(r=o().createElement("td",null,o().createElement("button",{tabIndex:"-1",type:"button",className:"btn btn-default btn-sm relative v2",style:{boxShadow:"none",height:"28px"},onClick:this.AnimationPaste},o().createElement("i",{className:"fa fa-clipboard"})))),o().createElement("div",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement(ae.A,{name:"effect",selections:c,className:l,value:this.props.anim.effect,onValueChanged:this.props.onEffect,disabled:i})),o().createElement("td",null,o().createElement(ae.A,{name:"property",selections:e,className:l,disabled:n||i,value:this.props.anim.property,onValueChanged:this.props.onValueChanged})),o().createElement("td",null," "),o().createElement("td",null,o().createElement(te.A,{name:"duration",resetValue:1,step:.01,unit:"s",format:"0.01",min:0,max:60,value:this.props.anim.duration,showSlider:!1,onValueChanged:this.props.onValueChanged,disabled:n||i})),o().createElement("td",null,o().createElement(Y(),{tabIndex:"-1",trigger:"click",rootClose:!0,placement:this.props.gizmoOverlayPlacement,overlay:s},o().createElement("button",{className:"btn btn-default",tabIndex:"-1",disabled:n||i},this.props.anim.easing.easing," ",o().createElement("i",{className:"fa fa-sliders"})))),r))))}});var fe=a(95093),ge=a.n(fe),ve=a(57453),be=a(33738),ye=a(9769),Ee=a(82465),we=[];const Se=o().createClass({displayName:"WidgetInstanceInfo",getInitialState:function(){return this.widgetVersionGetHandler=null,this.itemType=null,this.widget=null,this.tileId=null,this.widgetID=null,this.widgetVersion=null,{showBusyIcon:!1,currentVersionchangeDate:null,isVersionUpToDate:!1,isDeveloperVersion:!1}},componentWillMount:function(){this.updateEditor(this.props.item)},componentWillReceiveProps:function(e){this.updateEditor(e.item)},componentWillUnmount:function(){null!=this.widgetVersionGetHandler&&(this.widgetVersionGetHandler.abort(),this.widgetVersionGetHandler=null)},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!0},getElementFromWidgetCache:function(e){if(!e||void 0===e.id)return null;for(var t=0,a=we.length;t<a;t++)if(we[t].widget.id==e.id)return we[t];return null},updateEditor:function(e){if(this.widget=null,this.widgetID=null,this.widgetVersion=null,null!=e){switch(e.type){case void 0:case"group":this.itemType="group";break;case"composition":this.itemType="composition";break;case"widget":this.itemType="widget";break;default:this.itemType=null}if("widget"==this.itemType){this.tileId=e.id,this.widgetID=e.widget,this.widgetVersion=e.version,this.widget=h.A.getWidgetById(e.widget,e.version);var t=this.getElementFromWidgetCache(this.widget);null==t?this.getVersion(this.widget):this.populateEditor(t)}}else this.itemType=null},getVersion:function(e){e&&(null!=this.widgetVersionGetHandler&&(this.widgetVersionGetHandler.abort(),this.widgetVersionGetHandler=null),this.setState({showBusyIcon:!0,isVersionUpToDate:!1,isDeveloperVersion:!1,currentVersionchangeDate:null}),this.widgetVersionGetHandler=S().get("/widgets/"+e.id+"/versions").set("Content-Type","application/json").end(function(t,a){this.widgetVersionGetHandler=null;var i=[];if(t)this.setState({showBusyIcon:!1}),N.A.add(N.A.TYPE.ERROR,{title:"Widget version read error",description:"Cannot read version info of widget "+e.name,compositionId:this.props.sbRef.key,tileId:this.tileId});else{if(a.headers.location)return void(window.location=a.headers.location);i=a.body}i.sort(function(e,t){return e.version<t.version});var n=this.getElementFromWidgetCache(this.widget);n?(n.widget=e,n.versions=i):(n={widget:e,versions:i},we.push(n)),this.populateEditor(n),this.setState({showBusyIcon:!1})}.bind(this)))},populateEditor:function(e){if(this.widget){for(var t=e.versions,a=this.widget,i=!1,n=!1,s=null,o=0,l=t.length;o<l;o++)t[o].version==a.version&&(s=t[o].updated_at,"published"==t[o].status&&(i=!0),"development"==t[o].status&&(n=!0));this.setState({versions:t,currentVersionchangeDate:s,isVersionUpToDate:i,isDeveloperVersion:n})}},refreshInfo:function(){this.getVersion(this.widget)},upgradeToLatestVersion:function(){var e=this.getElementFromWidgetCache(this.widget);if(null!=e){for(var t=e.versions,a=null,i=0,n=t.length;i<n;i++)"published"==t[i].status&&(a=t[i].version);null!=a&&this.changeVersionOfWidget(a)}},changeVersionOfWidget:function(e){var t=h.A.getWidgetById(this.widget.id,e);t&&t.id==this.widget.id&&t.version==e?this.__setWidgetVersion(t):(this.setState({showBusyIcon:!0}),h.A.loadWidgetFromVersion(this.widget.id,e,function(t,a){t?N.A.add(N.A.TYPE.ERROR,{title:"Failed to change widget version",description:"Cannot change widget version to "+e,compositionId:this.props.sbRef.key,tileId:this.tileId}):this.__setWidgetVersion(a),this.setState({showBusyIcon:!1})}.bind(this)))},__setWidgetVersion:function(e){var t=ye.convertWidgetModelIntoSBaseData(e.model),a=this.props.sbRef.child("data").child(this.tileId).val(),i={};$.extend(!0,i,t,a),this.props.sbRef.child("data").child(this.tileId).update(i),this.props.sbRef.child("tiles").child(this.tileId).child("version").set(e.version)},reloadDevVersion:function(){this.props.forceUpdateIFrame(this.tileId)},generateVersionSelection:function(){var e=[],t=this.getElementFromWidgetCache(this.widget);if(null!=t){for(var a=t.versions,i=0,n=a.length;i<n;i++)"deprecated"!=a[i].status&&e.push({id:a[i].version,title:a[i].status});return{value:this.widget.version,selection:e}}},showHelp:function(){this.widget.helpEnabled&&this.widget.helpUrl&&window.open(this.widget.helpUrl,this.widget.helpUrl).focus()},render:function(){if(1==this.state.showBusyIcon)return o().createElement("div",{className:"loader-wrapper"},o().createElement("img",{src:"/images/loading-bubbles.svg",className:"loader"}));switch(this.itemType){case null:case"group":case"composition":return o().createElement("div",null)}var e,t,a,i,n,s,l,r,c,d;if(null==this.widget?(t="Unknown",e=o().createElement("div",{className:"widget-icon"},o().createElement("img",{src:ye.getDefaultIconFromBrowserShortType(Ee.WIDGET),height:"32px"})),a=this.widgetID,i=this.widgetVersion):(t=this.widget.name,a=this.widget.id,e=o().createElement("div",{className:"widget-icon"},o().createElement(be.A,{imageUrl:this.widget.thumbnail,defaultImageUrl:ye.getDefaultIconFromBrowserShortType(Ee.WIDGET)}))),1==this.state.isDeveloperVersion||this.state.isVersionUpToDate,0!=this.state.isVersionUpToDate||this.state.isDeveloperVersion||(l=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"upgrade-widget-tooltip"},"Upgrade widget to latest version")},o().createElement("button",{tabIndex:"-1",className:"btn btn-default v2",style:{display:"inline-block",marginLeft:"2px"},onClick:this.upgradeToLatestVersion},o().createElement("i",{className:"fa fa-upload"}))),s="outdated"),window.singularUser.account.permission.permDevTool){this.state.isDeveloperVersion&&(r="Unknown",this.state.currentVersionchangeDate&&(r=ge()(this.state.currentVersionchangeDate).fromNow()),c=o().createElement("div",{className:"widget-changed-info"},"Updated ",r));var p=this.generateVersionSelection();if(p&&p.selection.length){var m,u=function(e){return o().createElement("li",{key:e.id},o().createElement("a",{onClick:this.changeVersionOfWidget.bind(this,e.id)},e.id," - ",e.title))}.bind(this);this.state.isDeveloperVersion&&(m=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"upgrade-widget-tooltip"},"Reload widget")},o().createElement("button",{tabIndex:"-1",className:"btn btn-default v2",style:{display:"inline-block",marginLeft:"2px"},onClick:this.reloadDevVersion},o().createElement("i",{className:"fa fa-refresh"}))));var h="unkown";this.widget&&null!=this.widget.version&&(h=this.widget.version+" ( "+this.widget.status+" )"),n=o().createElement("div",{style:{display:"inline-block"}},o().createElement("div",{className:"dropup",style:{display:"inline-block"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle v2",type:"button",id:"dropdownMenuVersion","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},h,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},p.selection.map(u))),l,m)}}else this.widget&&(n=o().createElement("span",{className:s},this.widget.version," (",this.widget.status,")",l));return this.widget&&this.widget.helpEnabled&&this.widget.helpUrl&&(d=o().createElement("button",{tabIndex:"-1",className:"btn btn-default v2 widget-help-btn",onClick:this.showHelp},o().createElement("i",{className:"fa fa-question",style:{left:"-3px",position:"relative",top:"-3px"}}))),null==this.widget&&null!=i&&(n=i),o().createElement("div",{className:"widget-info-panel"},o().createElement("div",{className:"header"},t," (ID: ",a,") ",d),e,o().createElement("div",{className:"widget-name"},"Version  ",n,c))}});var Ne=a(45659),Ce=a(9769),xe=o().createClass({displayName:"Cursor",getDefaultProps:function(){return{pos:0}},getInitialState:function(){return{pos:this.props.pos}},componentWillReceiveProps:function(e){this.setState({pos:e.pos})},shouldComponentUpdate:function(e,t){return!Ce.compareObject(this.props,e)},onMouseDown:function(e){this.accumulatePos=this.state.pos,this.isMouseDown=!0,this.mouseDownPosX=e.screenX,e.stopPropagation(),e.preventDefault()},onMouseMove:function(e){if(this.isMouseDown){var t=e.screenX-this.mouseDownPosX;this.mouseDownPosX=e.screenX,this.accumulatePos+=t;var a=Math.max(0,this.accumulatePos);this.setState({pos:a}),this.props.onUpdate&&this.props.onUpdate(a)}},onMouseUp:function(e){this.isMouseDown=!1,this.props.onChange&&this.props.onChange(this.state.pos)},componentDidMount:function(e){$(document).on("mouseup",this.onMouseUp),$(document).on("mousemove",this.onMouseMove)},componentWillUnmount:function(e){$(document).off("mouseup",this.onMouseUp),$(document).off("mousemove",this.onMouseMove)},render:function(){var e={left:this.state.pos+this.props.frame.left,top:this.props.top,height:this.props.height,position:"fixed"};e.left<this.props.screenVisibleRange.left||e.left>this.props.screenVisibleRange.right?e.opacity=0:e.opacity=1;var t=M()(this.props.cursorLabel).format("0.00");return o().createElement("div",{className:"cursor",style:e,onMouseDown:this.onMouseDown},o().createElement("div",{className:"handle"},o().createElement("div",{className:"handle-label"},t)))}});const Ie=o().createClass({displayName:"Ruler",getPosition:function(e){for(var t=0,a=0;e;)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,a+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{x:t,y:a}},onCursorChange:function(e){if(this.props.onCursorChange){var t=Ne.getRulerPixelToSec(this.props.zoom,e);this.props.onCursorChange(t)}},onMouseDown:function(e){this.isMouseDown=!0;var t=this.getPosition(this.rulerBody),a=e.clientX-t.x;this.onCursorChange(a),e.stopPropagation(),e.preventDefault()},onMouseMove:function(e){if(this.isMouseDown){var t=this.getPosition(this.rulerBody),a=e.clientX-t.x;a<0&&(a=0),this.onCursorChange(a)}},onMouseUp:function(e){this.isMouseDown=!1},componentDidMount:function(){$(document).on("mouseup",this.onMouseUp),$(document).on("mousemove",this.onMouseMove),this.rulerBody=n().findDOMNode(this.refs.rulerBody),this.props.onComponentDidMount&&this.props.onComponentDidMount(),this.forceUpdate()},componentWillUnmount:function(e){$(document).off("mouseup",this.onMouseUp),$(document).off("mousemove",this.onMouseMove)},render:function(){var e,t,a,i,n=[];a=Ne.getRuler(this.props.zoom).hSpace,i=Ne.getRuler(this.props.zoom).secPerTick;for(var s=0;s++*a<this.props.width;){s%10==0?(e="tick tick-big",t="tick-label tick-label-big"):s%5==0?(e="tick tick-medium",t="tick-label tick-label-medium"):(e="tick tick-small",t=this.props.zoom>1?"tick-label tick-label-small":"tick-label tick-label-medium");var l=o().createElement("div",{key:s,className:e,style:{left:s*a+"px"}},o().createElement("div",{className:t}," ",M()(s*i).format("0.0")," "));n.push(l)}var r,c=Ne.getRulerSecToPixel(this.props.zoom,this.props.timelinePosition),d=this.getPosition(this.rulerBody),p={left:d.x,top:d.y,width:$(this.rulerBody).width(),height:$(this.rulerBody).height()};return this.props.showCursor&&(r=o().createElement(xe,{onUpdate:this.onCursorChange,pos:c,top:this.props.cursorTop,height:this.props.cursorHeight,frame:p,screenVisibleRange:this.props.screenVisibleRange,cursorLabel:this.props.timelinePosition})),o().createElement("div",{className:"ruler",ref:"rulerBody",onMouseDown:this.onMouseDown},r,o().createElement("div",null,n))}}),ke=o().createClass({displayName:"HScrollerBar",isMouseDown:!1,getInitialState:function(){return{pos:0}},onMouseDown:function(e){this.isMouseDown=!0,this.mouseDownPosX=e.screenX},validatePosition:function(e){var t=$(this.scrollbarBody).width(),a=$(this.scrollbarContainer).width();return e+t>a&&(e=a-t),e<0&&(e=0),e},onMouseMove:function(e){if(this.isMouseDown){e.stopPropagation(),e.preventDefault();var t=e.screenX-this.mouseDownPosX;this.mouseDownPosX=e.screenX;var a=this.validatePosition(this.state.pos+t);this.setState({pos:a}),this.props.onUpdate&&this.props.onUpdate(a)}},onMouseUp:function(e){this.isMouseDown=!1,this.props.onChange&&this.props.onChange(this.state.pos)},componentDidMount:function(){$(document).on("mousemove",this.onMouseMove),$(document).on("mouseup",this.onMouseUp),this.scrollbarBody=n().findDOMNode(this.refs.scrollbarBody),this.scrollbarContainer=n().findDOMNode(this.refs.scrollbarContainer)},componentWillUnmount:function(){$(document).off("mousemove",this.onMouseMove),$(document).off("mouseup",this.onMouseUp)},render:function(){var e={left:this.props.pos,width:this.props.contentCurrentWidth/this.props.contentWidth*100+"%"};return o().createElement("span",{className:"h-scrollbar",ref:"scrollbarContainer"},o().createElement("span",{className:"scrollbar",ref:"scrollbarBody",style:e,onMouseDown:this.onMouseDown}))}});var De=a(42880),Ae=a.n(De),Re=a(9769),Pe=a(82465),Te="All",Me="Discontinued",Oe="My Account",Le="Shared with my account";const Ve={getInitialState:function(){return{widgetList:[],filteredWidgets:[],widgetCategories:[],selectedModalWidgetTab:"",mouseOverModalWidgetTab:"",filter:"",isDevelopmentMode:!1,showBusyIcon:!1}},getWidgets:function(e){this.setState({showBusyIcon:!0});var t="/widgets/json";e&&(t+="?status="+e),S().get(t).set("Content-Type","application/json").end(function(e,t){if(e)this.setState({showBusyIcon:!1}),N.A.add(N.A.TYPE.ERROR,{title:"Cannot get widget from database",description:e.message});else{if(t.headers.location)return void(window.location=t.headers.location);var a=[],i=[],n=t.body;for(var s in h.A.addWidgets(n),n.forEach(function(e,t){if(e.type="widget",e.category){var a=parseInt(window.singularUser.account.accountId);a==e.account_id&&(e.category+="|"+Oe),a!=e.account_id&&0!=e.account_id&&(e.category+="|"+Le),e.category.split("|").forEach(function(e,t){i[e]?i[e]++:i[e]=1})}}),i[Me]&&i[Oe]&&(i[Oe]-=i[Me]),i)a.push({name:s,count:i[s]});a.sort(function(e,t){return e.name==Me?1:t.name==Me?-1:e.name.localeCompare(t.name)}),a.forEach(function(e,t){e.name===Le&&(a.splice(t,1),a.unshift(e))}),a.forEach(function(e,t){e.name===Oe&&(a.splice(t,1),a.unshift(e))});var o=n.length;i[Me]&&(o-=i[Me]),a.unshift({name:Te,count:o}),n.sort(function(e,t){return e.name.localeCompare(t.name)}),this.setState({widgetList:n,widgetCategories:a,selectedModalWidgetTab:Te}),this.filterWidget({name:Te,count:n.length}),this.setState({showBusyIcon:!1})}}.bind(this))},componentDidMount:function(){this.getWidgets(""),$("#widgetBrowserModal").on("show.bs.modal",function(){setTimeout(function(){$("#widget-search-box").focus(),$("#widget-search-box").select()},500)}.bind(this))},developmentModeChanged:function(e,t){this.setState({isDevelopmentMode:t},function(){this.getWidgets(this.state.isDevelopmentMode?"development":"")}.bind(this))},onSearchBoxFilterChanged:function(e){this.setState({filter:e.target.value})},onSearchBoxFilterKeyDown:function(e){"Escape"==e.key&&""!=this.state.filter&&(this.setState({filter:""}),e.preventDefault(),e.stopPropagation())},clearSearchBox:function(){this.setState({filter:""})},renderModal:function(e,t){var a=function(e,t){return""!=this.state.filter.trim()&&-1==e.name.toLowerCase().indexOf(this.state.filter.trim().toLowerCase())?null:o().createElement("div",{key:e.id,className:e.name+"-widget browser-item-wrapper",title:e.description},o().createElement("div",{className:"component center-block",onClick:this.addWidget.bind(this,e)},o().createElement("div",{className:"icon"},o().createElement(ve.A,{src:e.thumbnail,fallbackImage:Re.getDefaultIconFromBrowserShortType(Pe.WIDGET),initialImage:"/images/loading-bubbles.svg"})),o().createElement("div",{className:"title",style:{textOverflow:"ellipsis",whiteSpace:"nowrap"}},e.name)))}.bind(this),i=function(e,t){var a=e.name;return e.name==this.state.selectedModalWidgetTab&&(a+=" active"),o().createElement("li",{key:e.name,className:a,onClick:this.filterWidget.bind(this,e),onMouseOver:this.modalTabMouseOver.bind(this,e)},e.name," ",o().createElement("span",{className:"pull-right"},e.count))}.bind(this),n=this.state.filter?"form-control dirty":"form-control",s=this.state.filter?"fa fa-times input-clear-icon":"fa fa-times input-clear-icon hidden";if(0==this.state.showBusyIcon)var l=o().createElement("div",{className:"panel-body"},o().createElement("div",{className:"row browser-tree component-tree font-tree"},"widget"==e?this.state.filteredWidgets.map(a):""));else l=o().createElement("div",{className:"panel-body"},o().createElement("div",{className:"row browser-tree component-tree font-tree",style:{width:"100%",height:"100%"}},o().createElement("img",{style:{margin:"0 auto"},src:"/images/loading-bubbles.svg",className:"loader"})));var r=null;return window.singularUser.account.permission.permDevTool&&(r=o().createElement("div",{className:"col-sm-4",style:{paddingTop:"5px"}},o().createElement("div",{style:{float:"right"}},"Show Dev Versions"),o().createElement("div",{style:{float:"right"}},o().createElement(se.A,{name:"a",title:"Development",value:this.state.isDevelopmentMode,onValueChanged:this.developmentModeChanged})))),o().createElement("div",{id:t,className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},"")),o().createElement("h4",{className:"modal-title",id:"myModalLabel"}," ","widget"==e?"Widgets":"Compositions")),o().createElement("div",{className:"modal-body"},o().createElement("div",{className:"row lists-wrapper"},o().createElement("div",{className:"col-sm-3 list-wrapper left-menu left-menu hidden-md-down"},o().createElement("div",{className:"panel full-modal"},o().createElement("div",{className:"panel-header"},"Categories"),o().createElement("div",{className:"panel-body"},o().createElement("ul",{className:"browser-tree font-tree"},"widget"==e?this.state.widgetCategories.map(i):"")))),o().createElement("div",{className:"col-sm-9 list-wrapper"},o().createElement("div",{className:"row fontBrowserOptions"},o().createElement("div",{className:"col-md-8"},o().createElement("i",{className:s,onClick:this.clearSearchBox}),o().createElement("input",{id:"widget-search-box",value:this.state.filter,className:n,style:{paddingLeft:"20px"},type:"text",onChange:this.onSearchBoxFilterChanged,onKeyDown:this.onSearchBoxFilterKeyDown}),o().createElement("i",{className:"fa fa-search input-icon"})),r),o().createElement("div",{className:"panel no-header"},l)))))))},filterWidget:function(e){var t=this.state.widgetList.filter(function(t,a){var i=t.category?t.category.split("|"):"";if(e.name===Te||-1!==i.indexOf(e.name)){if((e.name===Te||e.name===Oe||e.name===Le)&&-1!=i.indexOf(Me))return;return t}});this.setState({filteredWidgets:t,selectedModalWidgetTab:e.name})},modalTabMouseOver:function(e){this.setState({mouseOverModalWidgetTab:e.name})}};var _e=a(45659),Fe=a.n(_e),Be=a(33287),Ue=a.n(Be),We=a(56027),je=a(50313),Ye=a(9769);const He={onWidgetNameChange:function(e,t){var a={};a.name=t,this.props.sbRef.child("tiles").child(e).update(a),this.props.forceCompositionUpdate()},onWidgetDelete:function(e,t){var a=this,i=this.props.sbRef.child("groups").child(t.id).val();this.props.sbRef.beginBatch();var n=e.id,s=[],o=h.A.getWidgetById(e.widget,e.version);if(o&&o.model&&o.model.fields&&Array.isArray(o.model.fields)){var l=this.props.sbRef.child("data/"+n).val();o.model.fields.forEach(function(e){"composition"==e.type&&l[e.id]&&s.push(l[e.id])})}this.props.sbRef.child("groups").child(i.id).child("items").child(n).remove(),this.props.sbRef.child("tiles").child(n).remove(),this.props.sbRef.child("data").child(n).remove(),this.props.sbRef.child("dataLinks").child(n).remove(),this.props.sbRef.child("nodeRefs").child(n).remove(),s.forEach(function(e){a.removeComposition(e)}),"composition"==e.type&&this.removeComposition(e.id);var r,c=[];for(var d in i.items)c.push(i.items[d]);c.sort(function(e,t){return(e.priority>t.priority)-.5});for(var p=0;p<c.length&&c[p].id!=n;p++);if(p+1<c.length?r=c[p+1].id:p-1>=0&&(r=c[p-1].id),r){var m=this.props.sbRef.child("tiles").child(r).val();this.props.onWidgetSelect(null,m,i)}else this.props.onGroupSelect(i);this.props.sbRef.endBatch()},onWidgetDuplicate:function(e,t){this.onGroupDuplicate(t)},removeComposition:function(e){var t=this,a=this.props.sbRootRef.child("compositions").val(),i=[];We.A.getCompositionChildren(e,a,i),i.push(e),i.forEach(function(e){for(var i in t.props.sbRootRef.child("compositions").child(e).remove(),t.props.sbRootRef.child("compositionStates").child(e).remove(),We.A.COMPOSITION_PROPS.forEach(function(a){t.props.sbRootRef.child("compositionProps").child(a).child(e).remove()}),a){var n=a[i];if(n.tiles)for(var s in n.tiles)if(n.tiles[s].layout){var o=n.tiles[s].layout.events;if(o)for(var l in o)o[l].controlComp==e&&t.props.sbRootRef.child("compositions").child(i).child("tiles").child(s).child("layout").child("events").child(l).child("controlComp").remove()}}})},onWidgetAdd:function(e){"widget"==e.type&&h.A.addWidget(e),this.props.sbRef.beginBatch();var t=this.props.sbRef.child("groups"),a=this.props.sbRef.child("tiles"),i=this.getGroupArray(),n=i[0],s=0;if(this.props.selection)if("group"==this.props.selection.type)(o=i.filter(function(e){if(e.id==this.props.selection.id)return e}.bind(this))).length>0&&(n=o[0]);else{var o=i.filter(function(e){for(var t in e.items)if(e.items[t].id==this.props.selection.id)return e}.bind(this));o.length>0&&(n=o[0],s=this.props.selection.id)}var l=t.child(n.id).child("items"),r=0,c=0,d=[];for(var p in n.items)d.push(n.items[p]);d.sort(function(e,t){return e.priority-t.priority-.5});for(var m=0==s?1:0,u=0;u<d.length;u++){var f=d[u],g=l.child(f.id);f.id==s&&(r=u,c=1);var v=m+u+c;g.set({id:f.id,priority:v}),a.child(f.id).child("layout").update({zindex:v})}var b=a.push(),y=(g=t.child(n.id).child("items").child(b.key),Ue().getDefaultLayout(r));if(f={},"widget"==e.type){y.left=e.left,y.top=e.top,y.width=e.width,y.height=e.height,f={id:b.key,name:e.name,type:"widget",widget:e.id,outputUrl:e.outputUrl,style:"",layout:y,keyframes:Fe().getDefaultKeyframes(),effects:Fe().getDefaultEffects()},1==e.supportInteractivity&&(f.supportInteractivity=1),f.keyframes.In[1]=.5,f.keyframes.Out[1]=.5,e.supportCustomAnimation?(f.effects.In.effect="widget",f.effects.Out.effect="widget"):(f.effects.In.effect="fade",f.effects.In.easing.easing="linear",f.effects.Out.effect="fade",f.effects.Out.easing.easing="linear"),e.version&&(f.version=e.version),b.set(f);var E=Ye.convertWidgetModelIntoSBaseData(e.model);this.props.sbRef.child("data").child(f.id).set(E)}else if(f={id:b.key,name:e.name,type:"composition",widget:"",layout:y,keyframes:Fe().getDefaultKeyframes(),effects:Fe().getDefaultEffects()},e.firebaseUrl||e.storageUrl)this.__loadCompJson(e.storageUrl,e.firebaseUrl,function(e,a,i){h.A.loadWidgetsFromCompositions(i.compositions,!0,function(e){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot load widgets from composition",description:e.message});else{var s=We.A.importComposition(i,f.id,a);this.props.sbRootRef.child("compositions").update(s),this.props.sbRootRef.child("compositionStates").child(f.id).set("In");var o=We.A.copyCompositionStatesWithIdMapping(i.compositionStates);this.props.sbRootRef.child("compositionStates").update(o);var l=We.A.copyCompositionPropsWithIdMapping(i.compositionProps);this.props.sbRootRef.child("compositionProps").update(l),b.set(f),g.set({id:b.key,priority:r}),this.props.onWidgetSelect(null,f,t.child(n.id).val())}}.bind(this))}.bind(this));else{var w=this.props.sbRootRef.child("compositions").child(f.id);this.props.sbRootRef.child("compositionStates").child(f.id).set("In"),this.props.sbRootRef.child("compositionProps").child("timeline2Active").child(f.id).set(!1),Ye.createDefaultGroupForComposition(w),b.set(f);var S=!1;je.A.compositionStack&&je.A.compositionStack.forEach(function(e){e.editCompInfo&&(S=!0)}),this.props.sbCompositionRef.key===this.props.sbRootRef.key||S||(this.props.sbRootRef.child("compositions").child(f.id).child("settings").child("linkTimeline").set(!0),w.child("settings").child("parentTimeline").set(this.props.sbCompositionRef.key))}null==e.firebaseUrl&&(g.set({id:b.key,priority:r}),this.props.onWidgetSelect(null,f,t.child(n.id).val())),this.props.sbRef.endBatch()},__loadCompJson:function(e,t,a){if(e)S().get(e).end(function(t,i){t?a("Cannot load revision from: "+e):i.body&&i.body.compositions&&i.body.mainComposition?a(null,i.body.mainComposition,i.body):a("No compositions available in cdn"+e)});else if(t){var i=window.singularRtdbCoreRef.child(t.replace(window.singularRtdbCoreRef.toString(),""));i.once("value",function(e){var t=e.val();t&&t.compositions&&a(null,i.key,t)})}else a("No url available")},onWidgetSort:function(e,t){var a=this.props.sbRef.child("groups").child(t).child("items"),i=this.props.sbRef.child("tiles");this.props.sbRef.beginBatch(),e.forEach(function(e){a.child(e.id).set(e),i.child(e.id).child("layout").update({zindex:e.priority})}),this.props.sbRef.endBatch()},onWidgetRemoveFromGroup:function(e,t){this.props.sbRef.child("groups").child(t).child("items").child(e).remove()},onWidgetVisibleToggle:function(e){var t=!this.getTiles()[e].layout.visible;this.props.sbRef.child("tiles").child(e).child("layout").update({visible:t})}},ze={current:a(16524).TRANSFORM};a(28866);var Ge=o().createClass({displayName:"AnchorGizmo",mixins:[],getInitialState:function(){return{selected:"Center"}},componentWillMount:function(){},componentWillUnmount:function(){},componentWillReceiveProps:function(e){this.translateValuesIntoPresets(e.value.x,e.value.y)},componentDidMount:function(){this.translateValuesIntoPresets(this.props.value.x,this.props.value.y)},translateValuesIntoPresets:function(e,t){var a="Center";e<25&&t<25?a="TopLeft":e>25&&e<75&&t<25?a="Top":e>75&&t<25?a="TopRight":e<25&&t>25&&t<75?a="Left":e>25&&e<75&&t>25&&t<75?a="Center":e>75&&t>25&&t<75?a="Right":e<25&&t>75?a="BottomLeft":e>25&&e<75&&t>75?a="Bottom":e>75&&t>75&&(a="BottomRight"),this.setState({selected:a})},onClick:function(e){if(1!=this.props.disabled){var t=0,a=0;switch(e){case"TopLeft":t=0,a=0;break;case"Top":t=50,a=0;break;case"TopRight":t=100,a=0;break;case"Left":t=0,a=50;break;case"Center":t=50,a=50;break;case"Right":t=100,a=50;break;case"BottomLeft":t=0,a=100;break;case"Bottom":t=50,a=100;break;case"BottomRight":t=100,a=100;break;default:return}this.props.onValueChanged&&this.props.onValueChanged(this.props.name,{x:t,y:a}),this.translateValuesIntoPresets(t,a)}},PropValueChanged:function(e,t){var a,i;"x"==e?(a=Number(t),i=Number(this.props.value.y)):(a=Number(this.props.value.x),i=Number(t)),this.props.onValueChanged(this.props.name,{x:a,y:i}),this.translateValuesIntoPresets(a,i)},render:function(){var e=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M10 13H9v3H6l3.5 3 3.5-3h-3v-3zm9-3.5L16 6v3h-3v1h3v3l3-3.5zM9.5 11c.8 0 1.5-.7 1.5-1.5S10.3 8 9.5 8 8 8.7 8 9.5 8.7 11 9.5 11z"})),t=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M3 6L0 9.5 3 13v-3h3V9H3V6zm16 3.5L16 6v3h-3v1h3v3l3-3.5zM10 13H9v3H6l3.5 3 3.5-3h-3v-3zm-.5-2c.8 0 1.5-.7 1.5-1.5S10.3 8 9.5 8 8 8.7 8 9.5 8.7 11 9.5 11z"})),a=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M10 16v-3H9v3H6l3.5 3 3.5-3h-3zM3 6L0 9.5 3 13v-3h3V9H3V6zm6.5 5c.8 0 1.5-.7 1.5-1.5S10.3 8 9.5 8 8 8.7 8 9.5 8.7 11 9.5 11z"})),i=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M10 13H9v3H6l3.5 3 3.5-3h-3v-3zm9-3.5L16 6v3h-3v1h3v3l3-3.5zM6 3h3v3h1V3h3L9.5 0 6 3zm5 6.5c0-.8-.7-1.5-1.5-1.5S8 8.7 8 9.5 8.7 11 9.5 11s1.5-.7 1.5-1.5z"})),n=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M3 6L0 9.5 3 13v-3h3V9H3V6zm7 7H9v3H6l3.5 3 3.5-3h-3v-3zm9-3.5L16 6v3h-3v1h3v3l3-3.5zM6 3h3v3h1V3h3L9.5 0 6 3zm5 6.5c0-.8-.7-1.5-1.5-1.5S8 8.7 8 9.5 8.7 11 9.5 11s1.5-.7 1.5-1.5z"})),s=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M9 6h1V3h3L9.5 0 6 3h3v3zm1 7H9v3H6l3.5 3 3.5-3h-3v-3zM3 6L0 9.5 3 13v-3h3V9H3V6zm5 3.5c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5S10.3 8 9.5 8 8 8.7 8 9.5z"})),l=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M6 3h3v3h1V3h3L9.5 0 6 3zm13 6.5L16 6v3h-3v1h3v3l3-3.5zM9.5 8C8.7 8 8 8.7 8 9.5S8.7 11 9.5 11s1.5-.7 1.5-1.5S10.3 8 9.5 8z"})),r=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M3 6L0 9.5 3 13v-3h3V9H3V6zm16 3.5L16 6v3h-3v1h3v3l3-3.5zM6 3h3v3h1V3h3L9.5 0 6 3zm3.5 5C8.7 8 8 8.7 8 9.5S8.7 11 9.5 11s1.5-.7 1.5-1.5S10.3 8 9.5 8z"})),c=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("path",{d:"M3 6L0 9.5 3 13v-3h3V9H3V6zm6 0h1V3h3L9.5 0 6 3h3v3zm.5 2C8.7 8 8 8.7 8 9.5S8.7 11 9.5 11s1.5-.7 1.5-1.5S10.3 8 9.5 8z"})),d=o().createElement("svg",{width:"19",height:"19",viewBox:"0 0 19 19"},o().createElement("rect",{x:"8",y:"8",width:"3",height:"3",rx:"2",fillRule:"evenodd"})),p=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15"},o().createElement("g",{fillRule:"evenodd",fill:"currentColor"},o().createElement("path",{d:"M6 8.293V1h1v7.293l.207.207L7 8.707V9h-.293L1.55 14.157l-.707-.707L6 8.293z",opacity:".3"}),o().createElement("path",{d:"M15 8.5L12 6v5l3-2.5zM6 8h6v1H6V8zm6.5-6.333L11.25 0H10l1.875 2.5L10 5h1.25l1.25-1.667L13.75 5H15l-1.875-2.5L15 0h-1.25L12.5 1.667z"}))),m=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15"},o().createElement("g",{fillRule:"evenodd",fill:"currentColor"},o().createElement("path",{d:"M6.293 8H6v.293L.843 13.45l.707.707L6.707 9H14V8H6.707L6.5 7.793 6.293 8z",opacity:".3"}),o().createElement("path",{d:"M6.5 0L4 3h5L6.5 0zM6 9V3h1v6H6zm6.5-7.506L13.753 0H15l-2 2.5V5h-1V2.5L10 0h1.25l1.25 1.494z"}))),u=function(e,t){return this.state.selected!=e&&(t=d),o().createElement("div",{className:"anchorGizmoElement",onClick:this.onClick.bind(this,e)},t)}.bind(this),h=o().createElement("div",{className:"anchorGizmo"},o().createElement("div",{className:"anchorGizmoValues"},o().createElement("div",{className:"form-inline"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,p),o().createElement("td",null,o().createElement(te.A,{name:"x",resetValue:50,step:.1,unit:"%",format:"0.0[0]",min:0,max:100,value:this.props.value.x,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))),o().createElement("tr",null,o().createElement("td",null,m),o().createElement("td",null,o().createElement(te.A,{name:"y",title:m,resetValue:50,step:.1,unit:"%",format:"0.0[0]",min:0,max:100,value:this.props.value.y,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}))))))),o().createElement("div",{className:"form-group anchorGizmoFrame",disabled:this.props.disabled},u("TopLeft",e),u("Top",t),u("TopRight",a),o().createElement("br",null),u("Left",i),u("Center",n),u("Right",s),o().createElement("br",null),u("BottomLeft",l),u("Bottom",r),u("BottomRight",c)));return this.props.renderInline&&(h=o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{style:{margin:"8px 0px 16px 0px"}},p),o().createElement("div",null,m)),o().createElement("td",{className:"rotation-prop"},o().createElement(te.A,{name:"x",resetValue:50,step:.1,unit:"%",format:"0.0[0]",min:0,max:100,value:this.props.value.x,onValueChanged:this.PropValueChanged,disabled:this.props.disabled}),o().createElement(te.A,{name:"y",title:m,resetValue:50,step:.1,unit:"%",format:"0.0[0]",min:0,max:100,value:this.props.value.y,onValueChanged:this.PropValueChanged,disabled:this.props.disabled})),o().createElement("td",{rowSpan:"2"},o().createElement("div",{className:"form-group anchorGizmoFrame",disabled:this.props.disabled,style:{marginLeft:"10px",marginTop:"3px !important"}},u("TopLeft",e),u("Top",t),u("TopRight",a),o().createElement("br",null),u("Left",i),u("Center",n),u("Right",s),o().createElement("br",null),u("BottomLeft",l),u("Bottom",r),u("BottomRight",c))))),h}});const Ke=Ge;var $e=a(76716),qe=a(74199);function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}const Xe=o().createClass({displayName:"NodeRefsBrowser",mixins:[$e.A],getInitialState:function(){return this.currentStores={},{availableNodes:[],availableFields:[],selectedDataNode:null,selectedNodeName:null,selectedFieldName:null,newFieldName:"",disableAddButton:!0,dropDownOpen:!1,filterValue:""}},componentWillMount:function(){this.getAvailableNodes()},componentDidMount:function(){this.refs.dropdownInput&&($(this.refs.dropdownInput).on("show.bs.dropdown",function(){this.setState({dropDownOpen:!0},function(){setTimeout(function(){$(this.refs.filterInputField).focus()}.bind(this),250)})}.bind(this)),$(this.refs.dropdownInput).on("hide.bs.dropdown",function(){this.setState({dropDownOpen:!1,filterValue:""})}.bind(this)))},componentWillUnmount:function(){},onFilterValueChanged:function(e){this.setState({filterValue:e.target.value})},onFilterKeyDown:function(e){if("Escape"==e.key&&this.setState({filterValue:""}),e.key,"Tab"===e.key)return e.preventDefault(),void e.stopPropagation()},getAvailableNodes:function(){if(this.props.enableDataLink){var e=function(e,t){var a=e.child(t).val();return 0===Object.entries(a).length&&a.constructor===Object?null:a},t=this.props.sbCompositionRef.child("dataSources").child("composition");this.currentStores.compositionControlNode=e(t,"controlNode"),this.currentStores.compositionWidgetNode=e(t,"widgetNode"),this.currentStores.compositionDataNodes=e(t,"dataNodes"),this.currentStores.dataLink=e(this.props.sbCompositionRef.child("nodeRefs"),this.props.sbRef.key);var a=this.currentStores,i=[],n=null;a.dataLink&&a.dataLink[this.props.nodeRefKey]&&(n=a.dataLink[this.props.nodeRefKey]);var s=function(e,t,a,s){if(""==a.dataNode)return!1;var o={};if(o.sourceLocation=t,o.index=0,o.name=e,"string"==typeof a.dataNode){var l=qe.A.get(a.dataNode);if(!l)return!1;"public"==a.type?o.type="publicDataNode":o.type="dataNode",o.item=l,o.index=a.id,o.payload=l.payload,o.name+=l.name}else{if(!a.payload)return!1;o.item=a,o.type=s||"controlNode",o.payload=a.payload,o.name+=a.name}return n&&n.sourceLocation.join("#")==t.join("#")&&n.sourceIndex==o.index&&n.sourceType==o.type&&this.showFieldInDataNode(o,!0,n),i.push({node:o,sourceLocation:t}),!0}.bind(this);if(a.compositionDataNodes)for(var o in a.compositionDataNodes)s("",this.__getSourceLocation("<selfCompId>"),a.compositionDataNodes[o]);if(this.props.compositionStack&&this.props.compositionStack.length>1){var l,r,c="<rootCompId>",d=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return Je(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Je(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw s}}}}(this.props.compositionStack);try{for(d.s();!(r=d.n()).done;){var p=r.value;if(p.inheritedProps.compositionDataNodes)for(var m in p.inheritedProps.compositionDataNodes)s(l+" / ",this.__getSourceLocation(c),p.inheritedProps.compositionDataNodes[m]);p.inheritedProps.compositionControlNode&&s(l+" / ",this.__getSourceLocation(c),p.inheritedProps.compositionControlNode),c="root"==p.compId?"<rootCompId>":p.compId,l=void 0===l?"Root":p.name}}catch(e){d.e(e)}finally{d.f()}}var u=!1;a.compositionControlNode&&(u=s("",this.__getSourceLocation("<selfCompId>"),a.compositionControlNode)),0==u&&i.push({node:{name:"Control Node"}}),a.compositionWidgetNode&&s("",this.__getSourceLocation("<selfCompId>"),a.compositionWidgetNode,"widgetNode"),this.setState({availableNodes:i},function(){if(!n){var e=null;i.length&&(e=i[i.length-1].node),e&&this.showFieldInDataNode(e,!0)}}.bind(this))}},__getSourceLocation:function(e){return[e,"dataSources","composition"]},showFieldInDataNode:function(e,t,a){var i=null,n=null;if(e&&e.item){a?i=a:this.currentStores.dataLink&&this.currentStores.dataLink[this.props.nodeRefKey]&&(i=this.currentStores.dataLink[this.props.nodeRefKey]);var s=[],o=e.item.model.fields,l=0;for(var r in e.payload){var c=r,d="",p="",m=l++;for(var u in o)if(r==o[u].id){(c=o[u].title)!=o[u].id&&(c+=" ("+o[u].id+")"),d=o[u].type,void 0!==o[u].index&&(m=o[u].index),p=u;break}"infotext"!=d&&(s.push({sourceInfo:{sourceIndex:e.index,sourceKey:r,sourceKeyId:p,sourceType:e.type,sourceLocation:e.sourceLocation,sortIndex:m},name:r,title:c}),i&&t&&i.sourceKey==r&&(n=c))}var h=s.sort(function(e,t){return e.sourceInfo.sortIndex>t.sourceInfo.sortIndex?1:e.sourceInfo.sortIndex<t.sourceInfo.sortIndex?-1:0});this.setState({selectedDataNode:e,selectedNodeName:e.name,selectedFieldName:n,availableFields:h},this.setNewFieldName)}else this.setState({selectedDataNode:e,selectedNodeName:e.name,selectedFieldName:null,availableFields:[]},this.setNewFieldName)},selectDataField:function(e){if(e){var t={},a={};$.extend(!0,a,e),a.targetLocation=this.props.targetLocation,t[this.props.nodeRefKey]=a,this.props.sbCompositionRef.child("nodeRefs").child(this.props.sbRef.key).update(t)}else this.props.sbCompositionRef.child("nodeRefs").child(this.props.sbRef.key).child(this.props.nodeRefKey).remove();this.getAvailableNodes()},unlinkDataField:function(e){this.selectDataField(""),this.setState({selectedDataNode:null,selectedNodeName:null,selectedFieldName:null,availableFields:[]},this.getAvailableNodes)},addAutoControlNode:function(){if("string"!=typeof this.state.newFieldName)return"";for(var e=this.state.newFieldName.replace(/[\/\.\[\]\#\$\\"'`]/g,""),t=0;t<e.length;t++)(e.charCodeAt(t)<31||127==e.charCodeAt(t))&&(e=e.slice(0,t)+e.slice(t+1),t--);e=e.trim();var a=/^\d+$/.test(e);if(""==e||a)return"";for(var i=1,n=e;this.isDuplicateControlName(n);)n=e+" "+i,i++;var s=this.onControlNodeAdd(this.currentStores.compositionControlNode,n,this.props.fieldType,this.props.fieldProperties,this.props.fieldProperties.value);this.selectDataField({sourceIndex:0,sourceKey:n,sourceKeyId:s,sourceType:"controlNode",sourceLocation:this.__getSourceLocation("<selfCompId>")}),this.getAvailableNodes()},isDuplicateControlName:function(e){if(this.currentStores.compositionControlNode){var t=this.currentStores.compositionControlNode.model;if(e&&t&&t.fields)for(var a in t.fields)if(t.fields[a]&&t.fields[a].id==e)return!0}return!1},setNewFieldName:function(e){void 0===e&&this.props.widgetName&&(e=this.props.widgetName);var t=!0;""!=e&&(t=this.isDuplicateControlName(e)),this.setState({newFieldName:e,disableAddButton:t})},onNewFieldNameChange:function(e){this.setNewFieldName(e.target.value)},handleKeyDown:function(e){if(".[]#$/\\\"'`".includes(e.key))return e.preventDefault(),void e.stopPropagation();"Enter"===e.key&&this.addAutoControlNode()},render:function(){if(!this.props.enableDataLink)return null;var e,t=function(e,t){var a;switch(e.node.type){case"dataNode":a=o().createElement("i",{className:"fa fa-database",style:{width:"15px",textAlign:"center"}});break;case"widgetNode":a=o().createElement("i",{className:"fa fa-wrench",style:{width:"15px",textAlign:"center"}});break;default:a=o().createElement("i",{className:"fa fa-gamepad",style:{width:"15px",textAlign:"center"}})}return o().createElement("li",{key:t,onClick:this.showFieldInDataNode.bind(this,e.node,!1,null)},o().createElement("a",null,a," ",e.node.name))}.bind(this),a=this.state.filterValue.trim().toLowerCase(),i=function(e,t){return""!=a&&-1===e.title.toLowerCase().indexOf(a)?null:o().createElement("li",{key:t,onClick:this.selectDataField.bind(this,e.sourceInfo)},o().createElement("a",null,e.title))}.bind(this);this.currentStores.dataLink&&this.currentStores.dataLink[this.props.nodeRefKey]?e=o().createElement("button",{type:"button",className:"btn btn-danger width160",tabIndex:"-1",onClick:this.unlinkDataField},"Unlink"):(this.state.selectedDataNode&&"controlNode"==this.state.selectedDataNode.type&&this.state.selectedDataNode.sourceLocation&&"<selfCompId>"==this.state.selectedDataNode.sourceLocation[0]&&!this.state.selectedFieldName||this.state.selectedDataNode&&void 0===this.state.selectedDataNode.item)&&!this.props.disableAddToControlNodeButton&&(e=o().createElement("div",{style:{display:"flex"}},o().createElement("input",{type:"text",style:{top:"1px",marginRight:"3px"},placeholder:"enter unique name",className:"form-control",onChange:this.onNewFieldNameChange,onKeyDown:this.handleKeyDown,value:this.state.newFieldName}),o().createElement("button",{className:"btn btn-default",style:{flex:"0 1 50px"},tabIndex:"-1",onClick:this.addAutoControlNode,disabled:this.state.disableAddButton},"Add")));var n,s,l=o().createElement("div",{className:"selector",style:{width:"250px",marginLeft:"10px"}},e),r="Select a field";this.state.selectedFieldName&&(r=this.state.selectedFieldName),n=this.state.dropDownOpen?o().createElement("input",{type:"text",className:"form-control",value:this.state.filterValue,placeholder:r,onChange:this.onFilterValueChanged,onKeyDown:this.onFilterKeyDown,style:{left:"-1px",top:"-2px",width:"calc(100% + 2px)",height:"100%",position:"absolute"},ref:"filterInputField"}):o().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},r),s=this.state.availableFields.length?o().createElement("div",{className:"selector",ref:"dropdownInput"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160 h-100","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},n,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},this.state.availableFields.map(i))):o().createElement("div",{className:"selector",ref:"dropdownInput"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160",disabled:!0,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"No fields exist",o().createElement("span",{className:"caret"})));var c,d="Select a node";return this.state.selectedNodeName&&(d=this.state.selectedNodeName),c=this.state.availableNodes.length?o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},o().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},d),o().createElement("span",{className:"caret"})):o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle width160",disabled:!0,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"No nodes exist",o().createElement("span",{className:"caret"})),o().createElement("div",{className:"row datanode-browser-inline"},o().createElement("div",{className:"col-12"},o().createElement("div",{className:"panel singular-panel"},o().createElement("div",{className:"panel-header"},"Link Browser"),o().createElement("div",{className:"panel-body",style:{display:"flex",flexDirection:"row"}},o().createElement("div",{className:"selector"},c,o().createElement("ul",{className:"dropdown-menu"},this.state.availableNodes.map(t))),s,l))))}});var Ze=a(9769);const Qe=o().createClass({displayName:"NodeRefFieldWrapper",mixins:[W.A],componentWillMount:function(){var e=this.props.nodeRefParams.params;this.sBindAsObject(e.sbCompositionRef.child("nodeRefs").child(e.sbRef.key),"nodeRef")},componentWillUnmount:function(){this.sUnbind("nodeRef")},render:function(){var e=this.props.nodeRefParams.params,t="linkable",a=Ze.genNodeRefKeyFromLocation(this.props.nodeRefParams.targetLocation);this.state.nodeRef&&this.state.nodeRef[a]&&(t="linked");var i={},n=["nodeRefParams","name","onValueChanged","children"];for(var s in this.props)n.includes(s)||(i[s]=this.props[s]);var l=o().createElement(de(),{id:"popover",className:"popover-animate-opacity"},o().createElement(Xe,{sbRef:e.sbRef,sbCompositionRef:e.sbCompositionRef,compositionStack:e.compositionStack,rootRtdbRef:e.rootRtdbRef,nodeRefKey:a,targetLocation:this.props.nodeRefParams.targetLocation,widgetName:e.sbRef.val().name,targetTitle:this.props.nodeRefParams.targetTitle?this.props.nodeRefParams.targetTitle:this.props.nodeRefParams.title,fieldType:e.fieldType,fieldProperties:i,enableDataLink:!0,disableDataNode:this.props.disableDataNode,disableAddToControlNodeButton:this.props.disableAddToControlNodeButton})),r=o().createElement(Y(),{trigger:"click",rootClose:!0,animation:!1,placement:"bottom",overlay:l},o().createElement("span",null,this.props.nodeRefParams.title)),c={};$.extend(!0,c,this.props,{disabled:"linked"==t});var d=o().cloneElement(e.inputElement,c);return o().createElement("tr",null,o().createElement("td",{className:t+" label-col"},o().createElement("span",null,r)),o().createElement("td",null,d,this.props.children))}});var et=a(97376),tt=a(9769);const at=o().createClass({displayName:"TransformProperties",mixins:[W.A,pe.A],localData:{lockSizeFactor:0},getInitialState:function(){return{}},componentWillMount:function(){this.sBindAsObject(this.props.sbRef.child("layout"),"layout")},componentDidMount:function(){var e=this;this.calculateLockSizeFactor(this.state.layout.lockSize),setTimeout(function(){e.forceUpdate()},100)},shouldComponentUpdate:function(e,t){return!1===this.props.active&&!0===e.active||this.props.editorWidth!=e.editorWidth||this.props.editorHeight!=e.editorHeight||0==tt.compareObject(this.state.layout,t.layout)||0==tt.compareObject(this.props.settings,e.settings)},render:function(){if(!1===this.props.active)return!1;var e=this.state.layout,t=tt.getParentSize(this.props.sbRef,this.props.editorWidth,this.props.editorHeight),a=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{d:"M6 8.293V1h1v7.293l.207.207L7 8.707V9h-.293L1.55 14.157l-.707-.707L6 8.293z",opacity:".3"}),o().createElement("path",{d:"M15 8.5L12 6v5l3-2.5zM6 8h6v1H6V8zm6.5-6.333L11.25 0H10l1.875 2.5L10 5h1.25l1.25-1.667L13.75 5H15l-1.875-2.5L15 0h-1.25L12.5 1.667z"}))),i=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{d:"M6.293 8H6v.293L.843 13.45l.707.707L6.707 9H14V8H6.707L6.5 7.793 6.293 8z",opacity:".3"}),o().createElement("path",{d:"M6.5 0L4 3h5L6.5 0zM6 9V3h1v6H6zm6.5-7.506L13.753 0H15l-2 2.5V5h-1V2.5L10 0h1.25l1.25 1.494z"}))),n=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{id:"svg_3",opacity:"0.3",d:"m2.87501,12.60548l0,-8.91799l1,0l0,8.91799l-1,0z",stroke:"null"}),o().createElement("path",{id:"svg_4",d:"m13.25003,3.37501l-3.16666,-2.5l0,5l3.16666,-2.5zm-3.16666,-0.5l0,1l-7.20837,0l0,-0.87501l7.20837,-0.12499z",stroke:"null"}),o().createElement("path",{id:"svg_5",d:"m9.18757,8.85438l-1.25,-1.667l-1.25,0l1.875,2.5l-1.875,2.5l1.25,0l1.25,-1.667l1.25,1.667l1.25,0l-1.875,-2.5l1.875,-2.5l-1.25,0l-1.25,1.667z"}))),s=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{id:"svg_3",opacity:"0.3",d:"m7.43748,6.54302l0,-8.91799l1,0l0,8.91799l-1,0z",stroke:"null",transform:"rotate(90 7.9374799728393555,2.084024906158448) "}),o().createElement("path",{id:"svg_4",d:"m8.25005,6.81249l-3.16666,-2.5l0,5l3.16666,-2.5zm-3.16666,-0.5l0,1l-7.20837,0l0,-0.87501l7.20837,-0.12499z",stroke:"null",transform:"rotate(90 3.062541246414184,6.812479972839356) "}),o().createElement("path",{d:"m9.25001,7.49393l1.253,-1.494l1.247,0l-2,2.5l0,2.5l-1,0l0,-2.5l-2,-2.5l1.25,0l1.25,1.494z",id:"svg_4"}))),l=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{d:"M7 8h7v1H6l1-1zM6 1h1v7L6 9V1z",opacity:".3"}),o().createElement("path",{d:"M0 15h4l-4-4v4zm6.85-6.15l-4.5 4.5-.7-.7 4.5-4.5.7.7zM15 1h-1.25L11 4h1.25L15 1zm-4-1h4v1h-4V0zm0 4h4v1h-4V4z"}))),r=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("path",{d:"M12.5 1.667L11.25 0H10l1.875 2.5L10 5h1.25l1.25-1.667L13.75 5H15l-1.875-2.5L15 0h-1.25L12.5 1.667zM2.017 9.997C2.172 12.774 3.613 15 5.502 15 7.502 15 9 12.502 9 9.5S7.502 4 5.502 4c-1.127 0-2.094.792-2.724 2.02h1.16C4.374 5.38 4.925 5 5.5 5 6.814 5 8 6.98 8 9.5S6.814 14 5.502 14c-1.225 0-2.34-1.723-2.484-4.002h1.99L2.504 7.01 0 9.998h2.017z",fill:"currentColor",fillRule:"evenodd"})),c=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("path",{d:"M12.5 1.494L13.753 0H15l-2 2.5V5h-1V2.5L10 0h1.25l1.25 1.494zm-6.502 11.49C8.773 12.827 11 11.386 11 9.497 11 7.497 8.502 6 5.5 6S0 7.498 0 9.498c0 1.127.792 2.094 2.02 2.724v-1.16C1.38 10.626 1 10.075 1 9.5 1 8.186 2.98 7 5.5 7S10 8.186 10 9.498c0 1.225-1.723 2.34-4.002 2.484v-1.99L3.01 12.496 5.998 15v-2.017z",fill:"currentColor",fillRule:"evenodd"})),d=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("path",{d:"M4.988 4.01a5.547 5.547 0 0 0-3.394 1.606c-2.125 2.125-2.125 5.666 0 7.79 2.124 2.125 5.666 2.125 7.79 0 2.054-2.053 2.125-5.24.354-7.435l-.708.71c1.346 1.77 1.346 4.32-.283 5.95-1.842 1.84-4.675 1.84-6.445.07a4.488 4.488 0 0 1 0-6.372A4.685 4.685 0 0 1 4.988 5.01v1.998l3.005-2.504L4.988 2v2.01zM15 1h-1.25L11 4h1.25L15 1zm-4-1h4v1h-4V0zm0 4h4v1h-4V4z",fill:"currentColor",fillRule:"evenodd"})),p="constrain-proportion-selector";1==e.lockSize&&(p+=" locked");var m=[{unit:"%",step:"0.1",resetValue:"0.0",format:"0.0[0]"},{unit:"px",step:"1",resetValue:"0",format:"0"}],u=[{unit:"%",step:"0.1",resetValue:"100.0",format:"0.0[0]",min:"0.0",max:"10000.0"},{unit:"px",step:"1",resetValue:"300",format:"0",min:"0",max:"10000"}],h="group"==this.props.type?"groups":"tiles",f={sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,rootRtdbRef:this.props.rootRtdbRef,fieldType:"number",inputElement:o().createElement(te.A,null)},g=null,v=null;1==(this.props.settings&&this.props.settings.perspectiveActive)?(g=o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,r," "),o().createElement("td",null,o().createElement(te.A,{name:"rotateX",resetValue:0,step:.1,format:"0.0[0]",min:-9999,max:9999,value:e.rotateX,unit:"deg",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",null,c),o().createElement("td",null,o().createElement(te.A,{name:"rotateY",resetValue:0,step:.1,format:"0.0[0]",min:-9999,max:9999,value:e.rotateY,unit:"deg",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",null,d),o().createElement("td",null,o().createElement(te.A,{name:"rotateZ",resetValue:0,step:.1,format:"0.0[0]",min:-9999,max:9999,value:e.rotateZ,unit:"deg",onValueChanged:this.PropValueChanged})))),v=o().createElement("tr",null,o().createElement("td",null,l),o().createElement("td",null,o().createElement(te.A,{name:"zPos",resetValue:0,step:1,format:"0",value:e.zPos,unit:"px",onValueChanged:this.PropValueChanged})))):g=o().createElement("tbody",null,o().createElement(Qe,{nodeRefParams:{title:d,targetTitle:"Rotate Z",params:f,targetLocation:["<selfCompId>",h,"<objId>","layout","rotateZ"]},name:"rotateZ",resetValue:0,step:.1,format:"0.0[0]",min:-9999,max:9999,value:e.rotateZ,unit:"deg",onValueChanged:this.PropValueChanged}));var b="",y="";return t&&(b=Math.round(e.left*t.width/100)+" x "+Math.round(e.top*t.height/100)+" px",y=Math.round(e.width*t.width/100)+" x "+Math.round(e.height*t.height/100)+" px"),o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"position")}),o().createElement("span",{className:"panel-label",style:{width:"calc(100% - 35px)",display:"flex",justifyContent:"space-between"}},o().createElement("span",null,"Position"),o().createElement("span",null,b))),o().createElement("table",{className:"singular-form"},o().createElement("tbody",null,o().createElement(Qe,{nodeRefParams:{title:n,targetTitle:"Position X",params:f,targetLocation:["<selfCompId>",h,"<objId>","layout","left"]},name:"left",resetValue:0,step:1,format:"0.0",unitCollection:m,value:e.left,unitName:"leftUnit",pixelValue:null==t?void 0:t.width,unit:e.leftUnit,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:s,targetTitle:"Position Y",params:f,targetLocation:["<selfCompId>",h,"<objId>","layout","top"]},name:"top",resetValue:0,step:1,format:"0.0",unitCollection:m,value:e.top,unitName:"topUnit",pixelValue:null==t?void 0:t.height,unit:e.topUnit,onValueChanged:this.PropValueChanged}),v)))),o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"size")}),o().createElement("span",{className:"panel-label",style:{width:"calc(100% - 35px)",display:"flex",justifyContent:"space-between"}},o().createElement("span",null,"Size"),o().createElement("span",null,y))),o().createElement("table",{className:"singular-form"},o().createElement("tbody",null,o().createElement(Qe,{nodeRefParams:{title:a,targetTitle:"Width",params:f,targetLocation:["<selfCompId>",h,"<objId>","layout","width"]},name:"width",resetValue:100,step:.1,format:"0.0[0]",unitCollection:u,min:0,max:1e4,value:e.width,unitName:"widthUnit",pixelValue:null==t?void 0:t.width,unit:e.widthUnit,onValueChanged:this.SizeValueChanged}),o().createElement(Qe,{nodeRefParams:{title:i,targetTitle:"Height",params:f,targetLocation:["<selfCompId>",h,"<objId>","layout","height"]},name:"height",resetValue:100,step:.1,format:"0.0[0]",unitCollection:u,min:0,max:1e4,value:e.height,unitName:"heightUnit",pixelValue:null==t?void 0:t.height,unit:e.heightUnit,onValueChanged:this.SizeValueChanged},o().createElement("div",{onClick:this.lockSizeClicked,className:p,style:{right:"0px"}})))))),o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"rotation")}),o().createElement("span",{className:"panel-label"},"Rotation")),o().createElement("table",{className:"singular-form"},g))),o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"anchor")}),o().createElement("span",{className:"panel-label"},"Anchor Point")),o().createElement("table",null,o().createElement("tbody",null,o().createElement(Ke,{name:"anchor",resetValue:{x:50,y:50},value:e.anchor,onValueChanged:this.AnchorValueChanged,renderInline:!0}))))))},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");if(t)switch(e){case"position":this.props.sbRef.child("layout").update({left:t.left,leftUnit:t.leftUnit,top:t.top,topUnit:t.topUnit,zPos:t.zPos});break;case"rotation":this.props.sbRef.child("layout").update({rotateX:t.rotateX,rotateY:t.rotateY,rotateZ:t.rotateZ});break;case"size":this.props.sbRef.child("layout").update({width:t.width,widthUnit:t.widthUnit,height:t.height,heightUnit:t.heightUnit,lockSize:t.lockSize}),this.calculateLockSizeFactor(t.lockSize,t.width,t.height);break;case"anchor":this.props.sbRef.child("layout").update({anchor:t.anchor})}},PropValueChanged:function(e,t){tt.compareObject(this.props.sbRef.child("layout").child(e).val(),t)||this.props.sbRef.child("layout").child(e).set(t)},SizeValueChanged:function(e,t,a){if(1==this.state.layout.lockSize&&("heightUnit"==e||"widthUnit"==e))return(n={}).heightUnit=t,n.widthUnit=t,void this.props.sbRef.child("layout").update(n);if(1==this.state.layout.lockSize&&("height"==e||"width"==e)){var i=Number(t);if(t===this.state.layout[e])return;var n={};return"width"==e?(0==this.localData.lockSizeFactor?n.height=i:n.height=M()(i/this.localData.lockSizeFactor).format(a.toString()),n.width=t):(0==this.localData.lockSizeFactor?n.width=i:n.width=M()(i*this.localData.lockSizeFactor).format(a.toString()),n.height=t),void this.props.sbRef.child("layout").update(n)}this.props.sbRef.child("layout").child(e).set(t)},lockSizeClicked:function(){var e={};e.lockSize=!this.state.layout.lockSize,1==e.lockSize&&(e.heightUnit=this.state.layout.widthUnit),this.props.sbRef.child("layout").update(e),this.calculateLockSizeFactor(e.lockSize)},calculateLockSizeFactor:function(e,t,a){void 0===t&&(t=this.state.layout.width),null==a&&(a=this.state.layout.height),0==e||0==Number(a)?this.localData.lockSizeFactor=0:this.localData.lockSizeFactor=Number(t)/Number(a)*1},AnchorValueChanged:function(e,t){var a={},i=0,n=0,s=Number(this.state.layout.width);this.state.layout.widthUnit;var o=Number(this.state.layout.height);this.state.layout.heightUnit,this.state.layout.anchor.x!=t.x&&(i=(Number(this.state.layout.anchor.x)-t.x)*(100-s)/100),this.state.layout.anchor.y!=t.y&&(n=(Number(this.state.layout.anchor.y)-t.y)*(100-o)/100),this.state.layout.leftUnit,this.state.layout.topUnit,a.left=Number(this.state.layout.left)+i,a.top=Number(this.state.layout.top)+n,a.anchor=t;var l=this.props.sbRef.child("layout").val();tt.compareObject(l.anchor,a.anchor)&&l.left==a.left&&l.top==a.top||this.props.sbRef.child("layout").update(a)}});var it=a(31486),nt=(a(92643),a(9769)),st=a(57437);const ot=o().createClass({displayName:"EffectProperties",mixins:[W.A,pe.A],localData:{lockSizeFactor:0},getInitialState:function(){return{}},componentWillMount:function(){this.sBindAsObject(this.props.sbRef.child("layout"),"layout")},componentDidMount:function(){this.calculateLockScaleFactor(this.state.layout.lockScale)},shouldComponentUpdate:function(e,t){return!nt.compareObject(t,this.state)||!nt.compareObject(e,this.props)},render:function(){if(!1===this.props.active)return!1;var e=this.state.layout,t="constrain-proportion-selector";1==e.lockScale&&(t+=" locked");var a,i,n=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{d:"M6 8.293V1h1v7.293l.207.207L7 8.707V9h-.293L1.55 14.157l-.707-.707L6 8.293z",opacity:".3"}),o().createElement("path",{d:"M15 8.5L12 6v5l3-2.5zM6 8h6v1H6V8zm6.5-6.333L11.25 0H10l1.875 2.5L10 5h1.25l1.25-1.667L13.75 5H15l-1.875-2.5L15 0h-1.25L12.5 1.667z"}))),s=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{d:"M6.293 8H6v.293L.843 13.45l.707.707L6.707 9H14V8H6.707L6.5 7.793 6.293 8z",opacity:".3"}),o().createElement("path",{d:"M6.5 0L4 3h5L6.5 0zM6 9V3h1v6H6zm6.5-7.506L13.753 0H15l-2 2.5V5h-1V2.5L10 0h1.25l1.25 1.494z"}))),l=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{id:"svg_3",opacity:"0.3",d:"m2.87501,12.60548l0,-8.91799l1,0l0,8.91799l-1,0z",stroke:"null"}),o().createElement("path",{id:"svg_4",d:"m13.25003,3.37501l-3.16666,-2.5l0,5l3.16666,-2.5zm-3.16666,-0.5l0,1l-7.20837,0l0,-0.87501l7.20837,-0.12499z",stroke:"null"}),o().createElement("path",{id:"svg_5",d:"m9.18757,8.85438l-1.25,-1.667l-1.25,0l1.875,2.5l-1.875,2.5l1.25,0l1.25,-1.667l1.25,1.667l1.25,0l-1.875,-2.5l1.875,-2.5l-1.25,0l-1.25,1.667z"}))),r=o().createElement("svg",{width:"15",height:"15",viewBox:"0 0 15 15",className:"svg-label"},o().createElement("g",{fill:"currentColor",fillRule:"evenodd"},o().createElement("path",{id:"svg_3",opacity:"0.3",d:"m7.43748,6.54302l0,-8.91799l1,0l0,8.91799l-1,0z",stroke:"null",transform:"rotate(90 7.9374799728393555,2.084024906158448) "}),o().createElement("path",{id:"svg_4",d:"m8.25005,6.81249l-3.16666,-2.5l0,5l3.16666,-2.5zm-3.16666,-0.5l0,1l-7.20837,0l0,-0.87501l7.20837,-0.12499z",stroke:"null",transform:"rotate(90 3.062541246414184,6.812479972839356) "}),o().createElement("path",{d:"m9.25001,7.49393l1.253,-1.494l1.247,0l-2,2.5l0,2.5l-1,0l0,-2.5l-2,-2.5l1.25,0l1.25,1.494z",id:"svg_4"})));if(this.props.styles&&this.props.styles.length){var c=[{id:"",title:"No styles"}].concat(this.props.styles);a=o().createElement("tr",null,o().createElement("td",null,"Style"),o().createElement("td",null,o().createElement(ae.A,{key:"Style",name:"style",selections:c,value:this.props.item.style,onValueChanged:this.styleValueChanged})))}if("group"==this.props.type){var d=!1;void 0!==e.groupClipChildren&&(d=e.groupClipChildren);var p=!0;void 0!==e.groupBorderRadiusMode&&(p=e.groupBorderRadiusMode);var m=0,u=0,h=0,f=0;void 0!==e.groupBorderRadiusValueTL&&(m=e.groupBorderRadiusValueTL),void 0!==e.groupBorderRadiusValueTR&&(u=e.groupBorderRadiusValueTR),void 0!==e.groupBorderRadiusValueBL&&(h=e.groupBorderRadiusValueBL),void 0!==e.groupBorderRadiusValueBR&&(f=e.groupBorderRadiusValueBR);var g,v=!0;d&&(v=!1),g=p?o().createElement("div",null,o().createElement(te.A,{name:"groupBorderRadiusValueTL",resetValue:0,step:.1,unit:"%",format:"0.0",min:0,max:100,value:m,showSlider:!1,onValueChanged:this.BorderChanged,disabled:v})):o().createElement("div",null,o().createElement("div",{className:"border-field-icon"},o().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{opacity:".4",fillRule:"evenodd",clipRule:"evenodd",d:"M9 2h5v5h-2V4H9V2zm3 7h2v5H9v-2h3V9zM2 14V9h2v3h3v2H2z",fill:"currentColor"}),o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 2a3 3 0 0 0-3 3v2h2V5a1 1 0 0 1 1-1h2V2H5z",fill:"currentColor"})),o().createElement(te.A,{name:"groupBorderRadiusValueTL",resetValue:0,step:.1,unit:"%",format:"0.0",min:0,max:100,value:m,showSlider:!1,onValueChanged:this.BorderChanged,disabled:v})),o().createElement("div",{className:"border-field-icon"},o().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{opacity:".4",fillRule:"evenodd",clipRule:"evenodd",d:"M14 9v5H9v-2h3V9h2zm-7 3v2H2V9h2v3h3zM2 2h5v2H4v3H2V2z",fill:"currentColor"}),o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14 5a3 3 0 0 0-3-3H9v2h2a1 1 0 0 1 1 1v2h2V5z",fill:"currentColor"})),o().createElement(te.A,{name:"groupBorderRadiusValueTR",resetValue:0,step:.1,unit:"%",format:"0.0",min:0,max:100,value:u,showSlider:!1,onValueChanged:this.BorderChanged,disabled:v})),o().createElement("div",{className:"border-field-icon"},o().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{opacity:".4",fillRule:"evenodd",clipRule:"evenodd",d:"M7 14H2V9h2v3h3v2zM4 7H2V2h5v2H4v3zm10-5v5h-2V4H9V2h5z",fill:"currentColor"}),o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 14a3 3 0 0 0 3-3V9h-2v2a1 1 0 0 1-1 1H9v2h2z",fill:"currentColor"})),o().createElement(te.A,{name:"groupBorderRadiusValueBL",resetValue:0,step:.1,unit:"%",format:"0.0",min:0,max:100,value:h,showSlider:!1,onValueChanged:this.BorderChanged,disabled:v})),o().createElement("div",{className:"border-field-icon"},o().createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",style:{display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{opacity:".4",fillRule:"evenodd",clipRule:"evenodd",d:"M2 7V2h5v2H4v3H2zm7-3V2h5v5h-2V4H9zm5 10H9v-2h3V9h2v5z",fill:"currentColor"}),o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 11a3 3 0 0 0 3 3h2v-2H5a1 1 0 0 1-1-1V9H2v2z",fill:"currentColor"})),o().createElement(te.A,{name:"groupBorderRadiusValueBR",resetValue:0,step:.1,unit:"%",format:"0.0",min:0,max:100,value:f,showSlider:!1,onValueChanged:this.BorderChanged,disabled:v})));var b={display:"grid",gridTemplateColumns:"auto auto auto",gridGap:"5px"};v&&(b.pointerEvents="none"),i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Clip Children"),o().createElement("td",null,o().createElement(se.A,{name:"groupClipChildren",value:d,onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"top",paddingTop:"8px"}},"Border Radius"),o().createElement("td",null,o().createElement("div",{className:"border-radius",style:b,disabled:v},o().createElement("div",{style:{paddingTop:"8px"},className:"border-property-toggle"},o().createElement("svg",{onClick:this.PropValueChanged.bind(this,"groupBorderRadiusMode",!0),width:"16",height:"16",viewBox:"0 0 16 16",className:"border-radius-icon",style:{color:p&&!v?"rgb(235, 235, 235)":"rgb(115, 115, 115)",display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 2a3 3 0 0 0-3 3v6a3 3 0 0 0 3 3h6a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H5zm0 2a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H5z",fill:"currentColor"}))),o().createElement("div",{style:{paddingTop:"8px"},className:"border-property-toggle"},o().createElement("svg",{onClick:this.PropValueChanged.bind(this,"groupBorderRadiusMode",!1),width:"16",height:"16",viewBox:"0 0 16 16",className:"border-radius-icon",style:{color:p||v?"rgb(115, 115, 115)":"rgb(235, 235, 235)",display:"block",transform:"translate(0px, 0px)"}},o().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 2a3 3 0 0 0-3 3v2h2V5a1 1 0 0 1 1-1h2V2H5zm6 0a3 3 0 0 1 3 3v2h-2V5a1 1 0 0 0-1-1H9V2h2zM5 14a3 3 0 0 1-3-3V9h2v2a1 1 0 0 0 1 1h2v2H5zm6 0a3 3 0 0 0 3-3V9h-2v2a1 1 0 0 1-1 1H9v2h2z",fill:"currentColor"}))),g)))))}var y,E,w=!0,S=this.props.settings;if(void 0!==S&&void 0!==S.perspectiveActive&&0!=S.perspectiveActive||(w=!1),1==w){var N=!1;void 0!==e.backfaceVisibility&&(N=e.backfaceVisibility),y=o().createElement("tr",null,o().createElement("td",null,"Backface Visibility"),o().createElement("td",null,o().createElement(se.A,{name:"backfaceVisibility",value:N,onValueChanged:this.PropValueChanged})))}(y||a||i)&&(E=o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"renderOptions")}),o().createElement("span",{className:"panel-label"},"Render Options")),o().createElement("table",null,o().createElement("tbody",null,a,y)),i)));var C=st.opacity,x=st.filterBlur,I=st.filterBrightness,k=st.filterContrast,D=st.filterGrayscale,A=st.filterHueRotate,R=st.filterInvert,P=st.filterSaturate,T=st.filterSepia,M=st.filterDropShadowMode,O=st.filterDropShadowX,L=st.filterDropShadowY,V=st.filterDropShadowBlur,_=st.filterDropShadowSpread,F=st.filterDropShadowColor,B=st.filterDropShadowInset;void 0!==e.opacity&&(C=e.opacity),void 0!==e.filterBlur&&(x=e.filterBlur),void 0!==e.filterBrightness&&(I=e.filterBrightness),void 0!==e.filterContrast&&(k=e.filterContrast),void 0!==e.filterGrayscale&&(D=e.filterGrayscale),void 0!==e.filterHueRotate&&(A=e.filterHueRotate),void 0!==e.filterInvert&&(R=e.filterInvert),void 0!==e.filterSepia&&(T=e.filterSepia),void 0!==e.filterSaturate&&(P=e.filterSaturate),void 0!==e.filterDropShadowMode&&(M=e.filterDropShadowMode),void 0!==e.filterDropShadowX&&(O=e.filterDropShadowX),void 0!==e.filterDropShadowY&&(L=e.filterDropShadowY),void 0!==e.filterDropShadowBlur&&(V=e.filterDropShadowBlur),void 0!==e.filterDropShadowSpread&&(_=e.filterDropShadowSpread),void 0!==e.filterDropShadowColor&&(F=e.filterDropShadowColor),void 0!==e.filterDropShadowInset&&(B=e.filterDropShadowInset);var U="drop"==M,W="none"==M,j="group"==this.props.type?"groups":"tiles",Y={sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,rootRtdbRef:this.props.rootRtdbRef,fieldType:"number",inputElement:o().createElement(te.A,null)};return o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"shadow")}),o().createElement("span",{className:"panel-label"},"Shadow")),o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Type"),o().createElement("td",null,o().createElement(ae.A,{name:"filterDropShadowMode",selections:[{id:"none",title:"None"},{id:"box",title:"Box Shadow"},{id:"drop",title:"Drop Shadow"}],value:M,onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",null,l),o().createElement("td",null,o().createElement(te.A,{name:"filterDropShadowX",resetValue:0,step:1,unit:"px",format:"0",min:-100,max:100,value:O,showSlider:!1,onValueChanged:this.PropValueChanged,disabled:W}))),o().createElement("tr",null,o().createElement("td",null,r),o().createElement("td",null,o().createElement(te.A,{name:"filterDropShadowY",resetValue:0,step:1,unit:"px",format:"0",min:-100,max:100,value:L,showSlider:!1,onValueChanged:this.PropValueChanged,disabled:W}))),o().createElement("tr",null,o().createElement("td",null,"Blur"),o().createElement("td",null,o().createElement(te.A,{name:"filterDropShadowBlur",resetValue:0,step:1,unit:"px",format:"0",min:0,max:100,value:V,showSlider:!1,onValueChanged:this.PropValueChanged,disabled:W}))),o().createElement("tr",null,o().createElement("td",null,"Spread"),o().createElement("td",null,o().createElement(te.A,{name:"filterDropShadowSpread",resetValue:0,step:1,unit:"px",format:"0",min:-50,max:50,value:_,showSlider:!1,onValueChanged:this.PropValueChanged,disabled:W||U}))),o().createElement("tr",null,o().createElement("td",null,"Color"),o().createElement("td",null,o().createElement(it.A,{name:"filterDropShadowColor",value:F,onValueChanged:this.PropValueChanged,disabled:W}))),o().createElement("tr",null,o().createElement("td",null,"Inset"),o().createElement("td",null,o().createElement(se.A,{name:"filterDropShadowInset",value:B,onValueChanged:this.PropValueChanged,disabled:W||U}))))))),o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"filters")}),o().createElement("span",{className:"panel-label"},"Filters")),o().createElement("table",{className:"singular-form"},o().createElement("tbody",null,o().createElement(Qe,{nodeRefParams:{title:"Visibility",params:{sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,rootRtdbRef:this.props.rootRtdbRef,fieldType:"checkbox",inputElement:o().createElement(se.A,null)},targetLocation:["<selfCompId>",j,"<objId>","layout","visible"]},name:"visible",value:this.state.layout.visible,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Opacity",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","opacity"]},name:"opacity",resetValue:100,step:1,unit:"%",format:"0.0",min:0,max:100,value:C,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Brightness",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterBrightness"]},name:"filterBrightness",resetValue:100,step:1,unit:"%",format:"0.0",min:0,max:200,value:I,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Blur",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterBlur"]},name:"filterBlur",resetValue:0,step:1,unit:"px",format:"0",min:0,max:300,value:x,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Contrast",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterContrast"]},name:"filterContrast",resetValue:100,step:1,unit:"%",format:"0.0",min:0,max:200,value:k,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Grayscale",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterGrayscale"]},name:"filterGrayscale",resetValue:0,step:1,unit:"%",format:"0.0",min:0,max:100,value:D,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Hue",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterHueRotate"]},name:"filterHueRotate",resetValue:0,step:1,unit:"deg",format:"0.0",min:0,max:360,value:A,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Invert",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterInvert"]},name:"filterInvert",resetValue:0,step:1,unit:"%",format:"0.0",min:0,max:100,value:R,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Saturate",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterSaturate"]},name:"filterSaturate",resetValue:100,step:1,unit:"%",format:"0.0",min:0,max:500,value:P,showSlider:!1,onValueChanged:this.PropValueChanged}),o().createElement(Qe,{nodeRefParams:{title:"Sepia",params:Y,targetLocation:["<selfCompId>",j,"<objId>","layout","filterSepia"]},name:"filterSepia",resetValue:0,step:1,unit:"%",format:"0.0",min:0,max:100,value:T,showSlider:!1,onValueChanged:this.PropValueChanged}),void 0)))),o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"scale")}),o().createElement("span",{className:"panel-label"},"Scale")),o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,n),o().createElement("td",null,o().createElement(te.A,{name:"scaleX",resetValue:100,step:1,format:"0.0",min:-1e4,max:1e4,value:e.scaleX,unit:"%",onValueChanged:this.ScaleValueChanged}))),o().createElement("tr",null,o().createElement("td",null,s),o().createElement("td",null,o().createElement(te.A,{name:"scaleY",resetValue:100,step:1,format:"0.0",min:-1e4,max:1e4,value:e.scaleY,unit:"%",onValueChanged:this.ScaleValueChanged}),o().createElement("div",{onClick:this.lockScaleClicked,className:t}))))))),o().createElement("div",{className:"panel panel-default panel-element narrow grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"skew")}),o().createElement("span",{className:"panel-label"},"Skew")),o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,n),o().createElement("td",null,o().createElement(te.A,{name:"skewX",resetValue:0,step:1,format:"0.0",min:-89.9,max:89.9,value:e.skewX,unit:"deg",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",null,s),o().createElement("td",null,o().createElement(te.A,{name:"skewY",resetValue:0,step:1,format:"0.0",min:-89.9,max:89.9,value:e.skewY,unit:"deg",onValueChanged:this.PropValueChanged}))))))),void 0,E)},PropValueChanged:function(e,t){nt.compareObject(this.props.sbRef.child("layout").child(e).val(),t)||this.props.sbRef.child("layout").child(e).set(t)},BorderChanged:function(e,t){if("group"==this.props.type)if(void 0===this.state.layout.groupBorderRadiusMode||1==this.state.layout.groupBorderRadiusMode){var a={groupBorderRadiusMode:!0};a.groupBorderRadiusValueTL=t,a.groupBorderRadiusValueTR=t,a.groupBorderRadiusValueBL=t,a.groupBorderRadiusValueBR=t,this.props.sbRef.child("layout").update(a)}else this.props.sbRef.child("layout").child(e).set(t)},MaskValueChanged:function(e,t){var a={};null==this.state.layout.mask?(a.mask={},a.mask[e]=t,this.props.sbRef.child("layout").update(a)):(a[e]=t,this.props.sbRef.child("layout").child("mask").update(a))},styleValueChanged:function(e,t){this.props.sbRef.child("style").set(t)},ScaleValueChanged:function(e,t,a){if(1!=this.state.layout.lockScale||"scaleX"!=e&&"scaleY"!=e)this.props.sbRef.child("layout").child(e).set(t);else{var i=Number(t);if(t===this.state.layout[e])return;var n={};"scaleX"==e?(0==this.localData.lockScaleFactor?n.scaleY=i:n.scaleY=M()(i/this.localData.lockScaleFactor).format(a.toString()),n.scaleX=t):(0==this.localData.lockScaleFactor?n.scaleX=i:n.scaleX=M()(i*this.localData.lockScaleFactor).format(a.toString()),n.scaleY=t),this.props.sbRef.child("layout").update(n)}},lockScaleClicked:function(){var e=!this.state.layout.lockScale;this.props.sbRef.child("layout").child("lockScale").set(e),this.calculateLockScaleFactor(e)},calculateLockScaleFactor:function(e,t,a){void 0===t&&(t=this.state.layout.scaleX),null==a&&(a=this.state.layout.scaleY),0==e||0==Number(t)?this.localData.lockScaleFactor=0:this.localData.lockScaleFactor=Number(t)/Number(a)*1},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");if(t){var a={},i=function(e){void 0!==t[e]&&(a[e]=t[e])};switch(e){case"shadow":i("filterDropShadowMode"),i("filterDropShadowX"),i("filterDropShadowY"),i("filterDropShadowBlur"),i("filterDropShadowSpread"),i("filterDropShadowColor"),i("filterDropShadowInset");break;case"filters":i("visible"),i("opacity"),i("filterBlur"),i("filterBrightness"),i("filterContrast"),i("filterGrayscale"),i("filterHueRotate"),i("filterInvert"),i("filterSepia"),i("filterSaturate"),i("blendMode");break;case"scale":this.props.sbRef.child("layout").update({lockScale:t.lockScale,scaleX:t.scaleX,scaleY:t.scaleY}),this.calculateLockScaleFactor(t.lockScale,t.scaleX,t.scaleY);break;case"skew":this.props.sbRef.child("layout").update({skewX:t.skewX,skewY:t.skewY});break;case"renderOptions":i("backfaceVisibility"),i("groupClipChildren"),i("style"),i("groupBorderRadiusMode"),i("groupBorderRadiusValueTL"),i("groupBorderRadiusValueTR"),i("groupBorderRadiusValueBL"),i("groupBorderRadiusValueBR");break;default:return}0!=Object.entries(a).length&&this.props.sbRef.child("layout").update(a)}}});var lt=a(2774);function rt(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return ct(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ct(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw s}}}}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var dt=a(75348),pt=a(9769);const mt=o().createClass({displayName:"EventProperties",mixins:[W.A,pe.A],getInitialState:function(){return{layout:null,event:null,filteredProperty:[],properyInMenuIndex:0,selectedEvent:null,compTree:null}},getSubCompTreeData:function(e,t){if(!e[t])return[];var a={comp:e[t],tile:{name:"Root"},id:t},i=[];return this.getSubCompTreeDataEx(e,a,i),i},getSubCompTreeDataEx:function(e,t,a){var i=t.comp,n=t.tile;if((i||n.widgetCompInfo)&&(!i&&n.widgetCompInfo&&(i=e[n.widgetCompInfo.id]),i)){var s=[];i.groups&&(s=Object.keys(i.groups)).sort(function(e,t){return e.priority-t.priority-.5});var o=[];if(s.forEach(function(e){var t=i.groups[e].items;if(t){var a=Object.keys(t);a.sort(function(e,a){return t[e].priority-t[a].priority-.5}),i.tiles&&a.forEach(function(e){var t=i.tiles[e];t&&"composition"==t.type&&o.push(t)})}}),!(i.settings&&i.settings.linkTimeline||n.widgetCompInfo)){var l=[];o.forEach(function(t){l.push({comp:e[t.id],tile:t,id:t.id})});var r=[];l.forEach(function(t){this.getSubCompTreeDataEx(e,t,r)}.bind(this)),a.push({name:n.name,id:t.id,children:r})}}},updateEditor:function(e){var t,a;e.val()&&(a=e.val(),t=a.events),t||(t={});var i=this.getSubCompTreeData(this.props.sbAllCompsRef.val(),this.props.sbRootCompRef.key);this.setState({compTree:i});var n=[];dt.EVENT_SELECTION.map(function(e,a){t[e.id]||n.push(e)}),(-1==this.state.properyInMenuIndex||this.state.properyInMenuIndex>=n.length)&&this.setState({properyInMenuIndex:0});var s=this.state.selectedEvent;if(!t[s]){var o=Object.keys(t);"cursor"==(s=o[0])&&(s=o[1])}this.setState({filteredProperty:n,layout:a,event:t,selectedEvent:s})},componentWillMount:function(){this.props.sbRef.child("layout").on("value",this.updateEditor)},componentWillUnmount:function(){this.props.sbRef.child("layout").off("value",this.updateEditor)},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!1===this.props.active&&!0===e.active||0==pt.compareObject(this.props,e)||0==pt.compareObject(this.state,t)},render:function(){if(!1===this.props.active)return!1;var e,t,a,i,n,s=function(e,t){return o().createElement("li",{key:"property-"+t},o().createElement("a",{onClick:this.menuPropertyChanged.bind(this,t)},e.title))}.bind(this),l=function(e,t){return o().createElement("li",{key:"line"+t,className:this.state.selectedEvent==e?"active":""},o().createElement(se.A,{name:"active",value:this.state.event[e].active,onValueChanged:this.propertyChanged.bind(this,e)}),o().createElement("span",{onClick:this.selectEvent.bind(this,e)},pt.getTitleFromSelection(dt.EVENT_SELECTION,e)),o().createElement("i",{className:"fa fa-times-circle btn-delete",onClick:this.deleteEvent.bind(this,e)}))}.bind(this),r="None",c=!0;if(-1!=this.state.properyInMenuIndex&&this.state.filteredProperty.length>0&&(r=this.state.filteredProperty[this.state.properyInMenuIndex].title,c=!1),this.state.selectedEvent){var d=function(e,t){return o().createElement("li",{key:"mode-"+t},o().createElement("a",{onClick:this.propertyChanged.bind(this,this.state.selectedEvent,"controlMode",e.id)},e.title))}.bind(this),p=function(e,t){var a;return e.children&&(a=o().createElement("ul",{className:"sub-menu"},e.children.map(p))),o().createElement("li",{key:"comp-"+t},o().createElement("a",{onClick:this.propertyChanged.bind(this,this.state.selectedEvent,"controlComp",e.id)},e.name),a)}.bind(this),m=this.state.event[this.state.selectedEvent],u=!0;m.messageActive&&(u=!1);var h=!0;m.controlActive&&(h=!1),e=o().createElement("table",{style:{width:"100%"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"999"},o().createElement("h3",{style:{marginLeft:"-5px"}},"Send Message to Composition Script",o().createElement("div",{className:"group-panel-options pull-right"},o().createElement("span",null,"Active"),o().createElement(se.A,{name:"messageActive",value:m.messageActive,onValueChanged:this.propertyChanged.bind(this,this.state.selectedEvent)}))))),o().createElement("tr",{style:{height:"45px"}},o().createElement("td",null,"Info"),o().createElement("td",null,o().createElement(lt.A,{name:"messageInfo",value:m.messageInfo,disabled:u,onValueChanged:this.propertyChanged.bind(this,this.state.selectedEvent)}))),o().createElement("tr",null,o().createElement("td",{colSpan:"999"},o().createElement("h3",{style:{marginLeft:"-5px"}},"Control Sub-Composition",o().createElement("div",{className:"group-panel-options pull-right"},o().createElement("span",null,"Active"),o().createElement(se.A,{name:"controlActive",value:m.controlActive,onValueChanged:this.propertyChanged.bind(this,this.state.selectedEvent)}))))),o().createElement("tr",{style:{height:"45px"}},o().createElement("td",null,"Composition"),o().createElement("td",null,o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:h},o().createElement("div",{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},(t=this.state.compTree,a=m.controlComp,i=null,n=function(e,t){e.forEach(function(e){if(!i){if(e.id!=t)return e.children?n(e.children,t):void 0;i=e.name}})},t&&n(t,a),i||"Select"))),o().createElement("ul",{className:"dropdown-menu nested"},this.state.compTree.map(p))))),o().createElement("tr",{style:{height:"45px"}},o().createElement("td",null,"Mode"),o().createElement("td",null,o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:h},pt.getTitleFromSelection(dt.CONTROL_MODE_SELECTION,m.controlMode)),o().createElement("ul",{className:"dropdown-menu"},dt.CONTROL_MODE_SELECTION.map(d)))))))}var f=function(e,t){return o().createElement("li",{key:"property-"+t},o().createElement("a",{onClick:this.mouseCursorPropertyChanged.bind(this,e.id)},e.title))}.bind(this),g="Default";if(this.state.event.cursor){var v,b=rt(dt.MOUSE_CURSORS);try{for(b.s();!(v=b.n()).done;){var y=v.value;if(y.id==this.state.event.cursor){g=y.title;break}}}catch(e){b.e(e)}finally{b.f()}}var E,w=!pt.isInteractivityEnabled(this.state.layout),S=[],N=rt(dt.EVENT_SELECTION);try{for(N.s();!(E=N.n()).done;){var C=E.value;this.state.event[C.id]&&S.push(C.id)}}catch(e){N.e(e)}finally{N.f()}return o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"events")}),o().createElement("span",{className:"panel-label"},"Event")),o().createElement("div",{className:"",style:{margin:"0px",display:"flex",float:"left"}},o().createElement("div",{className:"",style:{padding:"0px",display:"flex"}},o().createElement("div",{className:"panel panel-default grouped-properties behavior-list"},o().createElement("div",{className:"input-group",style:{marginBottom:"5px"}},o().createElement("div",{className:"input-group-btn"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle",style:{width:"120px"},"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:c},r,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},this.state.filteredProperty.map(s)),o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-primary",onClick:this.addEvent,disabled:c,style:{height:"29px"}},"Add"))),o().createElement("ul",{style:{height:"300px",overflow:"auto"}},S.map(l)))),o().createElement("div",{className:"",style:{display:"flex"}},o().createElement("div",{className:"panel panel-default grouped-properties behavior-properties",style:{width:"300px"}},e))))),o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"miscellaneous")}),o().createElement("span",{className:"panel-label"},"Miscellaneous")),o().createElement("div",{className:"",style:{margin:"0px",display:"flex"}},o().createElement("div",{className:"",style:{padding:"0px",display:"flex"}},o().createElement("table",{style:{width:"100%"}},o().createElement("tbody",null,o().createElement("tr",{style:{height:"45px"}},o().createElement("td",null,"Mouse Pointer"),o().createElement("td",null,o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle",style:{width:"120px"},"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:w},g,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},dt.MOUSE_CURSORS.map(f))))))))))))},updateEventObject:function(e){this.props.sbRef.child("layout").child("events").set(e)},menuPropertyChanged:function(e){this.setState({properyInMenuIndex:e})},mouseCursorPropertyChanged:function(e){var t={};$.extend(!0,t,this.state.event),t.cursor=e,this.updateEventObject(t)},addEvent:function(){if(-1!=this.state.properyInMenuIndex&&null!=this.state.filteredProperty[this.state.properyInMenuIndex]){var e=this.state.filteredProperty[this.state.properyInMenuIndex].id,t={};$.extend(!0,t,this.state.event),t[e]={active:!0,messageActive:!0,messageInfo:"",controlActive:!1,controlComp:null,controlMode:"toggle"},this.updateEventObject(t)}},deleteEvent:function(e){var t={};$.extend(!0,t,this.state.event),delete t[e],this.updateEventObject(t)},selectEvent:function(e){this.setState({selectedEvent:e})},propertyChanged:function(e,t,a){var i={};$.extend(!0,i,this.state.event),i[e][t]=a,this.updateEventObject(i)},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");if(t){if("events"==e)if(t.events){var a=Object.assign({},t.events);delete a.cursor,this.props.sbRef.child("layout").child("events").set(a)}else this.props.sbRef.child("layout").child("events").remove();if("miscellaneous"==e&&t.events){var i={cursor:t.events.cursor};this.props.sbRef.child("layout").child("events").set(i)}}}});function ut(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return ht(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ht(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw s}}}}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var ft=a(87567),gt=a(9769);const vt=o().createClass({displayName:"AdaptationProperties",mixins:[W.A,pe.A],getInitialState:function(){return{layout:null,adaptation:null,filteredProperty:[],properyInMenuIndex:0}},updateEditor:function(e){var t,a;e.val()&&(a=e.val(),t=a.adaptations),t||(t={});var i=[];ft.ADAPTATION_SELECTION.map(function(e){t[e.id]||i.push(e)}),(-1==this.state.properyInMenuIndex||this.state.properyInMenuIndex>=i.length)&&this.setState({properyInMenuIndex:0}),this.setState({filteredProperty:i,layout:a,adaptation:t})},componentWillMount:function(){this.props.sbRef.child("layout").on("value",this.updateEditor)},componentWillUnmount:function(){this.props.sbRef.child("layout").off("value",this.updateEditor)},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!1===this.props.active&&!0===e.active||0==gt.compareObject(this.props,e)||0==gt.compareObject(this.state,t)},updateAdaptationObject:function(e){this.props.sbRef.child("layout").child("adaptations").set(e)},menuPropertyChanged:function(e){this.setState({properyInMenuIndex:e})},addAdaptation:function(){if(-1!=this.state.properyInMenuIndex&&null!=this.state.filteredProperty[this.state.properyInMenuIndex]){var e=this.state.filteredProperty[this.state.properyInMenuIndex].id,t={active:!0};switch(e){case"interactive":t.value={},ft.ADAPTATION_INTERACTIVE.map(function(e){t.value[e.id]=!0});break;case"screenSize":t.value={},ft.ADAPTATION_SCREEN_SIZES.map(function(e){t.value[e.id]=!0});break;case"layout":t.value={},ft.ADAPTATION_LAYOUTS.map(function(e){t.value[e.id]=!0});break;case"textDirection":t.value={},ft.ADAPTATION_TEXT_DIRECTIONS.map(function(e){t.value[e.id]=!0});break;case"language":t.value="en",t.operation=ft.OPERATION_SELECTION[0].id;break;case"custom1":case"custom2":case"custom3":t.value="",t.operation=ft.OPERATION_SELECTION[0].id}var a={};$.extend(!0,a,this.state.adaptation),a[e]=t,this.updateAdaptationObject(a)}},deleteAdaptation:function(e){var t={};$.extend(!0,t,this.state.adaptation),delete t[e],this.updateAdaptationObject(t)},propertyChanged:function(e,t,a){var i={};$.extend(!0,i,this.state.adaptation),i[e][t]=a,this.updateAdaptationObject(i)},onToggleButtonChanged:function(e,t,a,i){if(i.ctrlKey||i.altKey){var n=Object.assign({},this.state.adaptation[e].value);n||(n={});var s,o=ut(this.getAdaptationList(e));try{for(o.s();!(s=o.n()).done;){var l=s.value.id;l!=t&&(n[l]?delete n[l]:n[l]||(n[l]=!0))}}catch(e){o.e(e)}finally{o.f()}this.propertyChanged(e,"value",n)}else this.onValueChanged(e,t,a)},onValueChanged:function(e,t,a){var i=Object.assign({},this.state.adaptation[e].value);i||(i={}),i[t]&&0==a?delete i[t]:i[t]||1!=a||(i[t]=!0),this.propertyChanged(e,"value",i)},onLanguageChanged:function(e,t){this.propertyChanged(e,"value",t)},onCustomChanged:function(e,t){this.propertyChanged(e,"value",t)},onOperationChanged:function(e,t){this.propertyChanged(e,"operation",t)},getAdaptationList:function(e){switch(e){case"interactive":return ft.ADAPTATION_INTERACTIVE;case"screenSize":return ft.ADAPTATION_SCREEN_SIZES;case"layout":return ft.ADAPTATION_LAYOUTS;case"textDirection":return ft.ADAPTATION_TEXT_DIRECTIONS}},render:function(){if(!1===this.props.active)return!1;var e=this.props.adaptationGlobals;e||(e={});var t=1;ft.ADAPTATION_INTERACTIVE.length>t&&(t=ft.ADAPTATION_INTERACTIVE.length),ft.ADAPTATION_SCREEN_SIZES.length-1>t&&(t=ft.ADAPTATION_SCREEN_SIZES.length-1),ft.ADAPTATION_LAYOUTS.length-1>t&&(t=ft.ADAPTATION_LAYOUTS.length-1),ft.ADAPTATION_TEXT_DIRECTIONS.length>t&&(t=ft.ADAPTATION_TEXT_DIRECTIONS.length);var a,i=100/(t+1),n=function(a){var n=this.state.adaptation[a];if(!n)return null;var s=function(e){var t=function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:this.onOperationChanged.bind(this,e,t.id)},t.title))}.bind(this);return o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},gt.getTitleFromSelection(ft.OPERATION_SELECTION,n.operation)),o().createElement("ul",{className:"dropdown-menu"},ft.OPERATION_SELECTION.map(t)))}.bind(this);if("language"==a){var l="fa fa-eye-slash";g().checkString(n,e[a])&&(l="fa fa-eye");var r=(100-i)/4;return o().createElement("div",{key:a,className:"adaptive-properties",style:{gridTemplateColumns:"".concat(r,"% ").concat(r,"% ").concat(2*r,"% ").concat(i,"%")}},o().createElement("div",{className:"adaptive-property"},gt.getTitleFromSelection(ft.ADAPTATION_SELECTION,a)),o().createElement("div",{className:"adaptive-property"},s(a)),o().createElement("div",{className:"adaptive-property"},o().createElement(lt.A,{name:a,value:n.value,onValueChanged:this.onLanguageChanged})),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:a},"Shows the result of comparing the adaptive property with the global property.")},o().createElement("div",{className:"adaptive-property property-result"},o().createElement("div",null,o().createElement("div",{className:"adaptive-property"},o().createElement("i",{className:l}))),o().createElement("div",null,"Result"))))}if("custom1"==a||"custom2"==a||"custom3"==a){var c="fa fa-eye-slash";g().checkString(n,e[a])&&(c="fa fa-eye");var d=(100-i)/4;return o().createElement("div",{key:a,className:"adaptive-properties",style:{gridTemplateColumns:"".concat(d,"% ").concat(d,"% ").concat(2*d,"% ").concat(i,"%")}},o().createElement("div",{className:"adaptive-property"},gt.getTitleFromSelection(ft.ADAPTATION_SELECTION,a)),o().createElement("div",{className:"adaptive-property"},s(a)),o().createElement("div",{className:"adaptive-property"},o().createElement(lt.A,{name:a,value:n.value,onValueChanged:this.onCustomChanged})),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:a},"Shows the result of comparing the adaptive property with the global property.")},o().createElement("div",{className:"adaptive-property property-result"},o().createElement("div",null,o().createElement("div",{className:"adaptive-property"},o().createElement("i",{className:c}))),o().createElement("div",null,"Result"))))}if("interactive"==a||"screenSize"==a||"layout"==a||"textDirection"==a){var p=[];n.value&&(p=n.value);var m=0,u=function(e){if("automatic"==e.id)return null;m++;var t=!1;p[e.id]&&(t=!0);var i=o().createElement("div",{key:m,className:"adaptive-property"},o().createElement("div",null,o().createElement(se.A,{name:e.id,value:t,onValueChanged:this.onToggleButtonChanged.bind(this,a)})),o().createElement("div",null,e.title));return e.tooltip?o().createElement(Y(),{key:m,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:e.id},e.tooltip)},i):i}.bind(this),h=this.getAdaptationList(a),f=[];h.length<t&&(f=new Array(t-h.length).fill(0));var v="fa fa-eye-slash";return g().checkArray(n,e[a])&&(v="fa fa-eye"),o().createElement("div",{key:a,className:"adaptive-properties",style:{gridTemplateColumns:"repeat(".concat(t+1,", ").concat(i,"%)")}},h.map(u),f.map(function(e,t){return o().createElement("div",{key:"empty-"+t})}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:a},"Shows the result of comparing the adaptive property with the global property.")},o().createElement("div",{className:"adaptive-property property-result"},o().createElement("div",null,o().createElement("div",{className:"adaptive-property"},o().createElement("i",{className:v}))),o().createElement("div",null,"Result"))))}return null}.bind(this),s=function(e,t){var a=gt.getTitleFromSelection(ft.ADAPTATION_SELECTION,e),i=gt.getPropertyFromSelection(ft.ADAPTATION_SELECTION,e,"tooltip"),s=this.state.adaptation[e].active;return o().createElement("div",{className:"element-properties-wrapper",key:"line"+t},o().createElement("div",{className:"panel panel-default panel-element grouped-properties",style:{width:"100%",maxWidth:"550px"}},o().createElement("div",{className:"panel-body"},o().createElement("h3",null,o().createElement("div",{className:"group-panel-options",style:{left:"0px",right:"unset"}},o().createElement(se.A,{name:"active",value:s,onValueChanged:this.propertyChanged.bind(this,e)})),o().createElement("div",{style:{position:"absolute",left:"40px"}},a),o().createElement("div",{className:"group-panel-options extended pull-right"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"position"},i)},o().createElement("i",{className:"fa fa-info-circle",style:{padding:"5px"}})),o().createElement("i",{className:"fa fa-times-circle btn-delete",style:{left:"160px",right:"unset"},onClick:this.deleteAdaptation.bind(this,e)}))),o().createElement("div",{className:"panel panel-default grouped-properties",disabled:!s,style:{background:"#434343"}},n(e)))))}.bind(this),l=[],r=ut(ft.ADAPTATION_SELECTION);try{for(r.s();!(a=r.n()).done;){var c=a.value;void 0!==this.state.adaptation[c.id]&&l.push(c.id)}}catch(e){r.e(e)}finally{r.f()}var d="None",p=!0;-1!=this.state.properyInMenuIndex&&this.state.filteredProperty.length>0&&(d=this.state.filteredProperty[this.state.properyInMenuIndex].title,p=!1);var m=function(e,t){return o().createElement("li",{key:"property-"+t},o().createElement("a",{onClick:this.menuPropertyChanged.bind(this,t)},e.title))}.bind(this);return o().createElement("div",null,o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element grouped-properties",style:{width:"100%",maxWidth:"550px"}},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"adaptations")}),o().createElement("span",{className:"panel-label"},"Adaptive")),o().createElement("div",{className:"panel panel-default grouped-properties",style:{background:"#434343"}},o().createElement("div",{className:"group-help-text"},"Use the adaptive settings to toggle if this element is rendered based on the global variables of the output,",o().createElement("a",{href:"https://singularlive.zendesk.com/hc/en-us/articles/360028595691-Introduction-to-Adaptive-Overlays",target:"_blank",tabIndex:"-1"},"click here"),"to learn about adaptive rendering."),o().createElement("div",{className:"input-group",style:{margin:"10px"}},o().createElement("div",{className:"input-group-btn"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle",style:{width:"120px"},"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:p},d,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},this.state.filteredProperty.map(m)),o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-primary",style:{height:"29px"},onClick:this.addAdaptation,disabled:p},"Add"))),o().createElement("ul",null))))),l.map(s))},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");if(t&&"adaptations"==e)if(t.adaptations){var a=Object.assign({},t.adaptations);delete a.cursor,this.props.sbRef.child("layout").child("adaptations").set(a)}else this.props.sbRef.child("layout").child("adaptations").remove()}});var bt=a(16524),yt=a(9769);const Et=o().createClass({displayName:"GroupProperties",getInitialState:function(){return{currentTab:null}},componentDidMount:function(){this.manageTimeline()},shouldComponentUpdate:function(e,t){return 0==yt.compareObject(this.props,e)||this.state.currentTab!=ze.current},saveTab:function(e){ze.current=e,this.manageTimeline(),this.setState({currentTab:e})},manageTimeline:function(){ze.current==bt.ANIMATION?this.props.onShowTimeline(!0):this.props.onShowTimeline(!1)},render:function(){var e=ze.current;return e!=bt.CONTROL&&e!=bt.UPDATE&&e!=bt.BEHAVIOR||(e=bt.TRANSFORM),o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:e==bt.TRANSFORM?"active":"",href:"#transform",onClick:this.saveTab.bind(this,bt.TRANSFORM)},"Transform")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:e==bt.ANIMATION?"active":"",href:"#animation",onClick:this.saveTab.bind(this,bt.ANIMATION)},"Animation")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:e==bt.EFFECT?"active":"",href:"#effect",onClick:this.saveTab.bind(this,bt.EFFECT)},"Effect")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:e==bt.EVENT?"active":"",href:"#event",onClick:this.saveTab.bind(this,bt.EVENT)},"Event")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:e==bt.ADAPTIVE?"active":"",href:"#adaptive",onClick:this.saveTab.bind(this,bt.ADAPTIVE)},"Adaptive"))),o().createElement("div",{className:"tab-content comp-tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane "+(e==bt.TRANSFORM?"active":""),id:"transform"},o().createElement(at,{type:"group",sbRef:this.props.sbRef,rootRtdbRef:this.props.rootRtdbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings,editorWidth:this.props.editorWidth,editorHeight:this.props.editorHeight})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(e==bt.ANIMATION?"active":""),id:"animation"}),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(e==bt.EFFECT?"active":""),id:"effect"},o().createElement(ot,{type:"group",sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,rootRtdbRef:this.props.rootRtdbRef,compositionStack:this.props.compositionStack,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(e==bt.EVENT?"active":""),id:"event"},o().createElement(mt,{active:e==bt.EVENT,type:"group",styles:this.props.styles,sbRef:this.props.sbRef,sbAllCompsRef:this.props.sbAllCompsRef,sbRootCompRef:this.props.sbRootCompRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(e==bt.ADAPTIVE?"active":""),id:"adaptive"},o().createElement(vt,{active:e==bt.ADAPTIVE,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,sbAllCompsRef:this.props.sbAllCompsRef,sbRootCompRef:this.props.sbRootCompRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings,adaptationGlobals:this.props.adaptationGlobals}))))}});function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}var St=function(){this.history={past:[],present:void 0,future:[]}};St.prototype.compareObject=function(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a]){if("object"!==wt(e[a]))return!1;if(!this.compareObject(e[a],t[a]))return!1}}for(a in t)if(t.hasOwnProperty(a)&&!e.hasOwnProperty(a))return!1;return!0},St.prototype.length=function(){var e=this.history.past,t=this.history.future;return e.length+1+t.length},St.prototype.getPresent=function(){return this.history.present},St.prototype.insertState=function(e){var t=this.history.past,a=this.history.present;if(!this.compareObject(a,e)){var i=this.length(this.history)>=100;if(void 0===a)this.history={past:[],present:e,future:[]};else{var n={};$.extend(!0,n,a,e),this.history={past:[].concat(t.slice(i?1:0),[a]),present:n,future:[]}}}},St.prototype.undo=function(){var e=this.history.past,t=this.history.present,a=this.history.future;e.length<=0||(this.history={past:e.slice(0,e.length-1),present:e[e.length-1],future:[t].concat(a)})},St.prototype.redo=function(){var e=this.history.past,t=this.history.present,a=this.history.future;a.length<=0||(this.history={future:a.slice(1,a.length),present:a[0],past:[].concat(e,[t])})},new St;var Nt=a(45659),Ct=a(9769);const xt={onGroupNameChange:function(e,t){var a={};a.name=t,this.props.sbRef.child("groups").child(e).update(a)},onGroupDelete:function(e){var t=this,a=this.props.sbRef.child("groups").child(e.id).val();this.props.sbRef.beginBatch();var i,n,s=this.props.sbRef.child("tiles").val(),o=a.id,l=function(){i=a.items[r];var e=[],o=h.A.getWidgetById(s[r].widget,s[r].version);if(o&&o.model&&o.model.fields&&Array.isArray(o.model.fields)){var l=t.props.sbRef.child("data/"+r).val();o.model.fields.forEach(function(t){"composition"==t.type&&l[t.id]&&e.push(l[t.id])})}n=t.getTiles()[i.id],t.props.sbRef.child("tiles").child(i.id).remove(),t.props.sbRef.child("data").child(i.id).remove(),t.props.sbRef.child("dataLinks").child(i.id).remove(),t.props.sbRef.child("nodeRefs").child(i.id).remove(),e.forEach(function(e){t.removeComposition(e)}),"composition"==n.type&&t.removeComposition(n.id)};for(var r in a.items)l();var c,d=0,p=this.props.sbRef.child("groups").val();for(c=Ct.getGroupArray(p),d=0;d<c.length&&c[d].id!=o;d++);var m=0;if(d+1<c.length?m=c[d+1].id:d-1>=0&&(m=c[d-1].id),this.props.sbRef.child("groups").child(o).remove(),m){var u=this.props.sbRef.child("groups").child(m).val();this.props.onGroupSelect(u)}this.forceUpdate(),this.props.sbRef.endBatch()},onGroupSort:function(e){var t=this.props.sbRef.child("groups");this.props.sbRef.beginBatch(),e.forEach(function(e,a){var i=t.child(e.groupId);i.update({priority:e.priority}),i.child("layout").update({zindex:e.priority})}),this.props.sbRef.endBatch()},onGroupAdd:function(e,t,a){this.props.sbRef.beginBatch();var i=this.props.sbRef.child("groups"),n=i.push(),s={id:n.key,name:a,priority:t,expand:1,layout:Ue().getDefaultLayout(t)};n.set(s),i.child(s.id+"/keyframes").set(Nt.getDefaultKeyframes()),i.child(s.id+"/effects").set(Nt.getDefaultEffects()),e.forEach(function(e,t){var a=i.child(e.groupId);a.update({priority:e.priority}),a.child("layout").update({zindex:e.priority})}),this.props.onGroupSelect(s),this.props.sbRef.endBatch()},onGroupVisibleToggle:function(e){var t=!this.getGroups()[e].layout.visible;this.props.sbRef.child("groups").child(e).child("layout").update({visible:t})},onGroupExpandToggle:function(e){this.getGroups();var t=this.getGroups()[e];this.props.sbRef.child("groups").child(e).update({expand:!t.expand})},onGroupExpandAll:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getGroups(),a=Object.keys(t),i=0,n=a.length;i<n;i++)this.props.sbRef.child("groups").child(t[a[i]].id).update({expand:e})},onGroupDuplicate:function(e){var t={};$.extend(!0,t,this.clipboard),this.onCopy(),this.onPaste(),this.clipboard={},$.extend(!0,this.clipboard,t)}};var It=a(86025),kt=a(18654),Dt=a(99547);function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)({}).hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},At.apply(null,arguments)}var Rt=a(45659),Pt=a(9769),Tt=a(48766).EffectSelections;const Mt=o().createClass({displayName:"WidgetTree",mixins:[Ve,W.A,He,xt,D(),pe.A],lastGroupCount:0,lastCursorTop:0,currentTimelinePosition:{In:0,Out:0},getInitialState:function(){return this.prevUndoStackCount=this.prevRedoStackCount=0,this.lastHScrollerMousePos=0,{snapPoints:{In:[],Out:[]},rulerWidth:2e3,rulerCurrentWidth:0,hScrollerPositions:{In:0,InPX:0,Out:0,OutPX:0},animationPanel:"In",selectedItem:void 0,groupExpand:!1}},componentWillMount:function(){this.allSnapPoints={In:{},Out:{}},this.bindSelection(this.props)},componentDidMount:function(){var e=this;$(window).on("resize",this.onWindowResize);var t=n().findDOMNode(this.refs.compositionTreeArea);t&&(It.A.createShortcut("mod+c",this.onCopy,t),It.A.createShortcut("mod+v",this.onPaste,t),It.A.createShortcut("mod+x",function(){this.onCopy(),this.props.onDeleteButton()}.bind(this),t),It.A.createShortcut("mod+d",this.onGroupDuplicate,t),It.A.createShortcut("mod+s",this.props.onSaveComposition,t),It.A.createShortcut("mod+g",this.addGroup.bind(this,"Group"),t),It.A.createShortcut("mod+m",this.addNewComposition,t),It.A.createShortcut("mod+b",function(){$("#widgetBrowserModal").modal("show")},t),It.A.createShortcut("del",this.props.onDeleteButton,t),It.A.createShortcut("up",this.onKeyboardNavigate.bind(this,"up"),t),It.A.createShortcut("down",this.onKeyboardNavigate.bind(this,"down"),t),It.A.createShortcut("left",this.onKeyboardNavigate.bind(this,"left"),t),It.A.createShortcut("right",this.onKeyboardNavigate.bind(this,"right"),t),It.A.createShortcut("h",this.onKeyboardNavigate.bind(this,"h"),t),It.A.createShortcut("space",function(){"In"==e.state.animationPanel?e.props.onAnimationStateMoveFromTo("Out1","In"):e.props.onAnimationStateMoveFromTo("In","Out2")},t),It.A.createShortcut("enter",this.onKeyboardNavigate.bind(this,"enter"),t)),It.A.createShortcut("mod+z",this.undo),It.A.createShortcut("mod+y",this.redo),It.A.createShortcut("mod+f",this.props.onToggleCompositionNavigator),It.A.createShortcut("mod+e",this.expandTree),this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("c"),this.browserRef.config({useDefaultItemDoubleClick:!1,showTypeSelection:!1,showRevisionSelection:!0,showInspector:!1,browserStyle:"image-selector-modal",onItemDoubleClick:function(e){S().get("/apiv1/compositions/"+e.refId).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading image: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);var i=a.body;e.revStorageUrl&&(i.storageUrl=e.revStorageUrl),e.revFirebaseUrl&&(i.firebaseUrl=e.revFirebaseUrl),this.onWidgetAdd(i)}}.bind(this)),$("#compBrowserModal").modal("toggle")}.bind(this)}),$("#compBrowserModal").on("show.bs.modal",function(){this.refs.browser.refs.child.refresh()}.bind(this)),je.A.compositionEffect=Pt.getCompositionInfo(this.props.sbRootRef.val(),this.props.sbRef.key).effect},componentWillUnmount:function(){$(window).off("resize",this.onWindowResize)},componentWillReceiveProps:function(e){this.props.selection.id!=e.selection.id&&0!=this.props.selection.id&&("widget"==this.props.selection.type||"composition"==this.props.selection.type?this.props.sbRef.child("tiles").child(this.props.selection.id).off("value",this.setSelectedItem):this.props.sbRef.child("groups").child(this.props.selection.id).off("value",this.setSelectedItem)),this.bindSelection(e),this.props.timeline2Active||this.onAnimationPanel("In"),void 0===this.props.timeline2Active&&this.props.onTimeline2Active(this.props.sbRef.key,!0)},setSelectedItem:function(e){this.setState({selectedItem:e.val()})},bindSelection:function(e){0!=e.selection.id&&("widget"==e.selection.type||"composition"==e.selection.type?e.sbRef.child("tiles").child(e.selection.id).on("value",this.setSelectedItem):e.sbRef.child("groups").child(e.selection.id).on("value",this.setSelectedItem))},shouldComponentUpdate:function(e,t){return this.prevUndoStackCount!=this.props.sbRef.undoStackCount()||this.prevRedoStackCount!=this.props.sbRef.redoStackCount()?(this.prevUndoStackCount=this.props.sbRef.undoStackCount(),this.prevRedoStackCount=this.props.sbRef.redoStackCount(),!0):!Pt.compareObject(this.props,e)||!Pt.compareObject(this.state,t)},componentDidUpdate:function(){var e=this,t=this;if($.isEmptyObject(this.props.sbRef.child("groups").val())&&this.addGroup("Group"),$(".widget-tree-group").sortable({connectWith:".widget-tree-group",cancel:".list-group-item-timeline",delay:150,axis:"y",update:function(e,a){var i=$(this).sortable("toArray");$(this).sortable("cancel");var n,s=[];i.forEach(function(e,t){s.push({groupId:e,priority:t}),""!=e||n||(n=!0)}),!n&&t.onGroupSort&&t.onGroupSort(s)}}).disableSelection().click(function(){}),0==this.props.selection.id){var a=this.getGroupArray();this.props.onGroupSelect(a[0])}if("group"==this.props.selection.type){var i=this.getGroupArray();0==i.filter(function(t){return t.id==e.props.selection.id}).length&&this.props.onGroupSelect(i[0])}else{var n=this.getTileArray(),s=this.getGroupArray();0==n.filter(function(t){return t.id==e.props.selection.id}).length&&this.props.onGroupSelect(s[0])}},onAnimationPanel:function(e){this.setState({animationPanel:e})},onSetSnapPoints:function(e,t,a){var i=this;this.allSnapPoints[e][t]=a;var n=[];Object.keys(this.allSnapPoints[e]).forEach(function(t){n=n.concat(i.allSnapPoints[e][t])}),n.sort(function(e,t){return e-t});var s={};$.extend(!0,s,this.state.snapPoints),s[e]=n,this.setState({snapPoints:s})},onWindowResize:function(){var e=$(".ruler-wrapper").width();e&&this.setState({rulerCurrentWidth:e})},onRulerDidmount:function(){var e=$(".ruler-wrapper").width();e&&this.setState({rulerCurrentWidth:e})},onHScrollUpdate:function(e,t){var a=$(".ruler-wrapper").width();if(a&&(this.refs.hScrollBar&&(t=this.refs.hScrollBar.validatePosition(t)),a<this.state.rulerWidth)){var i={};$.extend(!0,i,this.state.hScrollerPositions),i[e]=-t/a*this.state.rulerWidth,i[e+"PX"]=t,this.setState({hScrollerPositions:i})}},onTimelinePosition:function(e,t){this.props.onTimelinePosition&&this.props.onTimelinePosition(this.props.sbRef.key,e,t)},moveStateFromTo:function(e,t){this.props.onAnimationStateMoveFromTo(e,t)},addNewComposition:function(){this.onWidgetAdd({name:"New Sub-Comp",type:"composition"})},addWidget:function(e){$("#widgetBrowserModal").hasClass("show")&&($("#widgetBrowserModal").modal("hide"),this.onWidgetAdd(e))},onTimelineZoom:function(e){this.props.onUISettings&&this.props.onUISettings("timelineZoom",e)},onTimelineSnap:function(e){this.props.onUISettings&&this.props.onUISettings("timelineSnap",e)},onToggleTimelineSnap:function(){var e;this.props.onUISettings&&(e="grid"==this.props.uiSettings.timelineSnap?"none":"grid",this.props.onUISettings("timelineSnap",e))},onToggleTimelineUpdate:function(){this.props.onUISettings&&this.props.onUISettings("disableTimelineUpdate",!this.props.uiSettings.disableTimelineUpdate)},onToggleTimeline2:function(){void 0===this.props.timeline2Active?this.props.onTimeline2Active(this.props.sbRef.key,!1):this.props.onTimeline2Active(this.props.sbRef.key,!this.props.timeline2Active)},onSetCompositionTreeFilterKind:function(e){this.props.onUISettings&&this.props.onUISettings("widgetFilterKind",e)},onSetCompositionTreeFilter:function(e){this.props.onUISettings&&this.props.onUISettings("widgetFilter",e)},animEffectChanged:function(e,t,a){var i=this;if("effect"==t&&"widget"==a){this.onEffectChange("In",a);var n=Tt.filter(function(e){return e.id==a})[0];this.onEffectPropertyChange("In",n.property[0].id),this.onEffectChange("Out",a),n=Tt.filter(function(e){return e.id==a})[0],this.onEffectPropertyChange("Out",n.property[0].id)}else this.onEffectChange(e,a),(n=Tt.filter(function(e){return e.id==a})[0]).property.find(function(t){return t.id==i.state.selectedItem.effects[e].property})||this.onEffectPropertyChange(e,n.property[0].id);je.A.compositionEffect=Pt.getCompositionInfo(this.props.sbRootRef.val(),this.props.sbRef.key).effect},animValueChanged:function(e,t,a){"easing"==t?this.onEasingChange(e,a):"duration"==t?this.onEffectDurationChange(e,Number(a)):"begin"==t?this.onEffectBeginChange(e,Number(a)):"property"==t&&this.onEffectPropertyChange(e,a)},onKeyframesChange:function(e){if(this.props.selection){var t={};t[0]=e.begin,t[1]=e.end,"group"==this.props.selection.type?this.props.sbRef.child("groups").child(this.props.selection.id+"/keyframes").child(e.timeline).update(t):Pt.compareObject(this.props.sbRef.child("tiles").child(this.props.selection.id+"/keyframes").child(e.timeline).val(),t)||this.props.sbRef.child("tiles").child(this.props.selection.id+"/keyframes").child(e.timeline).update(t)}},onEffectChange:function(e,t){if(this.props.selection){var a={};a.effect=t,"group"==this.props.selection.type?this.props.sbRef.child("groups").child(this.props.selection.id+"/effects").child(e).update(a):this.props.sbRef.child("tiles").child(this.props.selection.id+"/effects").child(e).update(a)}},onEasingChange:function(e,t){if(this.props.selection){var a={};a.easing=t,"group"==this.props.selection.type?this.props.sbRef.child("groups").child(this.props.selection.id+"/effects").child(e).update(a):this.props.sbRef.child("tiles").child(this.props.selection.id+"/effects").child(e).update(a)}},getGroups:function(){return this.props.sbRef.child("groups").val()},getGroupArray:function(){return Pt.getGroupArray(this.getGroups())},getTiles:function(){return this.props.sbRef.child("tiles").val()},getTileArray:function(){return Pt.getTileArray(this.getTiles())},getRootTiles:function(){return this.props.sbCompositionRef.child("tiles").val()},getRootTileArray:function(){return Pt.getTileArray(this.getRootTiles())},getComps:function(){return this.props.sbRootRef.child("compositions").val()},getCompArray:function(){return Pt.getCompArray(this.getComps())},onEffectDurationChange:function(e,t){if(this.props.selection){var a=this.props.selection.id,i={};if("group"==this.props.selection.type){var n=this.getGroupArray().filter(function(e){return e.id==a})[0];i[0]=n.keyframes[e][0],i[1]=n.keyframes[e][0]+t,this.props.sbRef.child("groups").child(a+"/keyframes").child(e).update(i)}else{var s=this.getTileArray().filter(function(e){return e.id==a})[0];i[0]=s.keyframes[e][0],i[1]=s.keyframes[e][0]+t,this.props.sbRef.child("tiles").child(a+"/keyframes").child(e).update(i)}}},onEffectBeginChange:function(e,t){if(this.props.selection){var a=this.props.selection.id,i={};if("group"==this.props.selection.type){var n=this.getGroupArray().filter(function(e){return e.id==a})[0],s=n.keyframes[e][1]-n.keyframes[e][0];i[0]=t,i[1]=t+s,this.props.sbRef.child("groups").child(a+"/keyframes").child(e).update(i)}else{var o=this.getTileArray().filter(function(e){return e.id==a})[0],l=o.keyframes[e][1]-o.keyframes[e][0];i[0]=t,i[1]=t+l,this.props.sbRef.child("tiles").child(a+"/keyframes").child(e).update(i)}}},onEffectPropertyChange:function(e,t){if(this.props.selection){var a={};a.property=t,"group"==this.props.selection.type?this.props.sbRef.child("groups").child(this.props.selection.id+"/effects").child(e).update(a):this.props.sbRef.child("tiles").child(this.props.selection.id+"/effects").child(e).update(a)}},onFilterChanged:function(e){this.setState({widgetTreeFilter:e.target.value})},onFilterKeyDown:function(e){"Escape"==e.key&&this.setState({widgetTreeFilter:""})},selectDefaultGroupIfCurrentSelectionDoesNotExist:function(){var e=this;if("group"==this.props.selection.type){var t=this.getGroupArray();0==t.filter(function(t){return t.id==e.props.selection.id}).length&&this.props.onGroupSelect(t[0])}else{var a=this.getTileArray(),i=this.getGroupArray();0==a.filter(function(t){return t.id==e.props.selection.id}).length&&this.props.onGroupSelect(i[0])}},undo:function(){this.props.sbRef.undo(),this.forceUpdate(),this.selectDefaultGroupIfCurrentSelectionDoesNotExist()},redo:function(){this.props.sbRef.redo(),this.forceUpdate(),this.selectDefaultGroupIfCurrentSelectionDoesNotExist()},expandTree:function(){var e=this.state.groupExpand;this.onGroupExpandAll(!e),this.forceUpdate(),this.selectDefaultGroupIfCurrentSelectionDoesNotExist(),this.setState({groupExpand:!e})},onAddWidgetShortcut:function(e){var t=h.A.getWidgetById({text:1032,image:642,circle:1052,rectangle:1022,video:812}[e],"published");t&&(t.type="widget",this.onWidgetAdd(t))},clearWidgetTreeSearchBox:function(){this.setState({widgetTreeFilter:""})},render:function(){var e=this,t={},a=!1;if(this.state.selectedItem&&this.state.selectedItem.effects&&this.state.selectedItem.keyframes){var i,n={};if(n.duration=this.state.selectedItem.keyframes[this.state.animationPanel][1]-this.state.selectedItem.keyframes[this.state.animationPanel][0],n.easing=this.state.selectedItem.effects[this.state.animationPanel].easing,n.effect=this.state.selectedItem.effects[this.state.animationPanel].effect,n.property=this.state.selectedItem.effects[this.state.animationPanel].property,this.state.selectedItem&&"widget"==this.state.selectedItem.type){var s=h.A.getWidgetById(this.state.selectedItem.widget,this.state.selectedItem.version);s&&s.supportCustomAnimation&&(a=!0)}i="In"==this.state.animationPanel?o().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.moveStateFromTo.bind(this,"Out1","In")},o().createElement("i",{className:"fa fa-play"})):o().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.moveStateFromTo.bind(this,"In","Out2")},o().createElement("i",{className:"fa fa-play"}));var l=o().createElement(de(),{id:"animPanel"},o().createElement("table",{style:{width:"540px"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,i),o().createElement("td",null,o().createElement(he,{anim:n,onEffect:this.animEffectChanged.bind(this,this.state.animationPanel),onValueChanged:this.animValueChanged.bind(this,this.state.animationPanel),gizmoOverlayPlacement:"right",menuStyle:"dropup",showWidgetAnimation:a,showPasteButton:!0,state:this.state.animationPanel}))))));t.panelOverlay=o().createElement(Y(),{tabIndex:"-1",trigger:"click",rootClose:!0,placement:"right",overlay:l},o().createElement("i",{id:"animOverlay",className:"fa fa-sliders anim-inline-shortcut"}))}var r,c,d,p,m=function(e,a){return o().createElement(ee,At({key:e.id,groupId:e.id,filter:this.state.widgetTreeFilter},this.props,{onWidgetDelete:this.onWidgetDelete,onWidgetVisibleToggle:this.onWidgetVisibleToggle,onWidgetNameChange:this.onWidgetNameChange,onWidgetDuplicate:this.onWidgetDuplicate,onWidgetSort:this.onWidgetSort,onCopy:this.onCopy,onPaste:this.onPaste,onGotoComp:this.props.onGotoComp,onWidgetRemoveFromGroup:this.onWidgetRemoveFromGroup,onGroupDelete:this.onGroupDelete,onGroupVisibleToggle:this.onGroupVisibleToggle,onGroupNameChange:this.onGroupNameChange,onGroupDuplicate:this.onGroupDuplicate,onGroupExpandToggle:this.onGroupExpandToggle,onNavigateItem:this.onNavigateItem,animPanel:t,onKeyframesChange:this.onKeyframesChange,snapPoints:this.state.snapPoints,onSetSnapPoints:this.onSetSnapPoints,hScrollerPositions:this.state.hScrollerPositions,animationPanel:this.state.animationPanel,adaptationGlobals:this.props.adaptationGlobals}))}.bind(this),u={},f={};this.state.selectedItem&&this.state.selectedItem.effects&&this.state.selectedItem.keyframes&&(u.duration=this.state.selectedItem.keyframes.In[1]-this.state.selectedItem.keyframes.In[0],u.easing=this.state.selectedItem.effects.In.easing,u.effect=this.state.selectedItem.effects.In.effect,u.property=this.state.selectedItem.effects.In.property,r=o().createElement(he,{anim:u,onEffect:this.animEffectChanged.bind(this,"In"),onValueChanged:this.animValueChanged.bind(this,"In"),gizmoOverlayPlacement:"top",menuStyle:"dropup",showWidgetAnimation:a,showPasteButton:!0,state:"In"}),f.duration=this.state.selectedItem.keyframes.Out[1]-this.state.selectedItem.keyframes.Out[0],f.easing=this.state.selectedItem.effects.Out.easing,f.effect=this.state.selectedItem.effects.Out.effect,f.property=this.state.selectedItem.effects.Out.property,c=o().createElement(he,{label:"Out",anim:f,onEffect:this.animEffectChanged.bind(this,"Out"),onValueChanged:this.animValueChanged.bind(this,"Out"),gizmoOverlayPlacement:"top",menuStyle:"dropup",showWidgetAnimation:a,showPasteButton:!0,state:"Out"}));var g={},v=this.props.uiSettings;v||(v={timelineZoom:1,timelineSnap:"grid"}),v&&null==v.timelineSnap&&(v.timelineSnap="grid");var b={visibility:"inherit"};!1===this.props.timeline2Active&&(b.visibility="hidden");var y=o().createElement("div",{className:"animation-selection"},o().createElement("span",null,o().createElement("div",{className:"btn-group"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"2-timelines-tooltip"},"Use different animations for Out-In and In-out")},o().createElement("button",{tabIndex:"-1",className:(!1===this.props.timeline2Active?"":"active ")+"btn btn-sm btn-default v2",onClick:this.onToggleTimeline2,style:{width:"100px",marginRight:"50px"}},"2 timelines")),o().createElement("button",{tabIndex:"-1",className:("In"==this.state.animationPanel?"active ":"")+"btn btn-sm btn-default v2",onClick:this.onAnimationPanel.bind(this,"In"),style:b},"Out1 to In"),o().createElement("button",{tabIndex:"-1",className:("Out"==this.state.animationPanel?"active ":"")+"btn btn-sm btn-default v2",onClick:this.onAnimationPanel.bind(this,"Out"),style:b},"In to Out2"))));if(this.props.showTimeline){var E=$(".animation-scrollbar-wrapper").height()-15;$(".ruler")&&$(".ruler").offset()&&(this.lastCursorTop=$(".ruler").offset().top+$(".ruler").height()),d=o().createElement(Ie,{screenVisibleRange:{left:255,right:$(".scroll-content").width()-10},cursorTop:this.lastCursorTop-2,cursorHeight:E+5,showCursor:this.props.compActiveTimeline==this.state.animationPanel,width:this.state.rulerWidth,zoom:v.timelineZoom,onComponentDidMount:this.onRulerDidmount,onCursorChange:this.onTimelinePosition.bind(this,this.state.animationPanel),timelinePosition:this.props.timelinePositions[this.state.animationPanel]}),("composition"!=this.state.selectedItem.type||"composition"==this.state.selectedItem.type&&"none"!=this.state.selectedItem.effects[this.state.animationPanel].effect)&&(p=o().createElement(ke,{contentCurrentWidth:this.state.rulerCurrentWidth,contentWidth:this.state.rulerWidth,pos:this.state.hScrollerPositions[this.state.animationPanel+"PX"],onUpdate:this.onHScrollUpdate.bind(this,this.state.animationPanel),ref:"hScrollBar"}),g.In=o().createElement("div",{className:"input-group-btn row effect-selector-wrapper"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{paddingLeft:"6px"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.moveStateFromTo.bind(this,"Out1","In")},o().createElement("i",{className:"fa fa-play"}))),o().createElement("td",null,o().createElement("div",null,r)))))),g.Out=o().createElement("div",{className:"input-group-btn row effect-selector-wrapper"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{paddingLeft:"6px"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default",onClick:this.moveStateFromTo.bind(this,"In","Out2")},o().createElement("i",{className:"fa fa-play"}))),o().createElement("td",null,o().createElement("div",null,c)))))))}Rt.statePresets.map(function(e){return e.title}),Rt.getStateIdByName(this.props.animationState);var w,S=Pt.getGroupArray(this.getGroups()),N=this.props.compositionNavigatorActive?"active btn btn-default btn-sm relative v2":"btn btn-default btn-sm relative v2";w=this.state.widgetTreeFilter?o().createElement("i",{className:"fa fa-times input-clear-icon-widget-tree",onClick:this.clearWidgetTreeSearchBox}):o().createElement("i",{className:"fa fa-filter filter-input-icon"});var C="Ctrl";navigator.platform.toUpperCase().indexOf("MAC")>=0&&(C="CMD");var x,I=o().createElement("span",null,"Undo ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + z)")),k=o().createElement("span",null,"Redo ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + y)")),D=o().createElement("span",null,"Copy ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + c)")),A=o().createElement("span",null,"Paste ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + v)")),R=o().createElement("span",null,"Composition navigator ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + f)"));return x=this.state.groupExpand?o().createElement("span",null,"Close all groups ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + e)")):o().createElement("span",null,"Open all groups ",o().createElement("span",{className:"tooltip-shortcut"},"(",C," + e)")),o().createElement("div",{className:"widget-tree-list-area"},o().createElement("div",{className:"widget-tree-back-panel-divider"}),o().createElement("div",{className:"comp-tree-menu toolbox"},o().createElement("div",{className:"widget-shortcut",id:"widget-shortcut-group",onClick:this.addGroup.bind(this,"Group")},o().createElement("i",{className:"fa fa-folder"})),o().createElement("div",{className:"widget-shortcut",id:"widget-shortcut-text",onClick:this.onAddWidgetShortcut.bind(this,"text")},o().createElement("i",{className:"fa fa-font"})),o().createElement("div",{className:"widget-shortcut widget-shortcut-circle",id:"widget-shortcut-circle",onClick:this.onAddWidgetShortcut.bind(this,"circle")},o().createElement("i",{className:"fa fa-circle widget-shortcut-circle"})),o().createElement("div",{className:"widget-shortcut",id:"widget-shortcut-rectangle",onClick:this.onAddWidgetShortcut.bind(this,"rectangle")},o().createElement("i",{className:"fa fa-square"})),o().createElement("div",{className:"widget-shortcut",id:"widget-shortcut-image",onClick:this.onAddWidgetShortcut.bind(this,"image")},o().createElement("i",{className:"fa fa-picture-o"})),o().createElement("div",{className:"widget-shortcut",id:"widget-shortcut-video",onClick:this.onAddWidgetShortcut.bind(this,"video")},o().createElement("i",{className:"fa fa-video-camera"}))),o().createElement("div",{className:"comp-tree-menu wide"},o().createElement("div",{className:"comp-nav-wrapper pull-left"},o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"comp-nav-tooltip"},R)},o().createElement("button",{tabIndex:"-1",className:N,onClick:this.props.onToggleCompositionNavigator},o().createElement("i",{className:"fa fa-tasks"})))),o().createElement("div",{className:"widget-tree-filter pull-left"},w,o().createElement("input",{type:"text",className:"form-control filter-input",placeholder:"Filter ...",value:this.state.widgetTreeFilter,onKeyDown:this.onFilterKeyDown,onChange:this.onFilterChanged})),o().createElement("div",{className:"widget-tree-toolbar pull-left"},o().createElement("div",{className:"dropdown v2 add-item"},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm dropdown-toggle",id:"compostion-tree-filter-selector","data-toggle":"dropdown","aria-expanded":"false"},"Add",o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu",style:{width:"175px"}},o().createElement("li",{onClick:this.addGroup.bind(this,"Group")},o().createElement("a",null,o().createElement("span",null,"Group ",o().createElement("span",{className:"shortcut-description"},"(",C," +g)")))),o().createElement("li",{"data-toggle":"modal","data-target":"#widgetBrowserModal"},o().createElement("a",null,o().createElement("span",null,"Widget ",o().createElement("span",{className:"shortcut-description"},"(",C," +b)")))),o().createElement("li",{onClick:this.addNewComposition},o().createElement("a",null,o().createElement("span",null,"New Sub-composition ",o().createElement("span",{className:"shortcut-description"},"(",C," +m)")))))),o().createElement("div",{className:"input-group-btn tools"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Copy"},D)},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2",onClick:this.onCopy},o().createElement("i",{className:"fa fa-clone"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Paste"},A)},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2",onClick:this.onPaste,style:{borderLeft:"0px"}},o().createElement("i",{className:"fa fa-clipboard"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Undo"},I)},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2",disabled:this.props.sbRef.undoStackCount()<=0,onClick:this.undo,style:{borderLeft:"0px"}},o().createElement("i",{className:"fa fa-undo"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Redo"},k)},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2",disabled:this.props.sbRef.redoStackCount()<=0,onClick:this.redo,style:{borderLeft:"0px"}},o().createElement("i",{className:"fa fa-repeat"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Redo"},x)},o().createElement("button",{tabIndex:"-1",className:"btn btn-default btn-sm relative v2",onClick:this.expandTree,style:{borderLeft:"0px"}},o().createElement("i",{className:this.state.groupExpand?"fa fa-minus":"fa fa-plus"}))))),y,o().createElement("div",{className:"animation-right-menu"},o().createElement("div",{className:"row"},o().createElement("div",{className:"col-sm-12"},o().createElement(Ae(),{value:v.timelineZoom,onChange:this.onTimelineZoom,min:0,max:6,step:1}),o().createElement("div",{className:"btn-group"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"snap-grid"},"Snap to grid")},o().createElement("button",{tabIndex:"-1",className:("grid"==v.timelineSnap?"active ":"")+"btn btn-sm btn-default v2",onClick:this.onToggleTimelineSnap},o().createElement("i",{className:"fa fa-align-justify"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"timelineProgress"},"Show timeline progress during animation")},o().createElement("button",{tabIndex:"-1",className:(v.disableTimelineUpdate?"":"active ")+"btn btn-sm btn-default v2",onClick:this.onToggleTimelineUpdate},o().createElement("svg",{width:"16px",height:"16px",viewBox:"-3 2 22 22",preserveAspectRatio:"none",style:{fill:"currentColor"}},o().createElement("g",null,o().createElement("path",{fillRule:"evenodd",d:"M-0-0C-0-0 7-0 7-0 7-0 7 10.67 7 10.67 7 10.67 4.2 16 4.2 16 4.2 16 2.8 16 2.8 16 2.8 16-0 10.67-0 10.67-0 10.67-0-0-0-0ZM 9 7C 9 7 16 9.8 16 9.8 16 9.8 16 11.27 16 11.27 16 11.27 9 14 9 14 9 14 9 7 9 7Z"}),o().createElement("path",{fillRule:"evenodd",d:"M 3.5 10.88C 3.5 10.88 4 9.93 4 9.93 4 9.93 4 3 4 3 4 3 3 3 3 3 3 3 3 9.93 3 9.93 3 9.93 3.5 10.88 3.5 10.88M 4.2 16C 4.2 16 2.8 16 2.8 16 2.8 16-0 10.67-0 10.67-0 10.67-0 0-0 0-0 0 7 0 7 0 7 0 7 10.67 7 10.67 7 10.67 4.2 16 4.2 16 4.2 16 4.2 16 4.2 16ZM 9 14C 9 14 9 7 9 7 9 7 16 9.8 16 9.8 16 9.8 16 11.27 16 11.27 16 11.27 9 14 9 14 9 14 9 14 9 14Z"}))))))))),o().createElement("div",{className:"ruler-wrapper top u-displaynone"},o().createElement("span",{className:"timeline-full"},o().createElement(U,{position:this.state.hScrollerPositions[this.state.animationPanel],ref:"ruler"},d)))),o().createElement("div",{className:"animation-scrollbar-wrapper",ref:"compositionTreeArea"},o().createElement("div",{className:"widget-tree-scrollbar",onMouseMove:function(t){if(4===t.buttons){var a=t.clientX-e.lastHScrollerMousePos;e.onHScrollUpdate(e.state.animationPanel,e.state.hScrollerPositions[e.state.animationPanel+"PX"]-a),e.lastHScrollerMousePos=t.clientX}},onMouseDown:function(t){4===t.buttons&&(e.lastHScrollerMousePos=t.clientX)}},o().createElement("div",{className:"scroll-content"},o().createElement("ul",{className:"widget-tree-group list-group composition-tree"},S.map(m))))),o().createElement("div",{className:"widget-tree-toolbox-bottom"},o().createElement(Se,{sbRef:this.props.sbRef,item:this.state.selectedItem,forceUpdateIFrame:this.props.forceUpdateIFrame})),o().createElement("div",{className:"animation-wrapper u-displaynone"},o().createElement("div",{className:"scrollbar-wrapper"},o().createElement("span",{className:"timeline-full"},p)),o().createElement("div",{className:"effect-wrapper"},o().createElement("span",{className:"timeline-full"},g[this.state.animationPanel]))),this.renderModal("widget","widgetBrowserModal"),o().createElement("div",{id:"compBrowserModal",className:"modal fade u-displaynone singular-modal-v2",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-body"},o().createElement(kt.A,{rtdbFolderRef:Dt.A.rtdbFolderRef(),ref:"browser",showHeader:!0,browserTitle:"Composition",showInspector:!1,showSearch:!0,browserStyle:"composition-selector-modal"}))))))},addGroup:function(e,t){var a=9999;if(this.props.selection)if("group"==this.props.selection.type)a=this.props.selection.id;else{var i=Object.keys(this.getGroups());i.length>0&&(a=this.getGroups()[i[0]].id)}var n=[];$.isEmptyObject(this.getGroups())||(n=$(".widget-tree-group").sortable("toArray"));for(var s=0,o=9999,l=[],r=0,c=0;c<n.length;c++){var d=n[c];d==a&&(o=c,r=1),s=c+r,l.push({groupId:d,priority:s})}9999==o&&(o=s),this.onGroupAdd(l,o,e)},onNavigateItem:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(""!=t&&"filled"!=t)for(var i=this.getGroupArray(),n=0,s=i.length;n<s;n++){var o,l="group",r=i[n],c="";if(i[n].id==e){if("child"==t){var d=this.getItemFromGroup(i[n],"first");d&&(0==this.canSeeGroupChildren(i[n])&&this.onGroupExpandToggle(i[n].id),o=d,l="widget")}if("next"==t&&(0==this.canSeeGroupChildren(i[n])?n<s-1&&(o=i[n+1]):(o=this.getItemFromGroup(i[n],"first"),l="widget")),"previous"==t&&n>0&&(0==this.canSeeGroupChildren(i[n-1])?o=i[n-1]:(o=this.getItemFromGroup(i[n-1],"last"),r=i[n-1],l="widget")),"parent"==t){var p=this.props.exitSubcomp();if(!p)return;var m=this.getSelectionForItemId(p.compId);if(!m)return;r=m.group,o=m.item,l="widget"}o||(o=i[n],c=Math.random())}else if(1==this.canSeeGroupChildren(i[n]))for(var u=this.getSortedItemsOfGroupAsArray(i[n]),h=0,f=u.length;h<f;h++)if(u[h].id==e){if("previous"==t){if(0==h){o=i[n],l="group";break}o=u[h-1],l="widget";break}if("next"==t)if(h==f-1){if(n<i.length-1){o=i[n+1],l="group";break}}else if(h<f-1){o=u[h+1],l="widget";break}if("parent"==t){o=i[n],l="group";break}if("child"==t){var g=this.getTileArray().filter(function(t){return t.id==e})[0];if(g&&"composition"==g.type)return void this.props.onGotoComp(g,{compositionDataNodes:this.props.sbCompositionRef.child("dataSources").child("composition").child("dataNodes").val(),compositionControlNode:this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").val(),compositionWidgetNode:this.props.sbCompositionRef.child("dataSources").child("composition").child("widgetNode").val()})}o||(o=u[h],l="widget",c=Math.random())}if(o){if("group"==l)this.props.onGroupSelect(o);else{var v={id:o.id,type:"widget"};this.props.onWidgetSelect("",v,r)}return void(a&&this.props.onRenameItem({id:o.id,type:l,forceRedraw:c}))}}else this.props.onRenameItem({id:0,type:"widget",forceRedraw:Math.random()})},onKeyboardNavigate:function(e){if(this.props.selection){var t=this.props.selection.id;if(t){var a=this.props.selection.type;switch(e){case"up":this.onNavigateItem(t,"previous",!1);break;case"down":this.onNavigateItem(t,"next",!1);break;case"left":this.onNavigateItem(t,"parent",!1);break;case"right":this.onNavigateItem(t,"child",!1);break;case"space":"group"==a&&this.onGroupExpandToggle(t);break;case"h":"group"==a?this.onGroupVisibleToggle(t):this.onWidgetVisibleToggle(t);break;case"enter":this.props.onRenameItem({id:t,type:a,forceRedraw:Math.random()})}}}},canSeeGroupChildren:function(e){return 0!=e.expand&&null!=e.items&&0!=e.items.length},getSelectionForItemId:function(e){for(var t=this.getGroupArray(),a=0;a<t.length;a++)if(t[a].items[e])return{group:t[a],item:t[a].items[e]}},getItemFromGroup:function(e,t){var a=this.getSortedItemsOfGroupAsArray(e);if(0!=a.length)return"first"==t?a[0]:"last"==t?a[a.length-1]:void 0},getSortedItemsOfGroupAsArray:function(e){if(void 0===e||void 0===e.items)return[];var t=[];for(var a in e.items)t.push(e.items[a]);return t.sort(function(e,t){return(e.priority>t.priority)-.5}),t}});function Ot(e){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(e)}var Lt=a(9769),Vt=a(48766).EffectSelectionsUpdateAnimation;const _t=o().createClass({displayName:"UpdateProperties",mixins:[W.A,pe.A],shouldComponentUpdate:function(e,t){return!1===this.props.active&&!0===e.active||0==Lt.compareObject(this.state.layout.updateAnimation,t.layout.updateAnimation)},componentWillMount:function(){this.sBindAsObject(this.props.sbRef.child("layout"),"layout")},render:function(){if(!1===this.props.active)return!1;var e=this.state.layout.updateAnimation;void 0!==e&&"object"===Ot(e)||(e={});var t=e.in,a=e.out,i=this.props.disabled;return 0==e.active&&(i=!0),o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body",style:{minWidth:"521px"}},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"updateAnimation")}),o().createElement("span",{className:"panel-label"},"Update Animation"),o().createElement("div",{className:"group-panel-options pull-right"},o().createElement("span",null,"Active"),o().createElement(se.A,{name:"active",value:e.active,onValueChanged:this.PropertyChanged}))),o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Out"),o().createElement("td",null,o().createElement(he,{anim:a,onEffect:this.EffectChanged.bind(this,"out"),onValueChanged:this.ValueChanged.bind(this,"out"),gizmoOverlayPlacement:"bottom",isUpdateAnimation:!0,disabled:i}))),o().createElement("tr",null,o().createElement("td",null,"In"),o().createElement("td",null,o().createElement(he,{anim:t,onEffect:this.EffectChanged.bind(this,"in"),onValueChanged:this.ValueChanged.bind(this,"in"),gizmoOverlayPlacement:"bottom",isUpdateAnimation:!0,disabled:i}))),o().createElement("tr",null,o().createElement("td",null,"Offset"),o().createElement("td",null,o().createElement("table",{style:{width:"100%"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement(te.A,{name:"offset",resetValue:0,step:.01,unit:"s",format:"0.01",min:-5,max:5,value:e.offset,showSlider:!1,onValueChanged:this.PropertyChanged,disabled:i})),o().createElement("td",null,o().createElement("div",{className:"group-panel-options pull-right",style:{top:"9px"}},o().createElement("span",{style:{top:"-2px",position:"relative"}},"Always execute"),o().createElement(se.A,{name:"alwaysExecute",tabIndex:"-1",value:e.alwaysExecute,onValueChanged:this.PropertyChanged,disabled:i})))))))))))))},PropertyChanged:function(e,t){this.props.sbRef.child("layout").child("updateAnimation").child(e).set(t)},ValueChanged:function(e,t,a){this.props.sbRef.child("layout").child("updateAnimation").child(e).child(t).set(a)},TestUpdateAnimation:function(){console.log("TestUpdateAnimation")},EffectChanged:function(e,t,a){var i=!1;Vt.map(function(t){t.id==a&&(t.property.map(function(t){t.id==this.state.layout.updateAnimation[e].property&&(i=!0)}.bind(this)),0==i&&this.props.sbRef.child("layout").child("updateAnimation").child(e).child("property").set(t.property[0].id))}.bind(this)),this.props.sbRef.child("layout").child("updateAnimation").child(e).child(t).set(a)},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");t&&"updateAnimation"==e&&(t.updateAnimation?this.props.sbRef.child("layout").child("updateAnimation").set(t.updateAnimation):this.props.sbRef.child("layout").child("updateAnimation").remove())}});function Ft(e){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(e)}const Bt=o().createClass({displayName:"BehaviorProperties",mixins:[W.A,pe.A],getInitialState:function(){return{behavior:[],properyInMenuIndex:0,selectedProperty:null}},filteredPropertySelections:[],propertySelections:[{id:"opacity",title:"Opacity"},{id:"positionX",title:"Position X"},{id:"positionY",title:"Position Y"},{id:"positionZ",title:"Position Z"},{id:"rotationX",title:"Rotation X"},{id:"rotationY",title:"Rotation Y"},{id:"rotationZ",title:"Rotation Z"},{id:"scale",title:"Scale"},{id:"scaleX",title:"Scale X"},{id:"scaleY",title:"Scale Y"}],effectSelections:[{id:"drift",title:"Drift"},{id:"loop+",title:"Loop +"},{id:"loop-",title:"Loop -"},{id:"pingpong",title:"Ping Pong"}],easingSelections:[{id:"linear",title:"Linear"},{id:"power1",title:"Power1"},{id:"power2",title:"Power2"},{id:"power3",title:"Power3"},{id:"back",title:"Back"},{id:"elastic",title:"Elastic"},{id:"bounce",title:"Bounce"},{id:"rough",title:"Rough"},{id:"slomo",title:"Slow Motion"},{id:"steppedease",title:"Stepped"},{id:"circ",title:"Circ"},{id:"expo",title:"Expo"},{id:"sine",title:"Sine"}],updateEditor:function(e){var t=null;e.val()&&(t=e.val().behavior),0==Array.isArray(t)&&(t=[]),this.filteredPropertySelections=[],this.propertySelections.map(function(e,a){var i=!1;t.map(function(t){t.property!=e.id&&("scale"!=e.id||"scaleX"!=t.property&&"scaleY"!=t.property)&&("scaleX"!=e.id&&"scaleY"!=e.id||"scale"!=t.property)||(i=!0)}),0==i&&this.filteredPropertySelections.push(e)}.bind(this)),(-1==this.state.properyInMenuIndex||this.state.properyInMenuIndex>=this.filteredPropertySelections.length)&&this.setState({properyInMenuIndex:0});var a=0;t.map(function(e,t){null!==this.state.selectedProperty&&this.state.selectedProperty.property==e.property&&(a=t)}.bind(this)),t.length>a?this.setState({selectedProperty:t[a]}):this.setState({selectedProperty:null}),this.setState({behavior:t})},componentWillMount:function(){this.props.sbRef.child("layout").on("value",this.updateEditor)},componentWillUnmount:function(){this.props.sbRef.child("layout").off("value",this.updateEditor)},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!1===this.props.active&&e.active,!0},render:function(){if(!1===this.props.active)return!1;var e,t,a,i=function(e,t){return e.map(function(e){if(e.id==t)return e.title})||"Title not found"},n=function(e,t){return o().createElement("li",{key:"effect-"+t},o().createElement("a",{onClick:this.propertyChanged.bind(this,this.state.selectedProperty.property,"effect",e.id)},e.title))}.bind(this),s=function(e,t){var a="";return null!==this.state.selectedProperty&&(a=this.state.selectedProperty.property),o().createElement("li",{key:"line"+t,className:a==e.property?"active":""},o().createElement(se.A,{name:"active",value:e.active,onValueChanged:this.propertyChanged.bind(this,e.property)}),o().createElement("span",{onClick:this.selectProperty.bind(this,e)},i(this.propertySelections,e.property)),o().createElement("i",{className:"fa fa-times-circle btn-delete",onClick:this.deleteProperty.bind(this,t)}))}.bind(this),l=function(){if(null==this.state.selectedProperty)return o().createElement("div",{className:"panel behavior-properties",style:{minWidth:"354px"}});var e=!1;0==this.state.selectedProperty.active&&(e=!0);var t=o().createElement(de(),{id:"popover"},o().createElement(re,{name:"easing",title:"Easing Editor",value:this.state.selectedProperty.easing,onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)}));return o().createElement("table",{style:{width:"420px"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"15%"}}),o().createElement("th",{style:{width:"40%"}}),o().createElement("th",{style:{width:"10%"}}),o().createElement("th",{style:{width:"35%"}}))),o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Effect"),o().createElement("td",null,o().createElement("div",{className:"btn-group width110"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:e},i(this.effectSelections,this.state.selectedProperty.effect)),o().createElement("ul",{className:"dropdown-menu"},this.effectSelections.map(n)))),o().createElement("td",null,"Easing"),o().createElement("td",null,o().createElement(Y(),{trigger:"click",rootClose:!0,placement:"bottom",overlay:t},o().createElement("button",{className:"btn btn-default width110",tabIndex:"-1",disabled:e},this.state.selectedProperty.easing.easing,o().createElement("i",{className:"fa fa-sliders pull-right"}))))),o().createElement("tr",null,o().createElement("td",null,"Value Min"),o().createElement("td",null,o().createElement(te.A,{name:"valueMin",resetValue:0,step:.1,format:"0.0",min:-999,max:999,disabled:e,value:this.state.selectedProperty.valueMin,unit:this.state.selectedProperty.valueUnit,onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)})),o().createElement("td",null,"Max"),o().createElement("td",null,o().createElement(te.A,{name:"valueMax",resetValue:0,step:.1,format:"0.0",min:-999,max:999,disabled:e,value:this.state.selectedProperty.valueMax,unit:this.state.selectedProperty.valueUnit,onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)}))),o().createElement("tr",null,o().createElement("td",null,"Duration"),o().createElement("td",null,o().createElement(te.A,{name:"duration",resetValue:0,step:.1,format:"0.0",min:.1,max:999,disabled:e,value:this.state.selectedProperty.duration,unit:"s",onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)})),o().createElement("td",null,"Range"),o().createElement("td",null,o().createElement(te.A,{name:"durationRange",resetValue:0,step:.1,format:"0.0",min:0,max:999,disabled:e,value:this.state.selectedProperty.durationRange,unit:"s",onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)}))),o().createElement("tr",null,o().createElement("td",null,"Delay"),o().createElement("td",null,o().createElement(te.A,{name:"delay",resetValue:0,step:.1,format:"0.0",min:0,max:999,disabled:e,value:this.state.selectedProperty.delay,unit:"s",onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)})),o().createElement("td",null,"Range"),o().createElement("td",null,o().createElement(te.A,{name:"delayRange",resetValue:0,step:.1,format:"0.0",min:0,max:999,disabled:e,value:this.state.selectedProperty.delayRange,unit:"s",onValueChanged:this.propertyChanged.bind(this,this.state.selectedProperty.property)})))))}.bind(this),r="None",c=!0;return-1!=this.state.properyInMenuIndex&&this.filteredPropertySelections.length>0&&(r=this.filteredPropertySelections[this.state.properyInMenuIndex].title,c=!1),o().createElement("div",{className:"element-properties-wrapper"},o().createElement("div",{className:"panel panel-default panel-element grouped-properties"},o().createElement("div",{className:"panel-body"},o().createElement("h3",{className:"panel-clipboard"},o().createElement(et.A,{checkProperty:"layout",onPaste:this.PropertyPaste.bind(this,"behavior")}),o().createElement("span",{className:"panel-label"},"Behavior Animation")),o().createElement("div",{className:"",style:{margin:"0px",display:"flex",float:"left"}},o().createElement("div",{className:"",style:{padding:"0px",display:"flex"}},o().createElement("div",{className:"panel panel-default grouped-properties behavior-list"},o().createElement("div",{className:"input-group",style:{marginBottom:"5px"}},o().createElement("div",{className:"input-group-btn",style:{display:"flex"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle",style:{width:"124px"},"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:c},r,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu"},this.filteredPropertySelections.map(function(e,t){return o().createElement("li",{key:"property-"+t},o().createElement("a",{onClick:this.currentPropertyChanged.bind(this,t)},e.title))}.bind(this))),o().createElement("button",(e={type:"button",tabIndex:"-1",className:"btn btn-primary",style:{height:"29px"},onClick:this.addProperty,disabled:c},a="-1",(t=function(e){var t=function(e){if("object"!=Ft(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Ft(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ft(t)?t:t+""}(t="tabIndex"))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e),"Add"))),o().createElement("ul",null,this.state.behavior.map(s)))),o().createElement("div",{className:"",style:{display:"flex"}},o().createElement("div",{className:"panel panel-default grouped-properties behavior-properties"},l()))))))},updateBehaviorObject:function(e){e.sort(function(e,t){return e.property<t.property?-1:e.property>t.property?1:0}),this.props.sbRef.child("layout").child("behavior").set(e)},currentPropertyChanged:function(e){this.setState({properyInMenuIndex:e})},addProperty:function(){var e=this.state.behavior.slice(0);if(-1!=this.state.properyInMenuIndex&&null!=this.filteredPropertySelections[this.state.properyInMenuIndex]){var t=this.filteredPropertySelections[this.state.properyInMenuIndex].id,a={active:!0,property:t,effect:"pingpong",duration:2,durationRange:0,delay:0,delayRange:0,easing:{easing:"power1",inOut:"inOut"}};switch(t){case"positionX":case"positionY":case"positionZ":a.valueMin=-50,a.valueMax=50,a.valueUnit="%";break;case"rotationX":case"rotationY":case"rotationZ":a.valueMin=-90,a.valueMax=90,a.valueUnit="deg";break;case"scaleX":case"scaleY":case"scale":a.valueMin=50,a.valueMax=200,a.valueUnit="%";break;case"opacity":a.valueMin=0,a.valueMax=100,a.valueUnit="%"}e.push(a),this.updateBehaviorObject(e)}},deleteProperty:function(e){var t=this.state.behavior.slice(0);void 0!==t[e]&&t.splice(e,1),this.updateBehaviorObject(t)},selectProperty:function(e){this.setState({selectedProperty:e})},propertyChanged:function(e,t,a){var i=this.state.behavior.slice(0);i.map(function(i,n){e==i.property&&(i[t]=a)}),this.updateBehaviorObject(i)},PropertyPaste:function(e){var t=this.onFetchClipBoardData("layout");t&&"behavior"==e&&(t.behavior?this.props.sbRef.child("layout").child("behavior").set(t.behavior):this.props.sbRef.child("layout").child("behavior").remove())}});var Ut=a(94768);a(9769);const Wt=o().createClass({displayName:"WidgetParamProperties",onStyleChanged:function(e,t){},componentWillMonth:function(){},shouldComponentUpdate:function(e,t){return!1===this.props.active&&e.active,!0},render:function(){if(!1===this.props.active)return!1;if("widget"==this.props.sbRef.val().type)return o().createElement("div",{className:"element-properties-wrapper"},o().createElement(Ut.A,{sbRef:this.props.sbRef,sbRootRef:this.props.sbRootRef,sbFieldsRef:this.props.sbFieldsRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,onEditCompStandalone:this.props.onEditCompStandalone,sbButtonsRef:this.props.sbButtonsRef,rootRtdbRef:this.props.rootRtdbRef,enableDataLink:!0}));var e,t=(e=this.props.subCompID?this.props.sbRootRef.child("compositions").child(this.props.subCompID):this.props.sbRootRef.child("compositions").child(this.props.sbRef.val().id)).child("dataSources").child("composition").child("controlNode");return o().createElement("div",{className:"element-properties-wrapper"},o().createElement(Ut.A,{sbRef:e,sbFieldsRef:t.child("payload"),sbCompositionRef:e,model:t.child("model").val(),fields:t.child("payload").val(),enableDataLink:!1,controlNodeButtonMode:!0}))}});var jt=a(16524),Yt=a(9769);const Ht=o().createClass({displayName:"WidgetProperties",getInitialState:function(){return{currentTab:null}},componentDidMount:function(){this.manageTimeline()},shouldComponentUpdate:function(e,t){return 0==Yt.compareObject(this.props,e)||this.state.currentTab!=ze.current},saveTab:function(e){ze.current=e,this.manageTimeline(),this.setState({currentTab:e})},manageTimeline:function(){ze.current==jt.ANIMATION?this.props.onShowTimeline(!0):this.props.onShowTimeline(!1)},showHelp:function(e){window.open(e,e).focus()},render:function(){var e,t="Control Properties",a=!1,i=!1,n=!1,s=this.props.sbRef.val(),l="composition"===s.type;if(this.props.sbRef&&s&&"widget"==s.type){var r=h.A.getWidgetById(s.widget,s.version);null!=r&&(i=r.supportCustomAnimation,n=r.supportInteractivity,r.helpEnabled&&r.helpUrl&&(e=o().createElement("i",{className:"fa fa-question-circle",style:{display:"flex",color:"rgb(88, 184, 72)",position:"relative",top:"5px",left:"5px"},onClick:this.showHelp.bind(this,r.helpUrl)})),t=r.name,r&&r.model&&r.model.fields&&Array.isArray(r.model.fields)&&r.model.fields.forEach(function(e){"composition"==e.type&&(a=!0)}))}var c,d=ze.current;return a||l||i||n?d==jt.UPDATE&&(d=jt.TRANSFORM):c=o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.UPDATE?"active":"",href:"#update",onClick:this.saveTab.bind(this,jt.UPDATE)},"Update")),o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.TRANSFORM?"active":"",href:"#transform",onClick:this.saveTab.bind(this,jt.TRANSFORM)},"Transform")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.ANIMATION?"active":"",href:"#animation",onClick:this.saveTab.bind(this,jt.ANIMATION)},"Animation")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.EFFECT?"active":"",href:"#effect",onClick:this.saveTab.bind(this,jt.EFFECT)},"Effect")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.EVENT?"active":"",href:"#event",onClick:this.saveTab.bind(this,jt.EVENT)},"Event")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.ADAPTIVE?"active":"",href:"#adaptive",onClick:this.saveTab.bind(this,jt.ADAPTIVE)},"Adaptive")),c,o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.BEHAVIOR?"active":"",href:"#behavior",onClick:this.saveTab.bind(this,jt.BEHAVIOR)},"Behavior")),o().createElement("li",{className:"nav-item",id:"widget-property-tab"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",className:d==jt.CONTROL?"active widgetProps":"widgetProps",href:"#control",onClick:this.saveTab.bind(this,jt.CONTROL)},o().createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",float:"left",maxWidth:"130px"}},t),e))),o().createElement("div",{className:"tab-content comp-tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.ANIMATION?"active":""),id:"animation"}),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.TRANSFORM?"active":""),id:"transform"},o().createElement(at,{active:d==jt.TRANSFORM,type:"widget",sbRef:this.props.sbRef,rootRtdbRef:this.props.rootRtdbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings,editorWidth:this.props.editorWidth,editorHeight:this.props.editorHeight})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.EFFECT?"active":""),id:"effect"},o().createElement(ot,{active:d==jt.EFFECT,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,rootRtdbRef:this.props.rootRtdbRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.EVENT?"active":""),id:"event"},o().createElement(mt,{active:d==jt.EVENT,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,sbAllCompsRef:this.props.sbAllCompsRef,sbRootCompRef:this.props.sbRootCompRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.ADAPTIVE?"active":""),id:"adative"},o().createElement(vt,{active:d==jt.ADAPTIVE,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,sbAllCompsRef:this.props.sbAllCompsRef,sbRootCompRef:this.props.sbRootCompRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,settings:this.props.settings,adaptationGlobals:this.props.adaptationGlobals})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.UPDATE?"active":""),id:"update"},o().createElement(_t,{active:d==jt.UPDATE,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.BEHAVIOR?"active":""),id:"behavior"},o().createElement(Bt,{active:d==jt.BEHAVIOR,type:"widget",styles:this.props.styles,sbRef:this.props.sbRef,settings:this.props.settings})),o().createElement("div",{role:"tabpanel",className:"tab-pane "+(d==jt.CONTROL?"active":""),id:"control"},o().createElement(Wt,{active:d==jt.CONTROL,sbRef:this.props.sbRef,sbRootRef:this.props.sbRootRef,sbCompositionRef:this.props.sbCompositionRef,compositionStack:this.props.compositionStack,sbFieldsRef:this.props.sbFieldsRef,sbButtonsRef:this.props.sbButtonsRef,rootRtdbRef:this.props.rootRtdbRef,onEditCompStandalone:this.props.onEditCompStandalone}))))}});var zt=a(4213),Gt=a.n(zt),Kt=a(82765),$t=a.n(Kt),qt=a(45261),Jt=a(82465),Xt=a(9769),Zt=o().createClass({displayName:"CompositionProperties",mixins:[D()],getInitialState:function(){return this.defaultAppHandler=null,this.generateUuidHandler=null,{defaultAppIcon:"",defaultAppName:"No default app selected",defaultAppBusy:!1,compositionUuid:window.singularScene.uuid,compositionId:window.singularScene.id,generateUuidBusy:!1}},shouldComponentUpdate:function(e,t){return!Xt.compareObject(this.props,e)||!Xt.compareObject(this.state,t)},componentWillMount:function(){this.props.settings&&this.fetchDefaultAppData(this.props.settings.defaultAppID)},componentWillReceiveProps:function(e){!e.settings||null!=this.props.settings&&this.props.settings.defaultAppID==e.settings.defaultAppID||this.fetchDefaultAppData(e.settings.defaultAppID)},PropValueChanged:function(e,t){this.props.onSettings&&this.props.onSettings(e,t)},onUISettings:function(e,t){this.props.onUISettings&&this.props.onUISettings(e,t)},export:function(){var e=JSON.stringify(this.props.sbRef.root.val()),t=new Blob([e],{type:"text/plain;charset=utf-8"});Gt().saveAs(t,"export.json")},fetchDefaultAppData:function(e){if(e){this.setState({defaultAppBusy:!0}),this.defaultAppHandler&&this.defaultAppHandler.abort();var t=Jt.API_ENDPOINTS.at+"json?status=development";this.defaultAppHandler=S().get(t).set("Content-Type","application/json").end(function(t,a){if(this.defaultAppHandler=null,t)N.A.add(N.A.TYPE.ERROR,{title:"Cannot get default app info",description:t.message}),this.setState({defaultAppIcon:"",defaultAppName:"No default app specified",defaultAppBusy:!1});else{if(a.headers.location)return void(window.location=a.headers.location);for(var i=a.body,n=0,s=i.length;n<s;n++)if(i[n].id==e)return void this.setState({defaultAppIcon:i[n].thumbnail,defaultAppName:i[n].name,defaultAppBusy:!1});N.A.add(N.A.TYPE.ERROR,{title:"Could not find app template ID "+e,description:""}),this.setState({defaultAppIcon:"",defaultAppName:"Not found",defaultAppBusy:!1})}}.bind(this))}else this.setState({defaultAppIcon:"",defaultAppName:"No default app selected",defaultAppBusy:!1})},selectDefaultApp:function(){$(n().findDOMNode(this.refs.appTemplateBrowser)).modal("show")},onAppTemplateSelected:function(e){this.PropValueChanged("defaultAppID",e.id),this.PropValueChanged("defaultAppVersion","published")},onAppTemplateReset:function(){this.PropValueChanged("defaultAppID",""),this.PropValueChanged("defaultAppVersion","")},generateUuid:function(){this.setState({generateUuidBusy:!0}),this.generateUuidHandler&&this.generateUuidHandler.abort(),this.generateUuidHandler=S().post("/apiv1/compositions/"+this.state.compositionId+"/token").set("Content-Type","application/json").end(function(e,t){var a="";e?N.A.add(N.A.TYPE.ERROR,{title:"Cannot get compositions token",description:e.message}):a=t.body.uuid,this.setState({compositionUuid:a,generateUuidBusy:!1}),this.generateUuidHandler=null}.bind(this))},render:function(){var e=this,t=this.props.settings;if(t){var a=this.props.sbMainRef.key==this.props.sbRef.key,i=95,n=i;void 0!==t.watermarkX&&(i=t.watermarkX);var s,l,r,c,d,p,m,u=95.5,h=u;void 0!==t.watermarkY&&(u=t.watermarkY),a&&(s=o().createElement("tr",null,o().createElement("td",{className:"settings-table-label"},"Watermark Position"),o().createElement("td",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"X"),o().createElement("td",null,o().createElement(te.A,{name:"watermarkX",resetValue:n,step:.1,format:"0.0",min:0,max:100,value:i,unit:"%",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Y"),o().createElement("td",null,o().createElement(te.A,{name:"watermarkY",resetValue:h,step:.1,format:"0.0",min:0,max:100,value:u,unit:"%",onValueChanged:this.PropValueChanged})))))))),a&&(1==this.state.defaultAppBusy?(c="",d="/images/loading-bubbles.svg"):(c=this.state.defaultAppName,d=this.state.defaultAppIcon),"No default app selected"===c&&(p=" disabled"),l=o().createElement("tr",null,o().createElement("td",{className:"settings-table-label"},"Control Application"),o().createElement("td",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"form-inline"},o().createElement("div",{className:"form-group"},o().createElement("div",{className:"input-group image-picker"},o().createElement("div",{className:"input-group-addon image-browser-picker-wrapper"},o().createElement(ve.A,{src:d,fallbackImage:Xt.getDefaultIconFromBrowserShortType(Jt.APPTEMPLATE),initialImage:"/images/loading-bubbles.svg",style:{width:"26px",height:"26px"},onMouseDown:this.selectDefaultApp})),o().createElement("input",{type:"text",className:"form-control",tabIndex:"-1",value:c,readOnly:!0,onMouseDown:this.selectDefaultApp}),o().createElement("div",{className:"input-group-addon image-browser-picker-wrapper "+p,onClick:this.onAppTemplateReset},o().createElement("i",{className:"fa fa-times"}))))))),o().createElement("tr",null,o().createElement("td",{className:"tooltip-text"},"Select a default control application to be used with this composition")))))),m=this.state.generateUuidBusy?"Generating key":this.state.compositionUuid,r=o().createElement("tr",null,o().createElement("td",{className:"settings-table-label"},"Composition API Token"),o().createElement("td",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"input-group",style:{width:"100%"}},o().createElement("input",{type:"text",className:"form-control v2",id:"deploykey",name:"deploykey",placeholder:"Please generate API token",value:m,disabled:!0}),o().createElement("span",{className:"input-group-btn"},o().createElement($t(),{className:"btn input-group-addon icon-only","data-clipboard-text":m,"button-tabIndex":"-1",style:{height:"26px",fontSize:"10px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"})),o().createElement("span",null,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"regenerate"},"Generate API token")},o().createElement("button",{tabIndex:"-1",onClick:this.generateUuid,className:"btn input-group-addon icon-only",style:{height:"26px",fontSize:"10px"}},o().createElement("i",{className:"fa fa-refresh fa-lg"})))))))),o().createElement("tr",null,o().createElement("td",{className:"tooltip-text"},"Generate an API Token to load this composition in external renderers (e.g. GraphicsSDK)")))))));var f,g=o().createElement("tr",null,o().createElement("td",{className:"settings-table-label",style:{paddingTop:"8px"}},"Perspective"),o().createElement("td",null,o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Active"),o().createElement("td",null,o().createElement(se.A,{name:"perspectiveActive",value:t.perspectiveActive,onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Distance"),o().createElement("td",null,o().createElement(te.A,{name:"perspective",resetValue:500,step:1,format:"0",disabled:!t.perspectiveActive,value:t.perspective,unit:"px",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Origin X"),o().createElement("td",null,o().createElement(te.A,{name:"perspectiveOriginX",resetValue:50,step:.1,format:"0.0",disabled:!t.perspectiveActive,value:t.perspectiveOriginX,unit:"%",onValueChanged:this.PropValueChanged}))),o().createElement("tr",null,o().createElement("td",{className:"td-label"},"Origin Y"),o().createElement("td",null,o().createElement(te.A,{name:"perspectiveOriginY",resetValue:50,step:.1,format:"0.0",disabled:!t.perspectiveActive,value:t.perspectiveOriginY,unit:"%",onValueChanged:this.PropValueChanged})))))));if(a){var v="Manual";"auto"===t.automaticTextDirection&&(v="Auto"),f=o().createElement("tr",null,o().createElement("td",{className:"settings-table-label",style:{paddingTop:"11px"}},"Text Direction"),o().createElement("td",null,o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px"}},v),o().createElement("ul",{className:"dropdown-menu"},o().createElement("li",null,o().createElement("a",{onClick:function(){return e.PropValueChanged("automaticTextDirection","auto")}},"Auto")),o().createElement("li",null,o().createElement("a",{onClick:function(){return e.PropValueChanged("automaticTextDirection","manual")}},"Manual"))))))}return o().createElement("div",null,o().createElement("table",{className:"composition-settings-table"},o().createElement("tbody",null,s,l,r,g,f)),o().createElement(qt.A,{onSelect:this.onAppTemplateSelected,ref:"appTemplateBrowser"}))}}});const Qt=Zt;var ea=a(26201),ta=a(62418).js_beautify;const aa=o().createClass({displayName:"DataNodesManager",mixins:[W.A],getInitialState:function(){return{}},componentWillMount:function(){this.sBindAsObject(this.props.sbCompositionRef.child("dataSources").child("composition").child("dataNodes"),"compositionDataNodes")},componentDidMount:function(){this.componentDidUpdate(),qe.A.onChange(this.dataNodeStoreChanged)},componentDidUpdate:function(){for(var e in this.state.compositionDataNodes){var t=this.state.compositionDataNodes[e];if(t.userId&&t.dataNode){var a=this.props.rtdbRef;qe.A.add(a,t,function(e){}.bind(this))}}this.props.onUpdateRef(this)},componentWillUnmount:function(){qe.A.offChange(this.dataNodeStoreChanged)},dataNodeStoreChanged:function(e){$.isEmptyObject(e)||this.forceUpdate()},onSelectDatanode:function(e){var t=this;S().get("/apiv1/datanodes/"+e.refId).set("Content-Type","application/json").end(function(e,a){e?console.log("error while reading datanode: "+e):(t.addDataNode(a.body,"private"),$("#datanodeBrowserModal").modal("toggle"))})},addDataNode:function(e,t){var a=this.sBaseRefs.compositionDataNodes.push(),i=e.firebaseUrl.substr(e.firebaseUrl.lastIndexOf("/")+1),n=0;for(var s in this.state.compositionDataNodes)n++;var o={id:a.key,dataNode:i,type:t,userId:e.user_id,refId:e.id,priority:n,datastore:e.datastore};a.set(o)},deleteDataNode:function(e){var t=this.props.sbCompositionRef.parent.val();for(var a in t){var i=t[a];for(var n in i.dataLinks){var s=i.dataLinks[n];for(var o in s){var l=s[o];"dataNode"==l.type&&l.index==e.id&&this.props.sbCompositionRef.parent.child(a).child("dataLinks").child(n).child(o).remove()}}for(var r in i.nodeRefs){var c=i.nodeRefs[r];for(var d in c){var p=c[d];"dataNode"==p.type&&p.index==e.id&&this.props.sbCompositionRef.parent.child(a).child("nodeRefs").child(r).child(d).remove()}}}this.sBaseRefs.compositionDataNodes.child(e.id).remove()},onChangeDataNodeId:function(e,t,a){this.sBaseRefs.compositionDataNodes.child(e).update(a)},render:function(){var e=function(e){if(!e.dataNode)return null;var t=qe.A.get(e.dataNode);if(!(t&&t.model&&t.model.fields&&t.payload))return null;var a=ta(JSON.stringify(t.payload)),i=window.location.origin+"/apiv1/datanodes/"+t.refId,n="undefined";return null!=t.ts&&(n=ge()(t.ts).format("YYYY-MM-DD HH:mm:ss")),o().createElement("div",{key:e.id,className:"panel panel-default panel-datanodes"},o().createElement("div",{className:"panel-heading",id:"heading"+e.id},o().createElement("h4",{className:"panel-title datanode-panel-title","data-toggle":"collapse",href:"#collapsed"+e.id},o().createElement("a",null,o().createElement("i",{className:"fa fa-caret-right"})," ",t.name)),o().createElement("div",{className:"tools"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item",style:{marginRight:"40px"}},o().createElement("button",{className:"btn btn-danger",tabIndex:"-1",style:{lineHeight:"11px"},onClick:this.deleteDataNode.bind(this,e)},"Remove")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#form"+e.id,className:"active"},o().createElement("i",{className:"fa fa-table"}))),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#metadata"+e.id},o().createElement("i",{className:"fa fa-info-circle"})))))),o().createElement("div",{id:"collapsed"+e.id,className:"panel-collapse collapse in",role:"tabpanel","aria-labelledby":"heading"+e.id},o().createElement("div",{className:"tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane active",id:"form"+e.id},o().createElement("div",{className:"inline-singular-form"},o().createElement("div",{className:"row"},o().createElement("div",{className:"col-md-5",style:{paddingRight:"0px"}},o().createElement(Ut.A,{key:e.id,model:t.model,fields:t.payload,enableDataLink:!1,disabled:!0}))))),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"metadata"+e.id},o().createElement("div",{className:"inline-singular-form"},o().createElement("div",{className:"row"},o().createElement("div",{className:"col-md-5"},o().createElement("table",{className:"singular-form",style:{marginLeft:"10px",width:"100%"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Last Updated"),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",defaultValue:n,disabled:"true"}))),o().createElement("tr",null,o().createElement("td",null,"ID"),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",defaultValue:t.refId,disabled:"true"})),o().createElement("td",null,o().createElement($t(),{className:"btn btn-default v2","data-clipboard-text":t.refId,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard"})))),o().createElement("tr",null,o().createElement("td",null,"Token"),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",defaultValue:e.dataNode,disabled:"true"})),o().createElement("td",null,o().createElement($t(),{className:"btn btn-default v2","data-clipboard-text":e.dataNode,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard"})))),o().createElement("tr",null,o().createElement("td",null,"URL"),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",defaultValue:i,disabled:"true"})),o().createElement("td",null,o().createElement($t(),{className:"btn btn-default v2","data-clipboard-text":i,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard"}))))))),o().createElement("div",{className:"col-md-7"},o().createElement("table",{style:{marginRight:"10px",width:"100%"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"top"}},"JSON"),o().createElement("td",{style:{width:"100%"}},o().createElement(ea.A,{name:"widgetJson",id:"DN"+t.refId,className:"widget-version-json",width:"100%",height:"250px",value:a,disabled:!0})),o().createElement("td",{style:{verticalAlign:"top"}},o().createElement($t(),{className:"btn btn-default v2","data-clipboard-text":a},o().createElement("i",{className:"fa fa-clipboard"})))))))))))))}.bind(this),t=[];if(this.state.compositionDataNodes)for(var a in this.state.compositionDataNodes){var i=this.state.compositionDataNodes[a];t.push(e(i))}return o().createElement("div",{className:"datanode-editor"},o().createElement("div",{className:"inner-toolbar"},o().createElement("ul",{className:"items"},o().createElement("li",null,o().createElement("a",{"data-toggle":"modal","data-target":"#datanodeBrowserModal",tabIndex:"-1",style:{cursor:"pointer"}},o().createElement("i",{className:"fa fa-plus-circle"})," Add")))),o().createElement("div",{id:"dataNodeAccordion",role:"tablist","aria-multiselectable":"true"},t))},renderNewDataNodeModal:function(){return o().createElement("div",{id:"datanodeBrowserModal",className:"modal fade u-displaynone singular-modal-v2",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-body"},o().createElement(kt.A,{rtdbFolderRef:Dt.A.rtdbFolderRef(),showHeader:!0,browserTitle:"Datanodes",showSearch:!0,ref:"browser",showInspector:!1,browserStyle:"datanode-selector-modal",showClose:!0,modalId:"datanodeBrowserModal"})))))}});function ia(e){return ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ia(e)}var na=a(9769);const sa=o().createClass({displayName:"CompositionDevInfo",getInitialState:function(){return{}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!na.compareObject(this.props,e)||!na.compareObject(this.state,t)},componentDidMount:function(){},componentWillReceiveProps:function(e){},render:function(){var e=this,t="";this.props.subCompID&&(t=this.props.subCompID);var a="";this.props.subCompName&&(a=this.props.subCompName);var i=[];this.props.model&&this.props.model.fields&&(i=Object.keys(this.props.model.fields).sort(function(t,a){return e.props.model.fields[t].index-e.props.model.fields[a].index}));var n=function(e,t){var a=this.props.model.fields[e],i="";if(this.props.payload&&a.id){var n=this.props.payload[a.id];i="object"==ia(n)?JSON.stringify(n):n}return o().createElement("tr",{key:t},o().createElement("td",null,o().createElement("div",null,a.id)),o().createElement("td",null,o().createElement("div",null,a.title)),o().createElement("td",null,o().createElement("div",null,a.type)),o().createElement("td",null,o().createElement("div",{style:{overflowWrap:"anywhere"}},i)))}.bind(this);return o().createElement("div",{className:"composition-dev-info"},o().createElement("table",{className:"sub-comp-id"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"table-field-label"},"Sub Composition Name"),o().createElement("td",null,o().createElement("div",{className:"input-group",style:{width:"100%",maxWidth:"280px"}},o().createElement("input",{type:"text",className:"form-control v2",value:a,disabled:!0}),o().createElement("span",{className:"input-group-btn"},o().createElement($t(),{className:"btn input-group-addon icon-only","data-clipboard-text":a,"button-tabIndex":"-1",style:{height:"26px",fontSize:"10px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"})))))),o().createElement("tr",null,o().createElement("td",{className:"table-field-label"},"Sub Composition ID"),o().createElement("td",null,o().createElement("div",{className:"input-group",style:{width:"100%",maxWidth:"280px"}},o().createElement("input",{type:"text",className:"form-control v2",value:t,disabled:!0}),o().createElement("span",{className:"input-group-btn"},o().createElement($t(),{className:"btn input-group-addon icon-only","data-clipboard-text":t,"button-tabIndex":"-1",style:{height:"26px",fontSize:"10px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"})))))))),o().createElement("div",{style:{height:"calc(100% - 74px)",display:"block",width:"100%",overflowX:"hidden",overflowY:"scroll",paddingLeft:"5px",paddingBottom:"5px"}},o().createElement("table",{className:"table table-striped dark-header"},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"20%",textAlign:"left"}},"ID"),o().createElement("th",{style:{width:"20%",textAlign:"left"}},"Name"),o().createElement("th",{style:{width:"10%",textAlign:"left"}},"Type"),o().createElement("th",{style:{width:"50%",textAlign:"left"}},"Value"))),o().createElement("tbody",null,i.map(n)))))}});var oa=a(70470);function la(e){return la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},la(e)}a(4708),a(87874),a(51289),ace.config.set("basePath","/build/ace-builds"),ace.config.set("workerPath","/build/ace-builds"),ace.config.set("modePath","/build/ace-builds"),ace.config.set("themePath","/build/ace-builds");const ra=o().createClass({displayName:"JsonViewer",getInitialState:function(){return{}},componentWillMount:function(){},componentDidMount:function(){},componentWillReceiveProps:function(e){},forceRedraw:function(){var e=this.refs.aceEditorRef;e&&e.editor.resize()},render:function(){var e="";return this.props.json&&(e="string"==typeof this.props.json?this.props.json:"object"==la(this.props.json)?JSON.stringify(this.props.json,null,"\t"):this.props.json),o().createElement("div",{className:"composition-dev-info"},o().createElement(oa.Ay,{id:"jsonEditor-"+this.props.name,mode:"json",theme:"monokai",name:"jsonEditor-"+this.props.name,width:"100%",height:"100%",readOnly:!0,showPrintMargin:!1,showGutter:!0,highlightActiveLine:!0,wrapEnabled:!0,setOptions:{showLineNumbers:!0,tabSize:2,fontSize:this.props.fontSize},editorProps:{$blockScrolling:1/0},value:e,className:"disabled",ref:"aceEditorRef"}))}});var ca=a(9769);const da=o().createClass({displayName:"ControlNodeListItem",getInitialState:function(){return{}},shouldComponentUpdate:function(e,t){return!ca.compareObject(e,this.props)||!ca.compareObject(t,this.state)},render:function(){var e=this,t=this.props.onGetControlNodeType(this.props.type),a=this.props.title;"group"!==this.props.type&&this.props.id!==this.props.title&&(a+=" ("+this.props.id+")");var i,n="control-node-list-item";"group"!==this.props.type&&this.props.parentId&&(n+=" indented"),"group"===this.props.type&&(n+=" group"),this.props.selected&&(n+=" selected"),t.icon&&(i=o().createElement("div",{className:"type"},o().createElement("i",{className:t.icon,style:{width:"15px",textAlign:"center",marginRight:"5px"}})));var s=!1;return"group"!==this.props.type||this.props.hasChildren||(s=!0),o().createElement("div",{className:n,onClick:function(){return e.props.onSelect(e.props.fieldId)}},o().createElement("div",{className:"control-node-list-item-container"},i,o().createElement("div",{className:"title-and-id"+(i?"":" no-type")},o().createElement("div",{className:"title"},a)),"group"!==this.props.type&&o().createElement("div",{className:"action"},o().createElement("i",{className:"fa fa-copy",onClick:function(t){t.stopPropagation(),e.props.onDuplicateField(e.props.fieldId)}})),o().createElement("div",{className:"action"},o().createElement("i",{className:"fa fa-trash",onClick:function(t){t.stopPropagation(),"group"===e.props.type?e.props.onDeleteGroup(e.props.fieldId):e.props.onDeleteField(e.props.fieldId)}}))),s&&o().createElement("div",{className:"add-children-indicator"},"Drag nodes here to add to container"))}});var pa=a(8817),ma=a(38088),ua=a.n(ma),ha=a(82327),fa=a(9769);const ga=o().createClass({displayName:"ControlNodeList",getInitialState:function(){return this.scrollTop=0,{}},shouldComponentUpdate:function(e,t){return!fa.compareObject(e,this.props)||!fa.compareObject(t,this.state)},componentWillReceiveProps:function(e){this.refNodeList&&(this.scrollTop=this.refNodeList.scrollTop)},componentDidMount:function(){var e=this,t=n().findDOMNode(this.refNodeListWrapper);t&&It.A.createShortcut("mod+d",function(){return e.onDuplicateField()},t)},componentDidUpdate:function(e,t){this.refNodeList&&(this.refNodeList.scrollTop=this.scrollTop)},onSelect:function(e){this.props.onEdit(e)},onSortEnd:function(e,t){var a=t.oldIndex,i=t.newIndex,n=e[a],s=e[i];a>i&&(s=i>0?e[i-1]:null);var o=function(t,a){var i=e.find(function(e){return e.key===t});i&&i&&i.item.activeId===a&&(i.item.activeId=null)};if(null===s){if("field"===n.type)o(n.parentId,n.item.id),n.parentId=null;else if("group"===n.type&&"field"===e[i].type)return}else if("group"===n.type&&"field"===s.type);else if("group"===n.type&&"group"===s.type);else if("field"===n.type&&"group"===s.type)n.parentId!==s.key&&(o(n.parentId,n.item.id),n.parentId=s.key);else{if("field"!==n.type||"field"!==s.type)return;n.parentId!==s.parentId&&(o(n.parentId,n.item.id),n.parentId=s.parentId)}var l=ua()(e,t.oldIndex,t.newIndex),r=l.filter(function(e){return"field"===e.type}),c={};r.map(function(e,t){e.item.index=t,c[e.key]=e.item});var d=l.filter(function(e){return"group"===e.type}).map(function(e){return e.item});d.forEach(function(e){var t=l.filter(function(t){return t.parentId===e.id});e.childIds=t.map(function(e){return e.item.id})}),this.props.onSaveFieldsAndGroups(c,d)},onSortOver:function(e,t){var a=e[t.index],i=null;t.newIndex>0&&(i=t.newIndex<t.index?e[t.newIndex-1]:e[t.newIndex]);var n=null;t.newIndex<e.length-1&&(n=t.newIndex<t.index?e[t.newIndex]:e[t.newIndex+1]),"field"===a.type&&(i&&null!==i.parentId?t.helper.classList.add("indented"):t.helper.classList.remove("indented")),"group"===a.type&&(i&&"group"===i.type||n&&"group"===n.type||i&&null!==i.parentId||n&&null!==n.parentId?t.helper.classList.remove("error"):t.helper.classList.add("error"))},onDuplicateField:function(e){if(e||(e=this.props.selected),e){var t=this.props.model;if(!t||!t.fields&&!t.groups)return null;var a=t.fields||{},i=t.groups||[],n=a[e];if(n){var s,o,l,r=Object.assign({},n),c=function(e){var t=!1;return Object.keys(a).forEach(function(i){a[i].id===e&&(t=!0)}),t},d=(o=(s=n.id).match(/(\d+)\s*$/))?{number:parseInt(o[1],10),stringWithoutNumber:s.slice(0,o.index).trim()}:{number:null,stringWithoutNumber:s.trim()},p=d.number,m=d.stringWithoutNumber;for(null===p&&(p=2);;){var u=m+" "+p;if(!c(u)){r.id===r.title&&(r.title=u),r.id=u;break}p++}r.index=Object.keys(a).length,a[ha.guid()]=r,i.forEach(function(e){if(e.childIds&&e.childIds.includes(n.id)){var t=e.childIds.indexOf(n.id);e.childIds.splice(t+1,0,r.id)}}),this.props.payload&&(l=this.props.payload[n.id]),void 0===l&&(l=""),this.props.onSaveFieldsAndGroups(a,i,r.id,l)}}},render:function(){var e=this,t=this.props.model;if(!t||!t.fields&&!t.groups)return null;var a=t.fields||{},i=t.groups||[],n=[],s=Object.keys(a).sort(function(e,t){return a[e].index-a[t].index}).map(function(e){return{key:e,field:a[e]}});i.forEach(function(e){n.push({type:"group",key:e.id,item:e}),e.childIds&&e.childIds.length>0&&e.childIds.forEach(function(t){s.forEach(function(a,i){a.field.id===t&&(n.push({type:"field",key:a.key,item:a.field,parentId:e.id}),s.splice(i,1))})})});var l=[];s.forEach(function(e){l.push({type:"field",key:e.key,item:e.field,parentId:null})}),n.unshift.apply(n,l);var r=(0,pa.Zj)(function(t){var a=t.fieldId,i=t.isGroup,n=t.field,s=t.parentId;return o().createElement(da,{id:n.id,title:n.title,type:i?"group":n.type,fieldId:a,hasChildren:i&&n.childIds&&n.childIds.length,parentId:s,selected:e.props.selected===a,onGetControlNodeType:e.props.onGetControlNodeType,onSelect:e.onSelect,onDeleteField:e.props.onDeleteField,onDeleteGroup:e.props.onDeleteGroup,onDuplicateField:e.onDuplicateField})}),c=(0,pa.q6)(function(t){var a=t.items;return o().createElement("div",{className:"control-node-list",ref:function(t){e.refNodeList=t}},a.map(function(e,t){return o().createElement(r,{key:e.key,isGroup:"group"===e.type,fieldId:e.key,field:e.item,parentId:e.parentId,index:t})}))});return o().createElement("div",{className:"control-node-list-wrapper",ref:function(t){e.refNodeListWrapper=t}},o().createElement(c,{items:n,onSortEnd:function(t){return e.onSortEnd(n,t)},shouldCancelStart:function(e){},updateBeforeSortStart:function(e){e.index},onSortStart:function(e,t){},onSortMove:function(e){},onSortOver:function(t){return e.onSortOver(n,t)},axis:"y",lockAxis:"y",distance:5,pressThreshold:5,lockToContainerEdges:!0,helperClass:"dragging"}))}});var va=a(9769);const ba=o().createClass({displayName:"CheckboxNumber",getInitialState:function(){return{backupValue:void 0}},componentWillMount:function(){void 0===this.props.value||""===this.props.value?this.setState({backupValue:this.props.default}):this.setState({backupValue:this.props.value})},shouldComponentUpdate:function(e,t){return!va.compareObject(t,this.state)||!va.compareObject(e,this.props)},render:function(){var e=this,t=this.props.value,a=!0;return""!==t&&null!=t||(a=!1,t=this.state.backupValue),o().createElement("span",{className:"checkbutton-number"},o().createElement("span",null,o().createElement(se.A,{name:"active",value:a,onValueChanged:function(t,a){a?e.props.onValueChanged(e.state.backupValue):e.props.onValueChanged(null)}})),o().createElement(te.A,{name:"number",resetValue:this.props.default,value:t,disabled:!a,width:"99px",step:this.props.step||"1",format:this.props.step||"1",unit:this.props.unit,onValueChanged:function(t,a){e.setState({backupValue:a}),e.props.onValueChanged(a)}}))}});function ya(e){return ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ya(e)}function Ea(e,t,a){return(t=function(e){var t=function(e){if("object"!=ya(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=ya(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ya(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var wa=a(9769);const Sa=o().createClass({displayName:"ControlNodeDetails",getInitialState:function(){return{fieldId:"",fieldIdValue:"",fieldIdOriginalValue:"",fieldIdValueValid:!0,fieldIdLocked:!1}},componentWillMount:function(){this.setInitialStateValues(this.props)},componentWillReceiveProps:function(e){this.setInitialStateValues(e)},shouldComponentUpdate:function(e,t){return!wa.compareObject(e,this.props)||!wa.compareObject(t,this.state)},setInitialStateValues:function(e){if(this.state.fieldId!==e.selected){var t=this.getCurrentModelField(e.model,e.selected);t?this.setState({fieldId:e.selected,fieldIdOriginalValue:t.id,fieldIdValue:t.id,fieldIdValueValid:!0,fieldIdLocked:t.id===t.title}):this.setState({fieldId:"",fieldIdOriginalValue:"",fieldIdValue:"",fieldIdValueValid:!0,fieldIdLocked:!0})}},getCurrentModelField:function(e,t){if(t&&e&&e.fields)return e.fields[t]},getModelFieldValue:function(e){var t=this.getCurrentModelField(this.props.model,this.props.selected);if(t&&void 0!==t[e])return t[e]},getPayloadFieldValue:function(e){var t=this.props.payload;return t&&void 0!==t[e]?t[e]:""},onModelFieldIdChanged:function(e,t){var a=this.verifyModelFieldId(t,this.state.fieldId,!0);this.setState({fieldIdValueValid:null!==a,fieldIdValue:null!==a?a:t})},onModelFieldIdBlur:function(e,t){var a=this.verifyModelFieldId(t.target.value,this.state.fieldId);if(a)this.state.fieldIdOriginalValue!==a&&(this.props.onModelFieldIdChanged(this.state.fieldId,this.state.fieldIdOriginalValue,a),this.state.fieldIdLocked&&this.onModelFieldPropertyChanged("title",a),this.setState({fieldIdValueValid:!0,fieldIdOriginalValue:a,fieldIdValue:a}));else{var i=this.getCurrentModelField(this.props.model,this.props.selected);i&&this.setState({fieldIdOriginalValue:i.id,fieldIdValue:i.id,fieldIdValueValid:!0})}},onModelFieldIdKeyDown:function(e,t){if("Escape"===t.key){var a=this.getCurrentModelField(this.props.model,this.props.selected);a&&this.setState({fieldIdOriginalValue:a.id,fieldIdValue:a.id,fieldIdValueValid:!0})}"Enter"===t.key&&this.state.fieldIdValueValid&&this.onModelFieldIdBlur(e,t)},onModelFieldPropertyChanged:function(e,t){this.props.onModelFieldPropertyChanged(this.state.fieldId,e,t)},onPayloadFieldValueChanged:function(e,t){this.props.onPayloadFieldValueChanged(e,t)},verifyModelFieldId:function(e,t,a){if("string"!=typeof e)return null;for(var i=e.replace(/[\/\.\[\]\#\$\\"'`]/g,""),n=0;n<i.length;n++)(i.charCodeAt(n)<31||127==i.charCodeAt(n))&&(i=i.slice(0,n)+i.slice(n+1),n--);a||(i=i.trim());var s=/^\d+$/.test(i);if(""==i||s)return null;if(this.props.model&&this.props.model.fields){var o=this.props.model;if(i&&o&&o.fields)for(var l in o.fields)if(o.fields[l]&&o.fields[l].id==i&&l!==t)return null}return i},renderTitleBar:function(e,t){var a=this;return this.props.uiStates[t]?null:[o().createElement("span",{key:"valueSeparator",className:"full-width highlight-text clickable",onClick:function(){return a.props.onUiStateChanged(t,!a.props.uiStates[t])}},e,o().createElement("i",{className:"fa "+(this.props.uiStates[t]?"fa-chevron-down":"fa-chevron-up")}))]},render:function(){var e=this,t=this.props.selected,a=this.props.model;if(!a||!a.fields)return null;if(!t)return o().createElement("div",{className:"control-node-details"},o().createElement("div",{className:"message"},"Select a control node to edit"));var i=this.getCurrentModelField(a,t);if(!i)return o().createElement("div",{className:"control-node-details"},o().createElement("div",{className:"message"},"No editor for this control node type exists"));var n=this.props.onGetControlNodeType(i.type);return o().createElement("div",{className:"control-node-details"},o().createElement("div",{className:"fields"},o().createElement("div",{className:"full-width type"},o().createElement("i",{className:n.icon}),o().createElement("div",{className:"title"},n.title)),o().createElement("span",{className:"field-label"},"Id"),o().createElement("span",{style:{position:"relative"}},o().createElement(lt.A,{name:"id",value:this.state.fieldIdValue,width:"130px",onValueChanged:this.onModelFieldIdChanged,onBlur:this.onModelFieldIdBlur,onKeyDown:this.onModelFieldIdKeyDown}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"lock-id-title"},this.state.fieldIdLocked?"Unlock to set the id and title separately":"Lock to set the id and title to the same value")},o().createElement("div",{onClick:function(){e.state.fieldIdLocked||e.onModelFieldPropertyChanged("title",e.state.fieldIdValue),e.setState({fieldIdLocked:!e.state.fieldIdLocked})},className:this.state.fieldIdLocked?"fa fa-lock":"constrain-proportion-selector",style:{position:"absolute",right:this.state.fieldIdLocked?"6px":"17px",top:this.state.fieldIdLocked?"4px":"12px",color:"#d6d6d6",padding:this.state.fieldIdLocked?"5px":"0px"}})),!this.state.fieldIdValueValid&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"field-id-error"},"Control field ids have to be unique, cannot be a number and cannot contain . # $ / [ ]")},o().createElement("span",{className:"field-id-error"},o().createElement("i",{className:"fa fa-exclamation-triangle"})))),!this.state.fieldIdLocked&&o().createElement("span",{className:"field-label"},"Title"),!this.state.fieldIdLocked&&o().createElement(lt.A,{name:"title",value:this.getModelFieldValue("title")||"",width:"130px",disabled:this.state.fieldIdLocked,onValueChanged:this.onModelFieldPropertyChanged}),function(){if(!i)return null;if("selection"===i.type){var t,a=e.renderTitleBar("Field properties","showFieldProperties");if(a)return a;switch(e.getModelFieldValue("format")){case"color":t="Display format Color needs the JSON 'id' to be a valid HTML color value like #ff0000 or red";break;case"image":t="Display format Image needs the JSON 'id' to be a valid image Url";break;default:t="The JSON 'id' will be used as the value of the field"}var n,s,l,r,c=e.getModelFieldValue("source")||"";return n="url"===c?"Enter a Url that returns a JSON array of objects with 'id' and 'title' properties":"Enter a JSON array of objects with 'id' and 'title' properties","url"===c?(s=o().createElement("span",{className:"element-properties-wrapper",style:{display:"flex",alignItems:"center",paddingLeft:"5px"}},o().createElement(lt.A,{id:"sourceUrl",name:"sourceUrl",width:"240px",value:e.getModelFieldValue("sourceUrl")||"",onValueChanged:e.onModelFieldPropertyChanged})),l=o().createElement("span",{className:"field-label"},"Use reload button"),r=o().createElement(se.A,{name:"useReload",height:"28px",value:e.getModelFieldValue("useReload")||!1,onValueChanged:e.onModelFieldPropertyChanged})):s=o().createElement("span",{className:"element-properties-wrapper",style:Ea(Ea({paddingLeft:"1px",paddingRight:"1px"},"paddingLeft","5px"),"width","calc(100% - 9px)")},o().createElement(ea.A,{id:"selections",name:"selections",width:"100%",height:"300px",value:e.getModelFieldValue("selections")||"",onValueChanged:e.onModelFieldPropertyChanged})),[o().createElement("span",{key:"valueSeparator",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldProperties",!e.props.uiStates.showFieldProperties)}},"Field properties",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldProperties?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleFormat"},"Display format"),o().createElement("div",{key:"format",style:{display:"flex",alignItems:"center"}},o().createElement(ae.A,{name:"format",selections:[{title:"Text",id:"text"},{title:"Color",id:"color"},{title:"Image",id:"image"}],value:e.getModelFieldValue("format")||"text",onValueChanged:e.onModelFieldPropertyChanged}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"format-info"},t)},o().createElement("span",{style:{display:"flex",alignItems:"center",padding:"5px"}},o().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"16px",position:"relative",top:"1px"}})))),o().createElement("span",{className:"field-label",key:"title"},"Use filter"),o().createElement(se.A,{key:"useFilter",name:"useFilter",height:"28px",value:e.getModelFieldValue("useFilter")||!1,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{className:"field-label",key:"titleSource"},"JSON Source"),o().createElement("div",{key:"source",style:{display:"flex",alignItems:"center"}},o().createElement(ae.A,{name:"source",selections:[{title:"Manual",id:""},{title:"Url",id:"url"}],value:c,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"source-info"},n)},o().createElement("span",{style:{display:"flex",alignItems:"center",padding:"5px"}},o().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"16px",position:"relative",top:"1px"}})))),o().createElement("div",{key:"titleOptions",className:"full-width-vertical-layout"},s),o().createElement("span",{key:"sourceReloadLabel"},l),o().createElement("span",{key:"sourceReloadCheckbox"},r)]}if("number"===i.type){var d=e.renderTitleBar("Field properties","showFieldProperties");if(d)return d;var p=e.getModelFieldValue("showSlider"),m=e.getModelFieldValue("min")||"",u=e.getModelFieldValue("max")||"",h=""===m&&p||""===u&&p;return[o().createElement("span",{key:"valueSeparator",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldProperties",!e.props.uiStates.showFieldProperties)}},"Field properties",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldProperties?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleResetValue"},"Reset Value"),o().createElement(te.A,{key:"value",name:"resetValue",step:"1",width:"119px",value:e.getModelFieldValue("resetValue")||0,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{className:"field-label",key:"titleStep"},"Step"),o().createElement(ae.A,{key:"step",name:"step",selections:[{title:"1",id:"1"},{title:"0.1",id:"0.1"},{title:"0.01",id:"0.01"}],width:"130px",value:e.getModelFieldValue("step")||1,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{className:"field-label",key:"titleUnit"},"Unit"),o().createElement(lt.A,{key:"unit",name:"unit",width:"130px",maxLength:"3",value:e.getModelFieldValue("unit")||"",onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{key:"numberSeparator",className:"full-width"}),o().createElement("span",{className:"field-label",key:"titleMin"},"Minimum"),o().createElement(ba,{key:"min",value:m,default:"0",step:e.getModelFieldValue("step")||"1",unit:e.getModelFieldValue("unit")||"",onValueChanged:function(t){return e.onModelFieldPropertyChanged("min",t)}}),o().createElement("span",{className:"field-label",key:"titleMax"},"Maximum"),o().createElement(ba,{key:"max",value:u,default:"100",step:e.getModelFieldValue("step")||"1",unit:e.getModelFieldValue("unit")||"",onValueChanged:function(t){return e.onModelFieldPropertyChanged("max",t)}}),o().createElement("span",{className:"field-label",key:"titleShowSlider"},"Show Slider"),o().createElement("span",{key:"showSlider",className:"checkbutton-line"},o().createElement(se.A,{key:"showSlider",name:"showSlider",height:"28px",value:e.getModelFieldValue("showSlider")||!1,onValueChanged:e.onModelFieldPropertyChanged}),h&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"field-id-error"},"The slider is only visible when the minimum and maximum is active")},o().createElement("span",{className:"field-id-error"},o().createElement("i",{className:"fa fa-exclamation-triangle"}))))]}return"normalizednumber"===i.type?e.renderTitleBar("Field properties","showFieldProperties")||[o().createElement("span",{key:"valueSeparator",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldProperties",!e.props.uiStates.showFieldProperties)}},"Field properties",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldProperties?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleResetValue"},"Reset Value"),o().createElement(te.A,{key:"value",name:"resetValue",step:"0.1",format:"0.1",unit:"%",value:e.getModelFieldValue("resetValue")||0,width:"119px",onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{className:"field-label",key:"titleLow"},"Output Low"),o().createElement(te.A,{key:"low",name:"low",step:"0.1",format:"0.1",default:"0.0",value:e.getModelFieldValue("low"),width:"119px",onValueChanged:function(t,a){e.onModelFieldPropertyChanged(t,a),e.onPayloadFieldValueChanged(i.id,e.getPayloadFieldValue(i.id)+" ")}}),o().createElement("span",{className:"field-label",key:"titleMax"},"Output High"),o().createElement(te.A,{key:"high",name:"high",step:"0.1",format:"0.1",default:"100.0",value:e.getModelFieldValue("high"),width:"119px",onValueChanged:function(t,a){e.onModelFieldPropertyChanged(t,a),e.onPayloadFieldValueChanged(i.id,e.getPayloadFieldValue(i.id)+" ")}}),o().createElement("span",{className:"field-label",key:"titleShowSlider"},"Show Slider"),o().createElement(se.A,{key:"showSlider",name:"showSlider",height:"28px",value:e.getModelFieldValue("showSlider")||!1,onValueChanged:e.onModelFieldPropertyChanged})]:"counter"===i.type?e.renderTitleBar("Field properties","showFieldProperties")||[o().createElement("span",{key:"valueSeparator",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldProperties",!e.props.uiStates.showFieldProperties)}},"Field properties",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldProperties?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleResetValue"},"Reset Value"),o().createElement(te.A,{key:"value",name:"resetValue",step:"1",width:"119px",value:e.getModelFieldValue("resetValue")||0,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement("span",{className:"field-label",key:"titleMin"},"Minimum"),o().createElement(ba,{key:"min",value:e.getModelFieldValue("min"),default:"0",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("min",t)}}),o().createElement("span",{className:"field-label",key:"titleMax"},"Maximum"),o().createElement(ba,{key:"max",value:e.getModelFieldValue("max"),default:"100",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("max",t)}})]:void 0}(),i&&"counter"===i.type?e.renderTitleBar("Set buttons","showFieldPropertiesSetButtons")||[o().createElement("span",{key:"valueSeparatorSetButtons",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldPropertiesSetButtons",!e.props.uiStates.showFieldPropertiesSetButtons)}},"Set buttons",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldPropertiesSetButtons?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleS1"},"S1"),o().createElement(ba,{key:"s1",value:e.getModelFieldValue("s1"),default:"0",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s1",t)}}),o().createElement("span",{className:"field-label",key:"titleS2"},"S2"),o().createElement(ba,{key:"s2",value:e.getModelFieldValue("s2"),default:"1",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s2",t)}}),o().createElement("span",{className:"field-label",key:"titleS3"},"S3"),o().createElement(ba,{key:"s3",value:e.getModelFieldValue("s3"),default:"2",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s3",t)}}),o().createElement("span",{className:"field-label",key:"titleS4"},"S4"),o().createElement(ba,{key:"s4",value:e.getModelFieldValue("s4"),default:"3",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s4",t)}}),o().createElement("span",{className:"field-label",key:"titleS5"},"S5"),o().createElement(ba,{key:"s5",value:e.getModelFieldValue("s5"),default:"4",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s5",t)}}),o().createElement("span",{className:"field-label",key:"titleS6"},"S6"),o().createElement(ba,{key:"s6",value:e.getModelFieldValue("s6"),default:"5",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s6",t)}}),o().createElement("span",{className:"field-label",key:"titleS7"},"S7"),o().createElement(ba,{key:"s7",value:e.getModelFieldValue("s7"),default:"6",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("s7",t)}})]:null,i&&"counter"===i.type?e.renderTitleBar("Modify buttons","showFieldPropertiesModifyButtons")||[o().createElement("span",{key:"valueSeparatorModifyButtons",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldPropertiesModifyButtons",!e.props.uiStates.showFieldPropertiesModifyButtons)}},"Modify buttons",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldPropertiesModifyButtons?"fa-chevron-down":"fa-chevron-up")})),o().createElement("span",{className:"field-label",key:"titleM1"},"M1"),o().createElement(ba,{key:"m1",value:e.getModelFieldValue("m1"),default:"-1",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m1",t)}}),o().createElement("span",{className:"field-label",key:"titleM2"},"M2"),o().createElement(ba,{key:"m2",value:e.getModelFieldValue("m2"),default:"1",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m2",t)}}),o().createElement("span",{className:"field-label",key:"titleM3"},"M3"),o().createElement(ba,{key:"m3",value:e.getModelFieldValue("m3"),default:"2",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m3",t)}}),o().createElement("span",{className:"field-label",key:"titleM4"},"M4"),o().createElement(ba,{key:"m4",value:e.getModelFieldValue("m4"),default:"3",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m4",t)}}),o().createElement("span",{className:"field-label",key:"titleM5"},"M5"),o().createElement(ba,{key:"m5",value:e.getModelFieldValue("m5"),default:"4",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m5",t)}}),o().createElement("span",{className:"field-label",key:"titleM6"},"M6"),o().createElement(ba,{key:"m6",value:e.getModelFieldValue("m6"),default:"5",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m6",t)}}),o().createElement("span",{className:"field-label",key:"titleM7"},"M7"),o().createElement(ba,{key:"m7",value:e.getModelFieldValue("m7"),default:"6",step:"1",onValueChanged:function(t){return e.onModelFieldPropertyChanged("m7",t)}})]:null,function(){if(!i)return null;if("infotext"===i.type){var t=e.renderTitleBar("Text and HTML","showFieldValue");if(t)return t;var a="In Dynamic mode, the text/HTML is taken from the payload value and can be updated via the REST API.",n=e.getPayloadFieldValue(i.id)||"",s=e.getModelFieldValue("mode")||"";return"static"===s&&(n=e.getModelFieldValue("text")||"",a="In Static mode, the text/HTML will be updated when a comp is reload in the contorl app."),[o().createElement("div",{className:"full-width-vertical-layout"},o().createElement("span",{className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showFieldValue",!e.props.uiStates.showFieldValue)}},"Text and HTML",o().createElement("i",{className:"fa "+(e.props.uiStates.showFieldValue?"fa-chevron-down":"fa-chevron-up")}))),o().createElement("span",{className:"field-label"},"Mode"),o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement(ae.A,{name:"mode",selections:[{title:"Dynamic",id:""},{title:"Static",id:"static"}],value:s,onValueChanged:e.onModelFieldPropertyChanged}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"mode-info"},a)},o().createElement("span",{style:{display:"flex",alignItems:"center",padding:"5px"}},o().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"16px",position:"relative",top:"1px"}})))),o().createElement("div",{className:"full-width-vertical-layout"},o().createElement("span",{className:"element-properties-wrapper"},o().createElement("span",{className:"textarea-wrapper",style:{position:"relative",width:"100%",marginTop:"5px",marginRight:"10px",marginLeft:"5px"}},o().createElement("textarea",{className:"form-control",rows:"5",name:i.id,value:n,onKeyDown:function(e){if("PageUp"==e.key&&(window.scrollTo(0,window.scrollY),e.preventDefault(),e.target.setSelectionRange(0,0),e.target.scrollTop=0),"PageDown"==e.key){window.scrollTo(0,window.scrollY),e.preventDefault();var t=e.target.value.length;e.target.setSelectionRange(t,t),e.target.scrollTop=999999}},onChange:function(t){"static"!==s?(e.onPayloadFieldValueChanged(i.id,t.target.value),e.onModelFieldPropertyChanged("defaultValue",t.target.value)):e.onModelFieldPropertyChanged("text",t.target.value)}}))))]}return null}(),i?[o().createElement("span",{key:"advancedSeparator",className:"full-width highlight-text clickable",onClick:function(){return e.props.onUiStateChanged("showAdvanced",!e.props.uiStates.showAdvanced)}},"Advanced",o().createElement("i",{className:"fa "+(e.props.uiStates.showAdvanced?"fa-chevron-down":"fa-chevron-up")}))]:null,i&&e.props.uiStates.showAdvanced?"infotext"===i.type?null:[o().createElement("span",{className:"field-label",key:"title"},"Tag as advanced"),o().createElement(se.A,{key:"value",name:"style",height:"28px",value:e.getModelFieldValue("style")||!1,onValueChanged:e.onModelFieldPropertyChanged})]:null,i&&e.props.uiStates.showAdvanced?"infotext"===i.type?null:[o().createElement("span",{className:"field-label",key:"title"},"Instant update"),o().createElement(se.A,{key:"value",name:"immediateUpdate",height:"28px",value:e.getModelFieldValue("immediateUpdate")||!1,onValueChanged:e.onModelFieldPropertyChanged})]:null,i&&e.props.uiStates.showAdvanced?"infotext"===i.type?null:[o().createElement("span",{className:"field-label",key:"title"},"Hide in form"),o().createElement(se.A,{key:"value",name:"hidden",height:"28px",value:e.getModelFieldValue("hidden")||!1,onValueChanged:e.onModelFieldPropertyChanged})]:null,i&&e.props.uiStates.showAdvanced?"button"===i.type?null:[o().createElement("span",{className:"field-label",key:"title"},"Hide title"),o().createElement(se.A,{key:"value",name:"hideTitle",height:"28px",value:e.getModelFieldValue("hideTitle")||!1,onValueChanged:e.onModelFieldPropertyChanged})]:null))}});var Na=a(87021),Ca=a.n(Na),xa=a(9769);const Ia=o().createClass({displayName:"ControlNodeGroupDetails",getInitialState:function(){return{}},componentWillMount:function(){},componentWillReceiveProps:function(e){},shouldComponentUpdate:function(e,t){return!xa.compareObject(e,this.props)||!xa.compareObject(t,this.state)},getCurrentGroup:function(){var e=this;if(this.props.selected&&this.props.model&&this.props.model.groups)return this.props.model.groups.find(function(t){return t.id===e.props.selected})},getGroupPropertyValue:function(e){var t=this.getCurrentGroup();if(t&&void 0!==t[e])return t[e]},getGroupPayload:function(){var e=this,t=this.getCurrentGroup();if(t){var a={};return t.childIds&&t.childIds.forEach(function(t){var i=e.props.model;for(var n in i.fields){var s=i.fields[n];if(s&&s.id==t){if("timecontrol"===s.type||"button"===s.type)return;if(void 0!==e.props.payload[t])if("color"===s.type){var o=Ca()(e.props.payload[t]);1==o.getAlpha()?a[s.id]=o.toHexString():a[s.id]=o.toHex8()}else a[s.id]=e.props.payload[t]}}}),a}},onGroupPropertyChanged:function(e,t){this.props.onGroupPropertyChanged(this.props.selected,e,t)},render:function(){var e=this.props.selected,t=this.props.model;if(!t||!t.groups)return null;if(!e)return o().createElement("div",{className:"control-node-details"},o().createElement("div",{className:"message"},"Select a group to edit"));var a,i=this.props.onGetControlNodeType("group"),n=this.getGroupPropertyValue("childIds");if(t.fields&&n&&n.length){var s=Object.keys(t.fields),l=[];s.forEach(function(e){var a=t.fields[e];"checkbox"===a.type&&-1!==n.indexOf(a.id)&&l.push(a)}),l.length&&(a=l.map(function(e){return{title:e.title,id:e.id}})).unshift({title:"None",id:""})}var r=this.getGroupPropertyValue("usePreset")||!1,c=this.getGroupPayload();return o().createElement("div",{className:"control-node-details"},o().createElement("div",{className:"fields"},o().createElement("div",{className:"full-width type"},o().createElement("div",{className:"title"},i.title)),o().createElement("span",{className:"field-label"},"Title"),o().createElement(lt.A,{name:"title",value:this.getGroupPropertyValue("title")||"",width:"130px",onValueChanged:this.onGroupPropertyChanged}),o().createElement("span",{className:"field-label"},"Width"),o().createElement(ae.A,{name:"width",selections:[{title:"Small",id:""},{title:"Large",id:"double"}],width:"130px",value:this.getGroupPropertyValue("width")||"",onValueChanged:this.onGroupPropertyChanged}),o().createElement("span",{className:"field-label"},"Active Checkbox"),o().createElement("span",{style:{position:"relative",display:"flex"}},o().createElement("span",{style:{flexGrow:"1"}},o().createElement(ae.A,{name:"activeId",selections:a,width:"130px",value:this.getGroupPropertyValue("activeId")||"",onValueChanged:this.onGroupPropertyChanged})),!a&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"format-info"},"Select one checkbox within your group to enable and disable the group")},o().createElement("span",{style:{display:"flex",alignItems:"center",padding:"5px"}},o().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"16px",position:"relative",top:"1px"}})))),o().createElement("span",{className:"field-label"},"Tooltip"),o().createElement(lt.A,{name:"toolTip",value:this.getGroupPropertyValue("toolTip"),width:"130px",onValueChanged:this.onGroupPropertyChanged}),o().createElement("span",{className:"highlight-text",style:{width:"230px"}},"Preset Selection"),o().createElement("span",{className:"highlight-text",style:{position:"relative",left:"110px",width:"45px"}},o().createElement(se.A,{name:"usePreset",height:"21px",value:r,onValueChanged:this.onGroupPropertyChanged})),o().createElement("span",{className:"field-label"},"JSON Source Url"),o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement("span",{style:{display:"flex",alignItems:"center"}},o().createElement(lt.A,{id:"presetSourceUrl",name:"presetSourceUrl",width:"130px",value:this.getGroupPropertyValue("presetSourceUrl")||"",disabled:!r,onValueChanged:this.onGroupPropertyChanged}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"format-info"},"Enter a Url that returns a JSON array of objects with 'id', 'title' and 'payload' properties")},o().createElement("i",{className:"fa fa-question-circle",style:{fontSize:"16px",position:"relative",top:"1px",right:"-4px"}})))),o().createElement("span",{className:"field-label"},"Use filter"),o().createElement(se.A,{name:"usePresetFilter",height:"28px",value:this.getGroupPropertyValue("usePresetFilter")||!1,disabled:!r,onValueChanged:this.onGroupPropertyChanged}),o().createElement("span",{className:"field-label"},"Use reload button"),o().createElement(se.A,{name:"usePresetReload",height:"28px",value:this.getGroupPropertyValue("usePresetReload")||!1,disabled:!r,onValueChanged:this.onGroupPropertyChanged}),o().createElement("span",{className:"field-label"},"Copy payload"),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"copy-group-payload"},"Copy the payload of the field in the group to the clipboard")},o().createElement("span",{style:{width:"24px",height:"24px"}},o().createElement($t(),{className:"btn input-group-addon icon-only","data-clipboard-text":c?JSON.stringify(c,null,2):"{}","button-tabIndex":"-1",style:{height:"24px",width:"24px",fontSize:"10px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"}))))))}});function ka(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function Da(e,t,a){return(t=function(e){var t=function(e){if("object"!=Aa(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Aa(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Aa(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Aa(e){return Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Aa(e)}var Ra=a(10611),Pa=a(9769),Ta=[{id:"group",title:"Node Container",icon:""},{id:"--divider--",title:"--divider--",icon:""},{id:"text",title:"Text",icon:"fa fa-font"},{id:"image",title:"Image",icon:"fa fa-picture-o"},{id:"number",title:"Number",icon:"fa fa-hashtag"},{id:"color",title:"Color",icon:"fa fa-eyedropper"},{id:"--divider--",title:"--divider--",icon:""},{id:"textarea",title:"Text Area",icon:"fa fa-align-left"},{id:"checkbox",title:"Checkbox",icon:"fa fa-check-square-o"},{id:"gradient",title:"Gradient",icon:"fa fa-sliders"},{id:"counter",title:"Counter",icon:"fa fa-sort-numeric-desc"},{id:"normalizednumber",title:"Normalized Number",icon:"fa fa-percent"},{id:"selection",title:"Selection",icon:"fa fa-list"},{id:"json",title:"JSON Text",icon:"fa fa-code"},{id:"timecontrol",title:"Time Control",icon:"fa fa-clock-o"},{id:"datetime",title:"Date Time",icon:"fa fa-calendar"},{id:"location",title:"Location",icon:"fa fa-map-marker"},{id:"button",title:"Button",icon:"fa fa-hand-pointer-o"},{id:"infotext",title:"Info Text",icon:"fa fa-info-circle"},{id:"audio",title:"Audio",icon:"fa fa-music"},{id:"video",title:"Video",icon:"fa fa-video-camera"},{id:"data",title:"Data",icon:"fa fa-file"},{id:"jsonfile",title:"JSON",icon:"fa fa-file-code-o"}];const Ma=o().createClass({displayName:"ControlNodeManager",mixins:[W.A,$e.A],getInitialState:function(){return{currentType:"text",controlNodeFieldId:"",controlNodeFieldIsValid:!1,errorMessage:"",currentOverlay:null,currentFields:{},editedFieldId:null,showHighlight:!0,showStyle:!0,uiState:{showFieldProperties:!0,showFieldPropertiesSetButtons:!0,showFieldPropertiesModifyButtons:!0,showFieldValue:!0,showAdvanced:!1},forceUpdate:0}},componentWillMount:function(){this.sBindAsObject(this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode"),"compositionControlNode"),this.sBindAsObject(this.props.sbRef.child("compositions"),"compositions")},componentDidMount:function(){this.refs.fillInForm&&$(this.refs.fillInForm).tab("show")},shouldComponentUpdate:function(e,t){return!Pa.compareObject(e,this.props)||!Pa.compareObject(t,this.state)},addNode:function(e){if(0!=this.state.controlNodeFieldIsValid){var t,a=this.verifyNodeId(this.state.controlNodeFieldId,!0);a&&(t="group"==this.state.currentType?this.onControlNodeGroupAdd(this.state.compositionControlNode,a):this.onControlNodeAdd(this.state.compositionControlNode,a,this.state.currentType,null,null,this.state.editedFieldId))&&(this.onSetSelectedFieldId(t),this.setState({editedFieldId:t})),this.setState({controlNodeFieldIsValid:!1,controlNodeFieldId:""})}},onControlNodeGroupAdd:function(e,t){var a=this;if(e){var i=[];e.model&&e.model.groups&&(i=e.model.groups);var n={id:Ra.v4(),title:t,width:"double",toolTip:"",activeId:"",childIds:[]},s=null;e.model&&e.model.fields&&e.model.fields[this.state.editedFieldId]&&(s=e.model.fields[this.state.editedFieldId]);var o=-1;return this.state.editedFieldId&&i.forEach(function(e,t){null===s?e.id===a.state.editedFieldId&&(o=t):e.childIds&&e.childIds.includes(s.id)&&(o=t)}),-1===o?i.push(n):i.splice(o+1,0,n),this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model").child("groups").set(i),n.id}},__checkDataLink:function(e,t,a,i,n){var s="dataLinks";for(var o in t[s]){var l=t[s][o];for(var r in l){var c=l[r];"controlNode"==c.type&&c.key==i&&("self"==c.locationId?a:"root"==c.locationId?this.props.sbCompositionRef.parent.parent.key:c.locationId)==e&&n&&n(this.props.sbCompositionRef.parent.child(a).child(s).child(o).child(r))}}},__checkNodeRefLink:function(e,t,a,i,n){var s="nodeRefs";for(var o in t[s]){var l=t[s][o];for(var r in l){var c=l[r];"controlNode"==c.sourceType&&c.sourceKey==i&&c.sourceLocation.length&&c.sourceLocation[0]&&("<selfCompId>"==c.sourceLocation[0]?a:"<rootCompId>"==c.sourceLocation[0]?this.props.sbCompositionRef.parent.parent.key:c.sourceLocation[0])==e&&n&&n(this.props.sbCompositionRef.parent.child(a).child(s).child(o).child(r))}}},onTypeChange:function(e,t){var a=this;this.setState({currentType:t},function(){a.verifyNodeId(a.state.controlNodeFieldId,!1)})},onFieldIdChanged:function(e,t,a){if(t!=a){var i=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode");i.beginBatch(),i.child("payload").child(a).set(i.child("payload").child(t).val()),i.child("payload").child(t).remove();var n=this.props.sbCompositionRef.parent.val(),s=this.props.sbCompositionRef.key;for(var o in n){var l=n[o];this.__checkDataLink(s,l,o,t,function(e){e.child("key").set(a)}),this.__checkNodeRefLink(s,l,o,t,function(e){e.child("sourceKey").set(a)})}i.child("model").child("fields").child(e).child("id").set(a);var r=i.child("model").child("groups").val();r&&r.length&&(r.forEach(function(e){e.childIds&&e.childIds.length&&(e.childIds=e.childIds.map(function(e){return e===t?a:e})),e.activeId===t&&(e.activeId=a)}),i.child("model").child("groups").set(r)),i.endBatch()}},onControlNodeChanged:function(e,t,a){var i=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model").child("fields").child(e).child(t);if(null!==a){if("selections"===t&&"object"!==Aa(a)){try{a=JSON.parse(a)}catch(e){}a||(a=[])}i.set(a)}else i.remove()},onControlNodeValueChanged:function(e,t){this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("payload").child(e).set(t)},onGroupPropertyChanged:function(e,t,a){var i=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model").child("groups"),n=i.val();n&&n.length&&n.forEach(function(i){i.id===e&&(i[t]=a)}),i.set(n)},onUiStateChanged:function(e,t){var a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ka(Object(a),!0).forEach(function(t){Da(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ka(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},this.state.uiState);a[e]=t,this.setState({uiState:a})},onGetEditedItemId:function(){var e=this;if(!this.state.editedFieldId)return"";if(this.state.compositionControlNode.model&&this.state.compositionControlNode.model.fields&&this.state.compositionControlNode.model.fields[this.state.editedFieldId]){var t=this.state.compositionControlNode.model.fields[this.state.editedFieldId];if(t)return t.id}if(this.state.compositionControlNode.model&&this.state.compositionControlNode.model.groups){var a=this.state.compositionControlNode.model.groups.find(function(t){return t.id===e.state.editedFieldId});if(a)return a.id}},onGetEditedItemType:function(){var e=this;if(!this.state.editedFieldId)return"";if(this.state.compositionControlNode.model&&this.state.compositionControlNode.model.fields&&this.state.compositionControlNode.model.fields[this.state.editedFieldId]){var t=this.state.compositionControlNode.model.fields[this.state.editedFieldId];if(t)return t.type}return this.state.compositionControlNode.model&&this.state.compositionControlNode.model.groups&&this.state.compositionControlNode.model.groups.find(function(t){return t.id===e.state.editedFieldId})?"group":""},verifyNodeId:function(e,t){var a=this,i=function(e,t){a.setState({controlNodeFieldIsValid:e,controlNodeFieldId:t})};if("string"!=typeof e)return i(!1,""),"";if("group"===this.state.currentType){var n=e;return t&&(n=n.trim()),""==n||""==n.trim()?i(!1,n):i(!0,n),n}for(var s=e.replace(/[\/\.\[\]\#\$\\"'`]/g,""),o=0;o<s.length;o++)(s.charCodeAt(o)<31||127==s.charCodeAt(o))&&(s=s.slice(0,o)+s.slice(o+1),o--);t&&(s=s.trim());var l=/^\d+$/.test(s);if(""==s||""==s.trim()||l)return i(!1,e),e;var r=s.trim();if(this.state.compositionControlNode){var c=this.state.compositionControlNode.model;if(r&&c&&c.fields)for(var d in c.fields)if(c.fields[d]&&c.fields[d].id==r)return i(!1,s),s}return i(!0,s),s},onEdit:function(e){this.onSetSelectedFieldId(e),this.setState({editedFieldId:e})},onDeleteGroup:function(e){e===this.state.editedFieldId&&(this.onSetSelectedFieldId(null),this.setState({editedFieldId:null}));var t=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model").child("groups"),a=t.val();if(a){var i=a.filter(function(t){return t.id!==e});t.set(i)}},onDeleteField:function(e){e===this.state.editedFieldId&&(this.onSetSelectedFieldId(null),this.setState({editedFieldId:null}));var t=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model").child("fields").child(e).val(),a=this.props.sbCompositionRef.parent.val(),i=this.props.sbCompositionRef.key;for(var n in a){var s=a[n];this.__checkDataLink(i,s,n,t.id,function(e){e.remove()}),this.__checkNodeRefLink(i,s,n,t.id,function(e){e.remove()})}var o=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode");o.beginBatch(),o.child("payload").child(t.id).remove(),o.child("model").child("fields").child(e).remove();var l=o.child("model").child("groups").val();l&&l.length&&(l.forEach(function(e){e.childIds&&(e.childIds=e.childIds.filter(function(e){return e!==t.id})),e.activeId===t.id&&(e.activeId="")}),o.child("model").child("groups").set(l)),o.endBatch()},onSaveFieldsAndGroups:function(e,t,a,i){var n=this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode"),s=n.child("model"),o=n.child("payload");s.beginBatch(),e&&(s.child("fields").set(e),void 0!==a&&void 0!==i&&o.child(a).set(i)),t&&t.length&&s.child("groups").set(t),s.endBatch(),this.setState({forceUpdate:this.state.forceUpdate+1})},forceUpdateModel:function(){this.refs.JsonViewerModel&&this.refs.JsonViewerModel.forceRedraw&&this.refs.JsonViewerModel.forceRedraw()},forceUpdatePayload:function(){this.refs.JsonViewerPayload&&this.refs.JsonViewerPayload.forceRedraw&&this.refs.JsonViewerPayload.forceRedraw()},render:function(){var e,t,a=this,i=!1;this.state.compositionControlNode&&this.state.compositionControlNode.model&&(this.state.compositionControlNode.model.fields||this.state.compositionControlNode.model.groups)&&(i=!0,this.state.compositionControlNode.model&&(e=this.state.compositionControlNode.model),this.state.compositionControlNode.payload&&(t=this.state.compositionControlNode.payload));var n=this.props.rtdbRef.key,s=this.props.sbCompositionRef.parent.val(),l=Pa.getSubcompositionNames(s)[n];null==l&&(l="Root");var r=this.onGetEditedItemType(),c=function(e){return Ta.find(function(t){return t.id===e})||{title:"Invalid",icon:"fa fa-exclamation-triangle"}};return o().createElement("div",{id:"controlNodeManager",className:"control-node-manager"},o().createElement("div",{className:"left-side"},o().createElement("div",{className:"header"},o().createElement(ae.A,{className:"input-group-btn toolbar-dropdown",useFilter:!0,selections:Ta,value:this.state.currentType,dropDownDataDisplay:"static",dropDownStyle:{maxHeight:"240px",overflowY:"auto"},width:"150px",valueRenderer:function(e){return o().createElement("div",null,o().createElement("i",{className:e.icon,style:{width:"12px",textAlign:"center",marginRight:"5px"}}),o().createElement("span",null,e.title))},onValueChanged:this.onTypeChange}),o().createElement("span",{style:{position:"relative"}},o().createElement("input",{type:"text",value:this.state.controlNodeFieldId,onChange:function(e){a.verifyNodeId(e.target.value)},onKeyDown:function(e){if(".[]#$/\\\"'`".includes(e.key))return e.preventDefault(),void e.stopPropagation();"Enter"===e.key&&a.addNode()},className:"form-control name-input",placeholder:"New control node id"}),!this.state.controlNodeFieldIsValid&&""!==this.state.controlNodeFieldId&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"field-id-error"},"Control field ids have to be unique, cannot be a number and cannot contain . # $ / [ ] \" ' `")},o().createElement("span",{className:"field-id-error"},o().createElement("i",{className:"fa fa-exclamation-triangle"})))),o().createElement("div",{className:"add-button"},o().createElement("button",{tabIndex:"-1",type:"button",className:"btn btn-default",onClick:this.addNode,disabled:!this.state.controlNodeFieldIsValid},"Add")),o().createElement("div",{className:"toolbar"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"toggleCustomization"},"Show advanced control nodes in the fill-in form")},o().createElement("div",{className:"tool "+(this.state.showStyle?"active":""),onClick:function(){a.setState({showStyle:!a.state.showStyle})}},o().createElement("i",{className:"fa fa-sliders"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"toggleHighlight"},"Highlight the selected field in the fill-in form")},o().createElement("div",{className:"tool "+(this.state.showHighlight?"active":""),onClick:function(){a.setState({showHighlight:!a.state.showHighlight})}},o().createElement("svg",{style:{top:"2px",position:"relative"},width:"16px",height:"16px",viewBox:"0 0 35 35"},o().createElement("g",null,o().createElement("path",{fillRule:"evenodd",d:"M 28 26C 28 26 4 26 4 26 4 26 2 26 2 26 2 26 2 24 2 24 2 24 2 4 2 4 2 4 2 2 2 2 2 2 4 2 4 2 4 2 28 2 28 2 28 2 30 2 30 2 30 2 30 4 30 4 30 4 30 24 30 24 30 24 30 26 30 26 30 26 28 26 28 26ZM 28 4C 28 4 4 4 4 4 4 4 4 24 4 24 4 24 28 24 28 24 28 24 28 4 28 4Z",fill:"rgb(136,136,136)"}),o().createElement("path",{fillRule:"evenodd",d:"M 30 26C 30 26 28 26 28 26 28 26 2 26 2 26 2 26 2 4 2 4 2 4 2 2 2 2 2 2 30 2 30 2 30 2 30 26 30 26 30 26 30 26 30 26ZM 4 4C 4 4 4 24 4 24 4 24 28 24 28 24 28 24 28 4 28 4 28 4 4 4 4 4 4 4 4 4 4 4Z"})),o().createElement("g",null,o().createElement("path",{fillRule:"evenodd",d:"M 28 28C 28 28 28 24 28 24 28 24 32 24 32 24 32 24 32 28 32 28 32 28 28 28 28 28ZM 28 12C 28 12 32 12 32 12 32 12 32 16 32 16 32 16 28 16 28 16 28 16 28 12 28 12ZM 28 0C 28 0 32 0 32 0 32 0 32 4 32 4 32 4 28 4 28 4 28 4 28 0 28 0ZM 14 24C 14 24 18 24 18 24 18 24 18 28 18 28 18 28 14 28 14 28 14 28 14 24 14 24ZM 14 12C 14 12 18 12 18 12 18 12 18 16 18 16 18 16 14 16 14 16 14 16 14 12 14 12ZM 14 0C 14 0 18 0 18 0 18 0 18 4 18 4 18 4 14 4 14 4 14 4 14 0 14 0ZM 0 24C 0 24 4 24 4 24 4 24 4 28 4 28 4 28 0 28 0 28 0 28 0 24 0 24ZM 0 12C 0 12 4 12 4 12 4 12 4 16 4 16 4 16 0 16 0 16 0 16 0 12 0 12ZM 0 0C 0 0 4 0 4 0 4 0 4 4 4 4 4 4 0 4 0 4 0 4 0 0 0 0Z"}),o().createElement("path",{fillRule:"evenodd",d:"M 32 28C 32 28 28 28 28 28 28 28 28 24 28 24 28 24 32 24 32 24 32 24 32 28 32 28 32 28 32 28 32 28ZM 18 28C 18 28 14 28 14 28 14 28 14 24 14 24 14 24 18 24 18 24 18 24 18 28 18 28 18 28 18 28 18 28ZM 4 28C 4 28-0 28-0 28-0 28-0 24-0 24-0 24 4 24 4 24 4 24 4 28 4 28 4 28 4 28 4 28ZM 32 16C 32 16 28 16 28 16 28 16 28 12 28 12 28 12 32 12 32 12 32 12 32 16 32 16 32 16 32 16 32 16ZM 18 16C 18 16 14 16 14 16 14 16 14 12 14 12 14 12 18 12 18 12 18 12 18 16 18 16 18 16 18 16 18 16ZM 4 16C 4 16-0 16-0 16-0 16-0 12-0 12-0 12 4 12 4 12 4 12 4 16 4 16 4 16 4 16 4 16ZM 32 4C 32 4 28 4 28 4 28 4 28-0 28-0 28-0 32-0 32-0 32-0 32 4 32 4 32 4 32 4 32 4ZM 18 4C 18 4 14 4 14 4 14 4 14-0 14-0 14-0 18-0 18-0 18-0 18 4 18 4 18 4 18 4 18 4ZM 4 4C 4 4-0 4-0 4-0 4-0-0-0-0-0-0 4-0 4-0 4-0 4 4 4 4 4 4 4 4 4 4Z"}))))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"helpButton"},"Open help page")},o().createElement("div",{className:"tool",style:{fontSize:"20px"},onClick:function(){window.open("https://support.singular.live/hc/en-us/articles/31545704499481","_blank")}},o().createElement("i",{className:"fa fa-question-circle"}))))),o().createElement("div",{className:"body"},!i&&o().createElement("div",{className:"control-node-list",style:{flex:"0 0 488px"}},o().createElement("div",{className:"message"},"Please create control nodes")),i&&o().createElement(ga,{model:e,payload:t,selected:this.state.editedFieldId,controlNodeTypes:Ta,forceUpdate:this.state.forceUpdate,onGetControlNodeType:c,onDeleteField:this.onDeleteField,onDeleteGroup:this.onDeleteGroup,onEdit:this.onEdit,onSaveFieldsAndGroups:this.onSaveFieldsAndGroups}),"group"!==r&&o().createElement(Sa,{model:e,payload:t,selected:this.state.editedFieldId,uiStates:this.state.uiState,forceUpdate:this.state.forceUpdate,onGetControlNodeType:c,onModelFieldIdChanged:this.onFieldIdChanged,onModelFieldPropertyChanged:this.onControlNodeChanged,onPayloadFieldValueChanged:this.onControlNodeValueChanged,onUiStateChanged:this.onUiStateChanged}),"group"===r&&o().createElement(Ia,{model:e,payload:t,selected:this.state.editedFieldId,forceUpdate:this.state.forceUpdate,onGetControlNodeType:c,onGroupPropertyChanged:this.onGroupPropertyChanged}))),o().createElement("div",{className:"vertical-divider"}),o().createElement("div",{className:"right-side",style:{visibility:"visible"}},o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist",style:{paddingLeft:"1px"}},o().createElement("li",{className:"nav-item active"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#fillInForm",ref:"fillInForm"},"Fill-in Form")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#devInfo",ref:"devInfo"},"Sub-comp Info")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#model",ref:"model",onClick:this.forceUpdateModel},"Model")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#payload",ref:"payload",onClick:this.forceUpdatePayload},"Payload"))),o().createElement("div",{className:"tab-content rightpanel-tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane active",id:"fillInForm",style:{overflowY:"auto",marginLeft:"5px"}},o().createElement(Ut.A,{sbFieldsRef:this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("payload"),model:e,fields:t,enableDataLink:!1,controlNodeButtonMode:!0,highlightItem:this.state.showHighlight?this.onGetEditedItemId():null,showStyle:this.state.showStyle,updateDefaultValueRef:this.props.sbCompositionRef.child("dataSources").child("composition").child("controlNode").child("model")})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"devInfo"},o().createElement(sa,{subCompID:n,subCompName:l,model:e,payload:t})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"model"},o().createElement(ra,{name:"model",json:e,ref:"JsonViewerModel"})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"payload"},o().createElement(ra,{name:"payload",json:t,ref:"JsonViewerPayload"})))))))}}),Oa=o().createClass({displayName:"WidgetNodesManager",mixins:[W.A],getInitialState:function(){return{dataLinks:[],nodeRefs:[]}},componentWillMount:function(){this.sBindAsObject(this.props.sbCompositionRef.child("dataSources").child("composition").child("widgetNode"),"compositionWidgetNode"),this.sBindAsObject(this.props.sbCompositionRef.child("dataLinks"),"dataLinks"),this.sBindAsObject(this.props.sbCompositionRef.child("nodeRefs"),"nodeRefs")},render:function(){var e;if(this.state.compositionWidgetNode&&this.state.compositionWidgetNode.payload){var t=[];for(var a in this.state.compositionWidgetNode.model.fields){var i=this.state.compositionWidgetNode.model.fields[a],n=!1;for(var s in this.state.dataLinks){var l=this.state.dataLinks[s];if(l)for(var r in l){var c=l[r];if(c.key==i.id&&"widgetNode"==c.type){n=!0;break}}}for(var d in this.state.nodeRefs){var p=this.state.nodeRefs[d];if(p)for(var m in p){var u=p[m];if(u.sourceKey==i.id&&"widgetNode"==u.sourceType){n=!0;break}}}t[i.id]=null,"info"!==i.type&&(t[i.id]=n?o().createElement("i",{className:"fa fa-check green-color"}):o().createElement("i",{className:"fa fa-times red-color"}))}e=o().createElement("div",{className:"control-ui-properties"},o().createElement(Ut.A,{key:this.props.sbCompositionRef.key,model:this.state.compositionWidgetNode.model,fields:this.state.compositionWidgetNode.payload,disabled:!0,suffixElements:t,enableDataLink:!1}))}return o().createElement("div",{style:{height:"100%"}},e)}});function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}a(10611);const Va=o().createClass({displayName:"RevisionProperties",getInitialState:function(){return this.notificationRevisionRef,{revisions:[],revisionNumber:0,isSaving:!1,isLoading:!1,isRestoring:!1,deleteRevision:null,revisionNameValid:!1}},componentDidMount:function(){var e=this,t="composition-"+window.singularScene.id;this.notificationRevisionRef&&this.notificationRevisionRef.off("value"),this.notificationRevisionRef=this.props.rtdbRef.root.child("accounts").child(window.singularUser.account.accountId).child("assets").child("notification_revision_prop").child(t),this.notificationRevisionRef.on("value",function(t){e.loadRevisions()})},componentWillUnmount:function(){this.notificationRevisionRef&&this.notificationRevisionRef.off("value")},onKeyUp:function(e){"Enter"==e.key&&this.createRevision(),""==$(n().findDOMNode(this.refs.description)).val().trim()?this.setState({revisionNameValid:!1}):this.setState({revisionNameValid:!0})},loadRevisions:function(){this.setState({isLoading:!0}),S().get("/apiv1/compositions/"+window.singularScene.id+"/revisions").set("Content-Type","application/json").end(function(e,t){var a=[],i=0;if(e)N.A.add(N.A.TYPE.ERROR,{title:"Could not fetch revision list from server",description:e.message});else{if(t.headers.location)return void(window.location=t.headers.location);var n,s=0,o=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return La(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?La(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw s}}}}(t.body);try{for(o.s();!(n=o.n()).done;){var l=n.value;s=Math.max(l.revision_id,s)}}catch(e){o.e(e)}finally{o.f()}a=t.body,i=s}this.setState({isSaving:!1,isLoading:!1,isRestoring:!1,deleteRevision:null,revisions:a,revisionNumber:i})}.bind(this))},createRevision:function(){if(!this.state.isSaving&&0!=this.state.revisionNameValid){var e=$(n().findDOMNode(this.refs.description));this.setState({isSaving:!0});var t=e.val();S().post("/apiv1/compositions/"+window.singularScene.id+"/revisions").send({scene_id:window.singularScene.id,revision_id:this.state.revisionNumber+1,description:t}).set("Content-Type","application/x-www-form-urlencoded").end(function(a,i){if(a)N.A.add(N.A.TYPE.ERROR,{title:"Could not create revision "+t,description:a.message}),this.setState({isSaving:!1});else{if(i.headers.location)return void(window.location=i.headers.location);e.val("")}}.bind(this))}},restoreRevision:function(e){this.props.onBusy(!0),this.setState({isRestoring:!0}),S().post("/apiv1/compositions/"+window.singularScene.id+"/revisions/"+e.id+"/restore").end(),S().get("/apiv1/compositions/"+window.singularScene.id+"/revisions/"+e.id+"/content").end(function(t,a){if(t)return N.A.add(N.A.TYPE.ERROR,{title:"Could not restore revision: "+e.description,description:t.message}),this.setState({isRestoring:!1}),void this.props.onBusy(!1);var i=a.body;i.editingIds||(i.editingIds={}),i.editingIds[this.props.editingId]=!0,this.props.sbRef.child("groups").set(null),i.reloadPageAfterWritten=!0,i.saveScript=!0,i.restore=!0,this.props.sbRef.parent.parent.set(i)}.bind(this))},deleteRevision:function(e){this.setState({deleteRevision:e}),S().delete("/apiv1/compositions/"+window.singularScene.id+"/revisions/"+e.id).end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Delete revision failed",description:e.message});else if(t.headers.location)return this.setState({deleteRevision:null}),void(window.location=t.headers.location)}.bind(this))},render:function(){var e,t;this.state.isSaving&&(e=o().createElement("li",{className:"saving-placeholder"},o().createElement("img",{style:{height:"47px"},src:"/images/loading-bubbles.svg",className:"loader"}))),0==this.state.revisions.length&&(t=o().createElement("li",null,o().createElement("div",{className:"timeline-badge"},o().createElement("i",{className:"fa fa-exclamation"})),o().createElement("div",{className:"timeline-panel"},o().createElement("div",{className:"timeline-body warning-msg"},"No revisions have been created yet"))));var a=function(e){var t=!1;if(this.state.deleteRevision&&(t=!0,this.state.deleteRevision.id==e.id))return o().createElement("li",{key:e.id,className:"saving-placeholder"},o().createElement("img",{style:{height:"47px"},src:"/images/loading-bubbles.svg",className:"loader"}));var a=e.storageUrl?e.storageUrl:window.singularUrlBase+"apiv1/compositions/"+window.singularScene.id+"/revisions/"+e.id+"/content";return o().createElement("li",{key:e.id},o().createElement("div",{className:"timeline-badge"},o().createElement("i",{className:"fa fa-clock-o"})),o().createElement("div",{className:"timeline-panel"},o().createElement("span",{className:"timeline-id"},e.revision_id),o().createElement("div",{className:"timeline-heading"},o().createElement("h4",{className:"timeline-title"},e.description,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"delete"},"Delete revision")},o().createElement("button",{tabIndex:"-1",onClick:this.deleteRevision.bind(this,e),className:"btn btn-danger",disabled:t,style:{height:"29px"}},o().createElement("i",{className:"fa fa-trash-o"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"restore"},"Restore composition from revision")},o().createElement("button",{tabIndex:"-1",onClick:this.restoreRevision.bind(this,e),className:"btn btn-default",disabled:t},o().createElement("i",{className:"fa fa-refresh"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"copy"},"Copy revision URL to clipboard")},o().createElement("div",{style:{float:"right"}},o().createElement($t(),{className:"btn btn-default","data-clipboard-text":a,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard"})))))),o().createElement("div",{className:"timeline-body"},o().createElement("p",{className:"text-muted"},ge()(e.created_at).format("YYYY-MM-DD HH:mm:ss")," -"," ",ge()(e.created_at).fromNow()," by ",e.user_email))))}.bind(this);if(1==this.state.isLoading&&this.state.revision&&0==this.state.revision.length||1==this.state.isRestoring)return o().createElement("div",null,o().createElement("ul",{className:"timeline"},o().createElement("li",{className:"saving-placeholder"},o().createElement("img",{src:"/images/loading-bubbles.svg",className:"loader"}))));var i=!1;return(this.state.isSaving||this.state.deleteRevision||0==this.state.revisionNameValid)&&(i=!0),o().createElement("div",null,o().createElement("ul",{className:"timeline"},o().createElement("li",null,o().createElement("div",{className:"timeline-badge"},o().createElement("i",{className:"fa fa-star"})),o().createElement("div",{className:"timeline-panel"},o().createElement("div",{className:"timeline-body"},o().createElement("div",{className:"input-group"},o().createElement("input",{type:"text",className:"form-control",placeholder:"Description",onKeyUp:this.onKeyUp,ref:"description",disabled:this.state.isSaving}),o().createElement("span",{className:"input-group-btn"},o().createElement("button",{className:"btn btn-primary",style:{height:"28px"},tabIndex:"-1",type:"button",onClick:this.createRevision,disabled:i},"Create")))),o().createElement("div",{className:"timeline-footer"},"New revisions will be created from the last saved version of your composition"))),e,t,this.state.revisions.map(a)))}});var _a=a(3757),Fa=a(9769);const Ba=o().createClass({displayName:"DisplayVariantListItem",getInitialState:function(){return{}},shouldComponentUpdate:function(e,t){return!Fa.compareObject(e,this.props)||!Fa.compareObject(t,this.state)},render:function(){var e=this,t="variant-list-item";return this.props.selected&&(t+=" selected"),o().createElement("div",{className:t,onClick:function(){return e.props.onSelect(e.props.name)}},o().createElement("div",{className:"variant-list-item-container"},o().createElement("div",{className:"title"},this.props.name),o().createElement("div",{className:"delete"},o().createElement("i",{className:"fa fa-trash",onClick:function(t){t.stopPropagation(),e.props.onDelete(e.props.name)}}))))}});var Ua=a(9769),Wa=a(24113),ja=/^[a-zA-Z0-9\-._~]*$/,Ya="Variant names have to be unique and only contain A-Z, a-z, 0-9 and -._~";const Ha=o().createClass({displayName:"DisplayVariants",getInitialState:function(){return{variantNameValid:!1,variantName:"",newVariantNameValid:!1,newVariantName:"",variantDescription:""}},shouldComponentUpdate:function(e,t){return!Ua.compareObject(this.props,e)||!Ua.compareObject(this.state,t)},componentWillMount:function(){this.initParams(this.props)},componentWillReceiveProps:function(e){this.initParams(e)},initParams:function(e){if(e.displayVariants&&e.displayVariants.active&&e.displayVariants.variants){var t=e.displayVariants.variants,a=t.findIndex(function(t){return t.name===e.displayVariants.active});if(-1===a)return console.log("Could not find current variant"),null;this.setState({variantName:e.displayVariants.active,variantNameValid:!0,variantDescription:t[a].description||""})}},verifyVariantName:function(e){var t=-1,a=this.props.displayVariants;return a&&a.variants&&a.variants.length&&(t=a.variants.findIndex(function(t){return t.name===e})),!(""===e||!ja.test(e)||-1!==t)},addVariant:function(){if(this.state.newVariantNameValid){var e;e=this.props.displayVariants&&this.props.displayVariants.variants?{active:this.state.newVariantName,variants:this.props.displayVariants.variants.slice()}:{active:this.state.newVariantName,variants:[]};var t={name:this.state.newVariantName,resolution:Wa.VARIANT_RESOLUTIONS[1].id};e.variants.push(t),this.props.onDisplayVariantsChanged(e),this.setState({newVariantName:"",newVariantNameValid:!1,variantName:this.state.newVariantName,variantNameValid:!0,variantDescription:""})}},deleteVariant:function(e){var t,a=this.props.displayVariants;if(-1!==(t=a.variants.findIndex(function(t){return t.name===e}))){var i=a.active;if(a.active===a.variants[t].name){var n=a.variants.length;i=n>1?t===n-1?a.variants[n-2].name:a.variants[t+1].name:""}var s=a.variants.slice();s.splice(t,1),this.props.onDisplayVariantsChanged({active:i,variants:s})}},sortVariant:function(e){var t=this.props.displayVariants;this.props.onDisplayVariantsChanged({active:t.active,variants:ua()(t.variants,e.oldIndex,e.newIndex)})},changeVariantName:function(e,t){var a=JSON.parse(JSON.stringify(this.props.displayVariants));a.active=e,a.variants[t].name=e,this.props.onDisplayVariantsChanged(a)},changeVariantDescription:function(e,t){var a=JSON.parse(JSON.stringify(this.props.displayVariants));a.variants[t].description=e,this.props.onDisplayVariantsChanged(a)},changeVariantResolution:function(e,t){var a=JSON.parse(JSON.stringify(this.props.displayVariants));a.variants[t].resolution=e,this.props.onDisplayVariantsChanged(a)},render:function(){var e=this,t="variants",a=this.props.displayVariants;return a&&a.variants&&0!==a.variants.length||(t="globals"),o().createElement("div",{className:"display-variants"},o().createElement("div",{className:"header"},o().createElement("div",{className:"title"},"Create new Display Variant"),o().createElement("div",{style:{position:"relative"}},o().createElement("input",{type:"text",value:this.state.newVariantName,onChange:function(t){var a=e.verifyVariantName(t.target.value);e.setState({newVariantNameValid:a,newVariantName:t.target.value})},onKeyDown:function(t){ja.test(t.key)?"Enter"===t.key&&e.addVariant():t.preventDefault()},className:"form-control name-input",placeholder:"Enter variant name"}),!this.state.newVariantNameValid&&this.state.newVariantName&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"name-error"},Ya)},o().createElement("span",{className:"variant-name-error"},o().createElement("i",{className:"fa fa-exclamation-triangle"})))),o().createElement("div",{className:"add-button"},o().createElement("button",{tabIndex:"-1",type:"button",className:"btn btn-default",onClick:this.addVariant,disabled:!this.state.newVariantNameValid},"Add")),o().createElement("div",{className:"toolbar"},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"helpButton"},"Open help page")},o().createElement("div",{className:"tool",style:{fontSize:"20px"},onClick:function(){window.open("https://support.singular.live/hc/en-us/articles/40451425241497-Display-Variants","_blank")}},o().createElement("i",{className:"fa fa-question-circle"}))))),"globals"!==t?null:o().createElement("div",{className:"adaptation-globals"},o().createElement("div",{className:"title"},"Adaptive Globals"),o().createElement(_a.A,{adaptationGlobals:e.props.adaptationGlobals,onAdaptationGlobalsChanged:e.props.onAdaptationGlobalsChanged})),function(){if("variants"!==t)return null;var i=a.variants.findIndex(function(e){return e.name===a.active});if(-1===i)return console.log("Could not find current variant"),null;var n,s=a.variants[i],l=function(t){e.verifyVariantName(t,i)?e.changeVariantName(t,i):e.setState({variantNameValid:!0,variantName:a.active})},r=(0,pa.Zj)(function(t){var i=t.item;return o().createElement(Ba,{key:i.name,name:i.name,selected:i.name===a.active,onSelect:function(t){e.props.onDisplayVariantsChanged({active:t,variants:a.variants}),e.setState({variantName:t,variantNameValid:!0})},onDelete:function(t){e.deleteVariant(t)}})}),c=(0,pa.q6)(function(t){return t.items,o().createElement("div",{className:"control-node-list",ref:function(t){e.refNodeList=t}},a.variants.map(function(e,t){return o().createElement(r,{key:e.name,item:e,index:t})}))});return o().createElement("div",{className:"body"},o().createElement("div",{className:"variant-list"},o().createElement(c,{items:a.variants,onSortEnd:e.sortVariant,axis:"y",lockAxis:"y",distance:5,pressThreshold:5,lockToContainerEdges:!0,helperClass:"dragging"})),o().createElement("div",{className:"variant-editor"},o().createElement("div",{className:"full-width-header"},"Name and resolution"),o().createElement("div",{className:"variant-name"},o().createElement("div",{className:"title"},"Name"),o().createElement("div",{style:{position:"relative"}},o().createElement("input",{type:"text",value:e.state.variantName,onChange:function(t){var a=t.target.value,i=!0;s.name!==a&&(i=e.verifyVariantName(a)),e.setState({variantNameValid:i,variantName:t.target.value})},onBlur:function(e){l(e.target.value)},onKeyDown:function(t){ja.test(t.key)?("Escape"===t.key&&e.setState({variantNameValid:!0,variantName:a.active}),"Enter"===t.key&&l(t.target.value)):t.preventDefault()},className:"form-control name-input",placeholder:"Enter variant name"}),!e.state.variantNameValid&&e.state.variantName&&o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"name-error"},Ya)},o().createElement("span",{className:"variant-name-error"},o().createElement("i",{className:"fa fa-exclamation-triangle"}))))),o().createElement("div",{className:"variant-description"},o().createElement("div",{className:"title"},"Description"),o().createElement("input",{type:"text",value:e.state.variantDescription,onChange:function(t){e.setState({variantDescription:t.target.value})},onBlur:function(t){e.changeVariantDescription(t.target.value,i)},onKeyDown:function(t){"Escape"===t.key&&e.setState({variantDescription:s.description||""}),"Enter"===t.key&&e.changeVariantDescription(t.target.value,i)},className:"form-control description-input",placeholder:""})),o().createElement("div",{className:"variant-resolution"},o().createElement("div",{className:"title"},"Resolution"),o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px"}},Ua.getTitleFromSelection(Wa.VARIANT_RESOLUTIONS,s.resolution)),o().createElement("ul",{className:"dropdown-menu"},Wa.VARIANT_RESOLUTIONS.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:function(){return e.changeVariantResolution(t.id,i)}},t.title))})))),o().createElement("div",{className:"variant-resolution-info"},(n=Wa.VARIANT_RESOLUTIONS.find(function(e){return e.id===s.resolution}))?n.info:"Unknown resolution"),o().createElement("div",{className:"full-width-header"},"Adaptive Globals"),o().createElement("div",{className:"variant-globals"},o().createElement(_a.A,{adaptationGlobals:a.variants[i].globals||{},onAdaptationGlobalsChanged:function(t){var n=JSON.parse(JSON.stringify(a));n.variants[i].globals=Object.assign({},t),e.props.onDisplayVariantsChanged(n)}}))))}())}});var za=a(9769);const Ga=o().createClass({displayName:"RightPanelProperties",getInitialState:function(){return{errorLogCount:0,warningLogCount:0}},componentWillMount:function(){var e=N.A.getCountByType();this.setState({errorLogCount:e.error,warningLogCount:e.warning})},shouldComponentUpdate:function(e,t){return!za.compareObject(this.props,e)||!za.compareObject(this.state,t)},componentDidMount:function(){var e=this;$(this.refs.controlNode).tab("show"),this.refs&&this.refs.browser&&(this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType("d"),this.browserRef.config({useDefaultItemDoubleClick:!1,onItemDoubleClick:this.onItemDoubleClick})),$("#datanodeBrowserModal").on("shown.bs.modal",function(){e.browserRef.modalPending&&(e.browserRef.modalPending=!1)})},componentWillReceiveProps:function(e){e.standaloneOnAir&&!this.props.standaloneOnAir?$(this.refs.widgetNode).tab("show"):!e.standaloneOnAir&&this.props.standaloneOnAir&&$(this.refs.controlNode).tab("show")},widgetNodeExists:function(e){if(e.standaloneOnAir){var t=e.sbCompositionRef.child("dataSources").child("composition").child("widgetNode").val();return!(!t||!t.payload)}return!1},onLogChanged:function(e){this.setState({errorLogCount:e.error,warningLogCount:e.warning})},onUpdateDnmRef:function(e){var t=this;this.onItemDoubleClick||(this.onItemDoubleClick=function(e){return t.onItemDoubleClick.dnm.onSelectDatanode(e)},this.onItemDoubleClick.setDnsManager=function(e){return t.onItemDoubleClick.dnm=e}),this.onItemDoubleClick.setDnsManager(e)},render:function(){var e;return this.props.standaloneOnAir||(e={display:"none"}),o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item",style:e},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#widgetNode",ref:"widgetNode",style:{display:"flex",alignItems:"center"}},o().createElement("i",{className:"fa fa-database",style:{width:"20px",textAlign:"center"}}),"Widget Node")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#controlNode",ref:"controlNode",style:{display:"flex",alignItems:"center"}},o().createElement("i",{className:"fa fa-gamepad",style:{width:"20px",textAlign:"center"}}),"Control Nodes")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#dataNode",ref:"dataNode",style:{display:"flex",alignItems:"center"}},o().createElement("i",{className:"fa fa-database",style:{width:"20px",textAlign:"center"}}),"Data Nodes")),o().createElement("li",{className:"nav-item terminal-tab",style:{display:"inherit",position:"absolute",right:"0px"}},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#revisions"},"Revisions"),!this.props.standaloneOnAir&&o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#globals"},"Display Variants"),o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#settings"},"Settings"))),o().createElement("div",{className:"tab-content rightpanel-tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"widgetNode"},o().createElement(Oa,{key:this.props.sbCompositionRef.key,sbCompositionRef:this.props.sbCompositionRef})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"controlNode"},o().createElement(Ma,{key:this.props.sbCompositionRef.key,rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,sbCompositionRef:this.props.sbCompositionRef,onNotification:this.props.onNotification})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"dataNode"},o().createElement(aa,{key:this.props.sbCompositionRef.key,rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,onUpdateRef:this.onUpdateDnmRef,compositionStack:this.props.compositionStack,sbCompositionRef:this.props.sbCompositionRef})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"revisions"},o().createElement(Va,{rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,editingId:this.props.editingId,onBusy:this.props.onBusy})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"settings"},o().createElement(Qt,{mainCompositionName:this.props.mainCompositionName,onMainCompositionNameChanged:this.props.onMainCompositionNameChanged,settings:this.props.settings,onSettings:this.props.onSettings,uiSettings:this.props.uiSettings,onUISettings:this.props.onUISettings,sbMainRef:this.props.sbMainRef,sbRef:this.props.sbRef})),!this.props.standaloneOnAir&&o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"globals"},o().createElement(Ha,{adaptationGlobals:this.props.adaptationGlobals,onAdaptationGlobalsChanged:this.props.onAdaptationGlobalsChanged,displayVariants:this.props.displayVariants,onDisplayVariantsChanged:this.props.onDisplayVariantsChanged}))),o().createElement("div",{id:"datanodeBrowserModal",className:"modal fade u-displaynone singular-modal-v2",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-body"},o().createElement(kt.A,{rtdbFolderRef:Dt.A.rtdbFolderRef(),showHeader:!0,browserTitle:"Datanode",showSearch:!0,ref:"browser",showInspector:!1,browserStyle:"datanode-selector-modal",showClose:!0,modalId:"datanodeBrowserModal"}))))))}});var Ka=a(92171),$a=a(79806);const qa=o().createClass({displayName:"DisplayVariantSelector",getInitialState:function(){return{}},changeVariant:function(e){var t=JSON.parse(JSON.stringify(this.props.displayVariants));t.active=e,this.props.onDisplayVariantsChanged(t)},render:function(){var e=this,t=this.props.displayVariants.active,a=this.props.displayVariants.variants;return o().createElement("div",{className:"display-variant-selector"},o().createElement("div",{className:"title"},"Display variant"),o().createElement("div",{className:"btn-group",style:{width:"170px"}},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},t),o().createElement("ul",{className:"dropdown-menu"},a.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:function(){return e.changeVariant(t.name)}},t.name))}))))}});var Ja=a(63210),Xa=a(9769),Za=a(70782);const Qa=o().createClass({displayName:"CompositionNavigatorList",mixins:[W.A],getInitialState:function(){return{logicLayerMenuOpen:!1,logicLayerCompId:null,showWidgetSubComp:!0,showLinkedSubComp:!0,mode:"composer",searchString:""}},componentWillMount:function(){var e=this;setTimeout(function(){e.props.sbAllCompsRef.on("value",function(t){e.setState({allComps:t.val()})}),e.sBindAsObject(e.props.sbRootCompRef,"rootComp"),e.sBindAsObject(e.props.sbCompStatesRef,"compStates"),e.sBindAsObject(e.props.sbLogicLayersRef,"logicLayers")},1)},componentDidMount:function(){},componentWillUnmount:function(){},componentWillReceiveProps:function(e){},shouldComponentUpdate:function(e,t){return!Xa.compareObject(this.props,e)||!Xa.compareObject(this.state,t)},componentDidUpdate:function(){},onCompositionControl:function(e,t,a){this.props.compositionNavControl&&(a.stopPropagation(),a.preventDefault(),this.props.compositionNavControl(e,t))},onNavigateComposition:function(e,t){t.widgetCompInfo?this.props.onEditCompStandalone&&this.props.onEditCompStandalone(t.widgetCompInfo.field.id,t.widgetCompInfo.field.title,t.widgetCompInfo.id,t.id,t.widgetCompInfo.parentId):this.props.onNavigateComposition&&this.props.onNavigateComposition(t)},onOpenLogicLayerMenu:function(e,t){this.setState({logicLayerMenuOpen:!0,logicLayerCompId:e})},onSelectLogicLayer:function(e,t){var a=this;"In"!=this.state.compStates[this.state.logicLayerCompId]||this.state.logicLayers[this.state.logicLayerCompId]||$("#btn-in-"+this.state.logicLayerCompId).click();var i=null,n=Object.keys(this.state.logicLayers).find(function(t,a){return this.state.logicLayers[t].name==e}.bind(this));if(n)i=this.state.logicLayers[n].tag;else{for(var s=function(){var e=Za[o];if(!Object.keys(a.state.logicLayers).find(function(t,a){return this.state.logicLayers[t].tag==e}.bind(a)))return i=e,1},o=0,l=Za.length;o<l&&!s();o++);i||(i=Za[Math.floor(Za.length*Math.random())])}this.props.selectLogicLayer(this.state.logicLayerCompId,e,i),this.setState({logicLayerMenuOpen:!1,logicLayerCompId:null}),t.stopPropagation(),t.preventDefault()},onNewLogicLayerChanged:function(e){},onNewLogicLayerKeyDown:function(e){"Escape"==e.key&&(e.target.value?($(".logic-layer-rename").val(""),$(".btn-group.open").removeClass("open")):($(".logic-layer-rename").val(""),$(".btn-group.open").removeClass("open"),this.setState({logicLayerMenuOpen:!1,logicLayerCompId:null}))),"Tab"==e.key&&this.onSelectLogicLayer(e.target.value,e)},onNewLogicLayerKeyPress:function(e){"Enter"==e.key&&(e.target.value&&this.onSelectLogicLayer(e.target.value,e),$(".logic-layer-rename").val(""),$(".btn-group.open").removeClass("open"))},onToggleShowWidgetSubComp:function(e){this.setState({showWidgetSubComp:!this.state.showWidgetSubComp})},onToggleShowLinkedSubComp:function(e){this.setState({showLinkedSubComp:!this.state.showLinkedSubComp})},onSelecttransitionDelayLayer:function(e,t){this.props.sbLogicLayersRef.child(e).child("delay").set(t)},onCustomTransitionTimeChanged:function(e,t,a){this.props.sbLogicLayersRef.child(e).child("time").set(a)},onCompositionCollapse:function(e,t){var a={};a[e+"caret"]=t,this.setState(a)},onSearchChanged:function(e){this.setState({searchString:e.target.value})},onClearSearch:function(){this.setState({searchString:""})},onSearchKeyDown:function(e){"Escape"==e.key&&this.onClearSearch()},render:function(){var e=this.state.allComps,t=this.state.rootComp,a=[];if(!(e&&t&&this.state.compStates&&this.state.logicLayers))return!1;for(var i in this.state.logicLayers){var n=this.state.logicLayers[i].name;a.find(function(e,t){return e.name==n})||a.push({name:n,tag:this.state.logicLayers[i].tag})}var s,l,r,c,d,p=function(t,i){var n=t.comp,s=t.tile;if((n||s.widgetCompInfo)&&(!n&&s.widgetCompInfo&&(n=e[s.widgetCompInfo.id]),n&&!(("scriptEditor"==this.props.mode||0==this.state.showWidgetSubComp)&&s.widgetCompInfo||0==this.state.showLinkedSubComp&&n.settings&&n.settings.linkTimeline))){var l=[];n.groups&&(l=Object.keys(n.groups)).sort(function(e,t){return e.priority-t.priority-.5});var r,c=[];l.forEach(function(e){var a=n.groups[e].items;if(a){var i=Object.keys(a);i.sort(function(e,t){return a[e].priority-a[t].priority-.5}),n.tiles&&i.forEach(function(e){var a=n.tiles[e];if(a)if("composition"==a.type)c.push(a);else if("widget"==a.type){var i=h.A.getWidgetById(a.widget,a.version);if(i&&i.model&&i.model.fields&&Array.isArray(i.model.fields)&&n.data){var s=n.data[e];i.model.fields.forEach(function(e){if("composition"==e.type){var i={};$.extend(!0,i,a),i.widgetCompInfo={field:e,id:s[e.id],parentId:t.id},c.push(i)}})}}})}}),t.id==this.props.activeCompId&&(r=" comp-active");var d="inherit";(n.settings&&n.settings.linkTimeline||s.widgetCompInfo)&&(d="hidden");var m=s.name;s.widgetCompInfo&&(m=s.name+" / "+s.widgetCompInfo.field.title,s.widgetCompInfo.id==this.props.activeCompId&&(r=" comp-active"));var u="",f="";"In"==this.state.compStates[t.id]?u=" comp-active":f=" comp-active";var g=[];c.forEach(function(t){g.push({comp:e[t.id],tile:t,id:t.id})});var v,b=!1;if(this.state.logicLayers[t.id]&&(b=!0),b){var y,E=o().createElement("ul",{className:"dropdown-menu",style:{height:"74px",overflow:"hidden"}},o().createElement("li",{key:"1",className:"logic-layer-list-item"},o().createElement("a",{onClick:this.onSelecttransitionDelayLayer.bind(this,t.id,"none")},"None")),o().createElement("li",{key:"2",className:"logic-layer-list-item"},o().createElement("a",{onClick:this.onSelecttransitionDelayLayer.bind(this,t.id,"auto")},"Auto")),o().createElement("li",{key:"3",className:"logic-layer-list-item"},o().createElement("a",{onClick:this.onSelecttransitionDelayLayer.bind(this,t.id,"custom")},"Custom")));switch(this.state.logicLayers[t.id]&&(y=this.state.logicLayers[t.id].delay),y){case"auto":v=o().createElement("div",{className:"timing-wrapper"},o().createElement("span",null,"Auto"),o().createElement("div",{className:"btn-group timing-selector",disabled:!b,style:{float:"right",top:"2px"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle btn-sm v2 on","data-toggle":"dropdown",style:{width:"12px",minWidth:"12px"},disabled:!b}),E));break;case"custom":var w;this.state.logicLayers[t.id]&&(w=this.state.logicLayers[t.id].time),void 0===w&&(w=0),v=o().createElement("div",{className:"timing-wrapper"},o().createElement(te.A,{name:"custom",resetValue:0,step:.01,format:"0.0[0]",min:-10,max:10,value:w,unit:"s",onValueChanged:this.onCustomTransitionTimeChanged.bind(this,t.id)}),o().createElement("div",{className:"btn-group timing-selector",disabled:!b,style:{float:"right",top:"2px"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle btn-sm v2 on","data-toggle":"dropdown",style:{width:"12px",minWidth:"12px"},disabled:!b}),E));break;default:v=o().createElement("div",{className:"timing-wrapper"},o().createElement("span",null,""),o().createElement("div",{className:"btn-group timing-selector",disabled:!b,style:{float:"right",top:"2px"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle btn-sm v2","data-toggle":"dropdown",style:{width:"12px",minWidth:"12px"},disabled:!b}),E))}}var S,N=function(e,t){var a;return e.tag&&(a=o().createElement("div",{style:{width:"10px",height:"10px",backgroundColor:e.tag,float:"right",padding:"0px",top:"6px",right:"4px",position:"absolute"}})),o().createElement("li",{key:t,className:"logic-layer-list-item ","data-toggle":"dropdown-submenu"},o().createElement("a",{onClick:this.onSelectLogicLayer.bind(this,e.name)},e.name),a)}.bind(this),C=o().createElement("ul",{className:"dropdown-menu"},o().createElement("li",{key:"noLogicLayer",className:"logic-layer-list-item "},o().createElement("a",{onClick:this.onSelectLogicLayer.bind(this,null)},"None")),a.map(N),o().createElement("li",{key:"addLayer",className:"input-item"},o().createElement("input",{ref:"logicLayerNew",type:"text",placeholder:"New layer",value:this.state.newLogicLayer,onChange:this.onNewLogicLayerChanged,onKeyPress:this.onNewLogicLayerKeyPress,onKeyDown:this.onNewLogicLayerKeyDown,className:"logic-layer-rename"})));S=b?o().createElement("span",null,this.state.logicLayers[t.id].name):o().createElement("span",{className:"no-layer"},"No Layer");var x,I,k=o().createElement("div",{className:"btn-group"},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle btn-sm v2","data-toggle":"dropdown",onMouseDown:this.onOpenLogicLayerMenu.bind(this,t.id)},S),C),D={visibility:d,position:"absolute",right:"0px",top:"3px"},A=!0;if(g&&g.length){var R="fa fa-caret-down",P="closed";"closed"==this.state[t.id+"caret"]&&(R="fa fa-caret-right",P="open",A=!1),x=o().createElement("span",{style:{float:"left",width:"10px",cursor:"pointer"},onClick:this.onCompositionCollapse.bind(this,t.id,P)},o().createElement("i",{className:R}))}A&&(I=o().createElement("ul",{key:i+"-sub"},g.map(p))),"scriptEditor"==this.props.mode&&(v=void 0,k=o().createElement("div",{className:"btn-group",style:{marginRight:"10px",position:"relative",top:"-3px"}},S));var T="calc(100% - 300px)";"scriptEditor"==this.props.mode&&(T="calc(100% - 150px)");var M;M="In"==this.state.compStates[t.id]?"state-in":"state-out";var O={left:"7px",position:"relative",width:T,whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis",display:"block"};return this.state.searchString&&-1!==m.toUpperCase().indexOf(this.state.searchString.toUpperCase())&&(O.color="#f0ad4e"),o().createElement("li",{key:i,className:M},o().createElement("div",null,o().createElement("div",null,x,o().createElement("span",{onClick:r?function(){}:this.onNavigateComposition.bind(this,n,s),className:r?"comp-title "+r:"comp-title-clickable",style:O},m),o().createElement("div",{className:"btn-group",style:D},v,k,o().createElement("button",{tabIndex:"-1",className:"btn btn-sm btn-default v2 "+u,id:"btn-in-"+t.id,onClick:this.onCompositionControl.bind(this,t.id,"In")},"In"),o().createElement("button",{tabIndex:"-1",className:"btn btn-sm btn-default v2 "+f,onClick:this.onCompositionControl.bind(this,t.id,"Out")},"Out")))),I)}}.bind(this),m={comp:t,tile:{name:"Root",id:this.props.sbRootCompRef.key},id:this.props.sbRootCompRef.key},u=this.state.showWidgetSubComp?"active btn btn-default btn-sm relative v2":"btn btn-default btn-sm relative v2",f=this.state.showLinkedSubComp?"active btn btn-default btn-sm relative v2":"btn btn-default btn-sm relative v2";return l=this.state.searchString?o().createElement("i",{className:"fa fa-times input-clear-icon-widget-tree",onClick:this.onClearSearch}):o().createElement("i",{className:"fa fa-search filter-input-icon"}),"scriptEditor"!=this.props.mode&&(r=o().createElement("div",{className:"btn-group",style:{display:"inline-block",position:"absolute",right:"0px",top:"0px"}},o().createElement("span",{style:{pointerEvents:"none",height:"19px",position:"absolute",width:"110px",left:"-220px",textAlign:"center",top:"0px"}},"Transition Delay"),o().createElement("span",{style:{pointerEvents:"none",height:"19px",position:"absolute",width:"110px",left:"-107px",textAlign:"center",top:"0px"}},"Logic Layer"),o().createElement("button",{tabIndex:"-1",className:"btn btn-sm btn-default v2",onClick:this.onCompositionControl.bind(this,"__ALL__","In"),style:{visibility:"hidden"}},"In"),o().createElement("button",{tabIndex:"-1",className:"btn btn-sm btn-default v2",onClick:this.onCompositionControl.bind(this,"__ALL__","Out1")},"Out")),c=o().createElement("span",{className:"comp-header-button",style:{left:"-5px"}},o().createElement(Y(),{trigger:["hover"],placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"showWidgetSubComps"},"Show and hide widget sub compositions")},o().createElement("button",{tabIndex:"-1",type:"button",className:u,onClick:this.onToggleShowWidgetSubComp},o().createElement("i",{className:"fa fa-list"}))))),s=o().createElement("ul",{style:{paddingRight:"11px"}},o().createElement("li",null,c,o().createElement("span",{className:"comp-header-button"},o().createElement(Y(),{trigger:["hover"],placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"showLinkedSubComps"},"Show and hide sub compositions with linked timeline")},o().createElement("button",{tabIndex:"-1",type:"button",className:f,onClick:this.onToggleShowLinkedSubComp},o().createElement("i",{className:"fa fa-link"})))),o().createElement("div",{className:"widget-tree-filter",style:{position:"relative",display:"inline-block"}},l,o().createElement("input",{type:"text",className:"form-control filter-input",placeholder:"Find ...",value:this.state.searchString,onKeyDown:this.onSearchKeyDown,onChange:this.onSearchChanged,style:{width:"100px"}})),r)),d="scriptEditor"==this.props.mode?"calc(100% - 25px)":"calc(100% - 45px)",o().createElement("div",{style:{width:"100%",height:"100%"}},s,o().createElement("div",{style:{height:d,border:"solid 1px #222",overflowY:"scroll",overflowX:"hidden"},ref:"compositionList"},o().createElement("ul",{className:"subcomp-list"},p(m,0))))}});var ei=a(9769);const ti=o().createClass({displayName:"CompositionNavigatorFrame",mixins:[W.A],getInitialState:function(){return{snapRange:20,mouseMode:null,mouseStartX:0,mouseStartY:0,panelLeft:100,panelTop:250,panelWidth:400,panelHeight:250,panelResizeStartWidth:0,panelResizeStartHeight:0,panelMoveStartLeft:0,panelMoveStartTop:0}},componentWillMount:function(){},componentDidMount:function(){var e;try{e=localStorage.getItem("CompositionNavigatorPosAndSize")}catch(e){}var t=null;try{t=JSON.parse(e)}catch(e){}if(null!=t){var a=t.left,i=t.top,n=t.width,s=t.height;a+n>window.innerWidth&&(a=window.innerWidth-n),a<0&&(a=0),i+s>window.innerHeight&&(i=window.innerHeight-s),i<0&&(i=0),this.setState({panelLeft:a,panelTop:i,panelWidth:n,panelHeight:s})}},componentWillUnmount:function(){},componentWillReceiveProps:function(e){},shouldComponentUpdate:function(e,t){return!ei.compareObject(this.props,e)||!ei.compareObject(this.state,t)},componentDidUpdate:function(){var e=n().findDOMNode(this.refs.floatingPanel).getBoundingClientRect();this.setState({windowOffsetTop:e.top,windowOffsetLeft:e.left})},resizeDown:function(e){this.setState({mouseMode:"resize",mouseStartX:e.pageX,mouseStartY:e.pageY,panelResizeStartWidth:this.state.panelWidth,panelResizeStartHeight:this.state.panelHeight})},positionDown:function(e){e.preventDefault(),e.stopPropagation(),this.setState({mouseMode:"move",mouseStartX:e.pageX,mouseStartY:e.pageY,panelMoveStartTop:this.state.panelTop,panelMoveStartLeft:this.state.panelLeft})},mouseMove:function(e){if(e.preventDefault(),e.stopPropagation(),null!=this.state.mouseMode){var t=e.pageX-this.state.mouseStartX,a=e.pageY-this.state.mouseStartY;if("resize"==this.state.mouseMode){var i=this.state.panelResizeStartWidth+t,n=this.state.panelResizeStartHeight+a;i<500&&(i=500),n<200&&(n=200),this.setState({panelWidth:i,panelHeight:n})}else{var s=this.state.panelMoveStartLeft+t,o=this.state.panelMoveStartTop+a,l=this.state.snapRange;s<l?s=0:(s+this.state.panelWidth>window.innerWidth-l&&(s=window.innerWidth-this.state.panelWidth),s<0&&(s=0)),o<l?o=0:(o+this.state.panelHeight>window.innerHeight-l&&(o=window.innerHeight-this.state.panelHeight),o<0&&(o=0)),this.setState({panelLeft:s,panelTop:o})}}},mouseUp:function(e){e.preventDefault(),e.stopPropagation(),this.setState({mouseMode:null});var t={left:this.state.panelLeft,top:this.state.panelTop,width:this.state.panelWidth,height:this.state.panelHeight};try{localStorage.setItem("CompositionNavigatorPosAndSize",JSON.stringify(t))}catch(e){}},onClose:function(){this.props.onClose&&this.props.onClose()},onCompositionControl:function(e,t,a){a.stopPropagation(),a.preventDefault(),this.props.compositionNavControl(e,t)},render:function(){var e,t={left:this.state.panelLeft+"px",top:this.state.panelTop+"px",width:this.state.panelWidth+"px",height:this.state.panelHeight+"px"};if(1==this.props.visible?t.visibility="visible":t.visibility="hidden",null!=this.state.mouseMode){var a={width:window.innerWidth,height:window.innerHeight,position:"absolute",left:-this.state.windowOffsetLeft,top:-this.state.windowOffsetTop,zIndex:1001};e=o().createElement("div",{style:a,onMouseMove:this.mouseMove,onMouseUp:this.mouseUp})}return o().createElement("div",{style:t,ref:"floatingPanel",className:"comp-nav-window"},o().createElement("div",{className:"comp-nav-header"},o().createElement("div",{className:"comp-nav-header-title",onMouseDown:this.positionDown},o().createElement("span",null,"Composition Navigator")),o().createElement("div",{className:"comp-nav-header-ibox",onClick:this.onClose},o().createElement("i",{className:"fa fa-times"}))),o().createElement(Qa,{rootCompName:this.props.rootCompName,sbAllCompsRef:this.props.sbAllCompsRef,sbRootCompRef:this.props.sbRootCompRef,sbCompStatesRef:this.props.sbCompStatesRef,sbLogicLayersRef:this.props.sbLogicLayersRef,onNavigateComposition:this.props.onNavigateComposition,onEditCompStandalone:this.props.onEditCompStandalone,compositionNavControl:this.props.compositionNavControl,selectLogicLayer:this.props.selectLogicLayer,activeCompId:this.props.activeCompId,mode:"composer"}),o().createElement("div",{className:"resizer",onMouseDown:this.resizeDown},o().createElement("i",{className:"fa fa-caret-down",style:{transform:"rotate(310deg)"}})),e)}});var ai=a(25798),ii=a(84348),ni=a(71906),si=a.n(ni),oi=a(37321),li=a.n(oi);a(24143);const ri=o().createClass({displayName:"CompositionEditorZoom",getInitialState:function(){return{}},render:function(){var e=this,t=function(t,a){return o().createElement("li",{key:t,onClick:function(){return function(t){var a="FIT"===e.props.value?100:e.props.value;switch(t){case"zoomIn":e.props.onValueChanged(Math.min(a+10,200));break;case"zoomOut":e.props.onValueChanged(Math.max(a-10,50));break;case"zoomFit":e.props.onValueChanged("FIT");break;default:e.props.onValueChanged(t)}}(a)}},o().createElement("a",null,t))};return o().createElement("div",{className:"composition-editor-zoom"},o().createElement("span",{className:"editor-zoom-label"},"Zoom"),o().createElement("div",{className:"dropdown editor-zoom-menu"},o().createElement("button",{tabIndex:"-1",className:"btn dropdown-toggle",type:"button","data-toggle":"dropdown",style:{color:"#b0b0b0",width:"75px",minWidth:"75px"}},o().createElement("div",{className:"zoom-value"},"FIT"===e.props.value?"Fit":e.props.value+"%")),o().createElement("ul",{className:"dropdown-menu pull-right"},t("Fit","zoomFit"),o().createElement("li",{className:"divider"}),t("50%",50),t("75%",75),t("90%",90),t("100%",100),t("125%",125),t("150%",150),t("200%",200))))}});function ci(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i,n,s,o,l=[],r=!0,c=!1;try{if(s=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;r=!1}else for(;!(r=(i=s.call(a)).done)&&(l.push(i.value),l.length!==t);r=!0);}catch(e){c=!0,n=e}finally{try{if(!r&&null!=a.return&&(o=a.return(),Object(o)!==o))return}finally{if(c)throw n}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return di(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?di(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function di(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}function pi(e){return pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pi(e)}var mi=a(10611),ui=a(45659),hi=a(9769),fi=a(87567),gi=a(24113),vi=4194304;function bi(e,t){var a={},i=document.getElementsByClassName("root-onair")[0].getBoundingClientRect(),n=window.devicePixelRatio;a.top=i.top*n,a.left=i.left*n,a.width=i.width*n,a.height=i.height*n,a.viewportX=document.documentElement.clientWidth,a.viewportY=document.documentElement.clientHeight;var s=new Image;s.src=e,s.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(s,a.left,a.top,a.width,a.height,0,0,a.width,a.height);var i=e.toDataURL("image/png");t(i)}}const yi=o().createClass({displayName:"CompositionEditor",mixins:[D(),{onStyleAdd:function(e,t){var a=this.firebaseRefs.styles.push(),i=this.state.styles.length;a.setWithPriority({id:a.key,title:e,type:t,inherited:"",properties:[],priority:i},i)},onStyleNameChange:function(e,t){this.firebaseRefs.styles.child(e.id).update({title:t})},onStyleDelete:function(e){this.firebaseRefs.styles.child(e.id).remove()}},W.A],rtdbRef:null,sbAllCompsRef:null,sbRootCompRef:null,blockInputToPreview:null,onAirRefCollection:{},clipboard:{},tempEditCompId:"",_isDragging:!1,_dragStartX:0,_dragStartY:0,_scrollStartX:0,_scrollStartY:0,_altKeyPressed:!1,_mouseOverPreview:!1,getInitialState:function(){return this.timelineIsUpdated=!1,this.selections={},this.UISettingsTimeoutHandler=null,{selection:{id:0,type:"widget"},renameItem:{id:0,type:"widget"},compositions:{},styles:[],adaptationGlobals:fi.DEFAULT_GLOBALS,displayVariants:{active:"",variants:[]},editorWidth:void 0,editorHeight:void 0,standaloneOnAir:null,standaloneOnAirWidth:1920,standaloneOnAirHeight:1080,showTimeline:!1,settings:hi.getDefaultSettings(),timelinePositions:{In:0,Out:0},masterTimelinePosition:0,animationState:"In",bottomPaneStyle:{height:"100%"},compositionStack:[],compActiveTimeline:"In",mainCompositionName:window.singularScene.name,compositionNavigatorActive:!1,busy:!1,captureSnapshotBusy:!1,captureSubcompBusy:!1,captureSubcompCancel:!1,captureSubcompMessage:void 0,compositionSize:0,compositionSaveDuration:0,failToSaveToFirebase:!1,failToSaveToFirebaseMessage:"",savingState:"done",zoomLevel:"FIT",hideBoundingBox:!1}},componentWillMount:function(){this.rtdbRef=this.props.rtdbRef.child("compositions").child(this.props.rtdbRef.key),this.sbRef=this.props.sbRef.child("compositions").child(this.props.sbRef.key),this.sbAllCompsRef=this.props.sbRef.child("compositions"),this.sbRootCompRef=this.sbRef,this.firebaseGoTo({name:window.singularScene.name,compId:"root",inheritedProps:[]},this.rtdbRef,this.sbRef),this.sBindAsObject(this.props.sbRef.child("uiSettings"),"uiSettings"),this.sBindAsObject(this.props.sbRef.child("adaptationGlobals"),"adaptationGlobals"),this.sBindAsObject(this.props.sbRef.child("displayVariants"),"displayVariants"),this.sBindAsObject(this.props.sbRef.child("compositionProps").child("timeline2Active"),"timeline2Active"),this.props.rtdbRef.child("editingIds").on("value",this.checkEditingNumber)},localStorageSetItem:function(e,t){try{localStorage.setItem(e,t)}catch(e){}},componentDidMount:function(){var e=this;je.A.compositionStack=this.state.compositionStack;var t,a=this.props.sbRef.child("uiSettings").val();this.onResolutionSelect(a.editorResolution);try{t=localStorage.getItem("singularCompNavActive")}catch(e){}"true"===t?this.setState({compositionNavigatorActive:!0}):this.setState({compositionNavigatorActive:!1}),this.setState({compositionSize:this.props.initialCompositionSize});var i,s,o=n().findDOMNode(this.refs.previewPanelMain);o&&(It.A.createShortcut("mod+c",function(){e.widgetTreeRef.onCopy()},o),It.A.createShortcut("mod+v",function(){e.widgetTreeRef.onPaste()},o),It.A.createShortcut("left",function(){e.moveSelectedObject(-1,0)},o),It.A.createShortcut("right",function(){e.moveSelectedObject(1,0)},o),It.A.createShortcut("up",function(){e.moveSelectedObject(0,-1)},o),It.A.createShortcut("down",function(){e.moveSelectedObject(0,1)},o),It.A.createShortcut("shift+left",function(){e.moveSelectedObject(-3,0)},o),It.A.createShortcut("shift+right",function(){e.moveSelectedObject(3,0)},o),It.A.createShortcut("shift+up",function(){e.moveSelectedObject(0,-3)},o),It.A.createShortcut("shift+down",function(){e.moveSelectedObject(0,3)},o),It.A.createShortcut("mod+left",function(){e.moveSelectedObject(-.1,0)},o),It.A.createShortcut("mod+right",function(){e.moveSelectedObject(.1,0)},o),It.A.createShortcut("mod+up",function(){e.moveSelectedObject(0,-.1)},o),It.A.createShortcut("mod+down",function(){e.moveSelectedObject(0,.1)},o),It.A.createShortcut("del",function(){e.onWidgetTreeDeleteButton()},o));try{i=localStorage.getItem("splitPaneHorizontal"),s=localStorage.getItem("splitPaneVertical")}catch(e){}(!i||i<250||i>window.innerHeight-250)&&(i=window.innerHeight/2,this.localStorageSetItem("splitPaneHorizontal",i),this.forceUpdate()),(!s||s<500||s>window.innerWidth-650)&&(s=window.innerWidth/2,this.localStorageSetItem("splitPaneVertical",s),this.forceUpdate());var l=function(t){var a=document.getElementById("onairPreview");a?(a.addEventListener("mousedown",e.handlePreviewMouseDown),document.addEventListener("mousemove",e.handlePreviewMouseMove),document.addEventListener("mouseup",e.handlePreviewMouseUp),a.addEventListener("mouseenter",e.handlePreviewMouseEnter),a.addEventListener("mouseleave",e.handlePreviewMouseLeave),a.addEventListener("scroll",e.handlePreviewScroll)):setTimeout(l,1e3)};if(l(),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.resizeRightPanelWindow(parseInt(i)),this.state.uiSettings.showInteractiveHighlight){var r=0,c=function(){var t=e.onAirRefCollection[e.props.sbRef.key];t?t.setInteractiveHighlight(e.state.uiSettings.showInteractiveHighlight):r<10&&(r++,setTimeout(c,500))};c()}this.props.onOff({id:this.props.editingId,off:!1});try{singularanalytics.event(analyticEventType.COMP_OPENED,window.singularScene.account_id,"UI",window.location.hostname,{element_id:window.singularScene.id,user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.COMP_OPENED,{plan:window.singularUser.account.subscription.subscription_plan,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}window.addEventListener("beforeunload",function(e){var t=null;return"done"!==this.state.savingState&&!0!==this.state.failToSaveToFirebase&&(e.preventDefault(),t="The composition was changed but not saved yet. Are you sure you want to close the page?",(e||window.event).returnValue=t),t}.bind(this),!1)},setSelection:function(e){if(e)this.setState({selection:e}),this.selections[this.sbRef.key]=e,this.boundingBoxRef&&this.state.uiSettings.showBoundingBox&&("widget"!=this.state.selection.type&&"composition"!=this.state.selection.type||0==this.state.selection.id?this.boundingBoxRef.drawMovementOrigin():this.boundingBoxRef.drawMovementOrigin(this.sbRef.child("tiles").val()[this.state.selection.id]));else{var t=this.getGroupArray();t.sort(function(e,t){return(e.priority>t.priority)-.5}),this.onGroupSelect(t[0])}},moveSelectedObject:function(e,t){this.getOnAirRef().moveSelectedObject(e,t)},componentWillUnmount:function(){this.firebaseUnbind();var e=document.getElementById("onairPreview");e&&(e.removeEventListener("mousedown",this.handlePreviewMouseDown),document.removeEventListener("mousemove",this.handlePreviewMouseMove),document.removeEventListener("mouseup",this.handlePreviewMouseUp),e.removeEventListener("mouseenter",this.handlePreviewMouseEnter),e.removeEventListener("mouseleave",this.handlePreviewMouseLeave),e.removeEventListener("scroll",this.handlePreviewScroll)),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},handlePreviewScroll:function(){this.updateBoundingBox()},handlePreviewMouseDown:function(e){if(e.altKey&&0===e.button){e.preventDefault();var t=document.getElementById("onairPreview");t&&(this._isDragging=!0,this._dragStartX=e.clientX,this._dragStartY=e.clientY,this._scrollStartX=t.scrollLeft,this._scrollStartY=t.scrollTop,this.updateOnairPreviewCursor(),this.setState({hideBoundingBox:!0}))}},handlePreviewMouseMove:function(e){if(this._isDragging){e.preventDefault();var t=document.getElementById("onairPreview");if(t){var a=e.clientX-this._dragStartX,i=e.clientY-this._dragStartY;t.scrollLeft=this._scrollStartX-a,t.scrollTop=this._scrollStartY-i}}},handlePreviewMouseUp:function(e){this._isDragging&&(this._isDragging=!1,this.updateOnairPreviewCursor(),this.setState({hideBoundingBox:!1}))},updateOnairPreviewCursor:function(){var e=document.getElementById("onairPreview");if(e){var t="auto",a=e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth;this._isDragging&&a?t="grabbing":this._altKeyPressed&&this._mouseOverPreview&&a?t="grab":this.state.uiSettings.showBoundingBox&&(t="default"),e.style.cursor=t}},handleKeyDown:function(e){e.altKey&&!this._altKeyPressed&&(this._altKeyPressed=!0,this.updateOnairPreviewCursor())},handleKeyUp:function(e){!e.altKey&&this._altKeyPressed&&(this._altKeyPressed=!1,this.updateOnairPreviewCursor())},handlePreviewMouseEnter:function(){this._mouseOverPreview=!0,this.updateOnairPreviewCursor()},handlePreviewMouseLeave:function(){this._mouseOverPreview=!1,this.updateOnairPreviewCursor()},componentDidUpdate:function(){this.updateOnairPreviewCursor(),this.state.showEditedByOtherUser&&this.props.onOff({id:this.props.editingId,off:!0})},shouldComponentUpdate:function(e,t){return!hi.compareObject(t,this.state)},checkEditingNumber:function(e){e.exists()&&!e.val()[this.props.editingId]&&(this.props.rtdbRef.child("editingIds").off("value",this.checkEditingNumber),this.setState({showEditedByOtherUser:!0}))},ToggleGuidesMenu:function(e){zE.identify({name:window.singularUser.name,email:window.singularUser.email}),zE.activate({hideOnClose:!0})},firebaseAnimationState:function(e){var t,a,i;e.exists()?this.setState({animationState:e.val()}):this.setState({animationState:"Out1"}),this.timelineIsUpdated||(this.timelineIsUpdated=!0,e.exists()&&(t=e.val()),i="Out1"==t||"In"==t?"In":"Out",a="Out1"==t?0:"In"==t?this.getDuration().In:this.getDuration().Out,this.updateTimeline(e.key,i,a),this.updateMasterTimeline(i,a))},firebaseBind:function(e,t){this.rtdbRef=e.rtdbRef;var a=this.sbRef=e.sbRef;if(this.sBindAsObject(e.sbRef.child("settings"),"settings"),this.props.sbRef.child("compositionStates").child(this.sbRef.key).on("value",this.firebaseAnimationState),!t)if(a.key!=this.props.sbRef.key&&this.state.uiSettings.showActiveCompInPreview){var i=this.tileProperties[this.sbRef.key];i&&this.setState({standaloneOnAir:this.sbRef.key,standaloneOnAirWidth:i.width,standaloneOnAirHeight:i.height})}else""==this.tempEditCompId&&this.setState({standaloneOnAir:null});this.setSelection(this.selections[this.sbRef.key])},firebaseUnbind:function(){this.state.compositionStack.length&&(this.sUnbind("composition"),this.props.sbRef.child("compositionStates").child(this.sbRef.key).off("value",this.firebaseAnimationState))},firebaseGoTo:function(e,t,a,i){var n={name:e.name,compId:e.compId,inheritedProps:e.inheritedProps,rtdbRef:t,sbRef:a,editCompInfo:i};this.firebaseUnbind(),this.state.compositionStack.push(n),this.firebaseBind(n)},firebaseGoBack:function(e){var t={};if(this.state.compositionStack.length>1){for(var a=0;a<e;a++){var i=this.state.compositionStack.pop();i.editCompInfo&&$.extend(!0,t,this.exitEditCompStandalone(i.editCompInfo))}var n=this.state.compositionStack[this.state.compositionStack.length-1];this.firebaseUnbind(),this.firebaseBind(n);for(var s=n.editCompInfo,o=this.state.compositionStack.length-1;!s&&o>=0;)s=this.state.compositionStack[o].editCompInfo,o--;s?this._editWidgetComp(s):this.tempEditCompId=""}return this.forceUpdate(),t},_editWidgetComp:function(e,t){this.tempEditCompId=e.compKey,this.setState({busy:!0});var a=this,i=function(){var n,s=a.onAirRefCollection[a.props.sbRef.key];s&&(n=s.getIFrameRef(null,e.widgetTileId,!0))&&n.initHasBeenCalled&&(n.onSingularEditComp(e.widgetFieldId),1)?(a.setState({busy:!1}),t&&t()):setTimeout(i,1e3)};i()},onGotoComp:function(e,t,a){if("composition"==e.type){var i=this.props.rtdbRef.child("compositions").child(e.id),n=this.sbRef.parent.child(e.id),s={};$.extend(!0,s,t),this.firebaseGoTo({name:e.name,compId:e.id,inheritedProps:s},i,n,a)}},onMessage:function(e){"edit-comp-standalone"==e.message?(this.setState({standaloneOnAir:this.tempEditCompId,standaloneOnAirWidth:e.params.width,standaloneOnAirHeight:e.params.height}),e.params.widgetNodes&&this.writeWidgetNodes(e.params.widgetNodes)):"widget-log"==e.message&&N.A.add(e.params.type,{title:e.params.log.title,description:e.params.log.description,compositionId:e.params.compositionId,tileId:e.params.tileId})},onBusy:function(e){this.setState({busy:e})},writeWidgetNodes:function(e){var t=this.props.sbRef.child("compositions").child(this.state.standaloneOnAir);if(t.exists()){var a={id:"widgetNode",name:"Widget Node",model:{fields:{}},payload:{}},i=t.child("dataSources").child("composition").child("widgetNode"),n=0;for(var s in e){var o=e[s];if(o.id&&o.type&&o.title){var l=i.push().key;a.model.fields[l]=o,a.payload[o.id]=o.defaultValue,n++}}n>0&&i.set(a)}},onEditCompStandalone:function(e,t,a,i,n){var s=this.sbRef.key;if(""==a){var o=this.props.sbRef.child("compositions").push();hi.createDefaultGroupForComposition(o),a=o.key,this.props.sbRef.child("compositionStates").child(a).set("In"),this.props.sbRef.child("compositions").child(s).child("data").child(i).child(e).set(a)}var l=this.state.compositionStack.length,r=this.firebaseGoBack(l-1)[a];r||(r=a),this._navigateToTileFromRoot(r)},exitEditCompStandalone:function(e){var t=this;if(ii.A.ReleaseIframe(e.widgetTileId),this.tempEditCompId="",null!=this.state.standaloneOnAir){var a=this.props.sbRef.child("compositions").child(e.compKey),i=a.key,n=JSON.parse(JSON.stringify(a.val())),s=mi.v4(),o=this.props.sbRef.child("compositions/"+s);o.set(n);var l=this.props.sbRef.child("compositionStates").child(i),r=l.val();r||(r="In"),this.props.sbRef.child("compositionStates").child(s).set(r);var c=this.props.sbRef.child("compositionProps").val();We.A.COMPOSITION_PROPS.forEach(function(e){c[e]&&void 0!==c[e][i]&&t.props.sbRef.child("compositionProps").child(e).child(s).set(c[e][i]),t.props.sbRef.child("compositionProps").child(e).child(i).remove()}),l.remove(),a.remove(),e.compRef.child("data").child(e.widgetTileId).child(e.widgetFieldId).set(o.key),this.state.standaloneOnAir&&this.setState({standaloneOnAir:null});var d={};return d[a.key]=s,d}},onShowTimeline:function(e){this.setState({showTimeline:e}),e?($(".animation-wrapper").show(),$(".ruler-wrapper.top").show(),$(".animation-right-menu").show(),$(".comp-properties-panel").css("height",0),$(".composition-tree .list-group-item.active").css("width",""),$(".composition-tree .list-group-item").css("width","")):($(".animation-wrapper").hide(),$(".ruler-wrapper.top").hide(),$(".animation-right-menu").hide(),$(".comp-properties-panel").css("height","100%"),$(".composition-tree .list-group-item.active").css("width","360px"))},onDataChange:function(e){},hideBlockInputToPreview:function(){$(document).unbind("mouseup",this.hideBlockInputToPreview),$(this.blockInputToPreview).css("display","none")},splitPaneChange:function(e,t){this.blockInputToPreview&&($(this.blockInputToPreview).css("display","block"),$(document).mouseup(this.hideBlockInputToPreview)),$("#onairPreview").trigger("splitPaneChange"),"splitPaneHorizontal"==e&&this.resizeRightPanelWindow(t),this.localStorageSetItem(e,t),this.forceUpdate(),this.widgetTreeRef&&this.widgetTreeRef.forceUpdate(),setTimeout(function(){$("#onairPreview").trigger("splitPaneChange")},100)},resizeRightPanelWindow:function(e){},onSettings:function(e,t){var a={};if(a[e]=t,"linkTimeline"==e)if(this.sbRef.key!=this.props.sbRef.key)if(t){var i=null,n=this.props.sbRef.child("compositions").val();for(var s in n){var o=n[s];if(o.tiles)for(var l in o.tiles)if(o.tiles[l].id==this.sbRef.key){i=s;break}}i||(i=this.props.sbRef.key),i&&(a.parentTimeline=i)}else this.sbRef.child("settings").child("parentTimeline").remove();else a[e]=!1,this.sbRef.child("settings").child("parentTimeline").remove();this.sbRef.child("settings").update(a)},onUISettings:function(e,t){var a=this,i={};"object"===pi(e)?i=e:i[e]=t,this.props.sbRef.child("uiSettings").update(i,!1),("editorResolutionWidth"==e||"editorResolutionHeight"==e||e.editorResolutionWidth||e.editorResolutionHeight)&&(this.UISettingsTimeoutHandler&&clearTimeout(this.UISettingsTimeoutHandler),this.UISettingsTimeoutHandler=setTimeout(function(){a.UISettingsTimeoutHandler=null,a.onResolutionSelect(a.state.uiSettings.editorResolution)},200))},onLinkTimeline:function(e,t){this.props.sbRef.child("compositions").child(e).child("settings").child("linkTimeline").set(t),t?this.props.sbRef.child("compositions").child(e).child("settings").child("parentTimeline").set(this.sbRef.key):this.props.sbRef.child("compositions").child(e).child("settings").child("parentTimeline").remove(),t&&this.props.sbRef.child("compositionProps").child("logicLayers").child(e).remove()},onTimeline2Active:function(e,t){this.props.sbRef.child("compositionProps").child("timeline2Active").child(e).set(t)},getCompositionAnimationDuration:function(e,t){var a=0,i=0,n=t[e];for(var s in n.groups){var o=n.groups[s];"none"!=o.effects.In.effect&&(a=Math.max(a,o.keyframes.In[1])),"none"!=o.effects.Out.effect&&(i=Math.max(i,o.keyframes.Out[1]))}for(var l in n.tiles){var r=n.tiles[l];if("none"!=r.effects.In.effect&&(a=Math.max(a,r.keyframes.In[1])),"none"!=r.effects.Out.effect&&(i=Math.max(i,r.keyframes.Out[1])),"composition"==r.type&&t[r.id]&&t[r.id].settings&&t[r.id].settings.linkTimeline){var c=this.getCompositionAnimationDuration(r.id,t);a=Math.max(a,c.In),i=Math.max(i,c.Out)}}return{In:a,Out:i}},getGroupArray:function(){var e=[],t=this.sbRef.child("groups").val();for(var a in t)e.push(t[a]);return e},getTileArray:function(){var e=[],t=this.sbRef.child("tiles").val();for(var a in t)e.push(t[a]);return e},getDuration:function(){var e=0,t=0,a=this.props.sbRef.child("compositions").val();return this.getGroupArray().forEach(function(a){"none"!=a.effects.In.effect&&(e=Math.max(e,a.keyframes.In[1])),"none"!=a.effects.Out.effect&&(t=Math.max(t,a.keyframes.Out[1]))}),this.getTileArray().forEach(function(i){if("none"!=i.effects.In.effect&&(e=Math.max(e,i.keyframes.In[1])),"none"!=i.effects.Out.effect&&(t=Math.max(t,i.keyframes.Out[1])),"composition"==i.type&&a[i.id]&&a[i.id].settings&&a[i.id].settings.linkTimeline){var n=hi.getCompositionAnimationDuration(i.id,a);e=Math.max(e,n.In),t=Math.max(t,n.Out)}}),{In:e,Out:t}},updateMasterTimeline:function(e,t){var a=this.getDuration();if("In"==e){var i=Math.min(a.In,t);this.setState({masterTimelinePosition:i})}else if("Out"==e){var n=Math.min(a.In+a.Out,t+a.In);this.setState({masterTimelinePosition:n})}},updateTimelineByMasterTimelinePosition:function(e){var t=this.state.timelinePositions,a=this.getDuration(),i="In";e<=a.In?(t.In=Math.max(e,0),i="In",t.Out=0):(t.Out=Math.min(e-a.In,a.Out),i="Out",t.In=a.In),this.setState({timelinePositions:t,compActiveTimeline:i})},updateTimeline:function(e,t,a){if(e==this.sbRef.key){var i=this.state.timelinePositions,n=this.getDuration();i[t]=Math.min(a,n[t]),"In"==t?i.Out=0:"Out"==t&&(i.In=n.In),this.setState({timelinePositions:i,compActiveTimeline:t})}},getOnAirRef:function(e){return e?this.onAirRefCollection[e]:this.onAirRefCollection[this.sbRef.key]},onTimelinePosition:function(e,t,a){var i,n=this.getDuration();0==n.In&&0==n.Out||(this.updateTimeline(e,t,a),this.updateMasterTimeline(t,a),this.state.settings.linkTimeline&&(i=this.state.settings.parentTimeline),this.getOnAirRef(i).setTimelinePosition(e,t,a),this.updateBoundingBox())},onMasterTimelinePosition:function(e){var t,a=this.getDuration(),i=Math.min(e,a.In+a.Out);this.updateTimelineByMasterTimelinePosition(e),this.setState({masterTimelinePosition:i}),this.state.settings.linkTimeline&&(t=this.state.settings.parentTimeline),e<=a.In?this.getOnAirRef(t).setTimelinePosition(this.sbRef.key,"In",Math.max(e,0)):this.getOnAirRef(t).setTimelinePosition(this.sbRef.key,"Out",Math.min(e-a.In,a.Out)),this.updateBoundingBox()},onOnAirTimelinePosition:function(e,t,a){this.updateBoundingBox(),this.state.uiSettings&&!0===this.state.uiSettings.disableTimelineUpdate||this.state.showTimeline&&(this.updateTimeline(e,t,a),e==this.sbRef.key&&this.updateMasterTimeline(t,a))},onAnimationStateMoveFromTo:function(e,t){var a=this.sbRef.key;je.A.compAnimationState[a][a]=e,this.onAnimationStateMoveTo(t,{position:0,forceFromEditor:!0})},onAnimationStateMoveTo:function(e,t){var a=this,i=this.sbRef.key,n=je.A.compAnimationState[i][i];if(n){var s=this.props.sbRef.child("compositionProps").child("timeline2Active").val(),o=!0;void 0!==s[i]&&!1===s[i]&&(o=!1);var l=hi.getAnimationState(n,e,o).to;this.setState({animationState:l});var r={};r.id=Math.random();var c={name:"play2"};c.target=this.sbRef.key,c.to=l,c.options=t;for(var d=this.props.sbRef.child("compositions").val(),p=c.target;d&&d[p]&&d[p].settings&&d[p].settings.linkTimeline;)p=d[p].settings.parentTimeline;c.target=p,r.commands=[],r.commands.push(c);var m=this.props.sbRef.child("compositionProps").child("logicLayers").val();ui.computeLogicLayerCompositionStates(p,p,n,m,s).forEach(function(e){r.commands.unshift({name:c.name,target:e.timeline,to:e.state}),a.props.sbRef.child("compositionStates").child(e.timeline).set(e.state)}),this.props.sbRef.child("command").set(r,!1),this.props.sbRef.child("compositionStates").child(this.sbRef.key).set(l)}},compositionNavControlAll:function(e,t){var a=this.props.sbRef.child("compositions").val(),i=(this.props.sbRef.child("compositionStates").val(),Object.keys(a));i=i.filter(function(e){return!!a[e].settings&&!a[e].settings.linkTimeline});var n={};n.id=Math.random(),n.commands=[];for(var s=0;s<i.length;s++){var o=i[s],l={};l.name=t?"jump2":"play2",l.target=o,l.to=e,n.commands.push(l),"In"==e?this.props.sbRef.child("compositionStates").child(o).set("In"):this.props.sbRef.child("compositionStates").child(o).set("Out1")}this.props.sbRef.child("command").set(n,!1)},compositionNavControl:function(e,t){var a=this;if("__ALL__"!=e){var i={};i.id=Math.random();var n={name:"play2"};n.target=e,n.to=t,e=n.target;for(var s=this.props.sbRef.child("compositions").val(),o=this.props.sbRef.child("compositionStates").val();s&&s[e]&&s[e].settings&&s[e].settings.linkTimeline;)e=s[e].settings.parentTimeline;n.target=e,i.commands=[],i.commands.push(n);var l,r,c,d=this.props.sbRef.child("compositionProps").child("timeline2Active").val(),p=this.props.sbRef.child("compositionProps").child("logicLayers").val(),m=this.props.sbRef.child("compositionProps").child("durations").val(),u=[],h=ui.computeLogicLayerCompositionStates(e,e,t,p,d,u);u.forEach(function(e){"In"==o[e]&&(r=e)}),m&&m[r]&&(l=d[r]?m[r].Out:m[r].In),p&&p[e]&&(c=p[e].delay),r||(c="none");var f=0,g=0;if("auto"==c)g=parseFloat(l),isNaN(g)&&(g=0);else if("custom"==c){var v=parseFloat(p[e].time);isNaN(v)&&(v=0),v<0?f=-v:g=v}for(var b in n.delay=g,h.forEach(function(e){i.commands.unshift({name:n.name,target:e.timeline,to:e.state,delay:f}),a.props.sbRef.child("compositionStates").child(e.timeline).set(e.state)}),n.states={},je.A.stateCommand={},o)b!=e&&0==h.filter(function(e){return e.timeline==b}).length&&(s[b]&&s[b].settings&&s[b].settings.linkTimeline||(n.states[b]=o[b]));je.A.stateCommand=n.states,this.props.sbRef.child("command").set(i,!1),"In"==t?this.props.sbRef.child("compositionStates").child(e).set("In"):d[e]?this.props.sbRef.child("compositionStates").child(e).set("Out2"):this.props.sbRef.child("compositionStates").child(e).set("Out1")}else this.compositionNavControlAll(t)},selectLogicLayer:function(e,t,a){t?this.props.sbRef.child("compositionProps").child("logicLayers").child(e).update({name:t,tag:a}):this.props.sbRef.child("compositionProps").child("logicLayers").child(e).remove(),t&&this.compositionNavControl(e,"In")},onSaveToFirebase:function(e,t,a,i){"done"==e&&this.setState({compositionSaveDuration:i}),this.setState({savingState:e}),void 0!==a&&this.setState({compositionSize:a}),"error"===e&&(console.error(t),this.setState({failToSaveToFirebase:!0,failToSaveToFirebaseMessage:t}))},onNotification:function(e,t,a,i){this.refs.notificationSystem&&this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:a,position:i})},saveCompositionDuration:function(e){for(var t in this.props.rootTimelines){var a=this.props.rootTimelines[t][t];a&&(a.In&&this.props.sbRef.child("compositionProps").child("durations").child(t).child("In").set(a.In.duration(),!1),a.Out&&this.props.sbRef.child("compositionProps").child("durations").child(t).child("Out").set(a.Out.duration(),!1))}var i=this.props.sbRef.child("compositionProps").child("durations").val();for(var t in i)this.props.rootTimelines[t]||this.props.sbRef.child("compositionProps").child("durations").child(t).remove(!1)},onResolutionSelect:function(e){if(this.state.displayVariants&&this.state.displayVariants.variants&&this.state.displayVariants.variants.length>0)this.onDisplayVariantsChanged(this.state.displayVariants);else{e||(e=0);var t=(0,Ka.H)(e);-1==e?(t.width=this.state.uiSettings.editorResolutionWidth,t.height=this.state.uiSettings.editorResolutionHeight):(this.props.sbRef.child("uiSettings/editorResolutionWidth").set(t.width,!1),this.props.sbRef.child("uiSettings/editorResolutionHeight").set(t.height,!1)),this.onUISettings("editorResolution",e),this.setState({editorWidth:t.width,editorHeight:t.height},function(){this.onAirRefCollection[this.props.sbRef.key].resizeRenderWindow(),this.boundingBoxRef.drawMovementOrigin()})}},forceCompositionUpdate:function(){this.forceUpdate()},onValueChanged:function(e,t,a){"Master-Timeline-Position"==t&&this.onMasterTimelinePosition(a)},toggleBoundingBox:function(){this.props.sbRef.child("uiSettings").update({showBoundingBox:!this.state.uiSettings.showBoundingBox},!1)},toggleInteractiveHighlight:function(){var e=!this.state.uiSettings.showInteractiveHighlight;this.props.sbRef.child("uiSettings").update({showInteractiveHighlight:e},!1);var t=this.onAirRefCollection[this.props.sbRef.key];t&&t.setInteractiveHighlight(e)},toggleWatermark:function(){var e=this.state.uiSettings.showWatermark?0:1;this.props.sbRef.child("uiSettings").update({showWatermark:e},!1)},togglePreviewSnap:function(){this.props.sbRef.child("uiSettings").update({previewSnap:!this.state.uiSettings.previewSnap},!1)},onZoomLevelChanged:function(e){var t=this,a=document.getElementById("onairPreview");if(a){var i=this.state.zoomLevel,n="FIT"===e?1:e/100,s=a.scrollLeft,o=a.scrollTop,l=a.clientWidth,r=a.clientHeight,c=this.state.standaloneOnAir?this.state.standaloneOnAirWidth:this.state.editorWidth,d=this.state.standaloneOnAir?this.state.standaloneOnAirHeight:this.state.editorHeight,p=c*n,m=d*n,u=.5,h=.5;if("FIT"!==i){var f=i/100,g=c*f,v=d*f,b=Math.max((l-g)/2,0),y=Math.max((r-v)/2,0);u=g>0?(s+l/2-b)/g:.5,h=v>0?(o+r/2-y)/v:.5}this.setState({zoomLevel:e},function(){var e=t.state.standaloneOnAir||t.props.sbRef.key;t.onAirRefCollection[e].resizeRenderWindow();var i=Math.max((l-p)/2,0),n=Math.max((r-m)/2,0),s=u*p+i-l/2,o=h*m+n-r/2;a.scrollLeft=Math.max(0,s),a.scrollTop=Math.max(0,o)})}else this.setState({zoomLevel:e},function(){t.onAirRefCollection[t.props.sbRef.key].resizeRenderWindow()})},onCaptureThumbnail:function(){var e=this;this.setState({captureSnapshotBusy:!0});var t=function(){e.setState({captureSnapshotBusy:!1}),$("#captureThumbnailWarningModal").modal("show")};chrome.runtime?chrome.runtime.sendMessage("mcchmhccnhmgnjkoimaamfgobojmnakj",{},function(e){var a=this;if(e){var i=window.singularScene.id,n=hi.getApiEndpointFromBrowserShortType("c")+i+"/thumbnail";bi(e,function(e){var t=hi.dataURItoFile(e,i+".png"),s=S().put(n);s.field("name",t.name),window.singularScene.foldersToUpdateRecent&&window.singularScene.foldersToUpdateRecent.length>0&&s.field("folder",window.singularScene.foldersToUpdateRecent[0]),s.attach("file",t),s.end(function(e,t){e?this.onNotification("Failed to upload thumbnail","error",5,"tc"):this.onNotification("The composition thumbnail has been updated","info",5,"tc"),this.setState({captureSnapshotBusy:!1})}.bind(a))})}else-1!==chrome.runtime.lastError.message.indexOf("Could not establish connection.")?t():(this.setState({captureSnapshotBusy:!1}),this.onNotification(chrome.runtime.lastError.message,"error",5,"tc"))}.bind(this)):t()},onCaptureSubComp:function(){var e=this;chrome.runtime?(this.setState({captureSubcompMessage:"Initializing sub composition snapshot",captureSubcompCancel:!1,captureSubcompBusy:!0}),$.extend(!0,{},this.props.sbRef.child("compositionStates").val()),this.compositionNavControlAll("Out1",!0),setTimeout(function(){var t=e.props.sbRef.child("compositions").val(),a=[],i=function(e){var n=t[e];for(var s in n.tiles){var o=n.tiles[s];"composition"==o.type&&t[o.id]&&(0==t[o.id].settings.linkTimeline?a.push(o.id):this.props.sbRef.child("compositionProps").child("snapshot").child(o.id).set(""),i(o.id))}}.bind(e);i(e.props.sbRef.key),e.uploadSubcompsThumbnail(a,function(t,a){e.props.sbRef.child("compositionProps").child("snapshot").child(t).set(a)},function(){e.setState({captureSubcompMessage:void 0,captureSubcompCancel:!1,captureSubcompBusy:!1})})},500)):$("#captureThumbnailWarningModal").modal("show")},uploadSubcompsThumbnail:function(e,t,a){var i=this,n=0;E().eachSeries(e,function(a,s){i.state.captureSubcompCancel?s():(n++,i.setState({captureSubcompMessage:"Processing sub composition "+n+" of "+e.length}),l.A.controlLib.jump2(a,a,"In"),setTimeout(function(){chrome.runtime.sendMessage("mcchmhccnhmgnjkoimaamfgobojmnakj",{},function(e){bi(e,function(i){if(l.A.controlLib.jump2(a,a,"Out1"),e){var n=window.singularScene.id,o=hi.getApiEndpointFromBrowserShortType("c")+n+"/subcompimage",r=hi.dataURItoFile(i,n+".png"),c=S().post(o);c.field("key",a),c.attach("file",r),c.end(function(e,i){e?s(e):(i.body.url&&t&&t(a,i.body.url),s())})}else s("cannot connect")})})},100))},function(e,t){e&&("cannot connect"==e?-1!==chrome.runtime.lastError.message.indexOf("Could not establish connection.")&&$("#captureThumbnailWarningModal").modal("show"):i.onNotification("Failed to upload sub composition snapshot","error",5,"tc")),S().post("/apiv1/compositions/"+window.singularScene.id+"/subcompimage/log").end(),a&&a()})},toggleShowActiveComp:function(){this.props.sbRef.child("uiSettings").update({showActiveCompInPreview:!this.state.uiSettings.showActiveCompInPreview},!1)},onOnAirWidgetSelect:function(e,t,a){e.altKey||this.sbRef.child("tiles").val()[a]&&this.__onWidgetSelect(a,"widget",t,"")},onWidgetTreeDeleteButton:function(){if(this.selectedTile){var e=this.props.sbRef.child("compositions").child(this.sbRef.key).child("groups").val();for(var t in e){var a=e[t];if(a.items&&a.items[this.selectedTile.id]){this.selectedGroup=a;break}}this.widgetTreeRef.onWidgetDelete(this.selectedTile,this.selectedGroup)}else this.selectedGroup&&this.widgetTreeRef.onGroupDelete(this.selectedGroup)},onWidgetSelect:function(e,t,a){null==e&&(e=""),this.__onWidgetSelect(t.id,t.type,a.id,e)},__onWidgetSelect:function(e,t,a,i){var n={id:e,type:t,groupId:a,startTab:i};this.setSelection(n),this.selectedTile=this.sbRef.child("tiles").val()[e],this.boundingBoxRef&&this.state.uiSettings.showBoundingBox&&this.boundingBoxRef.drawMovementOrigin(this.sbRef.child("tiles").val()[e]);var s=this.getOnAirRef();s&&(s.OnAirMouseMixinGroupId=null,s.OnAirMouseMixinTileId=e)},onGroupSelect:function(e){if(e){var t={id:e.id,type:"group"};this.setSelection(t),this.selectedGroup=e,this.selectedTile=null,this.resetRenameItem();var a=this.getOnAirRef();a&&(a.OnAirMouseMixinGroupId=e.id,a.OnAirMouseMixinTileId=null)}},onSaveComposition:function(){this.props.onManualSave&&"changed"===this.state.savingState&&this.props.onManualSave()},onSetSelection:function(e){this.setSelection(e),this.resetRenameItem()},onRenameItem:function(e){this.setState({renameItem:e})},resetRenameItem:function(){this.setState({renameItem:{id:0,type:"widget"}})},updateBoundingBox:function(){this.boundingBoxRef&&this.state.uiSettings.showBoundingBox&&(this.boundingBoxRef.setWidgetTreeSelection(this.selectedGroup,this.selectedTile),this.boundingBoxRef.forceUpdate())},onOnAirElementUpdate:function(){var e=this;this.updateBoundingBox(),setTimeout(function(){e.updateBoundingBox()},100)},onTileProperties:function(e,t){this.tileProperties||(this.tileProperties={}),this.tileProperties[e]||(this.tileProperties[e]={}),$.extend(!0,this.tileProperties[e],t)},onPopoutPreviewWindow:function(){window.open(window.location.href.replace("edit","preview?bgcolor=black"))},onOpenScriptEditor:function(e){var t=window.location.href.replace("edit","script");e&&(t+="?"+e),window.open(t)},nameChanged:function(e){if(document.title=e.name,1==this.state.compositionStack.length){var t={name:e.name};window.singularScene.foldersToUpdateRecent&&window.singularScene.foldersToUpdateRecent.length>0&&(t.folder=window.singularScene.foldersToUpdateRecent[0]),S().put("/apiv1/compositions/"+window.singularScene.id+"/metadata").send(t).set("Content-Type","application/x-www-form-urlencoded").end(function(t,a){if(t)N.A.add(N.A.TYPE.ERROR,{title:"Cannot rename composition",description:t.message});else{if(a.headers.location)return void(window.location=a.headers.location);this.onMainCompositionNameChanged(e.name)}}.bind(this))}else this.state.compositionStack.length>1?this.state.compositionStack[this.state.compositionStack.length-2].sbRef.child("tiles").child(this.sbRef.key).update({name:e.name}):console.log("Invalid composition stack")},onCaptureSubcompCancel:function(){this.setState({captureSubcompCancel:!0})},doesCompScriptExist:function(){if(this.props.sbRef.child("script").exists()&&this.props.sbRef.child("script").val().length)return!0;for(var e=this.props.sbRef.child("compositionProps").child("scripts").val(),t=0,a=Object.entries(e);t<a.length;t++){var i=ci(a[t],2),n=(i[0],i[1]);if(n&&n.length)return!0}return!1},render:function(){var e,t=this;if(this.getDuration(),1==this.state.showEditedByOtherUser)return o().createElement("div",{id:"test",style:{width:"100%",height:"100%"}},o().createElement(si(),{show:!0,title:"",text:"This composition is being edited by another user",onConfirm:function(){window.location="/dashboard"},onEscapeKey:function(){window.location="/dashboard"},onOutsideClick:function(){window.location="/dashboard"}}));if(1==this.state.failToSaveToFirebase){var a="Composer needs to reload the page.";return this.state.failToSaveToFirebaseMessage&&(a+="<br/><br/>Error: "+this.state.failToSaveToFirebaseMessage),o().createElement("div",{id:"test",style:{width:"100%",height:"100%"}},o().createElement(si(),{show:!0,title:"Error while saving",html:a,onConfirm:function(){location.reload()},onEscapeKey:function(){location.reload()},onOutsideClick:function(){location.reload()}}))}var i,n,s,l,r,c=g().initializeGlobals(this.state.adaptationGlobals,this.state.editorWidth,this.state.editorHeight);if(this.state.selection)if("group"==this.state.selection.type){var d=this.state.selection.id;this.sbRef.child("groups").child(d).exists()&&(e=o().createElement(Et,{key:d,rootRtdbRef:this.props.rtdbRef,sbRef:this.sbRef.child("groups").child(d),sbAllCompsRef:this.sbAllCompsRef,sbRootCompRef:this.sbRootCompRef,sbCompositionRef:this.sbRef,compositionStack:this.state.compositionStack,onShowTimeline:this.onShowTimeline,settings:this.state.settings,adaptationGlobals:c,editorWidth:this.state.editorWidth,editorHeight:this.state.editorHeight}))}else"composition"!=this.state.selection.type&&"widget"!=this.state.selection.type||(d=this.state.selection.id,this.sbRef.child("tiles").child(d).exists()&&(e=o().createElement(Ht,{key:d,rootRtdbRef:this.props.rtdbRef,sbRef:this.sbRef.child("tiles").child(d),sbAllCompsRef:this.sbAllCompsRef,sbRootCompRef:this.sbRootCompRef,sbCompositionRef:this.sbRef,sbRootRef:this.props.sbRef,sbFieldsRef:this.sbRef.child("data").child(d),sbButtonsRef:this.sbRef.child("buttons").child(d),styles:this.state.styles,compositionDataNodes:this.state.compositionDataNodes,compositionStack:this.state.compositionStack,onEditCompStandalone:this.onEditCompStandalone,fields:void 0,groupId:this.state.selection.groupId,onShowTimeline:this.onShowTimeline,settings:this.state.settings,adaptationGlobals:c,editorWidth:this.state.editorWidth,editorHeight:this.state.editorHeight})));var p=1;if(this.state.standaloneOnAir?(s=this.props.rtdbRef.child("compositions").child(this.state.standaloneOnAir),n=this.props.sbRef.child("compositions").child(this.state.standaloneOnAir),l=this.state.standaloneOnAirWidth,r=this.state.standaloneOnAirHeight,p=1):(s=this.props.rtdbRef.child("compositions").child(this.props.rtdbRef.key),n=this.props.sbRef.child("compositions").child(this.props.rtdbRef.key),l=this.state.editorWidth,r=this.state.editorHeight,p=this.state.uiSettings.showWatermark?0:1),void 0===l||void 0===r)return!1;i=o().createElement(A.A,{key:n.key,ref:function(e){t.onAirRefCollection[s.key]=e},rtdbRef:s,rootRtdbRef:this.props.rtdbRef,sbRef:n,rootSbRef:this.props.sbRef,sbRefMode:!0,onUpdate:this.onOnAirElementUpdate,onWidgetSelect:this.onOnAirWidgetSelect,editingCompId:this.sbRef.key,noScaleUp:!0,canvasMode:"FIT"!==this.state.zoomLevel,standaloneOnAir:this.state.standaloneOnAir,compositionEditor:!0,width:l,height:r,mode:"preview",customSize:!0,uiSettings:this.state.uiSettings,showBoundingBox:this.state.uiSettings.showBoundingBox,onTileProperties:this.onTileProperties,rootTimelines:this.props.rootTimelines,onTimelinePosition:this.onOnAirTimelinePosition,onAirRefCollection:this.onAirRefCollection,showWatermark:p,adaptationGlobals:this.state.adaptationGlobals,displayVariant:this.state.displayVariants.active});var m,u,h,f,v,b,y,E=!0;if(this.state.uiSettings){var w="";(E=this.state.uiSettings.showBoundingBox)&&(w="active");var S="";this.state.uiSettings.showInteractiveHighlight&&(S="active");var N="";this.state.uiSettings.previewSnap&&(N="active"),this.state.uiSettings.showActiveCompInPreview;var C="";this.state.uiSettings.showWatermark&&(C="active")}if(this.state.busy&&(m=o().createElement("div",{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"#383838",zIndex:"10000",display:"flex",justifyContent:"center",alignItems:"center"}},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{width:"50px",height:"50px"}}))),this.state.uiSettings&&void 0!==this.state.uiSettings.editorResolution&&(u=(0,Ka.H)(this.state.uiSettings.editorResolution),-1==this.state.uiSettings.editorResolution&&((u=(0,Ka.H)(-1)).width=this.state.uiSettings.editorResolutionWidth,u.height=this.state.uiSettings.editorResolutionHeight)),hi.isChrome()&&(h=this.state.captureSnapshotBusy?o().createElement("div",{className:"tool",style:{cursor:"default"}},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{width:"21px",height:"19px",left:"-6px",top:"-5px",position:"relative"}})):o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"thumbnail"},"Save preview window as thumbnail")},o().createElement("div",{className:"tool",onClick:this.onCaptureThumbnail},o().createElement("i",{className:"fa fa-camera"})))),hi.isChrome()&&(f=this.state.captureSubcompBusy?o().createElement("div",{className:"tool",style:{cursor:"default"}},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{width:"21px",height:"19px",left:"-6px",top:"-5px",position:"relative"}})):o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"thumbnail"},"Generate thumbnails for each sub composition")},o().createElement("div",{className:"tool",onClick:this.onCaptureSubComp},o().createElement("i",{className:"fa fa-camera-retro"})))),this.state.captureSubcompBusy){b=o().createElement("div",{style:{cursor:"progress",width:"100%",height:"100%",position:"absolute",zIndex:"10000"}});var x,I={width:"60px",zIndex:"10001",position:"absolute",top:"1px"};x=0==this.state.captureSubcompCancel?o().createElement("button",{tabIndex:"-1",className:"state-label btn btn-primary v2",style:I,onClick:this.onCaptureSubcompCancel},"Cancel"):o().createElement("button",{tabIndex:"-1",className:"state-label btn btn-primary v2",disabled:!0,style:I},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{width:"25px",height:"20px",top:"-5px",position:"relative"}})),v=o().createElement("div",{style:{display:"inline-block"}},x,o().createElement("div",{style:{width:"250px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",float:"right",position:"relative",left:"70px"}},this.state.captureSubcompMessage))}y=this.state.displayVariants&&this.state.displayVariants.variants&&this.state.displayVariants.variants.length?o().createElement("div",{className:"tool"},o().createElement(qa,{displayVariants:this.state.displayVariants,onDisplayVariantsChanged:this.onDisplayVariantsChanged})):o().createElement("div",{className:"tool"},o().createElement($a.A,{onResolutionSelect:this.onResolutionSelect,selectedRes:u,uiSettings:this.state.uiSettings,onUISettings:this.onUISettings,optionsClassName:"render-options-menu-gray-scroll"})),this.state.standaloneOnAir&&(y=null);var k,D,P="tool";this.doesCompScriptExist()&&(P+=" active");try{k=localStorage.getItem("splitPaneVertical")+"px",D=localStorage.getItem("splitPaneHorizontal")+"px"}catch(e){}var T="0px",M="0px";if("FIT"!==this.state.zoomLevel){var O=$("#onairPreview");if(O){var L=this.state.zoomLevel/100,V=this.state.standaloneOnAir?this.state.standaloneOnAirWidth*L:this.state.editorWidth*L,_=this.state.standaloneOnAir?this.state.standaloneOnAirHeight*L:this.state.editorHeight*L,F=O.width(),B=O.height();T=Math.max((F-V)/2,0)+"px",M=Math.max((B-_)/2,0)+"px"}}return o().createElement("div",null,m,b,o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement(Dt.A.compositionInputSingleton,null),o().createElement(Dt.A.audioSingleton,null),o().createElement(Dt.A.imageSingleton,null),o().createElement(Dt.A.videoSingleton,null),o().createElement(Dt.A.jsonSingleton,null),o().createElement(Dt.A.dataSingleton,null),o().createElement(ai.A.colorPickerSingleton,null),o().createElement(R,{item:this.state.selection,visible:E&&!this.state.hideBoundingBox,ref:function(e){return t.boundingBoxRef=e},sbRef:this.sbRef}),o().createElement(Ja.A,{split:"vertical",minSize:500,maxSize:window.innerWidth-650,defaultSize:k,onChange:this.splitPaneChange.bind(this,"splitPaneVertical")},o().createElement("div",{className:"panel full-panel"},o().createElement("div",{style:{position:"absolute",width:"calc(100% - 124px)",display:"flex",alignItems:"center"}},this.renderSaveStatus(),this.renderBreadcrumb()),o().createElement("div",{className:"onairPreviewToolbar",style:{float:"right",padding:"0px",position:"relative",top:"2px",paddingRight:"5px"}},o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"compScritEditorSafeMode"},"Open composition script editor in safe mode")},o().createElement("div",{className:P,onClick:this.onOpenScriptEditor.bind(this,"safemode"),style:{lineHeight:"23px",height:"18px"}},o().createElement("i",{className:"fa fa-ambulance",style:{top:"-5px"}})))),o().createElement("div",{className:"onairPreviewToolbar",style:{float:"right",padding:"0px",position:"relative",top:"2px"}},o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"compScritEditor"},"Open composition script editor")},o().createElement("div",{className:P,onClick:this.onOpenScriptEditor.bind(this,""),style:{lineHeight:"23px",height:"18px",width:"90px",display:"flex",flexDirection:"row",alignItems:"center",gap:"5px"}},o().createElement("i",{className:"fa fa-code",style:{top:"0px"}}),o().createElement("span",{style:{position:"relative",top:"-1px"}},"Script Editor")))),o().createElement(Mt,{ref:function(e){t.widgetTreeRef=e},sbRef:this.sbRef,sbRootRef:this.props.sbRef,sbCompositionRef:this.sbRef,selection:this.state.selection,renameItem:this.state.renameItem,compositions:this.state.compositions,timeline2Active:this.state.timeline2Active[this.sbRef.key],onTimeline2Active:this.onTimeline2Active,onSetSelection:this.onSetSelection,onWidgetSelect:this.onWidgetSelect,onWidgetSort:this.onWidgetSort,onRenameItem:this.onRenameItem,onDeleteButton:this.onWidgetTreeDeleteButton,onGroupSelect:this.onGroupSelect,onGroupSort:this.onGroupSort,onSaveComposition:this.onSaveComposition,onLinkTimeline:this.onLinkTimeline,onGotoComp:this.onGotoComp,settings:this.state.settings,onUISettings:this.onUISettings,uiSettings:this.state.uiSettings,forceCompositionUpdate:this.forceCompositionUpdate,exitSubcomp:this.exitSubcomp,showTimeline:this.state.showTimeline,timelinePositions:this.state.timelinePositions,masterTimelinePosition:this.state.masterTimelinePosition,compActiveTimeline:this.state.compActiveTimeline,onTimelinePosition:this.onTimelinePosition,onMasterTimelinePosition:this.onMasterTimelinePosition,animationState:this.state.animationState,onAnimationStateMoveFromTo:this.onAnimationStateMoveFromTo,onToggleCompositionNavigator:this.onToggleCompositionNavigator,compositionNavigatorActive:this.state.compositionNavigatorActive,adaptationGlobals:c,forceUpdateIFrame:this.forceUpdateIFrame}),o().createElement("div",{className:"comp-properties-panel"},e)),o().createElement(Ja.A,{split:"horizontal",minSize:250,maxSize:window.innerHeight-250,defaultSize:D,onChange:this.splitPaneChange.bind(this,"splitPaneHorizontal")},o().createElement("div",{id:"preview-panel",ref:"previewPanelMain",className:"panel full-panel"},o().createElement("div",{className:"onairPreviewToolbar",style:{zIndex:1}},o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"toggleBB"},"Toggle Bounding Box")},o().createElement("div",{className:"tool "+w,onClick:this.toggleBoundingBox},o().createElement("svg",{style:{top:"-4px",position:"relative"},width:"16px",height:"16px",viewBox:"0 0 35 35"},o().createElement("g",null,o().createElement("path",{fillRule:"evenodd",d:"M 28 26C 28 26 4 26 4 26 4 26 2 26 2 26 2 26 2 24 2 24 2 24 2 4 2 4 2 4 2 2 2 2 2 2 4 2 4 2 4 2 28 2 28 2 28 2 30 2 30 2 30 2 30 4 30 4 30 4 30 24 30 24 30 24 30 26 30 26 30 26 28 26 28 26ZM 28 4C 28 4 4 4 4 4 4 4 4 24 4 24 4 24 28 24 28 24 28 24 28 4 28 4Z",fill:"rgb(136,136,136)"}),o().createElement("path",{fillRule:"evenodd",d:"M 30 26C 30 26 28 26 28 26 28 26 2 26 2 26 2 26 2 4 2 4 2 4 2 2 2 2 2 2 30 2 30 2 30 2 30 26 30 26 30 26 30 26 30 26ZM 4 4C 4 4 4 24 4 24 4 24 28 24 28 24 28 24 28 4 28 4 28 4 4 4 4 4 4 4 4 4 4 4Z"})),o().createElement("g",null,o().createElement("path",{fillRule:"evenodd",d:"M 28 28C 28 28 28 24 28 24 28 24 32 24 32 24 32 24 32 28 32 28 32 28 28 28 28 28ZM 28 12C 28 12 32 12 32 12 32 12 32 16 32 16 32 16 28 16 28 16 28 16 28 12 28 12ZM 28 0C 28 0 32 0 32 0 32 0 32 4 32 4 32 4 28 4 28 4 28 4 28 0 28 0ZM 14 24C 14 24 18 24 18 24 18 24 18 28 18 28 18 28 14 28 14 28 14 28 14 24 14 24ZM 14 12C 14 12 18 12 18 12 18 12 18 16 18 16 18 16 14 16 14 16 14 16 14 12 14 12ZM 14 0C 14 0 18 0 18 0 18 0 18 4 18 4 18 4 14 4 14 4 14 4 14 0 14 0ZM 0 24C 0 24 4 24 4 24 4 24 4 28 4 28 4 28 0 28 0 28 0 28 0 24 0 24ZM 0 12C 0 12 4 12 4 12 4 12 4 16 4 16 4 16 0 16 0 16 0 16 0 12 0 12ZM 0 0C 0 0 4 0 4 0 4 0 4 4 4 4 4 4 0 4 0 4 0 4 0 0 0 0Z"}),o().createElement("path",{fillRule:"evenodd",d:"M 32 28C 32 28 28 28 28 28 28 28 28 24 28 24 28 24 32 24 32 24 32 24 32 28 32 28 32 28 32 28 32 28ZM 18 28C 18 28 14 28 14 28 14 28 14 24 14 24 14 24 18 24 18 24 18 24 18 28 18 28 18 28 18 28 18 28ZM 4 28C 4 28-0 28-0 28-0 28-0 24-0 24-0 24 4 24 4 24 4 24 4 28 4 28 4 28 4 28 4 28ZM 32 16C 32 16 28 16 28 16 28 16 28 12 28 12 28 12 32 12 32 12 32 12 32 16 32 16 32 16 32 16 32 16ZM 18 16C 18 16 14 16 14 16 14 16 14 12 14 12 14 12 18 12 18 12 18 12 18 16 18 16 18 16 18 16 18 16ZM 4 16C 4 16-0 16-0 16-0 16-0 12-0 12-0 12 4 12 4 12 4 12 4 16 4 16 4 16 4 16 4 16ZM 32 4C 32 4 28 4 28 4 28 4 28-0 28-0 28-0 32-0 32-0 32-0 32 4 32 4 32 4 32 4 32 4ZM 18 4C 18 4 14 4 14 4 14 4 14-0 14-0 14-0 18-0 18-0 18-0 18 4 18 4 18 4 18 4 18 4ZM 4 4C 4 4-0 4-0 4-0 4-0-0-0-0-0-0 4-0 4-0 4-0 4 4 4 4 4 4 4 4 4 4Z"}))))),o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"toggleInteractiveHighlight"},"Toggle Interactive Zones")},o().createElement("div",{className:"tool "+S,onClick:this.toggleInteractiveHighlight},o().createElement("i",{className:"fa fa-crosshairs"}))),o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"snapToGrid"},"Toggle Snap to grid")},o().createElement("div",{className:"tool "+N,onClick:this.togglePreviewSnap},o().createElement("i",{className:"fa fa-th"}))),o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"toggleWatermark"},"Toggle Watermark")},o().createElement("div",{className:"tool "+C,onClick:this.toggleWatermark},o().createElement("svg",{style:{top:"-6px",position:"relative"},width:"16px",height:"16px",viewBox:"0 0 9.91 8.58"},o().createElement("polygon",{points:"5.74 8.58 9.91 8.58 7.43 4.29 4.96 0 2.48 4.29 0 8.58 4.17 8.58 4.17 7 2.73 7 4.96 3.15 7.18 7 5.74 7 5.74 8.58"})))),h,f,v,y,o().createElement(ri,{value:this.state.zoomLevel,onValueChanged:this.onZoomLevelChanged}),o().createElement(Y(),{placement:"left",delayShow:500,overlay:o().createElement(z(),{id:"preview"},"Open external preview window")},o().createElement("div",{onClick:this.onPopoutPreviewWindow,className:"render-option-popout"},o().createElement("i",{className:"fa fa-external-link"}))),o().createElement("div",{className:"tool right guides-button",onClick:this.ToggleGuidesMenu,style:{background:"#58b848"}},o().createElement("i",{className:"fa fa-question"}))),o().createElement("div",{id:"onairPreview",className:"panel full-panel onair-preview",style:{overflow:"auto"}},o().createElement("div",{id:"onairCanvas",style:{transform:"scale(".concat("FIT"===this.state.zoomLevel?1:this.state.zoomLevel/100,")"),transformOrigin:"top left",position:"relative",left:T,top:M,width:"1px",height:"1px"}},i,o().createElement("div",{id:"blockInputToPreview",ref:function(e){t.blockInputToPreview=e},style:{left:"0px",top:"0px",width:"100%",height:"100%",display:"none",position:"absolute"}}))),o().createElement("div",{className:"anim-control-menu"},o().createElement("div",{className:"timeline-actions"},o().createElement("button",{tabIndex:"-1",className:"In"==this.state.animationState?"state-label btn btn-primary v2":"btn btn-default state-label v2",onClick:this.onAnimationStateMoveTo.bind(this,"In",{})},"In"),o().createElement("button",{tabIndex:"-1",className:"In"!=this.state.animationState?"state-label btn btn-primary v2":"btn btn-default state-label v2",onClick:this.onAnimationStateMoveTo.bind(this,"Out",{})},"Out")))),o().createElement("div",{className:"panel full-panel"},o().createElement(Ga,{rtdbRef:this.rtdbRef,sbRef:this.sbRef,editingId:this.props.editingId,sbCompositionRef:this.sbRef,sbMainRef:this.props.sbRef,compositionStack:this.state.compositionStack,styles:this.state.styles,onStyleAdd:this.onStyleAdd,onStyleNameChange:this.onStyleNameChange,onStyleDelete:this.onStyleDelete,settings:this.state.settings,onSettings:this.onSettings,onBusy:this.onBusy,uiSettings:this.state.uiSettings,onUISettings:this.onUISettings,standaloneOnAir:this.state.standaloneOnAir,onNagivateToWidgetInComp:this.onNagivateToWidgetInComp,mainCompositionName:this.state.mainCompositionName,onMainCompositionNameChanged:this.onMainCompositionNameChanged,adaptationGlobals:this.state.adaptationGlobals,onAdaptationGlobalsChanged:this.onAdaptationGlobalsChanged,displayVariants:this.state.displayVariants,onDisplayVariantsChanged:this.onDisplayVariantsChanged,onNotification:this.onNotification})))),o().createElement(ti,{rootCompName:this.state.compositionStack[0].name,sbAllCompsRef:this.sbAllCompsRef,sbRootCompRef:this.sbRootCompRef,sbCompStatesRef:this.props.sbRef.child("compositionStates"),sbLogicLayersRef:this.props.sbRef.child("compositionProps").child("logicLayers"),visible:this.state.compositionNavigatorActive,onNavigateComposition:this.onNavigateComposition,onEditCompStandalone:this.onEditCompStandalone,onClose:this.onToggleCompositionNavigator,compositionNavControl:this.compositionNavControl,selectLogicLayer:this.selectLogicLayer,activeCompId:this.sbRef.key}),o().createElement("div",{id:"captureThumbnailWarningModal",className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog",style:{width:"40%",margin:"auto"}},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",top:"-2px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Singular Thumbnail Capture Extension")),o().createElement("div",{className:"modal-body"},o().createElement("div",{className:"modal-body share-scene-modal-body",style:{fontSize:"14px",padding:"0px",paddingBottom:"10px"}},o().createElement("div",null,"It seems like the Singular Thumbnail Capture extension is not installed or has been disabled. Please enabled it or install it from"," ",o().createElement("a",{target:"_blank",href:"https://chromewebstore.google.com/detail/singular-capture/mcchmhccnhmgnjkoimaamfgobojmnakj"},"here"))))))))},renderSaveStatus:function(){var e,t,a,i=this;switch(this.state.savingState){case"done":e="Saved",this.state.compositionSaveDuration&&(e+=" in "+(parseFloat(this.state.compositionSaveDuration)/1e3).toFixed(3)+" seconds");break;case"error":e="There was an error while saving";break;default:var n="Ctrl";navigator.userAgent.includes("Mac")&&(n="CMD"),e=o().createElement("span",null,"Save composition"," ",o().createElement("span",{className:"tooltip-shortcut"},n,"+s"))}switch(this.state.savingState){case"changed":t=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save-changed"},"Composition was changed")},o().createElement("i",{className:"fa fa-circle-o-notch fa-fw save-icon changed","aria-hidden":"true"}));break;case"saving":t=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save-pending"},"Saving composition")},o().createElement("i",{className:"fa fa-circle-o-notch fa-spin fa-fw save-icon","aria-hidden":"true"}));break;case"error":t=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save-error"},"There was an error while saving")},o().createElement("i",{className:"fa fa-exclamation-circle save-icon error","aria-hidden":"true"}));break;default:t=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save-done"},e)},o().createElement("i",{className:"fa fa-check-circle save-icon success","aria-hidden":"true"}))}switch(this.state.savingState){case"changed":a="save-button changed";break;case"error":a="save-button error";break;default:a="save-button"}var s,l=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save"},e)},o().createElement("button",{className:a,onClick:function(){i.props.onManualSave()},tabIndex:"-1"},o().createElement("i",{className:"fa fa-save saving-icon"}))),r="Size is "+hi.humanFileSize(this.state.compositionSize)+" of "+hi.humanFileSize(vi),c=Math.round(this.state.compositionSize/vi*1e3)/10;s=c<50?"gauge-ok":c<75?"gauge-warning":"gauge-error";var d=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"save-size-info"},r)},o().createElement("div",{className:"save-size"},o().createElement("div",{className:"save-size-gauge "+s,style:{width:c+"%"}}),o().createElement("div",{className:"save-size-label"},c.toFixed(1)+"%"))),p="Auto save is "+(!1!==this.state.uiSettings.autoSaveEnabled?"enabled":"disabled"),m=o().createElement(Y(),{placement:"right",overlay:o().createElement(z(),{id:"auto-save-info"},p)},o().createElement("div",{className:"auto-save "+(!1!==this.state.uiSettings.autoSaveEnabled?"on":"off"),onClick:function(){!1!==i.state.uiSettings.autoSaveEnabled?i.props.sbRef.child("uiSettings").update({autoSaveEnabled:!1},!1):i.props.sbRef.child("uiSettings").update({autoSaveEnabled:!0},!1)}},o().createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24"},o().createElement("path",{d:"m6.5 12c3.03756612 0 5.5 2.4624339 5.5 5.5s-2.46243388 5.5-5.5 5.5-5.5-2.4624339-5.5-5.5 2.46243388-5.5 5.5-5.5zm5.6289096-10c.5965331 0 1.1686509.23689125 1.5905738.6585934l2.8118716 2.81040012 2.8076453 2.81187325c.4212245.42185907.6578127.99364203.6578127 1.58979233v9.8793409c0 1.2426407-1.0073593 2.25-2.25 2.25l-6.5571718.0008195c.4264023-.4441773.7903106-.9488047 1.0775885-1.4997459l5.4795833-.0010736c.4142136 0 .75-.3357864.75-.75l-.000813-9.747-4.246.0008905c-1.190864 0-2.1656449-.92516156-2.2448092-2.09595115l-.0051908-.15404881-.001-4.25389054h-5.749c-.41421356 0-.75.33578644-.75.75l-.00090892 6.8265886c-.52322884.0808684-1.02585102.2241372-1.50002414.4219639l.00093306-7.2485525c0-1.24264069 1.00735931-2.25 2.25-2.25zm-2.6289096 15.5h-2l-.08987563.0080557c-.23324921.0423359-.41012437.2464844-.41012437.4919443s.17687516.4496084.41012437.4919443l.08987563.0080557.87050377.0006122c-.36017461.6735447-1.0707654 1.1229764-1.87401575 1.1229764-.6137847 0-1.1842744-.2611608-1.58513237-.710402-.05576321-.0624938-.10780502-.1282058-.15582402-.1967742-.15840404-.2261919-.47018064-.2811448-.69637253-.1227407-.2261919.158404-.28114482.4701806-.12274078.6963725.07053052.1007135.14694007.1971941.22879325.2889269.58864508.659694 1.4294867 1.0446175 2.33127645 1.0446175.94818454 0 1.80832359-.4254688 2.38493993-1.1058519l.11914978-.149636-.00057773.6318993.00805567.0898756c.04233596.2332492.24648444.4101244.49194433.4101244s.44960837-.1768752.49194433-.4101244l.00805567-.0898756v-2l-.00805567-.0898756c-.04233596-.2332492-.24648444-.4101244-.49194433-.4101244zm-3.00351198-3.1235886c-.94568796 0-1.80374093.423221-2.38030708 1.1004002l-.11917078.1489352.00170211-.6257468-.00805567-.0898756c-.04233596-.2332492-.24648445-.4101244-.49194433-.4101244-.24545989 0-.44960838.1768752-.49194434.4101244l-.00805566.0898756v2l.00805566.0898756c.03704397.2040931.19797565.3650248.4020687.4020687l.08987564.0080557h2.00128773l.08987563-.0080557c.23324921-.0423359.41012437-.2464844.41012437-.4919443s-.17687516-.4496084-.41012437-.4919443l-.08987563-.0080557-.87772819-.0002367c.36009624-.6737186 1.07077658-1.1233519 1.87421621-1.1233519.61203152 0 1.18103876.2596569 1.58179014.7066652.05871481.065492.11333189.1345405.16350243.2067263.15759838.2267539.46917753.2828156.69593149.1252172s.28281564-.4691775.12521725-.6959315c-.07369297-.1060301-.15388414-.2074101-.24006959-.3035435-.58849351-.6564206-1.42716378-1.0391337-2.32637172-1.0391337zm7.00251198-9.8174114.001 3.19489054c0 .37969576.2821539.69349096.6482294.74315338l.1017706.00684662 3.191-.00089054z",fill:"currentColor"})))),u=!1===this.state.uiSettings.autoSaveEnabled&&"saving"!==this.state.savingState;return o().createElement("div",{className:"save-status"},m,u&&l,!u&&o().createElement("div",{className:"save-icon-wrapper"},t),d)},renderBreadcrumb:function(){var e=function(e,t){var a=e.name;return e.editCompInfo&&(a+=" / "+e.editCompInfo.widgetFieldId),t==this.state.compositionStack.length-1?o().createElement("li",{key:e.sbRef.toString()},o().createElement("a",{className:"active",style:{cursor:"default"}},a)):o().createElement("li",{key:e.sbRef.toString()},o().createElement("a",{className:"u-cursor-pointer",onClick:this.onBreadCrumbClick.bind(this,this.state.compositionStack[t])},a))}.bind(this);return o().createElement("ol",{className:"breadcrumb breadcrumb-default"},o().createElement("li",null),this.state.compositionStack.map(e))},onMainCompositionNameChanged:function(e){if(this.state.compositionStack.length>0){var t=this.state.compositionStack;t[0].name=e,this.setState({compositionStack:t})}this.setState({mainCompositionName:e})},onAdaptationGlobalsChanged:function(e){this.props.sbRef.child("adaptationGlobals").set(e),this.setState({adaptationGlobals:e})},onDisplayVariantsChanged:function(e){var t=e.variants.filter(function(t){return t.name==e.active})[0],a=1920,i=1080;if(t){var n,s=gi.VARIANT_RESOLUTIONS.find(function(e){return e.id===t.resolution});s&&(a=s.width,i=s.height),n=g().addDefaultValues(n),$.extend(!0,n,t.globals),n=g().initializeGlobals(n,a,i),this.onAdaptationGlobalsChanged(n)}else a=this.state.uiSettings.editorResolutionWidth,i=this.state.uiSettings.editorResolutionHeight;var o=document.getElementById("onairPreview"),l=.5,r=.5;if(o&&"FIT"!==this.state.zoomLevel){var c=this.state.zoomLevel/100,d=this.state.editorWidth*c,p=this.state.editorHeight*c,m=o.clientWidth,u=o.clientHeight,h=o.scrollLeft,f=o.scrollTop,v=Math.max((m-d)/2,0),b=Math.max((u-p)/2,0);l=d>0?(h+m/2-v)/d:.5,r=p>0?(f+u/2-b)/p:.5}this.props.sbRef.child("displayVariants").set(e),this.setState({displayVariants:e,editorWidth:a,editorHeight:i},function(){var e=this.state.standaloneOnAir||this.props.sbRef.key;if(this.onAirRefCollection[e].resizeRenderWindow(),this.boundingBoxRef.drawMovementOrigin(),o&&"FIT"!==this.state.zoomLevel){var t=this.state.zoomLevel/100,n=a*t,s=i*t,c=o.clientWidth,d=o.clientHeight,p=Math.max((c-n)/2,0),m=Math.max((d-s)/2,0),u=l*n+p-c/2,h=r*s+m-d/2;o.scrollLeft=Math.max(0,u),o.scrollTop=Math.max(0,h)}})},onToggleCompositionNavigator:function(e){var t=this;this.setState({compositionNavigatorActive:!this.state.compositionNavigatorActive},function(){t.localStorageSetItem("singularCompNavActive",t.state.compositionNavigatorActive.toString())})},_navigateToTileFromRoot:function(e){var t,a,i=function(e,t){for(var a in e)if(-1!=e[a].indexOf(t))return a;return null},n=this.props.sbRef.child("compositions").val(),s=this.props.sbRef.key,o=We.A.getParentChildren(s,n),l=e,r=o[0],c=o[1],d=hi.getCompositionName(n,e);if(c[e]){d=c[e][0],a=c[e][1];var p=i(r,e);t={widgetFieldId:c[e][3],widgetTileId:c[e][2],compRef:this.props.sbRef.child("compositions").child(p),compKey:e,parent:p}}for(var m=[{id:e,name:d,widgetCompInfo:a,editCompInfo:t}],u=null;l!=s;)for(var h in r)if(-1!=r[h].indexOf(l)){var f=hi.getCompositionName(n,h),g=void 0,v=void 0;if(c[h]){f=c[h][0],v=c[h][1];var b=i(r,h);g={widgetFieldId:c[h][3],widgetTileId:c[h][2],compRef:this.props.sbRef.child("compositions").child(b),compKey:h,parent:b}}m[0].inheritedProps={compositionDataNodes:this.props.sbRef.child("compositions").child(h).child("dataSources").child("composition").child("dataNodes").val(),compositionControlNode:this.props.sbRef.child("compositions").child(h).child("dataSources").child("composition").child("controlNode").val(),compositionWidgetNode:this.props.sbRef.child("compositions").child(h).child("dataSources").child("composition").child("widgetNode").val()},m.unshift({id:h,name:f,widgetCompInfo:v,editCompInfo:g}),l=h;break}m[0].name="root",this.firebaseUnbind();for(var y=null,E=1;E<m.length;E++){var w=this.props.rtdbRef.child("compositions").child(m[E].id),S=this.props.sbRef.child("compositions").child(m[E].id),N={name:m[E].name,compId:m[E].id,inheritedProps:y?[]:m[E].inheritedProps,rtdbRef:w,sbRef:S,editCompInfo:m[E].editCompInfo};this.state.compositionStack.push(N),y=N.editCompInfo?t=N.editCompInfo:null,u=N}u&&this.firebaseBind(u,t),t&&this._editWidgetComp(t,function(){})},exitSubcomp:function(){var e;return this.state.compositionStack.length>1&&(e=this.state.compositionStack[this.state.compositionStack.length-1],this.onBreadCrumbClick(this.state.compositionStack[this.state.compositionStack.length-2])),e},onBreadCrumbClick:function(e){e.editCompInfo?this.onEditCompStandalone(e.editCompInfo.widgetFieldId,e.name,e.editCompInfo.compKey,e.editCompInfo.widgetTileId,e.editCompInfo.parent):this.onNavigateComposition({id:e.compId})},onNavigateComposition:function(e){var t=this.state.compositionStack.length;this.firebaseGoBack(t-1),null!=e.id&&"root"!=e.id&&this._navigateToTileFromRoot(e.id)},onNagivateToWidgetInComp:function(e,t,a){this.sbRef.key!=a&&this.onNavigateComposition({id:a}),this.__onWidgetSelect(e,"widget",t,"")},forceUpdateIFrame:function(e){var t=this.getOnAirRef().getIFrameRef(this.sbRef.key,e);t.forceRandomNumber=Math.random(),t.forceUpdate()}}),Ei=o().createClass({displayName:"CompositionConfirmEdit",getInitialState:function(){return{confirmEdit:!1,confirmEditMessage:""}},componentDidMount:function(){var e=this.props.activeUser,t=this.props.isScriptEditor?"script":"composition",a="This "+t+" is currently being edited by user "+e+". Clicking OK will close the "+t+" editor for user "+e+" and allow you to edit this "+t+".";this.setState({confirmEdit:!0,confirmEditMessage:a})},actionconfirmEdit:function(){this.props.rtdbFileRef.update({dontAsk:!0},function(){window.location.reload()})},actionCancel:function(){window.location.href="/dashboard"},render:function(){var e=this;return o().createElement(si(),{key:"sweetalertlogout",show:1==this.state.confirmEdit,title:"",text:this.state.confirmEditMessage,showCancelButton:!0,onConfirm:function(){e.setState({confirmEdit:!1}),e.actionconfirmEdit()},onCancel:function(){e.setState({confirmEdit:!1}),e.actionCancel()},onEscapeKey:function(){e.setState({confirmEdit:!1}),e.actionCancel()},onOutsideClick:function(){e.props.disableOutsideClick||(e.setState({confirmEdit:!1}),e.actionCancel())}})}});var wi=a(70187),Si=a(9769);const Ni=o().createClass({displayName:"ScriptEditorMenu",getInitialState:function(){return{fetchScriptLibraryBusy:!1,scriptLibraryContent:null,fetchScriptBusy:!1}},componentDidMount:function(){this.fetchScriptLibrary()},componentWillUnmount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return!Si.compareObject(e,this.props)||!Si.compareObject(t,this.state)},fetchScriptLibrary:function(){this.setState({fetchScriptLibraryBusy:!0}),S().get("https://script.singular.live/examples/InventoryVer2.json").end(function(e,t){if(e)console.log("cannot read script editor library");else{if(t.headers.location)return void(window.location=t.headers.location);var a;try{a=JSON.parse(t.text)}catch(e){console.log("cannot read script editor library. Parsing failed")}a&&a.content&&this.setState({scriptLibraryContent:a.content})}this.setState({fetchScriptLibraryBusy:!1})}.bind(this))},onInsertExampleScript:function(e){this.setState({fetchScriptBusy:!0}),S().get("https://script.singular.live/examples/"+e.file).end(function(e,t){if(e)console.log("cannot read script");else{if(t.headers.location)return void(window.location=t.headers.location);this.props.onInsertText(t.text)}this.setState({fetchScriptBusy:!1})}.bind(this))},render:function(){var e,t=function(e,t){return o().createElement(Y(),{key:t,placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"tip-"+t},e.info)},o().createElement("li",null,o().createElement("a",{onClick:this.onInsertExampleScript.bind(this,e)},e.name)))}.bind(this),a=[],i=!0;if(this.state.scriptLibraryContent)switch(this.props.currentFileId){case"overlay":a=this.state.scriptLibraryContent.overlay,i=!1;break;case"global":a=this.state.scriptLibraryContent.global,i=!1;break;case void 0:a=[];break;default:a=this.state.scriptLibraryContent.compositions,i=!1}e=this.state.fetchScriptBusy?o().createElement("div",null,o().createElement("button",{className:"btn btn-default",tabIndex:"-1"},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{height:"28px"}}))):o().createElement("div",{className:"btn-group"},o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"help"},"Script Library")},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",disabled:i},o().createElement("i",{style:{position:"relative",left:"-6px"},className:"fa fa-book"}))),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right"},a.map(t)));var n=o().createElement("div",{className:"btn-group"},o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"help"},"Developer Resources")},o().createElement("button",{tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},o().createElement("i",{style:{position:"relative",left:"-6px"},className:"fa fa-question"}))),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right"},o().createElement("li",null,o().createElement("a",{href:"https://developer.singular.live/composition-scripting/introduction",target:"_blank"},"Composition Script")),o().createElement("li",null,o().createElement("a",{href:"https://support.singular.live/hc/en-us/articles/52519920772889",target:"_blank"},"Script Buddy AI")),o().createElement("li",null,o().createElement("a",{href:"https://developer.singular.live/data-stream-api/introduction",target:"_blank"},"Data streams")),o().createElement("li",null,o().createElement("a",{href:"https://developer.singular.live/software-development-kits/overlay-sdk",target:"_blank"},"Singular Overlay SDK")),o().createElement("li",null,o().createElement("a",{href:"https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts",target:"_blank"},"Code Editor Keyboard Shortcuts"))));return o().createElement("div",{style:{display:"flex"}},e,n)}});var Ci=a(23233),xi=a.n(Ci),Ii=a(9769);const ki=o().createClass({displayName:"ScriptEditorSettings",getInitialState:function(){return{}},shouldComponentUpdate:function(e,t){return!Ii.compareObject(e,this.props)||!Ii.compareObject(t,this.state)},componentWillReceiveProps:function(e){e.editorSettings&&this.setState(Object.assign({},e.editorSettings))},open:function(){$("#scriptEditorSettingsModal").modal("show")},onPropertyChanged:function(e,t){var a={};t.target&&void 0!==t.target.checked?a[e]=t.target.checked:a[e]=t,this.setState(a,function(){this.props.onScriptEditorSettings&&this.props.onScriptEditorSettings(this.state)}.bind(this))},render:function(){var e=function(e,t){var a=this.state[t];return void 0===a&&(a=!1),o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},e)),o().createElement("td",null,o().createElement("label",{className:"switch rounded small",style:{margin:"0px"}},o().createElement("input",{className:"switch-input",style:{visibility:"inherit"},type:"checkbox",checked:a,onChange:this.onPropertyChanged.bind(this,t)}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"}))))}.bind(this),t="12px";this.state.fontSize&&(t=this.state.fontSize);var a=2;return this.state.tabSize&&(a=this.state.tabSize),this.state.renderWhitespace&&this.state.tabSizrenderWhitespace,this.state.keyboardHandler&&this.state.keyboardHandler,o().createElement("div",{id:"scriptEditorSettingsModal",className:"modal fade u-displaynone singular-modal",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"400px",top:"60px"}},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header",style:{padding:"5px 15px"}},o().createElement("div",{style:{fontSize:"16px",display:"inline-block"}},"Code Editor Settings"),o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",style:{padding:"0px",display:"inline-block"}},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{className:"fa fa-times",style:{position:"relative",fontSize:"12px",top:"-6px"}})))),o().createElement("div",{className:"modal-body"},o().createElement("div",{style:{display:"flex",justifyContent:"space-between",maxWidth:"690px"}},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Tab Size")),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement("button",{className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown",style:{margin:"0px"}},a,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu",style:{minWidth:"110px",textAlign:"center"}},o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"tabSize","2")},"2")),o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"tabSize","4")},"4")),o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"tabSize","8")},"8")))))),o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Font Size")),o().createElement("td",null,o().createElement("div",{className:"dropdown"},o().createElement("button",{className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown",style:{margin:"0px"}},t,o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu",style:{minWidth:"110px",textAlign:"center"}},o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"fontSize","10px")},"10px")),o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"fontSize","12px")},"12px")),o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"fontSize","14px")},"14px")),o().createElement("li",null,o().createElement("a",{onClick:this.onPropertyChanged.bind(this,"fontSize","18px")},"18px")))))),e("Dark Theme","darkTheme"),e("Show Line Numbers","lineNumbers"),e("Wrap Lines","wrapLines"),e("Indent with Tabs","indentWithTabs"),e("Render Whitespace","renderWhitespace"))))))))}});var Di=a(95474),Ai=a.n(Di),Ri=a(11978),Pi=a(71710),Ti=a.n(Pi),Mi=a(9769);const Oi=o().createClass({displayName:"CodeEditorTabs",getInitialState:function(){return this.editorsHaveBeenInitialized=!1,{editors:void 0,searchString:""}},componentWillMount:function(){this.componentWillReceiveProps(this.props)},componentWillReceiveProps:function(e){if(e.initialState&&e.files&&e.files.length&&0==this.editorsHaveBeenInitialized){var t=[];if(e.initialState.tabs.forEach(function(a){e.files.find(function(e){return e.id==a.id})&&t.push({id:a.id})}),0==t.length){var a,i=e.files.find(function(e){return"none"!=e.state});i||(i=e.files.find(function(e){return"Root Composition"==e.name}))?a=i.id:e.files[0]&&(a=e.files[0].id),a&&t.push({id:a})}this.setState({editors:t});var n,s=t.find(function(t){return t.id==e.initialState.selected});s?n=s.id:t[0]&&(n=t[0].id),this.selectTab(n),this.editorsHaveBeenInitialized=!0}},shouldComponentUpdate:function(e,t){return!Mi.compareObject(e,this.props)||!Mi.compareObject(t,this.state)},componentDidUpdate:function(e,t){this.editorsHaveBeenInitialized&&t&&this.state&&(!Mi.compareObject(t.editors,this.state.editors)||e.currentFileID!=this.props.currentFileID)&&this.saveEditorTabs()},resetEditors:function(){this.editorsHaveBeenInitialized=!1},saveEditorTabs:function(){this.props.onEditorTabsSave&&this.props.onEditorTabsSave({selected:this.props.currentFileID,tabs:this.state.editors})},selectTab:function(e){this.props.onCurrentFileIdChanged(e)},closeTab:function(e,t){var a=this.props.currentFileID;if(a==e)for(var i=0;i<this.state.editors.length;i++)if(this.state.editors[i].id==a){a=i<this.state.editors.length-1?this.state.editors[i+1].id:i>0?this.state.editors[i-1].id:void 0;break}var n=this.state.editors.filter(function(t){return t.id!=e});this.setState({editors:n}),a!=this.props.currentFileID&&this.selectTab(a),t.preventDefault(),t.stopPropagation()},addTab:function(e){if(this.state.editors&&this.state.editors.find(function(t){return t.id==e}))this.selectTab(e);else{var t=[];this.state.editors&&(t=this.state.editors.slice()),t.push({id:e}),this.setState({editors:t}),this.selectTab(e)}},onSortEnd:function(e){this.setState({editors:ua()(this.state.editors,e.oldIndex,e.newIndex)})},adjustDropDownPosition:function(){if(this.refs.AddFileDropDownButton&&this.refs.AllTabs){var e=this.refs.AddFileDropDownButton.getBoundingClientRect(),t=this.refs.AllTabs.getBoundingClientRect(),a=-2;e.right+151>t.right&&(a=-151),this.refs.AddFileDropDownMenuOffset.style.left=a+"px"}},onSearchChanged:function(e){this.setState({searchString:e.target.value})},onClearSearch:function(e){this.setState({searchString:""}),$(this.refs.AddFileDropDown).addClass("open")},onSearchKeyDown:function(e){"Escape"==e.key&&this.onClearSearch()},render:function(){var e,t=function(e){switch(e){case"exists":return o().createElement("i",{className:"fa fa-check-circle code-editor-tab-icon"});case"changed":return o().createElement("i",{className:"fa fa-circle code-editor-tab-icon"});case"error":return o().createElement("i",{className:"fa fa-exclamation-circle code-editor-tab-icon",style:{color:"red"}});case"eval":return o().createElement("i",{className:"fa fa-circle-o-notch fa-spin code-editor-tab-icon-spinner"});default:return o().createElement("i",{className:"fa fa-close code-editor-tab-icon",style:{color:"transparent"}})}},a=function(e){var a=10*e.level,i={left:a+"px",width:"calc(100% - "+(a+15)+"px)"};return this.state.searchString&&-1!==e.name.toUpperCase().indexOf(this.state.searchString.toUpperCase())&&(i.color="#f0ad4e"),o().createElement("li",{key:"key-"+e.id,className:"code-editor-tab-add-dropdown-item"},o().createElement("a",{onClick:this.addTab.bind(this,e.id)},t(e.state),o().createElement("div",{className:"code-editor-tab-label",style:i},e.name)))}.bind(this);e=this.state.searchString?o().createElement("i",{className:"fa fa-times input-clear-icon-widget-tree",onClick:this.onClearSearch}):o().createElement("i",{className:"fa fa-search filter-input-icon"});var i=o().createElement("div",{className:"dropdown code-editor-tab-add",ref:"AddFileDropDown"},o().createElement("button",{className:"btn btn-default dropdown-toggle code-editor-tab-add-button",tabIndex:"-1","data-toggle":"dropdown",onMouseDown:this.adjustDropDownPosition,ref:"AddFileDropDownButton"},o().createElement("i",{className:"fa fa-plus"})),o().createElement("div",{ref:"AddFileDropDownMenuOffset",style:{left:"-2px",top:"-30px",position:"relative"}},o().createElement("div",{className:"dropdown-menu dropdown-container"},o().createElement("div",{className:"widget-tree-filter",style:{position:"relative",display:"inline-block"}},e,o().createElement("input",{type:"text",className:"form-control filter-input",placeholder:"Find ...",value:this.state.searchString,onKeyDown:this.onSearchKeyDown,onChange:this.onSearchChanged,style:{width:"188px"}})),o().createElement("ul",{className:"dropdown-menu code-editor-tab-add-dropdown"},this.props.files.map(a))))),n=(0,pa.Zj)(function(e){var a=this.props.files.find(function(t){return t.id==e.value.id}),i="code-editor-tab";return a.id==this.props.currentFileID&&(i+=" active"),o().createElement(Y(),{placement:"bottom",delayShow:500,overlay:o().createElement(z(),{id:a.id},a.toolTip)},o().createElement("div",{key:a.id,className:i,onClick:this.selectTab.bind(this,a.id)},t(a.state),o().createElement("div",{className:"code-editor-tab-label"},a.name),o().createElement("div",{className:"code-editor-tab-close",onClick:this.closeTab.bind(this,a.id)},o().createElement("i",{className:"fa fa-close"}))))}.bind(this)),s=[];this.state.editors&&(s=this.state.editors.filter(function(e){return this.props.files.find(function(t){return t.id==e.id})}.bind(this)));var l=(0,pa.q6)(function(e){var t=e.items;return o().createElement("div",{className:"code-editor-tabs"},t.map(function(e,t){return o().createElement(n,{key:e.id,index:t,value:e})}))});return o().createElement("div",{style:{width:"100%",display:"flex",background:"linear-gradient(#3e3e3e, #2b2b2b)",borderBottom:"solid 2px #212121"},ref:"AllTabs"},o().createElement(l,{items:s,onSortEnd:this.onSortEnd,axis:"x",lockAxis:"x",distance:5,pressThreshold:5,lockToContainerEdges:!0,helperClass:"code-editor-tab-drag"}),i)}});a(80952),a(20047),a(1766),a(55208),a(22981);var Li=a(9769),Vi=a(56574),_i=a(62418);ace.config.set("basePath","/build/ace-builds"),ace.config.set("workerPath","/build/ace-builds"),ace.config.set("modePath","/build/ace-builds"),ace.config.set("themePath","/build/ace-builds");const Fi=o().createClass({displayName:"CodeEditor",getInitialState:function(){return this.availableFiles=[],this.localFiles={},this.aceEditorSessions={},this.oldSaveButtonState=void 0,this.compDSUpdate=void 0,{savingState:"done",currentFileID:null,initialTabState:void 0,script:"",evalStatus:"",evalStatusErrorList:[],compTreeRoot:void 0,compTreeStructure:{}}},componentDidMount:function(){var e=this;if(this.onLoadComposition(),window.addEventListener("message",this.previewWindowScriptMessageReceived,!1),window.addEventListener("beforeunload",function(e){var t=null;return this.didScriptChangeSinceLastSave()&&(e.preventDefault(),t="The script was changed but not saved. Are you sure you want to close the page?",(e||window.event).returnValue=t),t}.bind(this),!1),setTimeout(function(){e.refs.aceEditorRef&&e.refs.aceEditorRef.editor&&e.state.currentFileID&&void 0!==e.localFiles[e.state.currentFileID]&&e.refs.aceEditorRef.editor.getSession().setValue(e.localFiles[e.state.currentFileID].script)},2e3),window.singularScene.datastore&&!this.compDSUpdate){var t=new(c())(null);new(b())(t,window.singularScene.datastore,window.singularScene.pv).then(function(t){var a=t.update;e.compDSUpdate=a})}},componentDidUpdate:function(){var e=this.refs.aceEditorRef;e&&e.editor.resize()},shouldComponentUpdate:function(e,t){return!Li.compareObject(e,this.props)||!Li.compareObject(t,this.state)},getAllScripts:function(){return this.localFiles},getActiveFileID:function(){return this.state.currentFileID&&this.localFiles[this.state.currentFileID]?this.state.currentFileID:null},getEvalStatus:function(){return{status:this.state.evalStatus,errors:this.state.evalStatusErrorList}},onLoadComposition:function(){this.refs.CodeEditorTabs&&this.refs.CodeEditorTabs.resetEditors(),this.loadCompositionData(),this.loadScriptData(),this.loadInitialTabState()},loadScriptData:function(){var e=this;this.localFiles={},this.props.sbRef.child("script").once("value",function(t){var a="";if(t.exists()){a=t.val();try{a=Ai().decompress(a,{inputEncoding:"StorageBinaryString"})}catch(e){}}e.setLocalProperty("overlay","script",a),e.aceEditorSessions.overlay&&e.aceEditorSessions.overlay.setValue(a),e.setLocalProperty("overlay","lastSaveScript",a),a.length&&(e.props.safemode?e.setLocalProperty("overlay","evalStatus","ok"):e.setLocalProperty("overlay","evalStatus","eval")),e.updateEditor()}),this.props.sbRef.child("compositionProps").child("scripts").once("value",function(t){if(t.exists()){var a=t.val();Object.keys(a).forEach(function(e){var t=a[e];try{t=Ai().decompress(t,{inputEncoding:"StorageBinaryString"})}catch(e){}this.setLocalProperty(e,"script",t),this.aceEditorSessions[e]&&this.aceEditorSessions[e].setValue(t),this.setLocalProperty(e,"lastSaveScript",t),t.length&&(this.props.safemode?this.setLocalProperty(e,"evalStatus","ok"):this.setLocalProperty(e,"evalStatus","eval"))}.bind(e)),e.updateEditor()}}),this.props.safemode&&setTimeout(function(){this.updateEditor()}.bind(this),1e3)},rebuildAvailableFiles:function(e,t){var a=[];if(e){a.push({id:"overlay",name:"Overlay Script",state:this.getFileState("overlay"),toolTip:"Overlay Script",level:0}),a.push({id:"global",name:"Global Script",state:this.getFileState("global"),toolTip:"global",level:0}),a.push({id:e,name:"Root Composition",state:this.getFileState(e),toolTip:"Root",level:0});var i=function(e,n,s){var o=[];Object.keys(e).forEach(function(t){o.push({name:e[t],id:t})}.bind(this)),o.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:e.id>t.id?1:e.id<t.id?-1:0}),o.forEach(function(e){var o=e.id,l=e.name,r=n+" / "+l;a.push({id:o,name:l,state:this.getFileState(o),toolTip:r,level:s}),t[o]&&0!==Object.entries(t[o]).length&&i(t[o],r,s+1)}.bind(this))}.bind(this),n=t[e];i(n,"Root",1)}this.availableFiles=a},loadCompositionData:function(){var e=this;this.setState({compTreeRoot:void 0,compTreeStructure:{}}),this.props.sbRef.child("compositions").once("value",function(t){var a=t.val(),i=e.props.sbRef.key,n={};Li.getSubcompositionNamesEx(a,i,n),e.setState({compTreeRoot:i,compTreeStructure:n}),e.rebuildAvailableFiles(i,n)})},loadInitialTabState:function(){var e=this;this.setState({initialTabState:void 0}),this.props.rtdbRef.child("scriptEditorTabs").once("value",function(t){var a=t.val();a||(a={tabs:[],selected:null}),e.setState({initialTabState:a,currentFileID:a.selected})})},setLocalProperty:function(e,t,a){this.localFiles[e]||(this.localFiles[e]={script:"",lastSaveScript:"",evalStatus:"",evalStatusErrorList:[]}),this.localFiles[e][t]=a,"evalStatus"==t&&this.setState({forceRender:Math.random()})},didScriptChangeSinceLastSave:function(){var e=this,t=!1;return Object.keys(this.localFiles).forEach(function(a){e.localFiles[a].script!=e.localFiles[a].lastSaveScript&&(t=!0)}),t},updateUpdateSaveButtonChangedState:function(e){this.oldSaveButtonState!==e&&(e?this.props.onSaveButtonStateChanged("HighlightOn"):this.props.onSaveButtonStateChanged("HighlightOff"),this.oldSaveButtonState=e)},onScriptChange:function(e){this.setLocalProperty(this.state.currentFileID,"script",e),this.setState({script:e}),this.updateUpdateSaveButtonChangedState(this.didScriptChangeSinceLastSave())},onSave:function(){var e,t,a=this,i={},n={};for(var s in Object.keys(this.localFiles).forEach(function(a){this.setLocalProperty(a,"evalStatusErrorList",[]);var s=this.localFiles[a].script;this.localFiles[a].lastSaveScript!=s&&(this.setLocalProperty(a,"lastSaveScript",s),s.length?this.props.safemode?this.setLocalProperty(a,"evalStatus","ok"):this.setLocalProperty(a,"evalStatus","eval"):this.setLocalProperty(a,"evalStatus","none"),"overlay"===a?e=Ai().compress(s,{outputEncoding:"StorageBinaryString"}):i[a]=Ai().compress(s,{outputEncoding:"StorageBinaryString"})),"overlay"===a?t=Ai().compress(s,{outputEncoding:"StorageBinaryString"}):n[a]=Ai().compress(s,{outputEncoding:"StorageBinaryString"})}.bind(this)),this.updateEditor(),i)0==i[s].length&&(i[s]=null);var o={},l={};for(var r in n)0==n[r].length?delete n[r]:o[r]=!0;for(var c in this.state.compTreeStructure)o[c]||(l[c]=!0);this.localFiles.global&&""==this.localFiles.global.script&&(l.global=!0);try{this.props.onSaveButtonStateChanged("saving");var d=0,p=function(){1==d?(this.props.onSaveButtonStateChanged("done"),this.updateUpdateSaveButtonChangedState(!1)):d++}.bind(this);Vi.uploadCompositionJSON(JSON.stringify({overlayScript:t,subCompScripts:n,noScripts:l}),window.singularScene.id,"script",function(t,n){Vi.updateCompositionMetadata({id:window.singularScene.id,s3_script:1},function(t,n){t&&console.error(t),void 0!==e?(a.props.sbRef.child("script").set(e),a.props.rtdbRef.child("ts").set({".sv":"timestamp"}),a.compDSUpdate&&a.compDSUpdate({ts:Date.now()}),p()):(a.props.onCompileScript("overlay"),p()),0!==Object.keys(i).length?(a.props.sbRef.child("compositionProps").child("scripts").update(i),a.props.rtdbRef.child("ts").set({".sv":"timestamp"}),a.compDSUpdate&&a.compDSUpdate({ts:Date.now()}),p()):(a.props.onCompileScript("compScript"),p())})})}catch(e){this.props.onSaveButtonStateChanged("error")}},onEditorTabsSave:function(e){this.props.rtdbRef.child("scriptEditorTabs").set(e,function(){})},previewWindowScriptMessageReceived:function(e){if(e&&e.data&&e.data.type&&e.data.params)switch(e.data.type){case"overlay_ready":console.log("Message to Overlay SDK: ready: ",e.data.params);break;case"overlay_error":console.log("Message to Overlay SDK: error: ",e.data.params);break;case"overlay_message":console.log("Message to Overlay SDK: message: ",e.data.params);break;case"overlay_transformElement":console.log("Message to Overlay SDK: transformElement: ",e.data.params);break;case"overlay_controlVideo":console.log("Message to Overlay SDK: controlVideo: ",e.data.params);break;case"overlay_controlAudio":console.log("Message to Overlay SDK: controlAudio: ",e.data.params);break;case"CompositionScriptEditorMessage":var t=e.data.params.type,a=e.data.params.message,i=e.data.params.line,n=e.data.params.compId;switch(null==n&&(n="overlay"),this.props.onPreviewWindowMessageReceived(t,a),t){case"ok":this.setLocalProperty(n,"evalStatus","ok");break;case"eval":this.setLocalProperty(n,"evalStatus","eval"),this.setLocalProperty(n,"evalStatusErrorList",[]);break;case"error":var s=this.state.evalStatusErrorList.slice();s.push({info:a,line:i}),this.setLocalProperty(n,"evalStatus","error"),this.setLocalProperty(n,"evalStatusErrorList",s);break;default:console.log("previewWindowScriptMessageReceived unknown "+e.data.type+" params",e.data.params)}this.updateEditor();break;default:console.log("SingularOverlay: onMessage: invalid type "+e.data.type)}},updateEditor:function(e){if(e||(e=this.state.currentFileID),e){var t=this.localFiles[e];t||(t={script:"",lastSaveScript:"",evalStatus:"",evalStatusErrorList:[]},this.localFiles[e]=t),e==this.state.currentFileID&&t.script===this.state.script&&t.evalStatus===this.state.evalStatus&&Li.compareObject(t.evalStatusErrorList,this.state.evalStatusErrorList)||this.setState({currentFileID:e,script:t.script,evalStatus:t.evalStatus,evalStatusErrorList:Object.assign(t.evalStatusErrorList)})}},onCurrentFileIdChanged:function(e){if(this.props.onCurrentFileIdChanged&&this.props.onCurrentFileIdChanged(e),null!=e){var t=this.refs.aceEditorRef.editor;null==this.aceEditorSessions[e]&&(this.aceEditorSessions[e]=ace.createEditSession("","ace/mode/javascript"),this.localFiles[e]&&this.localFiles[e].script&&this.aceEditorSessions[e].setValue(this.localFiles[e].script)),e!=this.state.currentFileID&&(this.state.currentFileID&&(this.aceEditorSessions[this.state.currentFileID]=t.getSession()),t.setSession(this.aceEditorSessions[e]),this.setState({currentFileID:e}),this.updateEditor(e)),t.focus()}else this.setState({currentFileID:null,script:"",evalStatus:"",evalStatusErrorList:[]})},getFileState:function(e){var t=this.localFiles[e];return t&&t.script?t.script!=t.lastSaveScript?"changed":"ok"==t.evalStatus?t.script.length?"exists":"none":t.evalStatus:"none"},onScriptBeautify:function(){var e=this.refs.aceEditorRef.editor,t=e.getValue(),a={indent_size:this.props.editorSettings.tabSize,indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,jslint_happy:!1,end_with_newline:!0,wrap_line_length:"0",indent_inner_html:!1,comma_first:!1,e4x:!1,indent_empty_lines:!1},i=_i.js(t,a),n=e.getCursorPosition();e.session.mergeUndoDeltas=!0,e.setValue(i),e.session.mergeUndoDeltas=!0,e.clearSelection(),e.session.mergeUndoDeltas=!1,e.focus(),e.moveCursorToPosition(n),this.onScriptChange(i)},onExportScripts:function(){var e,t=this,a=new(Ti()),i=a.folder("src"),n=(null===(e=window)||void 0===e||null===(e=e.singularScene)||void 0===e?void 0:e.name)||"composition",s={exportDate:(new Date).toISOString(),compositionName:n,files:[]},o={};Object.keys(this.localFiles).forEach(function(e){var a=t.localFiles[e].script;if(a&&a.length>0){var i=t.availableFiles.find(function(t){return t.id===e}),n=i?i.name:e;o[n]=(o[n]||0)+1}}),Object.keys(this.localFiles).forEach(function(e){var a=t.localFiles[e].script;if(a&&a.length>0){var n,l=t.availableFiles.find(function(t){return t.id===e}),r=l?l.name:e,c=function(e){return"overlay"===e?"overlay":"global"===e?"global":e===t.state.compTreeRoot?"root":"subcomp"}(e);n=o[r]>1?"".concat(r,"-").concat(e,".js"):"".concat(r,".js"),i.file(n,a),s.files.push({id:e,name:r,type:c,fileName:n,subcomp:l?l.toolTip:""})}}),a.file(".project-meta.json",JSON.stringify(s,null,2)),a.generateAsync({type:"blob"}).then(function(e){(0,zt.saveAs)(e,"CompScript-".concat(n,".zip")),t.props.onNotification("Exported scripts successfully!","success",10,"tc")})},onImportScripts:function(){var e=this,t=document.createElement("input");t.type="file",t.accept=".zip",t.onchange=function(t){var a=t.target.files[0];if(a){var i=new FileReader;i.onload=function(t){Ti().loadAsync(t.target.result).then(function(t){var a=t.file(".project-meta.json");a?a.async("string").then(function(a){var i;try{i=JSON.parse(a)}catch(t){return void e.props.onNotification("Error: Invalid .project-meta.json file format.","error",10,"tc")}if(i.files&&Array.isArray(i.files)){var n=[],s=0,o=0;i.files.forEach(function(a){if(!a.id||!a.fileName)return console.warn("Skipping file with missing id or fileName:",a),void o++;if(!e.availableFiles.find(function(e){return e.id===a.id}))return console.warn("Skipping file ".concat(a.fileName,": ID ").concat(a.id," not found in composition")),void o++;var i="src/".concat(a.fileName),l=t.file(i);if(!l)return console.warn("Skipping file ".concat(a.fileName,": not found in zip archive")),void o++;n.push(l.async("string").then(function(t){e.setLocalProperty(a.id,"script",t),e.aceEditorSessions[a.id]&&e.aceEditorSessions[a.id].setValue(t),s++}).catch(function(e){console.error("Error importing ".concat(a.fileName,":"),e),o++}))}),Promise.all(n).then(function(){e.updateEditor(),e.updateUpdateSaveButtonChangedState(e.didScriptChangeSinceLastSave()),e.setState({forceRender:Math.random()});var t="Import completed!\n";t+="".concat(s," file(s) imported successfully."),o>0&&(t+="\n".concat(o," file(s) skipped.")),e.props.onNotification(t,"success",10,"tc")})}else e.props.onNotification("Error: .project-meta.json has invalid structure. Missing 'files' array.","error",10,"tc")}).catch(function(t){e.props.onNotification("Error reading .project-meta.json: "+t.message,"error",10,"tc")}):e.props.onNotification("Error: File .project-meta.json not found in the zip archive.","error",10,"tc")}).catch(function(t){e.props.onNotification("Error importing scripts: "+t.message,"error",10,"tc")})},i.readAsArrayBuffer(a)}},t.click()},onInsertText:function(e){var t=this.refs.aceEditorRef.editor,a=t.getCursorPosition();t.session.insert(a,e),t.focus(),this.onScriptChange(t.getValue())},onReplaceScript:function(e,t){if(this.availableFiles.find(function(t){return t.id===e})){var a=this.localFiles[e];if(a&&a.script===t||this.setLocalProperty(e,"script",t),e==this.state.currentFileID){var i=this.refs.aceEditorRef.editor;i.setValue(t),i.clearSelection(),i.focus(),this.onScriptChange(t)}else this.refs.CodeEditorTabs.addTab(e),this.onCurrentFileIdChanged(e);this.updateUpdateSaveButtonChangedState(this.didScriptChangeSinceLastSave()),this.setState({forceRender:Math.random()})}},render:function(){var e=this,t="monokai";0==this.props.editorSettings.darkTheme&&(t="xcode");var a="active";this.props.disabled&&(a="disabled");var i=this.state.script,n=this.props.disabled;this.state.currentFileID||(i="",n=!0);var s,l,r,c,d=0,p=0,m=0;Object.keys(this.localFiles).forEach(function(t){var a=e.localFiles[t].script;a&&0!==a.length&&(d++,p+=a.length,m+=(a.match(/\n/g)||"").length+1)}),d||p||m?(l=1==d?" 1 file     ":Li.numberWithCommas(d)+" files     ",r=1==m?" 1 line     ":Li.numberWithCommas(m)+" lines     ",c=1==p?" 1 byte":Li.numberWithCommas(p)+" bytes",s=o().createElement("span",{style:{float:"right",whiteSpace:"pre"}},l+r+c)):s=o().createElement("span",{style:{float:"right",whiteSpace:"pre"}},"0 files 0 lines 0 bytes");var u,h=[];try{Ri.qg(i,{ecmaVersion:"latest",sourceType:"script",locations:!0})}catch(e){h.push({row:e.loc.line-1,column:e.loc.column,text:e.message,type:"error"}),u="Syntax Error: "+e.message+" at line "+e.loc.line+" col "+e.loc.column}switch(this.state.evalStatus){case"ok":u||(u="OK");break;case"eval":u="Compiling ...";break;case"error":if(this.state.evalStatusErrorList.length){var f=this.state.evalStatusErrorList[0],g=f.line,v="";g&&g.line&&(h.push({row:g.line-1,column:g.col-1,text:f.info,type:"error"}),v=" - line "+g.line+" col "+g.col),u="Error: "+f.info+" "+v}else u="Error: unknown"}return this.rebuildAvailableFiles(this.state.compTreeRoot,this.state.compTreeStructure),this.refs.aceEditorRef&&this.refs.aceEditorRef.editor.setOptions({showLineNumbers:this.props.editorSettings.lineNumbers,mode:"ace/mode/javascript",tabSize:Number(this.props.editorSettings.tabSize),useSoftTabs:!this.props.editorSettings.indentWithTabs,wrap:this.props.editorSettings.wrapLines,fontSize:this.props.editorSettings.fontSize,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showPrintMargin:!1,showGutter:!0,showInvisibles:this.props.editorSettings.renderWhitespace,useWorker:!1,fixedWidthGutter:!0}),o().createElement("div",{className:"script-editor-wrapper"},o().createElement(Oi,{files:this.availableFiles,onCurrentFileIdChanged:this.onCurrentFileIdChanged,onEditorTabsSave:this.onEditorTabsSave,currentFileID:this.state.currentFileID,initialState:this.state.initialTabState,forceRender:this.props.forceRender,ref:"CodeEditorTabs"}),o().createElement("div",{className:"script-editor-ace"},o().createElement(oa.Ay,{id:"jsonEditor-"+this.props.id,onChange:this.onScriptChange,mode:"ace/mode/javascript",name:"jsonEditor-"+this.props.id,width:"100%",height:"100%",readOnly:n,theme:t,value:String(i),editorProps:{$blockScrolling:1/0},showPrintMargin:!1,commands:[{name:"Save",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(){e.onSave()}}],className:a,annotations:h,ref:"aceEditorRef"})),o().createElement("div",{className:"script-editor-footer"},o().createElement("div",null,u,s)))}});var Bi=a(9769);const Ui=o().createClass({displayName:"ScriptEditor",getInitialState:function(){return{savingState:"done",saveButtonHighlightState:"HighlightOff",showAskReloadDialog:!1,currentFileId:void 0,editorSettings:{darkTheme:!0,lineNumbers:!0,wrapLines:!1,tabSize:2,indentWithTabs:!0,fontSize:"12px",renderWhitespace:!1,keyboardHandler:"emacs"}}},componentWillMount:function(){var e;try{e=localStorage.getItem("ScriptEditorSettings")}catch(e){}if(e){var t;try{t=JSON.parse(e)}catch(e){}if(t){var a=Object.assign(this.state.editorSettings);void 0!==t.darkTheme&&(a.darkTheme=t.darkTheme),void 0!==t.lineNumbers&&(a.lineNumbers=t.lineNumbers),void 0!==t.wrapLines&&(a.wrapLines=t.wrapLines),void 0!==t.tabSize&&(a.tabSize=t.tabSize),void 0!==t.indentWithTabs&&(a.indentWithTabs=t.indentWithTabs),void 0!==t.fontSize&&(a.fontSize=t.fontSize),void 0!==t.renderWhitespace&&(a.renderWhitespace=t.renderWhitespace),void 0!==t.keyboardHandler&&(a.keyboardHandler=t.keyboardHandler),this.setState({editorSettings:a})}}},componentDidMount:function(){},componentWillUnmount:function(){},componentDidUpdate:function(){},shouldComponentUpdate:function(e,t){return!Bi.compareObject(e,this.props)||!Bi.compareObject(t,this.state)},getAllScripts:function(){return this.refs.CodeEditor?this.refs.CodeEditor.getAllScripts():null},getActiveFileID:function(){return this.refs.CodeEditor?this.refs.CodeEditor.getActiveFileID():null},getEvalStatus:function(){return this.refs.CodeEditor?this.refs.CodeEditor.getEvalStatus():null},onReloadComposition:function(){this.refs.CodeEditor&&this.refs.CodeEditor.didScriptChangeSinceLastSave()?this.setState({showAskReloadDialog:!0}):this.onReloadCompositionExecute()},onReloadCompositionExecute:function(){this.props.onReloadComposition&&this.props.onReloadComposition(),this.refs.CodeEditor&&this.refs.CodeEditor.onLoadComposition()},onOpenScriptEditorSettings:function(){this.refs.ScriptEditorSettings&&this.refs.ScriptEditorSettings.open()},onScriptEditorSettings:function(e){this.setState({editorSettings:e},this.saveLocalStorage)},saveLocalStorage:function(){try{localStorage.setItem("ScriptEditorSettings",JSON.stringify(this.state.editorSettings))}catch(e){}},onSave:function(){this.refs.CodeEditor&&this.refs.CodeEditor.onSave()},onInsertText:function(e){this.refs.CodeEditor&&this.refs.CodeEditor.onInsertText(e)},onReplaceScript:function(e,t){this.refs.CodeEditor&&this.refs.CodeEditor.onReplaceScript(e,t)},onSaveButtonStateChanged:function(e){"HighlightOn"==e||"HighlightOff"==e?this.setState({saveButtonHighlightState:e}):this.setState({savingState:e})},onCurrentFileIdChanged:function(e){this.setState({currentFileId:e})},render:function(){var e,t,a=this,i="Ctrl";switch(navigator.userAgent.includes("Mac")&&(i="CMD"),e=this.props.loadingBusy?o().createElement("button",{className:"btn btn-default",tabIndex:"-1"},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{height:"28px"}})):o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"reload-comp"},"Reload Composition")},o().createElement("button",{className:"btn btn-default",onClick:this.onReloadComposition,tabIndex:"-1"},o().createElement("i",{className:"fa fa-refresh"}))),this.state.savingState){case"saving":t=o().createElement("button",{className:"btn btn-default",tabIndex:"-1"},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{height:"28px"}}));break;case"done":var n="btn ";"HighlightOn"==this.state.saveButtonHighlightState?n+="btn-primary":n+="btn-default",t=o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"save"},o().createElement("span",null,"Save all scripts"," ",o().createElement("span",{className:"tooltip-shortcut"},"(",i," + s)")))},o().createElement("button",{className:n,onClick:this.onSave,tabIndex:"-1"},o().createElement("i",{className:"fa fa-save saving-icon"})));break;case"error":t=o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"saving-error"},"There was an error while saving script")},o().createElement("button",{className:"btn btn-default",tabIndex:"-1"},o().createElement("i",{className:"fa fa-save saving-icon error"})))}return o().createElement("div",{className:"script-editor"},o().createElement("div",{className:"script-editor-toolbar",style:{width:"100%",height:"30px",display:"flex",alignContent:"center",paddingTop:"2px"}},o().createElement("div",{style:{display:"flex",justifyContent:"flex-begin",width:"50%",marginLeft:"2px"}},o().createElement("div",null,t),o().createElement("div",null,e)),o().createElement("div",{style:{display:"flex",justifyContent:"flex-end",width:"50%"}},o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"export"},"Export all scripts as ZIP")},o().createElement("button",{className:"btn btn-default",onClick:function(){a.refs.CodeEditor&&a.refs.CodeEditor.onExportScripts()},tabIndex:"-1"},o().createElement("i",{className:"fa fa-download","aria-hidden":"true"}))),o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"import"},"Import scripts from ZIP")},o().createElement("button",{className:"btn btn-default",onClick:function(){a.refs.CodeEditor&&a.refs.CodeEditor.onImportScripts()},tabIndex:"-1"},o().createElement("i",{className:"fa fa-upload","aria-hidden":"true"}))),o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"beautify"},"Beautify JavaScript")},o().createElement("button",{className:"btn btn-default",onClick:function(){a.refs.CodeEditor&&a.refs.CodeEditor.onScriptBeautify()},tabIndex:"-1"},o().createElement("i",{className:"fa fa-magic"}))),o().createElement("div",{style:{width:"50px"}}),o().createElement(Ni,{onInsertText:this.onInsertText,currentFileId:this.state.currentFileId}),o().createElement(Y(),{placement:"bottom",overlay:o().createElement(z(),{id:"settings"},"Editor Setting")},o().createElement("button",{className:"btn btn-default",onClick:this.onOpenScriptEditorSettings,tabIndex:"-1"},o().createElement("i",{className:"fa fa-cog"}))))),o().createElement(Fi,{id:this.props.id,rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,disabled:this.props.disabled,editorSettings:this.state.editorSettings,onPreviewWindowMessageReceived:this.props.onPreviewWindowMessageReceived,onSaveButtonStateChanged:this.onSaveButtonStateChanged,onCurrentFileIdChanged:this.onCurrentFileIdChanged,onCompileScript:this.props.onCompileScript,onNotification:this.props.onNotification,forceRender:this.props.forceRender,safemode:this.props.safemode,ref:"CodeEditor"}),o().createElement(ki,{editorSettings:this.state.editorSettings,onScriptEditorSettings:this.onScriptEditorSettings,onGet:!0,ref:"ScriptEditorSettings"}),o().createElement(xi(),{show:1==this.state.showAskReloadDialog,text:"Some changes in the script editors were not saved. If you reload the composition these changes will be lost. Do you want to reload the composition?",confirmButtonText:"Reload",showCancelButton:!0,onConfirm:function(e){a.setState({showAskReloadDialog:!1}),e.value&&a.onReloadCompositionExecute()}}))}});var Wi=a(45659),ji=a(9769);const Yi=o().createClass({displayName:"CompositionControl",mixins:[W.A],getInitialState:function(){return{paneFillInForm:400,selectedSubCompID:null}},componentWillMount:function(){var e;this.sBindAsObject(this.props.sbRef.child("compositions"),"compositions"),this.rtdbRef=this.props.rtdbRef.child("compositions").child(this.props.rtdbRef.key),this.sbRef=this.props.sbRef.child("compositions").child(this.props.sbRef.key),this.sbAllCompsRef=this.props.sbRef.child("compositions"),this.sbRootCompRef=this.sbRef,this.setState({selectedSubCompID:this.sbRef.key});try{e=localStorage.getItem("CompositionScriptEditorControl")}catch(e){}if(e){var t;try{t=JSON.parse(e)}catch(e){}if(t){var a={};void 0!==t.paneFillInForm&&(a.paneFillInForm=t.paneFillInForm),this.setState(a)}}},shouldComponentUpdate:function(e,t){return!ji.compareObject(this.props,e)||!ji.compareObject(this.state,t)},componentDidMount:function(){$(this.refs.singularForm).tab("show")},componentWillUnmount:function(){},componentDidUpdate:function(){},componentWillReceiveProps:function(e){},saveLocalStorage:function(){var e={paneFillInForm:this.state.paneFillInForm};try{localStorage.setItem("CompositionScriptEditorControl",JSON.stringify(e))}catch(e){}},splitPaneChange:function(e,t){var a={};a[e]=t,this.setState(a,this.saveLocalStorage()),this.forceRedraw()},onNavigateComposition:function(e){e&&e.id&&this.setState({selectedSubCompID:e.id})},forceRedraw:function(){this.forceUpdateModel(),this.forceUpdatePayload()},compositionNavControlAll:function(e,t){var a=this.props.sbRef.child("compositions").val(),i=(this.props.sbRef.child("compositionStates").val(),Object.keys(a));i=i.filter(function(e){return!!a[e].settings&&!a[e].settings.linkTimeline});var n={};n.id=Math.random(),n.commands=[];for(var s=0;s<i.length;s++){var o=i[s],l={};l.name=t?"jump2":"play2",l.target=o,l.to=e,n.commands.push(l),"In"==e?this.props.sbRef.child("compositionStates").child(o).set("In"):this.props.sbRef.child("compositionStates").child(o).set("Out1")}this.props.sbRef.child("command").set(n)},compositionNavControl:function(e,t,a,i){var n=this;if("__ALL__"!=e){var s={};s.id=Math.random();var o={};o.name=i?"jump2":"play2",o.target=e,o.to=t,e=o.target;for(var l=this.props.sbRef.child("compositions").val(),r=this.props.sbRef.child("compositionStates").val();l&&l[e]&&l[e].settings&&l[e].settings.linkTimeline;)e=l[e].settings.parentTimeline;o.target=e,s.commands=[],s.commands.push(o);var c,d,p,m=this.props.sbRef.child("compositionProps").child("timeline2Active").val(),u=this.props.sbRef.child("compositionProps").child("logicLayers").val(),h=this.props.sbRef.child("compositionProps").child("durations").val(),f=[],g=Wi.computeLogicLayerCompositionStates(e,e,t,u,m,f);f.forEach(function(e){"In"==r[e]&&(d=e)}),h&&h[d]&&(c=m[d]?h[d].Out:h[d].In),u&&u[e]&&(p=u[e].delay),d||(p="none");var v=0,b=0;if("auto"==p)b=parseFloat(c),isNaN(b)&&(b=0);else if("custom"==p){var y=parseFloat(u[e].time);isNaN(y)&&(y=0),y<0?v=-y:b=y}o.delay=b,g.forEach(function(e){s.commands.unshift({name:o.name,target:e.timeline,to:e.state,delay:v}),n.props.sbRef.child("compositionStates").child(e.timeline).set(e.state)}),a||this.props.sbRef.child("command").set(s),"In"==t?this.props.sbRef.child("compositionStates").child(e).set("In"):m[e]?this.props.sbRef.child("compositionStates").child(e).set("Out2"):this.props.sbRef.child("compositionStates").child(e).set("Out1")}else this.compositionNavControlAll(t)},onFormChanged:function(e,t,a){this.props.sbRef.child("compositions").child(this.state.selectedSubCompID).child("dataSources/composition/controlNode/payload").child(e).set(t),this.props.onSetPayload(this.state.selectedSubCompID,e,t)},onLocalButtonClicked:function(e){this.props.onSetPayload(this.state.selectedSubCompID,e,{__singularButton:!0,ts:(new Date).valueOf()})},forceUpdateModel:function(){this.refs.JsonViewerModel&&this.refs.JsonViewerModel.forceRedraw&&this.refs.JsonViewerModel.forceRedraw()},forceUpdatePayload:function(){this.refs.JsonViewerPayload&&this.refs.JsonViewerPayload.forceRedraw&&this.refs.JsonViewerPayload.forceRedraw()},render:function(){var e,t,a=this.state.compositions[this.state.selectedSubCompID];a.dataSources&&a.dataSources.composition&&a.dataSources.composition.controlNode&&(e=a.dataSources.composition.controlNode.model,t=a.dataSources.composition.controlNode.payload);var i=ji.getSubcompositionNames(this.state.compositions)[this.state.selectedSubCompID];null==i&&(i="Root");var n,s={width:"100%",height:"100%"};return this.props.showBusy&&(s.visibility="hidden",n=o().createElement("div",{style:{width:"100%",height:"100%",color:"#b0b0b0"}},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{left:"45%",top:"45%",width:"10%",height:"10%",position:"absolute"}}))),o().createElement("div",{style:{width:"100%",height:"100%"}},n,o().createElement("div",{style:s},o().createElement(Ja.A,{split:"vertical",minSize:300,maxSize:700,style:{position:"relative"},defaultSize:this.state.paneFillInForm,onChange:this.splitPaneChange.bind(this,"paneFillInForm")},o().createElement("div",{className:"comp-nav-window script-editor",style:{width:"100%",height:"100%",zIndex:"auto"}},o().createElement(Qa,{rootCompName:window.singularScene.name,sbAllCompsRef:this.sbAllCompsRef,sbRootCompRef:this.sbRootCompRef,sbCompStatesRef:this.props.sbRef.child("compositionStates"),sbLogicLayersRef:this.props.sbRef.child("compositionProps").child("logicLayers"),onNavigateComposition:this.onNavigateComposition,onEditCompStandalone:void 0,compositionNavControl:this.compositionNavControl,selectLogicLayer:void 0,activeCompId:this.state.selectedSubCompID,mode:"scriptEditor"})),o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item active"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#singularForm",ref:"singularForm"},"Fill-in Form")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#devInfo",ref:"devInfo"},"Sub-comp Info")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#model",ref:"model",onClick:this.forceUpdateModel},"Model")),o().createElement("li",{className:"nav-item"},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#payload",ref:"payload",onClick:this.forceUpdatePayload},"Payload"))),o().createElement("div",{className:"tab-content rightpanel-tab-content"},o().createElement("div",{role:"tabpanel",className:"tab-pane active",id:"singularForm",style:{overflowY:"auto",marginLeft:"10px"}},o().createElement(Ut.A,{model:e,fields:t,enableDataLink:!1,disabled:!1,onChanged:this.onFormChanged,onLocalButtonClicked:this.onLocalButtonClicked})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"devInfo"},o().createElement(sa,{subCompID:this.state.selectedSubCompID,subCompName:i,model:e,payload:t})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"model"},o().createElement(ra,{name:"model",json:e,fontSize:this.props.fontSize,ref:"JsonViewerModel"})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"payload"},o().createElement(ra,{name:"payload",json:t,fontSize:this.props.fontSize,ref:"JsonViewerPayload"}))))))))}});var Hi=a(9769);const zi=o().createClass({displayName:"OverlaySimulator",getInitialState:function(){return this.hostName=this.getHostName(),this.videoPlayingInterval=null,{videoPlaying:!1,videoMute:!1,videoTime:0,videoVolume:100,simMessage:"{}",simMetadata:"{}"}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!Hi.compareObject(this.props,e)||!Hi.compareObject(this.state,t)},componentDidMount:function(){},componentWillUnmount:function(){},componentDidUpdate:function(){},componentWillReceiveProps:function(e){},onVideoPlayToggle:function(){var e=this;this.videoPlayingInterval&&(clearInterval(this.videoPlayingInterval),this.videoPlayingInterval=null);var t=!this.state.videoPlaying;t?(this.onSimulate("videoPlay"),this.onSimulate("videoTime","time",Number(this.state.videoTime)),this.videoPlayingInterval=setInterval(function(){var t=Number(e.state.videoTime)+.25;e.setState({videoTime:t}),e.onSimulate("videoTime","time",t)},250)):this.onSimulate("videoStopped"),this.setState({videoPlaying:t})},onVideoVolumeToggle:function(){this.state.videoMute?this.onSimulate("videoUnmuted"):this.onSimulate("videoMuted"),this.setState({videoMute:!this.state.videoMute})},onVideoTimeChanged:function(e,t){this.onSimulate("videoSeeking","time",t),this.setState({videoTime:t})},onVideoVolumeChanged:function(e,t){this.onSimulate("videoVolume","value",t/100),this.setState({videoVolume:t})},onSimValueChanged:function(e,t){var a={};a[e]=t,this.setState(a)},onSimulate:function(e,t,a){var i={type:"_overlay_send_"+e};void 0!==t&&void 0!==a&&(i.params={},i.params[t]=a),this.props.scriptPreviewEditor&&this.props.scriptPreviewEditor.postMessage(i,this.hostName)},getHostName:function(){var e=window.location.href;if(-1!==e.indexOf("file://"))return"file://";-1===e.indexOf("http")&&(e=location.href);try{return e.match(new RegExp("^(http(?:s)?://[^/]+)","im"))[1].toString().toLowerCase()}catch(e){}return"https://app.singular.live"},render:function(){var e,t;return e=this.state.videoPlaying?o().createElement("i",{className:"fa fa-play",style:{width:"20px"}}):o().createElement("i",{className:"fa fa-pause",style:{width:"20px"}}),t=this.state.videoMute?o().createElement("i",{className:"fa fa-volume-off",style:{width:"20px"}}):o().createElement("i",{className:"fa fa-volume-up",style:{width:"20px"}}),o().createElement("div",{style:{width:"100%",height:"100%",overflow:"auto"}},o().createElement("table",{className:"sub-comp-id"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"table-field-label"},"Video Time"),o().createElement("td",null,o().createElement("div",{style:{display:"flex"}},o().createElement("button",{className:"btn btn-default",onClick:this.onVideoPlayToggle,tabIndex:"-1",style:{padding:"5px"}},e),o().createElement(te.A,{name:"time",step:"0.1",format:"0.0",min:"0",value:this.state.videoTime,unit:"sec",onValueChanged:this.onVideoTimeChanged,disabled:this.state.videoPlaying})))),o().createElement("tr",null,o().createElement("td",{className:"table-field-label"},"Volume"),o().createElement("td",null,o().createElement("div",{style:{display:"flex"}},o().createElement("button",{className:"btn btn-default",onClick:this.onVideoVolumeToggle,tabIndex:"-1",style:{padding:"5px"}},t),o().createElement(te.A,{name:"volume",step:"0.1",format:"0.0",min:"0",max:"100",value:this.state.videoVolume,unit:"%",onValueChanged:this.onVideoVolumeChanged})))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Advertisement")),o().createElement("td",null,o().createElement("div",{style:{display:"flex"}},o().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.onSimulate.bind(this,"videoAdStart",void 0)},"Start"),o().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.onSimulate.bind(this,"videoAdFinished",void 0)},"Finished"),o().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.onSimulate.bind(this,"videoAdSkip",void 0)},"Skip")))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"videoMetadata")),o().createElement("td",null,o().createElement("div",{style:{width:"400px",display:"flex"}},o().createElement("div",{style:{width:"100%"}},o().createElement(ea.A,{name:"simMetadata",id:"JSON-Metadata",width:"100%",height:"100px",value:this.state.simMetadata,onValueChanged:this.onSimValueChanged})),o().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.onSimulate.bind(this,"videoMetadata","metadata",this.state.simMetadata),style:{margin:"1px 0px",borderLeft:"0px",marginLeft:"-2px",padding:"5px 10px"}},"Send")))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"message")),o().createElement("td",null,o().createElement("div",{style:{width:"400px",display:"flex"}},o().createElement("div",{style:{width:"100%"}},o().createElement(ea.A,{name:"simMessage",id:"JSON-Message",width:"100%",height:"100px",value:this.state.simMessage,onValueChanged:this.onSimValueChanged})),o().createElement("button",{className:"btn btn-default",tabIndex:"-1",onClick:this.onSimulate.bind(this,"message","message",this.state.simMessage),style:{margin:"1px 0px",borderLeft:"0px",marginLeft:"-2px",padding:"5px 10px"}},"Send")))))))}});var Gi=a(40927),Ki=a(9769);const $i=Gi.createClass({displayName:"WidgetExplorer",getInitialState:function(){return{selectedWidget:void 0}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!Ki.compareObject(this.props,e)||!Ki.compareObject(this.state,t)},componentDidMount:function(){},componentWillUnmount:function(){},componentDidUpdate:function(){},componentWillReceiveProps:function(e){},selectWidget:function(e){this.setState({selectedWidget:e})},render:function(){var e,t=[];h.A.widgets.forEach(function(e){t.push({thumbnail:e.thumbnail,name:e.name,id:e.id,version:e.version,status:e.status,model:e.model})}),t.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:e.version<t.version?-1:e.version>t.version?1:0}),void 0!==this.state.selectedWidget&&(e=t[this.state.selectedWidget]),null==e&&(e=t[0]);var a=[];void 0!==e&&(a=e.model.fields),a.sort(function(e,t){return e.id<t.id?-1:e.id>t.id?1:0});var i={overflow:"hidden",textOverflow:"ellipsis",display:"block",whiteSpace:"nowrap",width:"100%"},n=function(t,a){var n="";return e&&e.id==t.id&&e.version==t.version&&(n="selected"),Gi.createElement("tr",{key:a,className:n,onClick:this.selectWidget.bind(this,a)},Gi.createElement("td",{style:{paddingTop:"0px",lineHeight:"1",verticalAlign:"middle",paddingBottom:"0px"}},Gi.createElement("img",{src:t.thumbnail,style:{width:"32px",height:"32px"}})),Gi.createElement("td",{style:{verticalAlign:"middle"}},Gi.createElement("div",{style:i},t.name)),Gi.createElement("td",{style:{verticalAlign:"middle",textAlign:"center"}},Gi.createElement("div",null,t.id)),Gi.createElement("td",{style:{verticalAlign:"middle",textAlign:"center"}},Gi.createElement("div",null,t.version)),Gi.createElement("td",{style:{verticalAlign:"middle",textAlign:"center"}},Gi.createElement("div",{style:i},t.status)))}.bind(this),s=function(e,t){return Gi.createElement("tr",{key:t},Gi.createElement("td",{style:{verticalAlign:"middle"}},Gi.createElement("div",{style:i},e.id)),Gi.createElement("td",{style:{verticalAlign:"middle"}},Gi.createElement("div",{style:i},e.title)),Gi.createElement("td",{style:{verticalAlign:"middle"}},Gi.createElement("div",null,e.type)))}.bind(this);return Gi.createElement("div",{className:"widget-explorer"},Gi.createElement("div",{style:{width:"400px",height:"100%",float:"left"}},Gi.createElement("div",{style:{height:"25px",textAlign:"left",paddingTop:"5px",paddingLeft:"7px",fontSize:"14px"}},"Widgets in composition"),Gi.createElement("div",{style:{width:"100%",height:"calc(100% - 25px)",overflowX:"hidden",overflowY:"scroll"}},Gi.createElement("table",{className:"table dark-header selectable"},Gi.createElement("thead",null,Gi.createElement("tr",{style:{height:"26px"}},Gi.createElement("th",{style:{width:"10%"}}),Gi.createElement("th",{style:{width:"50%",textAlign:"left",verticalAlign:"middle"}},"Name"),Gi.createElement("th",{style:{width:"10%",textAlign:"center",verticalAlign:"middle"}},"ID"),Gi.createElement("th",{style:{width:"10%",textAlign:"center",verticalAlign:"middle"}},"Version"),Gi.createElement("th",{style:{width:"20%",textAlign:"center",verticalAlign:"middle"}},"Status"))),Gi.createElement("tbody",null,t.map(n))))),Gi.createElement("div",{style:{width:"calc(100% - 400px)",height:"100%",float:"left"}},Gi.createElement("div",{style:{height:"25px",textAlign:"left",paddingTop:"5px",paddingLeft:"7px",fontSize:"14px"}},"Fields of the selected widget"),Gi.createElement("div",{style:{width:"100%",height:"calc(100% - 25px)",overflowX:"hidden",overflowY:"scroll"}},Gi.createElement("table",{className:"table table-striped dark-header"},Gi.createElement("thead",null,Gi.createElement("tr",{style:{height:"26px"}},Gi.createElement("th",{style:{width:"35%",textAlign:"left",verticalAlign:"middle"}},"ID"),Gi.createElement("th",{style:{width:"35%",textAlign:"left",verticalAlign:"middle"}},"Name"),Gi.createElement("th",{style:{width:"30%",textAlign:"left",verticalAlign:"middle"}},"Type"))),Gi.createElement("tbody",null,a.map(s))))))}});var qi=a(9769);const Ji=o().createClass({displayName:"ControlPanel",getInitialState:function(){return{}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!qi.compareObject(this.props,e)||!qi.compareObject(this.state,t)},componentDidMount:function(){$(this.refs.compositionControl).tab("show")},componentWillUnmount:function(){},componentDidUpdate:function(){},componentWillReceiveProps:function(e){},forceRedraw:function(){this.refs.compositionControlRef&&this.refs.compositionControlRef.forceRedraw()},compositionNavControl:function(e,t,a,i){this.refs.compositionControlRef&&this.refs.compositionControlRef.compositionNavControl(e,t,a,i)},render:function(){var e=!1;return this.props.hideGlobals&&(e=!0),o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement("div",{className:"tab-area"},o().createElement("ul",{className:"nav nav-tabs",role:"tablist"},o().createElement("li",{className:"nav-item active",style:{minWidth:"100px",maxWidth:"200px"}},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#compositionControl",ref:"compositionControl"},"Composition Control")),!e&&o().createElement("li",{className:"nav-item",style:{minWidth:"100px",maxWidth:"200px"}},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#adaptation",ref:"adaptation"},"Globals")),o().createElement("li",{className:"nav-item",style:{minWidth:"100px",maxWidth:"200px"}},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#widgetExplorer",ref:"widgetExplorer"},"Widget Explorer")),o().createElement("li",{className:"nav-item",style:{minWidth:"100px",maxWidth:"200px"}},o().createElement("a",{"data-toggle":"tab",tabIndex:"-1",href:"#overlaySimulator",ref:"overlaySimulator"},"Overlay SDK Simulator"))),o().createElement("div",{className:"tab-content rightpanel-tab-content CompositionControlArea"},o().createElement("div",{role:"tabpanel",className:"tab-pane active",id:"compositionControl"},o().createElement(Yi,{forceReload:this.props.forceReload,rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,onSetPayload:this.props.onSetPayload,showBusy:this.props.showBusy,ref:"compositionControlRef"})),!e&&o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"adaptation",style:{padding:"5px"}},o().createElement(_a.A,{rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,onAdaptationGlobalsChanged:this.props.onAdaptationGlobalsChanged,adaptationGlobals:this.props.adaptationGlobals,ref:"adaptation"})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"widgetExplorer",style:{padding:"5px"}},o().createElement($i,{forceReload:this.props.forceReload,ref:"widgetExplorerRef"})),o().createElement("div",{role:"tabpanel",className:"tab-pane",id:"overlaySimulator",style:{padding:"5px"}},o().createElement(zi,{scriptPreviewEditor:this.props.scriptPreviewEditor,ref:"overlaySimulatorRef"})))))}});var Xi=a(37507),Zi=a(73557),Qi=a(19878);function en(e){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},en(e)}function tn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function an(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(a),!0).forEach(function(t){nn(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tn(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function nn(e,t,a){return(t=function(e){var t=function(e){if("object"!=en(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=en(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==en(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a(80794);var sn=a(9769),on=[{title:"Explain",id:"explain",class:"fa fa-comment",description:"Summarizes what the code does and why it is written that way.",refinePromptPlaceholder:"Enter specific questions or areas you want explained. (Not required)",refinePromptLabel:"Refine Prompt"},{title:"Review",id:"review",class:"fa fa-search",description:"Analyzes the code for bugs and risky patterns.",refinePromptPlaceholder:"Specify concerns or areas to focus the review on. (Not required)",refinePromptLabel:"Refine Prompt"},{title:"Fix",id:"fix",class:"fa fa-wrench",description:"Attempts to correct detected issues and returns a full version of the code.",refinePromptPlaceholder:"Describe the issue or bug to fix. (Not required)",refinePromptLabel:"Refine Prompt"},{title:"Extend",id:"extend",class:"fa fa-plus",description:"Adds features or enhancements while keeping the existing behavior intact.",refinePromptPlaceholder:"Describe the feature or enhancement you want to add. (Required)",refinePromptLabel:"Describe Feature"},{title:"Refactor",id:"refactor",class:"fa fa-cogs",description:"Restructures the code to improve readability, maintainability, and consistency.",refinePromptPlaceholder:"Optionally, specify refactoring goals or style preferences. (Not required)",refinePromptLabel:"Refine Prompt"},{title:"Document",id:"document",class:"fa fa-book",description:"Generates inline comments for the highlighted code.",refinePromptPlaceholder:"Optionally, specify documentation style or focus areas. (Not required)",refinePromptLabel:"Refine Prompt"},{title:"Ask Docs",id:"askdocs",class:"fa fa-question",description:"Answers questions about the official documentation or API usage related to the code.",refinePromptPlaceholder:"Enter your documentation or API usage question here. (Required)",refinePromptLabel:"Ask a Question"}],ln=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=h.A.getWidgetForScriptBuddy(),n=t.props.onGetAllScripts(),s=t.props.onGetActiveFileID(),o=t.props.onGetEvalStatus(),l=t.props.sbRef.val(),r=(0,Xi.extractCompositionStructure)(l,t.props.sbRef.toString()),c=(0,Xi.extractModelsDataLinksNodeRefs)(l),d=(t.state.customInstructions[e]||"").trim(),p="";for(var m in n){var u=n[m].script;u&&0!==u.trim().length&&(p+='\nFile name "'.concat((0,Xi.getScriptName)(m,r),'"\n```JavaScript\n').concat(u,"\n```\n"))}var f=p+="\n";"active"===t.state.scriptScope&&s&&n[s]&&(f='\nFile name "'.concat((0,Xi.getScriptName)(s,r),'":\n```JavaScript\n').concat(n[s].script,"\n```\n"));var g="\n<composition_structure>\n\n".concat(JSON.stringify(r),"\n</composition_structure>\n\n<Models_DataLinks_NodeRefs_in_composition>\n\n").concat(JSON.stringify(c),"\n</Models_DataLinks_NodeRefs_in_composition>\n\n<Widgets_available_in_the_composition>\n\n").concat(i,"\n</Widgets_available_in_the_composition>\n"),v="";v="<context>\n\n<composition_context>\n".concat(g,"</composition_context>\n\n<singular_script_document>\n<scripting>").concat(t.singularScriptingDocument,"</scripting>\n\n").concat((0,Xi.getModelsDataLinksNodeRefsPrompt)(),"\n").concat((0,Xi.getWidgetsPrompt)(),"\n</singular_script_document>\n</context>\n"),"askdocs"!==e&&(v+="<user_codebase>\n".concat(f,"\n</user_codebase>\n\n  ")),a||(v+="<tools_instructions>\nFunction: getDatastreamPayload\nDescription: Call this function with a valid token to interpret the datastream payload. \nUse it when writing code to access the datastream payload, or when verifying that the users codebase accesses the payload correctly  but only if the users codebase contains datastream-related code.\nAlways explain the payload to the user using a code block for clarity.\n</tools_instructions>\n"),v+='<response_guidelines>\n- Follow this guidelines strictly unless instructed otherwise.\n- Respond strictly in Markdown format. \n- When explaining concepts, avoid mentioning internal data structure names (e.g., `Models_DataLinks_NodeRefs_in_composition`). Use clear, plain language descriptions, such as the linked control nodes or the relevant data entries.\n- Only generate code snippets when instructed to do so.\n- For code snippets, begin with a header in the format `Script name: <File name>`, using an appropriate heading level. This must be followed by a code block containing the script.\n  * The first line inside each code block must be a comment: `// script id: <compId>`, where compId matches the script from the composition structure:\n      ** If the script is a "Global Script," set compId as `global`.\n      ** If it is an "Overlay Script," set compId as `overlay`.\n      ** If no matching File name exists in the composition structure, use `// script id: unknown`.\n      ** If multiple entries share the same File name, use the compId from the first matching entry.\n- If no File name is provided or no files/scripts are present in the user input, clearly state in Markdown: `No scripts found.`\n- Avoid using bold markdown (**) in nested lists in the output.\n  </response_guidelines>\n';var b="\nYou are an expert programming assistant. The user is working on the Singular composition script. \nThe user's script is provided. Use the singular_script_document as your main source of truth when assisting with the users script.\nBefore assisting with the codebase, you must first learn how composition structure, models, dataLinks, and nodeRefs relate.\nYou should analyze their definitions, dependencies, and data flow to build an internal understanding of their relationships.\nEnsure that all user scripts and reasoning align with the established composition context and reflect an accurate understanding of these relationships.\nYou will follow the given `Instructions` strictly.\n";return"explain"===e?v+="".concat(b,"\nInstructions:\nExplain what the provided code does. \nFor each file:\n - Identify the key entry points and highlight the core logic. \n - Provide a high-level overview of how data moves through the system.\n - Suggest the best starting points for exploration. \nIf there are multiple files\n - Explain each file separately.\n - Summarize how the files interact with each other.\n - Suggest the best starting points for exploring the entire codebase.\nDo not display or repeat the original code in your response. Do not add a comment: `// script id: <compId>`\nUse ### for File name headings.\nUse bold text (**) for section headings within each file explanation.\n---\n"):"review"===e?v+="".concat(b,"\nInstructions:\nAnalyze the provided code for bugs, security vulnerabilities, performance issues, and risky patterns. If there are multiple files, analyze each file separately and also consider their interactions.\nDo not display or repeat the original code in your response. Generate full code snippets only when suggesting fixes.\nUse ### for File name headings.\nUse bold text (**) for section headings within each file explanation.\n---\n"):"fix"===e?v+="".concat(b,"\nInstructions:\nThe issue is \n<issue>").concat(JSON.stringify(o),"</issue>\n\nBriefly summarize the issue and then attempt to correct the detected issues.\nGenerate full code snippets to fix the issues, providing a full version of each affected file.\n---\n"):"extend"===e?v+="".concat(b,"\nInstructions:\nImplement the provided custom instructions. Maintain the existing behavior of the code. Make least disruptive changes.\nBriefly summarize why and how you implemented it.\nGenerate full code snippets to implement the features or changes.\n---\n"):"refactor"===e?v+="".concat(b,"\nInstructions:\nRefactor the code to improve readability, maintainability, and consistency.\nBriefly summarize why and how you implemented it.\nGenerate full code snippets to show the refactored code.\n---\n"):"document"===e?v+="".concat(b,"\nInstructions:\nAdd inline comments to the code.\nGenerate full code snippets with the new comments added.\n---\n"):"askdocs"===e&&(v+="".concat(b,"\nInstructions:\nAnswer the user's questions provided in the custom instructions about the official documentation or API usage related to the code.\n---\n")),d.trim().length>0&&(v+="<custom_instructions>".concat(d,"</custom_instructions>\n")),v},rn=1e4;const cn=o().createClass({displayName:"ScriptEditorBuddy",getInitialState:function(){return this.aiRunningInterval=null,this.aiApiController=null,this.getSingularScriptingDocument=null,this.currentSessionId=null,this.md=new Zi.A({html:!0,linkify:!0,typographer:!0}),this.md.renderer.rules.fence=function(e,t){var a,i=e[t],n=i.info.trim()||"text",s=i.content,o=s.split("\n")[0].trim(),l=null;if(o.startsWith("// script id:")&&(l=o.split(":")[1].trim(),s=s.split("\n").slice(1).join("\n")),Qi.A.getLanguage(n))try{a=Qi.A.highlight(s,{language:n}).value}catch(e){a=this.md.utils.escapeHtml(s)}else a=this.md.utils.escapeHtml(s);var r=encodeURIComponent(s),c="";return l&&(c='<button id="replace-button" class="markdown-action-button" data-script-id='.concat(l,' style="right: 73px;">Replace</button>')),'\n        <div class="code-block">\n      <div class="code-header" data-code="'.concat(r,'">\n        <button id="copy-button" class="markdown-action-button">Copy</button>\n        ').concat(c,'\n      </div>\n      <pre><code class="hljs language-').concat(n,'">').concat(a,"</code></pre>\n        </div>\n      ")}.bind(this),{currentMode:on[0].id,scriptScope:"active",customInstructions:on.reduce(function(e,t){return e[t.id]="",e},{}),aiState:"idle",aiStartTime:null,aiResponse:null,aiError:null,aiCostInfo:null,showThomas:Math.random()<.01}},componentDidMount:function(){var e=this;(0,Xi.getSingularScriptingDocument)().then(function(t){e.singularScriptingDocument=t}),document.addEventListener("click",this.handleCopyClick)},componentWillUnmount:function(){this.clearAiRunningInterval(),document.removeEventListener("click",this.handleCopyClick)},handleCopyClick:function(e){if(e.target){var t=e.target.closest(".code-header");if(t){var a=decodeURIComponent(t.getAttribute("data-code"));if(a){var i=function(e){var t=e.textContent;e.textContent="",e.disabled=!0,setTimeout(function(){e.textContent=t,e.disabled=!1},1500)};if("copy-button"===e.target.id&&(navigator.clipboard.writeText(a),i(e.target)),"replace-button"===e.target.id){var n=e.target.getAttribute("data-script-id");n&&this.props.onReplaceScript&&this.props.onReplaceScript(n,a),i(e.target)}}}}},clearAiRunningInterval:function(){this.aiRunningInterval&&(clearInterval(this.aiRunningInterval),this.aiRunningInterval=null)},executeAI:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=!1,l=null,r=function(e){o||fetch("/ai/status/".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){if(!e.ok)throw new Error("Failed to poll status: "+e.status);return e.json()}).then(function(t){if(!o)return t.costInfo&&s(null,{cost_info:t.costInfo},e),"completed"===t.status?(t.text&&s(null,{text:t.text},e),s(null,{done:!0},e),void(o=!0)):"failed"===t.status?(s(new Error(t.error||"AI job failed"),null,e),void(o=!0)):void(o||(l=setTimeout(function(){return r(e)},2e3)))}).catch(function(t){o||(s(t,null,e),o=!0)})};return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t,model:a,configs:i})}).then(function(e){return e.ok?e.json():e.text().then(function(t){o=!0,s(new Error("Server error: "+e.status+"\n"+t),null,null)})}).then(function(e){if(!o&&e){var t=e.jobId;n(t),r(t)}}).catch(function(e){o=!0,s(e,null,null)}),{abort:function(){o=!0,l&&(clearTimeout(l),l=null)}}},onRunAI:function(){var e=this;this.currentSessionId=null,this.setState({aiState:"running",aiStartTime:Date.now(),aiResponse:"",aiError:null,aiCostInfo:null}),this.props.onSizeChanged("large"),this.aiRunningInterval=setInterval(function(){e.setState({})},1e3);var t=function(t,a){a===e.currentSessionId&&e.setState(function(e){return{aiResponse:e.aiResponse?e.aiResponse+t:t}})},a=function(){e.aiApiController&&(e.aiApiController.abort(),e.aiApiController=null),e.clearAiRunningInterval()},i=ln(this.state.currentMode,this);this.aiApiController=this.executeAI("/ai/execute",i,"gemini-2.5-pro",{effort:"low",verbosity:"low",thinkingBudget:-1},function(t){e.currentSessionId=t},function(i,n,s){s===e.currentSessionId&&(i&&"AbortError"===i.name||(i?(e.setState({aiState:"error",aiError:i.message,aiCostInfo:null,aiResponse:null}),a()):n?(void 0!==n.text&&t(n.text,s),n.done,void 0!==n.error&&t("Error: "+n.error,s),void 0!==n.cost_info&&e.setState({aiCostInfo:n.cost_info}),n.done&&(e.setState({aiState:"completed"}),a())):(e.setState({aiState:"completed"}),a())))})},onCancelAI:function(){this.currentSessionId=null,this.aiApiController&&(this.aiApiController.abort(),this.aiApiController=null),this.setState({aiState:"idle",aiResponse:null}),this.clearAiRunningInterval(),this.props.onSizeChanged("small"),this.aiApiController&&(this.aiApiController.abort(),this.aiApiController=null)},onClose:function(){this.props.onClose(),this.setState({showThomas:!1})},onEditorKeyDown:function(e){"Escape"===e.key&&(this.onClose(),e.preventDefault(),e.stopPropagation())},render:function(){var e,t,a,i,n=this,s="",l=this.state.customInstructions[this.state.currentMode]||"";return l.length>=rn&&(s=" over-limit"),this.state.showThomas&&(e=o().createElement("div",{className:"script-editor-buddy-icon"},o().createElement("svg",{viewBox:"0 0 326.92 407.09",fill:"#262626"},o().createElement("g",null,o().createElement("g",null,o().createElement("g",null,o().createElement("path",{d:"M173.92,312.39c4.82-2.26,8.82-5.84,11.3-11.19,2.42-5.14,3.38-12.49-.69-17.02-1.07,12.49-7.01,21.26-15.16,28.58,1.75.97,3.22.25,4.55-.37Z"}),o().createElement("path",{d:"M175.58,269.73c-15.2,7.49-30.62,10.88-47.19,4.94.66,1.84,1.28,3.39,2.35,4.51,11.37,11.58,30.27,6.97,41.05-3.06,1.75-1.56,3.73-3.27,3.79-6.4Z"}),o().createElement("path",{d:"M200.95,233.08c2.37-2.27,5.4-5.88,3.65-9.84-1.9-4.3-7.62,4.27-8.97,5.79-11.92,13.41-22.41,24.46-39.94,28.86-13.2,3.32-25.64.75-37.52-6.42-4.35-2.63-15.09-13.79-17.82-9.76-.54.8,1.14,3.11,1.78,3.74,3.62,3.57,6.87,8.11,10.97,11.03,35.28,26.26,62.35,2.93,87.84-23.4Z"}),o().createElement("path",{d:"M314.99,278.47c-19.51-1.49-41.89-3.27-47.92-8.74-3.21-2.91-4.9-6.66-4.69-10.99.94-14.23,2.3-26.76,2.89-41.97.16-4.11.5-8.63.25-12.73-.09-1.5,2.89-2.97,4.52-3.79,4.28-2.16,8.96-7.74,10.67-11.96,6.17-15.26,6.78-32.01,6.96-48.26-.1-4.87-.96-9.8-2.1-14.55-1.51-6.3-6.8-7.8-12.74-10.95,2.68-14.33,4.6-29.03,1.67-43.52-1.93-9.05-6.95-16.14-14.55-20.9-12.18-7.62-24.57-14.98-37.28-21.67-10.33-5.44-18.54-4.8-28.77.39C185.2,10.43,165.6-2.2,144.98.32c-20.55,1.93-40.22,7.82-59.97,13.33-7.57,2.11-21.42,2.26-29.24,3.05-15.4,1.57-65.32,3.25-52.46,16.03,3.37,3.35,19.82,4.12,15.63,4.51-11.17,1.03-10.75,10.7-14.7,20.55C.67,66.66.07,75.72,2.1,85.08c.49,2.23-.17,4.77-.59,7.12-5.12,27.15,2.14,49.92,32.39,53.71.57.12,1.28.46,1.57.92,3.62,5.67,7.58,11.18,9.06,17.93.62,2.88,1.43,5.75,1.71,8.66.68,7.31,5.44,10.93,11.63,13.2,1.89.69,2.65,1.55,2.96,3.57,1.55,10.03,2.76,20.17,5.16,30,5.31,20.82,21.65,36.57,29.59,56.26,16.18,40.13,20.7,34.47-8.17,74.03-5.5,7.54-1.43,18.25,7.69,20.24,14.32,3.13,27.92,5.11,40.84,6.13,1.49.12,2.67-1.26,2.31-2.71-.11-.45-.21-.93-.28-1.46-.32-2.27-.03-4.62.89-6.72,3.83-8.81,15.11-10.74,21.09-11.12.62-.04,1.26-.06,1.9-.06,3.07,0,6.58.45,10.44,1.34,1.8.41,3.43,1.2,4.8,2.29.78.61,1.86.62,2.67.05,2.38-1.68,3.96-3.27,4.99-5.19.76-1.43-.35-3.14-1.97-3.16-1.08-.01-2.16-.06-3.25-.13-10.69-.47-19.96-4.73-25.5-14.48,15.99-.52,28.13-2.01,40.14-13.47,9.35-8.93,16.47-19.67,24.26-29.89,15.85-20.8,24.34-44.67,29.53-69.87,2.22-10.76,2.46-21.76.61-32.68-.18-1.08-1.11-2.02-1.69-3.03-.45.94-1.16,1.85-1.29,2.83-.56,4.31-1.08,8.64-1.36,12.97-1.12,17.24-5.45,33.62-12.76,49.26-6.34,13.57-15.21,25.54-23.93,37.56-5.7,7.85-11.72,15.54-18.26,22.68-5.95,6.5-13.33,11.28-22.35,12.67-9.88,1.52-19.75,2.43-29.33-1.66-16.2-7.54-23.7-27.63-31.17-42.7-6.37-13.27-12.99-26.37-21.57-38.4-5.19-7.29-8.06-15.62-9.15-24.4-1.06-8.54-1.7-17.16-2.02-25.76-.36-9.33-2.07-18.41-4.09-27.46-2.6-11.64,6.54-25.04,18.27-23.66,6,.71,11.09,5.67,11.09,5.67,0,0-12.49,1.83-17.31,8.82-4.91,7.13-6.02,14.57-2.74,22.35,3.11,7.38,9.37,10.79,17.22,11.13,2.85.12,5.74-.21,8.56-.68,1.01-.16,1.85-1.33,2.77-2.05-1-.52-1.96-1.3-3.02-1.49-2.18-.38-4.45-.27-6.62-.67-15.74-2.9-15.84-25.74-.39-28.59,9.65-1.43,17.67,1.04,20.84,13.39.41,8.71-1.26,15.76-3.3,23.36-1.76,8.35-2.52,11.79-4.22,20.31-3.32,16.55,1.64,21.31,13.27,26.72,4.69,2.18,6.73,1.78,11.7,1.18,2.54-.3,6.13-2.1,8-3.95,2.88-2.86,9.66-6.31,14.14-6.66,5.21-.41,9.6-2.71,12.33-7.46,1.84-3.21,1.77-6.57-.22-9.56-1.73-2.58-3.98-4.83-6.08-7.15-.34-.37-1.09-.37-1.66-.53-.09.59-.37,1.23-.25,1.78.41,1.74,1.07,3.43,1.44,5.18,1.27,6.01-3.24,9.35-7.31,10.09-1.7.31-3.43.44-5.13.73-4.6.79-7.92,3.82-11.41,6.56-6.17,4.83-11.99,4.4-17.47-1.17-4.38-4.45-4.07-9.6-3.33-15.17,1.51-11.31,4.62-17.68,5.21-27,.4-6.33,2.4-10.25,2.59-18.77.11-4.75-1.52-9.37-4.46-13.11-4.57-5.8-9.13-11.61-13.93-17.21-4.5-5.25-10.6-7.54-17.28-8.53-9.1-1.34-17.26.74-24.9,6.58.82-4.77.83-9.62,2.02-14.3,3.57-17.77,7.52-33.68,20.52-38.23,19.82-10.76,30.66-9.62,56.85-19.12,6.6-2.39,15.55-6.53,22.61-7.53,12.82-1.8,29.43,4.99,33.29,18.76,1.3,4.65,1.96,9.48,3.29,14.12,1.99,6.96,5.86,12.43,13.02,15.02,9.51,3.45,14.32,11.06,17.59,20.03,5,13.23,7.24,27.1,10.04,40.86l.78.08c2.94-7.23,5.03-14.81,8.17-21.94,1.38-3.17,3.74-6.01,6.06-8.65,2.56-2.91,6.04-4.61,9.96-3.49,4.04,1.16,7.59,3.39,8.12,7.02,1.16,7.79.8,15.61-.4,23.36-.79,5.08-2.21,10.18-3.61,15.1-.71,2.49-3.11,6.52-6.06,8.39-2.07,1.32-3.74,2.66-5.96,1.73-2.08-.86-2.45-3.01-2.79-5.15-.49-3.12-1.2-6.23-2.12-9.24-.26-.85-1.58-1.37-2.42-2.03-.45.98-1.34,1.98-1.28,2.93.44,7.14,1.08,14.27,1.64,21.41,1.5,13.77,1.28,27.65.66,41.46-1.09,19.61-2.55,39.22-8.36,58.14-5.46,18.13-17.06,36.04-32.85,46.76-1.22.83-1.37,2.6-.23,3.54,2.13,1.77,4.55,2.51,8.13,2.74.98.06,1.9-.51,2.24-1.43.62-1.68,1.62-3.23,2.97-4.54,3.46-3.36,6.79-5.89,9.91-7.53,2.99-1.58,8.88-4.21,14.78-4.21,7.22,0,12.73,4.17,14.03,10.63.32,1.59.43,3.63.5,5.41.06,1.82,2.07,2.9,3.62,1.95,25.27-15.57,42.78-33.9,53.43-47.31,6.42-8.09,1.18-20.06-9.11-20.85Z"}),o().createElement("path",{d:"M170.19,172.59c.32.51.53,1.25.99,1.5,3.65,2.01,7.56,3.32,11.76,2.92,5.39-.51,10.31-2.52,14.89-5.4,10.73-6.73,10.67-20.16,5.21-28.03-4.95-7.13-12.23-9.56-22.47-9.71-6.38-.31-12.93,3.22-18.22,9.31-4.38,5.05-5.77,11.16-5.51,17.65.04.98,1.15,2.33,2.11,2.77,1.5.69,2.65-.47,3.3-1.82.35-.72.46-1.57.63-2.37,2.25-10.73,10.41-17.33,21.06-17.01,16.95.51,19.53,23.81,2.62,28.09-4.74,1.12-9.78.99-14.68,1.47-.58.06-1.13.41-1.7.63Z"}),o().createElement("path",{d:"M216.35,235.83c.2.03.4.07.6.1.58-1.32,1.5-2.59,1.67-3.96.39-3.16.54-6.37.55-9.57,0-3.61-1.38-6.68-4.09-9.16-5.32-4.89-16.86-6.09-22.9-2.11-1.03.68-1.44,2.31-2.14,3.51,1.19.69,2.31,1.79,3.58,1.99,2.17.34,4.46-.08,6.66.16,12.93,1.13,13.98,8.59,16.07,19.05Z"}),o().createElement("path",{d:"M214.71,139.86c.64.65,1.44,1.14,2.58,2.03,0-1.33.19-2.11-.03-2.73-1.88-5.31-3.58-8.72-5.81-13.88-6.96-16.09-21-20.89-36.91-18.01-10.57,1.91-19.26,5.28-27.1,12.31-1.89,1.69-3.16,2.37-4.03,4.83-1.42,4.01.96,6.84,5.14,6.01,3.81-.75,7.58-2.03,11.16-3.55,5.64-2.4,10.75-5.19,16.7-6.74,15.38-3.99,24.31,5.8,38.31,19.74Z"}),o().createElement("path",{d:"M188.09,156.54c-.06-2.91-2.98-5.1-6.63-4.98-3.5.11-6.48,2.63-6.39,5.39.09,2.64,3.25,4.91,6.69,4.8,3.6-.12,6.39-2.4,6.33-5.21Z"}),o().createElement("path",{d:"M102.96,173.51c3.39-.08,5.93-2.29,5.83-5.07-.1-2.65-2.78-4.69-6.04-4.61-7.83.43-7.73,9.62.22,9.67Z"})),o().createElement("path",{d:"M228.33,372.67c4.93,1.71,12.17,3.55,19.07,2.78,1.03-.12,1.67,1.07,1.01,1.88-2.84,3.51-4.72,8.73-4.89,12.26-.04.89-1.05,1.42-1.8.93-6.31-4.11-11.95-10.44-15.51-14.95-1.15-1.45.36-3.52,2.11-2.91ZM227.69,355.97c-14.22.34-20.17-3.01-27.14-15.29-1.22-2.14-4.51-1.21-4.49,1.27.1,14.22-3.34,20.22-15.74,27.4-2.16,1.25-1.29,4.53,1.19,4.47,14.22-.34,20.17,3.01,27.14,15.29,1.22,2.14,4.51,1.21,4.49-1.27-.1-14.22,3.34-20.22,15.74-27.4,2.16-1.25,1.29-4.53-1.19-4.47ZM237.78,361.04c-1.05,1.31-.36,2.96,1.29,3.34,3.07.71,6.56,1.25,9.58,1.06,7.39-.48,14.45-3.34,12.97-7.76-1.48-4.42-4.81-4.5-5.56-7.32-.75-2.81,2.07-4.63,1.15-9.21-.92-4.58-8.41-3.33-15,.14-2.69,1.42-5.42,3.72-7.72,5.94-1.23,1.19-1,2.98.55,3.55,2.08.77,3.61,2.31,4.15,4.34.54,2.03-.01,4.16-1.42,5.91ZM152,388.65c.92,4.58,8.41,3.33,15-.14,2.69-1.42,5.42-3.72,7.72-5.94,1.23-1.19,1-2.98-.55-3.55-2.08-.77-3.61-2.31-4.15-4.34-.54-2.03.01-4.16,1.42-5.91,1.05-1.31.36-2.96-1.29-3.34-3.07-.71-6.56-1.25-9.58-1.06-7.39.48-14.45,3.34-12.97,7.76,1.48,4.42,4.81,4.5,5.56,7.32.75,2.81-2.07,4.63-1.15,9.21ZM188.06,384.05c-3.39,4.06-8.7,9.44-15.02,12.41-.95.44-.91,1.79.06,2.15,4.18,1.53,8.39,5.02,10.29,7.97.48.74,1.61.66,2.01-.14,3.39-6.85,5.08-15.25,5.91-20.99.27-1.85-2.05-2.84-3.26-1.39Z"})))))),o().createElement("div",{className:"script-editor-buddy",onKeyDown:this.onEditorKeyDown},o().createElement("div",{className:"script-editor-buddy-header"},o().createElement("div",{className:"script-editor-buddy-header-title"},"Script Buddy AI"),o().createElement("div",{className:"toolbar"},o().createElement(Y(),{placement:"bottom",delayShow:500,overlay:o().createElement(z(),{id:"helpButton"},"Open help page")},o().createElement("div",{className:"tool",style:{position:"relative",top:"1px"},onClick:function(){window.open("https://support.singular.live/hc/en-us/articles/52519920772889","_blank")}},o().createElement("i",{className:"fa fa-question-circle"}))),o().createElement("button",{className:"tool",onClick:this.onClose},o().createElement("span",{className:"fa fa-times"})))),o().createElement("div",{className:"script-editor-buddy-body"},e,o().createElement("div",{className:"script-editor-buddy-body-line"},o().createElement("span",{className:"script-editor-buddy-body-line-title"},"Mode"),o().createElement(ae.A,{name:"format",selections:on,valueRenderer:function(e){return o().createElement("div",null,o().createElement("i",{className:e.class,style:{width:"12px",textAlign:"center",marginRight:"5px"}}),o().createElement("span",null,e.title))},value:this.state.currentMode,onValueChanged:function(e,t){n.setState({currentMode:t})}})),o().createElement("div",{className:"script-editor-buddy-body-line",style:{position:"relative",top:"-5px"}},o().createElement("span",{className:"script-editor-buddy-body-line-title"}),o().createElement("span",{className:"script-editor-buddy-body-line-description"},on.find(function(e){return e.id===n.state.currentMode}).description)),(a=!1,i=n.state.scriptScope,"extend"===n.state.currentMode&&(a="active"===i,i="active"),"askdocs"===n.state.currentMode&&(a=!0,i="none"),o().createElement("div",{className:"script-editor-buddy-body-line"},o().createElement("span",{className:"script-editor-buddy-body-line-title"},"Script Scope"),o().createElement("div",{className:"script-editor-buddy-body-line-radiobuttons"},o().createElement("button",{type:"button",className:"btn btn-default scope"+("all"===i?" active":""),onClick:function(){return n.setState({scriptScope:"all"})},style:{minWidth:"50px"},disabled:a},"All"),o().createElement("button",{type:"button",className:"btn btn-default scope"+("active"===i?" active":""),onClick:function(){return n.setState({scriptScope:"active"})},style:{minWidth:"50px"},disabled:a},"Active")))),("",t="askdocs"===n.state.currentMode?"The AI only answers questions about the documentation and ignores the code.":"all"===n.state.scriptScope?"The AI will consider all scripts in the composition.":"The AI will only consider the currently active script.",o().createElement("div",{className:"script-editor-buddy-body-line",style:{position:"relative",top:"-5px"}},o().createElement("span",{className:"script-editor-buddy-body-line-title"}),o().createElement("span",{className:"script-editor-buddy-body-line-description"},t))),o().createElement("div",{className:"script-editor-buddy-body-line",style:{alignItems:"flex-start",position:"relative"}},o().createElement("span",{className:"script-editor-buddy-body-line-title",style:{marginTop:"7px"}},on.find(function(e){return e.id===n.state.currentMode}).refinePromptLabel),o().createElement("div",{className:"textarea-wrapper",style:{flex:"1"}},o().createElement("textarea",{className:"form-control script-editor-buddy-body-line-custom-instructions",placeholder:on.find(function(e){return e.id===n.state.currentMode}).refinePromptPlaceholder,rows:"4",value:l,maxLength:rn,onChange:function(e){var t=e.target.value;n.setState(function(e){return{customInstructions:an(an({},e.customInstructions),{},nn({},n.state.currentMode,t))}})}}),o().createElement("span",{className:"script-editor-buddy-body-line-custom-instructions-length"+s},l.length," / ",rn))),o().createElement("div",{className:"script-editor-buddy-footer"},function(){if("idle"===n.state.aiState)return o().createElement("div",{className:"script-editor-buddy-footer-ai-status"});if("running"===n.state.aiState)return o().createElement("div",{className:"script-editor-buddy-footer-ai-status"},o().createElement("span",null,o().createElement("span",{style:{marginRight:"5px",position:"relative",top:"-1px"}},n.props.scriptEditorBuddyIcon),"AI is thinking ..."," ",sn.millisecondsToString(Date.now()-n.state.aiStartTime,"short")));if("completed"===n.state.aiState){var e=null,t=null;if(n.state.aiCostInfo&&n.state.aiCostInfo.tokens){var a=n.state.aiCostInfo.tokens,i=a.input,s=a.output;e="Input tokens: ".concat(sn.numberWithCommas(i)),t="Output tokens: ".concat(sn.numberWithCommas(s))}var l=null;return(window.singularUser.isImpersonated||0==window.singularUser.account.accountId||1==window.singularUser.account.accountId)&&n.state.aiCostInfo&&n.state.aiCostInfo.cost&&(l="Cost: $"+n.state.aiCostInfo.cost.toFixed(6)),o().createElement("div",{className:"script-editor-buddy-footer-ai-status"},o().createElement("span",null,o().createElement("i",{className:"fa fa-check",style:{marginRight:"5px"}}),"AI has completed."),l&&o().createElement("span",null,l),e&&o().createElement("span",null,e),t&&o().createElement("span",null,t))}return"error"===n.state.aiState?o().createElement("div",{className:"script-editor-buddy-footer-ai-status"},o().createElement("span",null,o().createElement("i",{className:"fa fa-exclamation-triangle",style:{color:"red",marginRight:"5px"}}),"AI has encountered an error.")):void 0}(),function(){if("completed"===n.state.aiState||"error"===n.state.aiState)return o().createElement("button",{className:"btn btn-default",style:{width:"120px",padding:"0px",marginRight:"10px"},onClick:function(){n.setState(function(e){return{aiResponse:null,aiState:"idle",aiError:null,aiCostInfo:null,aiStartTime:null}}),n.props.onSizeChanged("small")}},"Clear")}(),function(){if("running"===n.state.aiState)return o().createElement("button",{className:"btn btn-primary script-editor-buddy-footer-run-ai-button",onClick:function(){n.onCancelAI()}},"Cancel");var e=!1,t=n.state.customInstructions[n.state.currentMode]||"";"extend"!==n.state.currentMode&&"askdocs"!==n.state.currentMode||0!==t.trim().length||(e=!0);var a=["professional","trial","event","enterprise","education"].includes(window.singularUser.account.subscription.subscription_plan),i=!1;window.singularUser.isImpersonated||a||(e=!0,i=!0);var s=function(){return o().createElement("button",{className:"btn btn-primary script-editor-buddy-footer-run-ai-button",disabled:e,onClick:function(){n.onRunAI()}},n.props.scriptEditorBuddyIcon,o().createElement("span",{style:{marginLeft:"5px"}},"Run AI"))};return i?o().createElement(Y(),{placement:"bottom",delayShow:500,overlay:o().createElement(z(),{id:"run-air-tooltip"},"This function is only available for paid subscriptions, but you can copy the prompt and use it in your own AI tool.")},s()):s()}(),o().createElement(Y(),{placement:"bottom",delayShow:500,overlay:o().createElement(z(),{id:"copy-prompt-to-clipboard-tooltip"},"Copy prompt to clipboard")},o().createElement("span",{className:"input-group-btn"},o().createElement($t(),{className:"btn input-group-addon icon-only","option-text":function(){return ln(n.state.currentMode,n,!0)},"button-tabIndex":"-1",style:{height:"30px",fontSize:"10px",marginRight:"10px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"})))),o().createElement("button",{className:"btn btn-default",style:{width:"120px"},onClick:this.onClose},"Close"))),function(){if("running"===n.state.aiState||"completed"===n.state.aiState||"error"===n.state.aiState){if(n.state.aiError)return o().createElement("div",{className:"script-editor-buddy-response"},o().createElement("div",{className:"script-editor-buddy-response-error"},n.state.aiError));if(!n.state.aiResponse)return o().createElement("div",{className:"script-editor-buddy-response"},o().createElement("img",{style:{margin:"auto",display:"block",height:"25px"},src:"/images/loading-bubbles.svg"}));var e=n.md.render(n.state.aiResponse||"");return o().createElement("div",{className:"script-editor-buddy-response"},o().createElement("div",{className:"markdown-body",dangerouslySetInnerHTML:{__html:e}}))}return null}())}});var dn,pn=a(9769),mn=a.n(pn);function un(e,t,a){return(t=function(e){var t=function(e){if("object"!=hn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=hn(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==hn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function hn(e){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hn(e)}var fn=a(24113),gn="seEditingIds";const vn=o().createClass((un(un(un(un(un(un(un(un(un(un(dn={displayName:"CompositionScriptEditor",mixins:[W.A],_notificationSystem:null,getInitialState:function(){var e=!0;return new URLSearchParams(window.location.search).has("safemode")&&(this.safemode=!0,e=!1),this.skipFirstCall=!1,this.scriptPreviewEditor=void 0,{showEditedByOtherUser:!1,paneHorizontal:Math.round(window.innerHeight/2),paneVertical:Math.round(window.innerWidth/2),paneFillInForm:200,previewInteractive:!0,uiSettings:null,showScriptBuddy:!1,scriptBuddySize:"small",showInteractiveHighlight:!1,loadingPreviewBusy:e,adaptationGlobals:null}},loadScriptEditorSettings:function(){var e;try{e=localStorage.getItem("CompositionScriptEditor")}catch(e){}if(e){var t;try{t=JSON.parse(e)}catch(e){}if(t){var a={};void 0!==t.paneHorizontal&&(a.paneHorizontal=t.paneHorizontal),void 0!==t.paneVertical&&(a.paneVertical=t.paneVertical),this.setState(a)}}},shouldComponentUpdate:function(e,t){return!mn().compareObject(e,this.props)||!mn().compareObject(t,this.state)},componentWillMount:function(){var e=this;this.loadScriptEditorSettings(),this.props.sbRef.child("command").on("value",function(t){try{e.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.singularCompLib.onFirebaseTimelineCommand(t)}catch(e){}});var t=this.props.sbRef.child("uiSettings").val(),a=this.props.sbRef.child("adaptationGlobals").val(),i=this.props.sbRef.child("displayVariants").val();this.setState({uiSettings:t,adaptationGlobals:a,displayVariants:i}),this.props.rtdbRef.child(gn).on("value",this.checkEditingNumber)},componentDidMount:function(){this._notificationSystem=this.refs.notificationSystem},componentWillUnmount:function(){},componentDidUpdate:function(){this.state.showEditedByOtherUser&&this.props.onOff({id:this.props.editingId,off:!0})},onNotification:function(e,t,a,i){this.refs.notificationSystem&&this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:a,position:i})}},"componentDidMount",function(){this.props.onOff({id:this.props.editingId,off:!1});try{singularanalytics.event(analyticEventType.COMP_SCRIPT_OPENED,window.singularScene.account_id,"UI",window.location.hostname,{element_id:window.singularScene.id,user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.COMP_SCRIPT_OPENED,{plan:window.singularUser.account.subscription.subscription_plan,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}}),"getScriptPreviewEditor",function(){return void 0===this.scriptPreviewEditor&&document.getElementById("ScriptEditorPreview")&&(this.scriptPreviewEditor=document.getElementById("ScriptEditorPreview").contentWindow),this.scriptPreviewEditor}),"saveLocalStorage",function(){var e={paneHorizontal:this.state.paneHorizontal,paneVertical:this.state.paneVertical};try{localStorage.setItem("CompositionScriptEditor",JSON.stringify(e))}catch(e){}}),"splitPaneChange",function(e,t){var a={};a[e]=t,this.setState(a,this.saveLocalStorage()),this.refs.controlPanelRef&&this.refs.controlPanelRef.forceRedraw()}),"onDragStarted",function(){this.setState({previewInteractive:!1})}),"onDragFinished",function(){this.setState({previewInteractive:!0,forceRenderScriptEditor:Math.random()})}),"compositionNavControl",function(e,t){this.refs.controlPanelRef&&this.refs.controlPanelRef.compositionNavControl(e,t)}),"onSetPayload",function(e,t,a){var i={};i[t]=a;var n=this.getScriptPreviewEditor();if(n&&n.document){var s=n.document.getElementById("SingularPlayer");s&&s.contentWindow&&s.contentWindow.singularOnAirRef&&s.contentWindow.singularOnAirRef.setControlNodeOffline&&s.contentWindow.singularOnAirRef.setControlNodeOffline(e,i)}}),"onPreviewWindowMessageReceived",function(e,t){"error"==e&&(this.setState({loadingPreviewBusy:!1}),this.setInteractiveHighlight())}),"onScriptEditorPreviewLoad",function(){var e=this,t=function(){e.scriptPreviewEditor=void 0;try{if(e.getScriptPreviewEditor()._singular_composition_ready){for(var a in e.setState({loadingPreviewBusy:!1}),e.setInteractiveHighlight(),e.state.uiSettings&&e.onResolutionSelect(e.state.uiSettings.editorResolution),e.onDisplayVariantsChanged(e.state.displayVariants),e.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.addEventListener("message",function(t){try{var a=JSON.parse(t.data);"_singular_comp_command"!=a.event&&"_singular_update_ui_from_script"!=a.event||("setPayload"==a.params.command?(e.props.sbRef.child("compositions").child(a.params.compId).child("dataSources/composition/controlNode/payload").update(a.params.payload),"_singular_update_ui_from_script"!=a.event&&e.getScriptPreviewEditor().postMessage({event:"_singular_composition_payload_changed",params:{compId:a.params.compId,compositionId:a.params.compId,payload:a.params.payload}},"*")):"playTo"!=a.params.command&&"jumpTo"!=a.params.command||e.refs.controlPanelRef.compositionNavControl(a.params.compId,a.params.to,!0))}catch(e){console.error(e)}}),e.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.onSingularMessage=function(t){if("processAction"==t.type){var a,i=t.compId;switch(t.state){case"in":a="In";break;case"out":a="Out";break;case"toggle":a="In"==e.props.sbRef.child("compositionStates").child(i).val()?"Out":"In"}e.refs.controlPanelRef.compositionNavControl(i,a,!0)}},e.props.lastPayloads){for(var i in e.props.lastPayloads[a])e.onSetPayload(a,i,e.props.lastPayloads[a][i]);e.props.sbRef.child("compositions").child(a).child("dataSources/composition/controlNode/payload").update(e.props.lastPayloads[a])}for(var a in e.props.lastStates)e.refs.controlPanelRef.compositionNavControl(a,e.props.lastStates[a],!1,!0);e.props.lastAdaptationGlobals&&Object.keys(e.props.lastAdaptationGlobals).length>0&&e._setAdaptationGlobalsToOutput(e.props.lastAdaptationGlobals),e.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.document.getElementsByClassName("root-onair")[0].style.backgroundColor="black";var n=e.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.singularScriptCompInfoForUI;for(var s in n.payloads){var o=n.payloads[s];e.props.sbRef.child("compositions").child(s).child("dataSources/composition/controlNode/payload").update(o),e.getScriptPreviewEditor().postMessage({event:"_singular_composition_payload_changed",params:{compId:s,compositionId:s,payload:o}},"*")}for(var s in n.states)e.refs.controlPanelRef.compositionNavControl(s,n.states[s],!0);e.props.sbRef.child("compositionProps/scripts").on("value",function(t){e.skipFirstCall&&e.onCompileScript("compScript",t.val()),e.skipFirstCall=!0})}else setTimeout(t,100)}catch(e){setTimeout(t,100)}};setTimeout(t,100)}),un(un(un(un(un(un(un(un(un(un(dn,"onReloadComposition",function(){var e=this;this.setState({loadingPreviewBusy:!0},function(){e.props.onReload(!0)})}),"onToggleInteractiveHighlight",function(){this.setInteractiveHighlight(!this.state.showInteractiveHighlight)}),"setInteractiveHighlight",function(e){void 0===e?e=this.state.showInteractiveHighlight:this.setState({showInteractiveHighlight:e});try{var t=this.getScriptPreviewEditor();t&&t.document.getElementById("SingularPlayer").contentWindow.singularSetInteractiveHighlight(e)}catch(e){}}),"onResolutionSelect",function(e){var t=Object.assign({},this.state.uiSettings);t.editorResolution=e;var a=(0,Ka.H)(e);-1==e?(a.width=this.state.uiSettings.editorResolutionWidth?this.state.uiSettings.editorResolutionWidth:1920,a.height=this.state.uiSettings.editorResolutionHeight?this.state.uiSettings.editorResolutionHeight:1080):(t.editorResolutionWidth=a.width,t.editorResolutionHeight=a.height),this.setState({uiSettings:t}),this.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.singularResizeComp(a.width,a.height)}),"onDisplayVariantsChanged",function(e){if(this.setState({displayVariants:e}),e.active){var t=e.variants.find(function(t){return t.name===e.active});if(t){var a,i=1920,n=1080;if(t.resolution){var s=fn.VARIANT_RESOLUTIONS.find(function(e){return e.id===t.resolution});s&&(i=s.width,n=s.height,this.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.singularResizeComp(s.width||1920,s.height||1080))}t.globals&&(a=g().addDefaultValues(a),$.extend(!0,a,t.globals),a=g().initializeGlobals(a,i,n),this._setAdaptationGlobalsToOutput(a))}}}),"onUISettings",function(e,t){var a,i=this;"object"===hn(e)?a=Object.assign({},this.state.uiSettings,e):(a=Object.assign({},this.state.uiSettings))[e]=t,this.setState({uiSettings:a}),this.UISettingsTimeoutHandler=setTimeout(function(){i.UISettingsTimeoutHandler=null,i.onResolutionSelect(i.state.uiSettings.editorResolution)},200)}),"ToggleGuidesMenu",function(e){zE.identify({name:window.singularUser.name,email:window.singularUser.email}),zE.activate({hideOnClose:!0})}),"onAdaptationGlobalsChanged",function(e){var t=this;this.setState({adaptationGlobals:e},function(){t.props.sbRef.child("adaptationGlobals").update(e),t._setAdaptationGlobalsToOutput(e)})}),"onCompileScript",function(e,t){var a=this;if("overlay"==e){var i=function(e){a.getScriptPreviewEditor().postMessage(JSON.stringify({event:"_singular_setScript",params:{script:e}}),"*")};void 0===t?this.props.sbRef.child("script").on("value",function(e){i(e.val())}):i(t)}else{var n=function(e){a.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.postMessage(JSON.stringify({event:"_singular_setScript",params:{script:e}}),"*")};void 0===t?this.props.sbRef.child("compositionProps/scripts").on("value",function(e){n(e.val())}):n(t)}}),"onScriptBuddySizeChanged",function(e){this.setState({scriptBuddySize:e})}),un(un(un(un(un(un(un(dn,"onScriptBuddyClose",function(){this.setState({showScriptBuddy:!1})}),"getAllScripts",function(){return this.refs.ScriptEditor?this.refs.ScriptEditor.getAllScripts():null}),"getActiveFileID",function(){return this.refs.ScriptEditor?this.refs.ScriptEditor.getActiveFileID():null}),"getEvalStatus",function(){return this.refs.ScriptEditor?this.refs.ScriptEditor.getEvalStatus():null}),"_setAdaptationGlobalsToOutput",function(e){try{this.getScriptPreviewEditor().document.getElementById("SingularPlayer").contentWindow.postMessage(JSON.stringify({event:"_singular_setAdaptationGlobals",params:{data:e}}),"*"),this.getScriptPreviewEditor().postMessage({event:"_singular_setAdaptationGlobals",params:{adaptationGlobals:e},fromScriptEditor:!0},"*")}catch(e){console.error(e)}}),"checkEditingNumber",function(e){e.exists()&&!e.val()[this.props.editingId]&&(this.props.rtdbRef.child(gn).off("value",this.checkEditingNumber),this.setState({showEditedByOtherUser:!0}))}),"render",function(){var e,t=this;if(1==this.state.showEditedByOtherUser)return o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement(si(),{show:!0,title:"",text:"This script is being edited by another user",onConfirm:function(){window.location="/dashboard"},onEscapeKey:function(){window.location="/dashboard"},onOutsideClick:function(){window.location="/dashboard"}}));e=this.state.previewInteractive?"auto":"none";var a,i,n,s="";this.state.showInteractiveHighlight&&(s="active"),a=1==this.safemode?o().createElement("div",{style:{textAlign:"center",marginTop:"40px"}},o().createElement("span",{style:{fontSize:"14px"}},"Safemode is enabled"),o().createElement("br",null),"You can edit and save your scripts, but the render engine will not compile or execute them.",o().createElement("br",null),"If you accidentially create an infinite loop you can use the safemode to recover your scripts."):window.singularCompId?o().createElement("iframe",{title:"Composition Script Editor",key:this.props.forceReload,onLoad:this.onScriptEditorPreviewLoad,id:"ScriptEditorPreview",src:"/compositions/"+window.singularCompId+"/preview?variant=[disable_display_variant]",style:{width:"100%",height:"100%",pointerEvents:e,border:"0px"}}):o().createElement("div",null,"Could not generate preview window"),this.state.uiSettings&&void 0!==this.state.uiSettings.editorResolution?(i=(0,Ka.H)(this.state.uiSettings.editorResolution),-1==this.state.uiSettings.editorResolution&&((i=(0,Ka.H)(-1)).width=this.state.uiSettings.editorResolutionWidth?this.state.uiSettings.editorResolutionWidth:1920,i.height=this.state.uiSettings.editorResolutionHeight?this.state.uiSettings.editorResolutionHeight:1080)):i=(0,Ka.H)(0),this.state.loadingPreviewBusy&&(n=o().createElement("div",{style:{width:"100%",height:"100%",color:"#b0b0b0"}},o().createElement("img",{src:"/images/loading-bubbles.svg",style:{left:"45%",top:"45%",width:"10%",height:"10%",position:"absolute"}})));var l,r,c=this.state.displayVariants,d=c&&c.variants&&c.variants.length;this.safemode||(l=o().createElement(Ji,{forceReload:this.props.forceReload,rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,ref:"controlPanelRef",onSetPayload:this.onSetPayload,onAdaptationGlobalsChanged:this.onAdaptationGlobalsChanged,adaptationGlobals:this.state.adaptationGlobals,showBusy:this.state.loadingPreviewBusy,hideGlobals:d,scriptPreviewEditor:this.getScriptPreviewEditor()})),r=d?o().createElement("div",{className:"tool"},o().createElement(qa,{displayVariants:c,onDisplayVariantsChanged:this.onDisplayVariantsChanged})):o().createElement("div",{className:"tool"},o().createElement($a.A,{onResolutionSelect:this.onResolutionSelect,selectedRes:i,uiSettings:this.state.uiSettings,onUISettings:this.onUISettings,optionsClassName:"render-options-menu-gray-scroll"}));var p={};"small"==this.state.scriptBuddySize&&(p.height="auto"),this.state.showScriptBuddy?p.display="block":p.display="none";var m=o().createElement("svg",{viewBox:"0 0 301.81 163.87",width:"20px",height:"14px",fill:"#cbcbcb"},o().createElement("g",null,o().createElement("g",null,o().createElement("path",{d:"M206.33,107.21c11.44,7.98,28.72,17.96,46.91,20.99,2.73.45,3.55,3.95,1.31,5.57-9.66,6.96-18.06,19-20.9,27.98-.72,2.26-3.67,2.88-5.23,1.1-13.35-15.16-23.44-35.52-29.47-49.68-1.94-4.56,3.32-8.78,7.38-5.95Z"}),o().createElement("path",{d:"M95.48,107.21c-11.44,7.98-28.72,17.96-46.91,20.99-2.73.45-3.55,3.95-1.31,5.57,9.66,6.96,18.06,19,20.9,27.98.72,2.26,3.67,2.88,5.23,1.1,13.35-15.16,23.44-35.52,29.47-49.68,1.94-4.56-3.32-8.78-7.38-5.95Z"}),o().createElement("path",{d:"M238.47,84.16c-3.57,2.6-2.95,7.35,1.01,9.52,7.38,4.05,15.95,7.98,23.81,9.67,19.25,4.15,39.27,1.91,38.5-10.52-.77-12.44-9.24-15.08-9.24-22.85s8.47-10.41,9.24-22.85c.77-12.44-19.25-14.67-38.5-10.52-7.86,1.69-16.43,5.62-23.81,9.67-3.96,2.17-4.58,6.93-1.01,9.52,4.79,3.48,7.67,8.55,7.67,14.17,0,5.62-2.88,10.7-7.67,14.17Z"}),o().createElement("path",{d:"M.02,92.84c-.77,12.44,19.25,14.67,38.5,10.52,7.86-1.69,16.43-5.62,23.81-9.67,3.96-2.17,4.58-6.93,1.01-9.52-4.79-3.48-7.67-8.55-7.67-14.17,0-5.62,2.88-10.69,7.67-14.17,3.57-2.6,2.95-7.35-1.01-9.52-7.38-4.05-15.95-7.98-23.81-9.67C19.27,32.47-.75,34.7.02,47.14c.77,12.44,9.24,15.08,9.24,22.85S.79,80.4.02,92.84Z"}),o().createElement("path",{d:"M216.1,63.81c-36.64-9.46-49.56-22.38-59.02-59.02-1.65-6.39-10.71-6.39-12.36,0-9.46,36.64-22.38,49.56-59.02,59.02-6.39,1.65-6.39,10.71,0,12.36,36.64,9.46,49.56,22.38,59.02,59.02,1.65,6.39,10.71,6.39,12.36,0,9.46-36.64,22.38-49.56,59.02-59.02,6.39-1.65,6.39-10.71,0-12.36Z"})))),u=o().createElement("button",{className:"btn btn-default script-buddy-toggle",onClick:function(){t.setState({showScriptBuddy:!0})},tabIndex:"-1"},m,o().createElement("span",null,"Script Buddy AI")),h=o().createElement("div",{className:"script-editor-buddy-container",style:p},o().createElement(cn,{scriptEditorBuddyIcon:m,onSizeChanged:this.onScriptBuddySizeChanged,onClose:this.onScriptBuddyClose,onGetAllScripts:this.getAllScripts,onGetActiveFileID:this.getActiveFileID,onGetEvalStatus:this.getEvalStatus,onReplaceScript:function(e,a){t.refs.ScriptEditor&&t.refs.ScriptEditor.onReplaceScript(e,a)},onNotification:this.onNotification,sbRef:this.props.sbRef}));return o().createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"rgb(56, 56, 56)"}},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},o().createElement(Ja.A,{split:"vertical",minSize:500,maxSize:window.innerWidth-650,defaultSize:this.state.paneVertical,onChange:this.splitPaneChange.bind(this,"paneVertical"),onDragStarted:this.onDragStarted,onDragFinished:this.onDragFinished},o().createElement(Ui,{id:"script",rtdbRef:this.props.rtdbRef,sbRef:this.props.sbRef,loadingBusy:this.state.loadingPreviewBusy,onReloadComposition:this.onReloadComposition,onPreviewWindowMessageReceived:this.onPreviewWindowMessageReceived,onCompileScript:this.onCompileScript,forceRender:this.state.forceRenderScriptEditor,safemode:this.safemode,onNotification:this.onNotification,ref:"ScriptEditor"}),o().createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},h,o().createElement(Ja.A,{split:"horizontal",minSize:250,maxSize:window.innerHeight-250,defaultSize:this.state.paneHorizontal,onChange:this.splitPaneChange.bind(this,"paneHorizontal"),onDragStarted:this.onDragStarted,onDragFinished:this.onDragFinished},o().createElement("div",{style:{width:"100%",height:"100%"}},o().createElement("div",{className:"onairPreviewToolbar",style:{width:"100%",height:"30px",display:"flex",alignItems:"center"}},u,o().createElement(Y(),{placement:"bottom",delayShow:500,overlay:o().createElement(z(),{id:"toggleInteractiveHighlight"},"Toggle Interactive Zones")},o().createElement("div",{className:"tool "+s,onClick:this.onToggleInteractiveHighlight},o().createElement("i",{className:"fa fa-crosshairs"}))),r,o().createElement("div",{className:"tool right guides-button",onClick:this.ToggleGuidesMenu,style:{background:"#58b848"}},o().createElement("i",{className:"fa fa-question"}))),o().createElement("div",{style:{width:"100%",height:"calc(100% - 30px)"}},a,n)),o().createElement("div",{style:{width:"100%",height:"100%"}},l))))),o().createElement(Dt.A.imageSingleton,null),o().createElement(Dt.A.audioSingleton,null),o().createElement(Dt.A.videoSingleton,null),o().createElement(Dt.A.jsonSingleton,null),o().createElement(Dt.A.dataSingleton,null),o().createElement(ai.A.colorPickerSingleton,null))})));var bn=a(9769),yn=a(82445);const En=o().createClass({displayName:"AccountStatusSummary",getInitialState:function(){return this.renderIntervalId=null,{}},componentDidMount:function(){var e=this;this.renderIntervalId=setInterval(function(){e.setState({redraw:Math.random})},6e4)},componentWillUnmount:function(){this.renderIntervalId&&clearInterval(this.renderIntervalId)},openUrl:function(e){window.open(e,"_self").focus()},render:function(){var e,t,a,i=window.singularUser.account.subscription,n=yn.SubscriptionPlans.find(function(e){if(e.id==i.subscription_plan)return e}),s="Free";if(n&&(s=n.title),i.expires_on){var l=ge()(i.expires_on).diff(ge()());l<-72e5?(e="Expired "+bn.millisecondsToString(-l,"short")+" ago","event"==i.subscription_plan||i.subscription_plan):"event"!=i.subscription_plan&&"trial"!=i.subscription_plan||l<2592e5&&(e=bn.millisecondsToString(l,"short")+" left")}return(i.storage_limit<i.storage_usage||i.user_limit<i.user_usage||i.weboutput_limit<i.weboutput_usage||i.daily_api_limit<i.daily_api_usage||i.daily_data_limit<i.daily_data_usage||i.burst_api_violations||i.burst_data_violations)&&(t="Over limit usage warning"),a=e?o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},s),o().createElement("div",{className:"text-second-line usage-error"},e)):t?o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},s),o().createElement("div",{className:"text-second-line usage-warning"},t)):o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},s)),o().createElement("div",{className:"account-status-summary"},o().createElement("div",{className:"subscription"},a))}});var wn=a(15032),Sn=a(9769),Nn=o().createClass({displayName:"ApplicationHeader",_notificationSystem:null,getInitialState:function(){return{searchValue:""}},componentDidMount:function(){this._notificationSystem=this.refs.notificationSystem},shouldComponentUpdate:function(e,t){return!Sn.compareObject(e,this.props)||!Sn.compareObject(t,this.state)},onChange:function(e){this.setState({searchValue:e.target.value}),this.props.onSearch&&this.props.onSearch(e.target.value)},onKeyDown:function(e){"Escape"==e.key&&(this.setState({searchValue:""}),this.props.onSearchClick&&this.props.onSearchClick(""))},onKeyPress:function(e){"Enter"===e.key&&this.props.onSearchClick&&this.props.onSearchClick()},clearSearchBox:function(){this.setState({searchValue:""}),this.props.onClearSearchClick&&this.props.onClearSearchClick("clear")},onNotification:function(e,t,a,i){this._notificationSystem.addNotification({message:e,level:t,autoDismiss:a,position:i})},render:function(){var e,t=null,a=this.state.searchValue?"fa fa-times":"fa fa-times hidden",i=this.state.searchValue?"fa fa-search hidden":"fa fa-search";this.props.useSearch&&(t=o().createElement("div",{role:"search",className:"navbar-form-custom"},o().createElement("div",{className:"input-group",style:{width:"100%",height:"50px"}},o().createElement("span",{className:"search-icon"},o().createElement("i",{className:i}),o().createElement("i",{className:a,onClick:this.clearSearchBox})),o().createElement("input",{type:"text",placeholder:"Search for something ...",className:"form-control",name:"top-search",id:"top-search",onChange:this.onChange,onKeyDown:this.onKeyDown,onKeyPress:this.onKeyPress,value:this.state.searchValue,autoComplete:"off"})))),e=window.singularUser.email!=window.singularUser.account.accountName?o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},window.singularUser.email),o().createElement("div",{className:"text-second-line"},window.singularUser.account.accountName)):o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},window.singularUser.email));var n=window.singularUser.id==window.singularUser.account.accountAdminId,s=0==window.singularUser.account.accountId,l=window.singularUser.isImpersonated,r=window.singularUser.account.permission.permDevTool,c=!1;(l||n||s)&&(c=!0);var d,p,m,u,h,f=o().createElement("li",null,o().createElement("a",{href:"/dashboard",tabIndex:"-1"},o().createElement("i",{className:"fa fa-home"})," Dashboard"));return r&&(d=o().createElement("li",null,o().createElement("a",{href:"/widgets/editor",tabIndex:"-1"},o().createElement("i",{className:"fa fa-plug"})," Widget Manager")),p=o().createElement("li",null,o().createElement("a",{href:"/apptemplates/editor",tabIndex:"-1"},o().createElement("i",{className:"fa fa-rocket"})," App Manager"))),s&&(m=o().createElement("li",null,o().createElement("a",{href:"/accounts/settings",tabIndex:"-1"},o().createElement("i",{className:"fa fa-users"})," Account Manager")),u=o().createElement("li",null,o().createElement("a",{href:"/fontmanager",tabIndex:"-1"},o().createElement("i",{className:"fa fa-font"})," Font Manager")),h=o().createElement("li",null,o().createElement("a",{href:"/templatelibrary",tabIndex:"-1"},o().createElement("i",{className:"fa fa-book"})," Template Library"))),o().createElement("div",{style:{position:"relative"}},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{className:"singular-portal-header-wrapper"},o().createElement("div",{className:"left-area"},o().createElement("a",{href:"/",tabIndex:"-1",style:{textAlign:"center"}},o().createElement("img",{src:"/images/logo-v2.png",className:"logo"}))),t,o().createElement("div",{className:"right-area"},o().createElement("div",{className:"icons"},o().createElement("div",{className:"icon-wrapper",style:{fontSize:"14px",marginLeft:"50px"}},o().createElement(wn.A,null))),o().createElement("div",{className:"singular-browser-header-tools"},o().createElement("div",{className:"profile-button",style:{maxWidth:"190px",minWidth:"190px"}},o().createElement("a",{"data-toggle":"dropdown"},o().createElement("i",{className:"fa fa-credit-card",style:{color:"#6e8dc9"}}),o().createElement(En,null),o().createElement("i",{className:"fa fa-caret-down",style:{position:"absolute",right:"5px",left:"auto",color:"#6e8dc9"}})),o().createElement("ul",{className:"dropdown-menu",style:{width:"190px"}},o().createElement("li",null,c&&o().createElement("a",{href:"/users/settings/subscription",tabIndex:"-1"},o().createElement("i",{className:"fa fa-envelope"}),"Subscription Manager"),o().createElement("a",{href:"/users/settings/accountStatus",tabIndex:"-1"},o().createElement("i",{className:"fa fa-bar-chart"}),"Usage"),o().createElement("a",{href:"/users/settings/accountStorage",tabIndex:"-1"},o().createElement("i",{className:"fa fa-database"}),"Storage")))),o().createElement("div",{className:"profile-button",style:{maxWidth:"190px",minWidth:"190px"}},o().createElement("a",{"data-toggle":"dropdown"},o().createElement("i",{className:"fa fa-question-circle-o",style:{color:"#6e8dc9"}}),o().createElement("div",{className:"details-wrapper"},o().createElement("div",{className:"text-first-line"},"Help")),o().createElement("i",{className:"fa fa-caret-down",style:{position:"absolute",right:"5px",left:"auto",color:"#6e8dc9"}})),o().createElement("ul",{className:"dropdown-menu",style:{width:"190px"}},o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://www.singular.live/academy",target:"_blank"},o().createElement("i",{className:"fa fa-thumbs-up"}),"Singular Academy")),o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://support.singular.live/hc/en-us",target:"_blank"},o().createElement("i",{className:"fa fa-info-circle"}),"Support Portal")),o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://developer.singular.live/",target:"_blank"},o().createElement("i",{className:"fa fa-code"}),"Developer Portal")),o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://support.singular.live/hc/en-us/requests/new",target:"_blank"},o().createElement("i",{className:"fa fa-paper-plane"}),"Submit a Ticket")),o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://www.singular.live/resources/serviceproviders",target:"_blank"},o().createElement("i",{className:"fa fa-handshake-o"}),"Service Providers")),o().createElement("li",null,o().createElement("a",{tabIndex:"-1",href:"https://status.singular.live/",target:"_blank"},o().createElement("i",{className:"fa fa-server"}),"System Status")))),o().createElement("div",{className:"profile-button"},o().createElement("a",{"data-toggle":"dropdown"},o().createElement("i",{className:"fa fa-user",style:{color:"#6e8dc9"}}),e,o().createElement("i",{className:"fa fa-caret-down",style:{position:"absolute",right:"5px",left:"auto",color:"#6e8dc9"}})),o().createElement("ul",{className:"dropdown-menu"},f,o().createElement("li",null,o().createElement("a",{href:"/users/settings/profile",tabIndex:"-1"},o().createElement("i",{className:"fa fa-cog"})," Settings")),o().createElement("li",null,o().createElement("a",{href:"/outputmanager",tabIndex:"-1"},o().createElement("i",{className:"fa fa-globe"})," Output Manager")),o().createElement("li",null,o().createElement("a",{href:"/datastreammanager",tabIndex:"-1"},o().createElement("i",{className:"fa fa-bolt"})," Data Stream Manager")),d,p,m,h,u,o().createElement("li",null,o().createElement("a",{href:"/users/logout",tabIndex:"-1"},o().createElement("i",{className:"fa fa-sign-out"})," Sign out")))," ")))))}});const Cn=Nn;var xn=a(15734);const In=o().createClass({displayName:"BannerMessage",getInitialState:function(){return{closed:!0}},componentDidMount:function(){var e=this;setTimeout(function(){e.setState({closed:!1})},5e3)},onCloseClicked:function(){xn.post("/banners/close",{url:this.props.bannerUrl}).end(function(e,t){e&&console.log("close banner error")}),this.setState({closed:!0})},render:function(){return o().createElement("div",{className:"singular-banner"+(this.state.closed?" closed":"")},o().createElement("iframe",{scrolling:"no",src:this.props.bannerUrl,style:{height:"100%",width:"100%",border:"0px"}}))}});var kn=a(15734);const Dn=o().createClass({displayName:"DashboardManager",browserRef:null,getInitialState:function(){return{inspectorCollapsed:!0,filteredByOwner:!1,activeItem:null,globalSearchQuery:"",verticalPanelPosition:200,bannerInfo:""}},componentDidMount:function(){this.browserRef=this.refs.browser.refs.child,this.browserRef.updateConfig({saveSelectedFilter:!0}),this.sendLoginAnalytics(),this.sendDashboardOpenedAnalytics();var e=new URLSearchParams(window.location.search);if(e.has("welcome")||e.has("marketplace")||e.has("templateLibrary"))this.browserRef.showMarketplaceBrowser();else{var t=parseInt(e.get("marketplaceItem"));if(t||(t=parseInt(e.get("templateLibraryItem"))),t)this.browserRef.showMarketplaceBrowser("item",t);else{var a=e.get("marketplaceTag");a||(a=e.get("templateLibraryTag")),a?this.browserRef.showMarketplaceBrowser("tag",a):(kn.get("/apiv1/users/firstloggedin").end(function(e,t){if(e)console.log("cannot update first loggedin");else{if(t.headers.location)return void(window.location=t.headers.location);t.body||this.browserRef.showMarketplaceBrowser()}}.bind(this)),kn.get("/banners/user").end(function(e,t){e?console.log("cannot get banner for this user"):t.body&&t.body.url&&this.setState({bannerInfo:t.body})}.bind(this)))}}},shouldComponentUpdate:function(e,t){return t.globalSearchQuery==this.state.globalSearchQuery},toggleInspector:function(){this.setState({inspectorCollapsed:!this.state.inspectorCollapsed},function(){this.browserRef.toggleInspector(!this.state.inspectorCollapsed)}.bind(this))},toggleFilteredByOwner:function(){this.setState({filteredByOwner:!this.state.filteredByOwner},function(){this.browserRef.toggleFilteredByOwner(this.state.filteredByOwner)}.bind(this))},toggleListView:function(){this.setState({assetList:!this.state.assetList},function(){this.browserRef.toggleViewStyle(this.state.assetList?"thumb":"list")}.bind(this))},onFilterSearchChange:function(e){this.browserRef.searchQuery(e.target.value)},onGlobalSearchClick:function(){this.browserRef.onGlobalSearch(this.state.globalSearchQuery)},onClearSearchClick:function(){this.browserRef.onClearSearch()},onGlobalSearchChange:function(e){this.setState({globalSearchQuery:e}),""==e&&this.browserRef.gotoLastFolder()},onVerticalPaneChanged:function(e){this.setState({verticalPanelPosition:e})},onNotification:function(e,t,a,i){this.refs.appHeader.onNotification(e,t,a,i)},sendLoginAnalytics:function(){var e=sessionStorage.getItem("sendLoginAnalytics");if(window.singularUser&&"true"!=e){try{singularanalytics.event(analyticEventType.LOGIN,window.singularUser.account.accountId,window.page?window.page:"UI",window.location.hostname,{user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.LOGIN,{plan:window.singularUser.account.subscription.subscription_plan,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}window.singularUser.sendLoginAnalytics=!0,sessionStorage.setItem("sendLoginAnalytics",!0)}},sendDashboardOpenedAnalytics:function(){try{singularanalytics.event(analyticEventType.DASHBOARD_OPENED,window.singularUser.account.accountId,window.page?window.page:"UI",window.location.hostname,{user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.DASHBOARD_OPENED,{plan:window.singularUser.account.subscription.subscription_plan,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}},render:function(){return o().createElement("div",{className:"height-100p"},this.state.bannerInfo&&o().createElement(In,{bannerUrl:this.state.bannerInfo.url}),o().createElement(Cn,{onSearch:this.onGlobalSearchChange,onSearchClick:this.onGlobalSearchClick,onClearSearchClick:this.onClearSearchClick,logoWidth:this.state.verticalPanelPosition,ref:"appHeader"}),o().createElement("div",{id:"singular-browser",className:"portal",style:{height:"calc(100% - 60px)"}},o().createElement(kt.A,{enableRealtimeUpdate:!0,rtdbFolderRef:this.props.rtdbFolderRef,showInspector:!0,enableMarketplace:!0,enableAppTemplateBrowser:!0,onVerticalPaneChanged:this.onVerticalPaneChanged,onNotification:this.onNotification,ref:"browser"})))}});var An=a(82465),Rn=a(9769);const Pn=o().createClass({displayName:"ExternalBrowser",getInitialState:function(){return{}},componentDidMount:function(){var e;if(this.browserRef=this.refs.browser.refs.child,this.browserRef.modalPending=!1,window.singularBrowserTitle)e=window.singularBrowserTitle;else{var t=An.BROWSERITEM_FULLNAME_MAP_REV[window.singularBrowserType];t&&An.BROWSERITEM_NICENAME_MAP[t]&&(e=An.BROWSERITEM_NICENAME_MAP[t])}window.singularBrowserType==An.BROWSERITEM_FULLNAME_MAP[An.COMPOSITION]?(this.browserRef.filterByType(An.COMPOSITION),this.browserRef.config({useDefaultItemDoubleClick:!1,showTypeSelection:!1,showRevisionSelection:window.singularShowRevisions,showSearch:window.singularShowSearch,enableRealtimeUpdate:window.singularEnableRealtimeUpdate,showHeader:window.singularShowHeader,browserTitle:e,onItemDoubleClick:function(e){S().get("/apiv1/compositions/"+e.refId).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading composition: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);parent.postMessage({url:window.singularUrlBase+"apiv1/compositions/"+e.refId,name:a.body.name,event:"_singular_singularapp_compositionbrowser",params:{event:"composition_selected",composition:{name:a.body.name,refId:e.refId,revisionId:e.revisionId,url:window.singularUrlBase+"apiv1/compositions/"+e.refId+"/content"}}},"*")}}.bind(this))}.bind(this)})):window.singularBrowserType==An.BROWSERITEM_FULLNAME_MAP[An.ASSET]?(this.browserRef.filterByType(An.ASSET),this.browserRef.config({useDefaultItemDoubleClick:!1,showTypeSelection:!1,enableRealtimeUpdate:window.singularEnableRealtimeUpdate,browserTitle:e,onItemDoubleClick:function(e){S().get(Rn.appendAccessTokenUrl("/apiv1/mediatoS3/"+e.refId)).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading image: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);parent.postMessage({url:window.singularUrlBase+"apiv1/mediatoS3/"+e.refId,name:a.body.name,event:"_singular_singularapp_imagebrowser",params:{event:"image_selected",image:{name:a.body.name,refId:e.refId,url:a.body.url}}},"*")}}.bind(this))}.bind(this)})):window.singularBrowserType==An.BROWSERITEM_FULLNAME_MAP[An.AUDIO]?(this.browserRef.filterByType(An.AUDIO),this.browserRef.config({useDefaultItemDoubleClick:!1,showTypeSelection:!1,enableRealtimeUpdate:window.singularEnableRealtimeUpdate,browserTitle:e,onItemDoubleClick:function(e){S().get(Rn.appendAccessTokenUrl("/apiv1/audios/"+e.refId)).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading audio: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);parent.postMessage({url:window.singularUrlBase+"apiv1/audios/"+e.refId,name:a.body.name,event:"_singular_singularapp_audiobrowser",params:{event:"audio_selected",audio:{name:a.body.name,refId:e.refId,url:a.body.url}}},"*")}}.bind(this))}.bind(this)})):window.singularBrowserType!=An.APPINSTANCE&&window.singularBrowserType!=An.BROWSERITEM_FULLNAME_MAP[An.APPINSTANCE]||(this.browserRef.filterByType(An.APPINSTANCE),this.browserRef.config({useDefaultItemDoubleClick:!1,showTypeSelection:!1,enableRealtimeUpdate:window.singularEnableRealtimeUpdate,browserTitle:e,onItemDoubleClick:function(e){window.gws||(window.gws=new GWS({onReady:function(e,t){console.log("grabyo is ready",e,t)}})),S().get("/apiv1/appinstances/"+e.refId).set("Content-Type","application/json").end(function(t,a){if(t)console.log("error while reading app: "+t);else{if(a.headers.location)return void(window.location=a.headers.location);window.gws.addWebSource(a.body.onair_url,a.body.name),parent.postMessage({url:window.singularUrlBase+"apiv1/appinstances/"+e.refId,name:a.body.name,event:"_singular_singularapp_appbrowser",params:{event:"app_selected",app:{name:a.body.name,refId:e.refId,url:a.body.onair_url}}},"*")}}.bind(this))}.bind(this)}))},render:function(){return o().createElement("div",{id:"singular-browser"},o().createElement(kt.A,{rtdbFolderRef:this.props.rtdbFolderRef,ref:"browser",showInspector:!1,showNewButton:!0,enableRealtimeUpdate:!1,showHeader:window.singularShowHeader,showSearch:window.singularShowSearch,wrapperStyle:{height:"100%"},browserStyle:"modal"}))}}),Tn=o().createClass({displayName:"OutputListItem",mixins:[D()],getInitialState:function(){return this.currentRenameRequest=null,{user:null,rtDeviceStatus:null,compID:null,appName:null,fetchingData:!1,renameActive:!1,renameBusy:!1}},componentWillMount:function(){},componentDidMount:function(){this.getAdditionalData(this.props.output)},componentWillUpdate:function(e,t){var a=null,i=null;this.props.output&&(a=this.props.output.id,i=this.props.output.appinstance_id);var n=null,s=null;e.output&&(n=e.output.id,s=e.output.appinstance_id),n==a&&i==s||this.getAdditionalData(e.output)},componentWillUnmount:function(){this.getAdditionalDataRequest&&this.getAdditionalDataRequest.abort()},getAdditionalData:function(e){this.getAdditionalDataRequest&&this.getAdditionalDataRequest.abort(),e&&(e.appinstance_id?(this.setState({fetchingData:!0}),this.getAdditionalDataRequest=S().get("/apiv1/app/"+e.appinstance_id).set("Content-Type","application/json").query({access_token:window.singularAccessToken}).end(function(e,t){if(t.headers.location)window.location=t.headers.location;else if(this.getAdditionalDataRequest=null,e)console.log("error while reading app instance data: "+e),this.setState({compID:null,appName:null,fetchingData:!1});else{var a=null;if(t.body.outputs&&t.body.outputs.length){var i=t.body.outputs[0];i.composition&&(a=i.composition.id)}this.setState({compID:a,appName:t.body.name,fetchingData:!1})}}.bind(this))):this.setState({compID:null,appName:null,fetchingData:!1}))},onSelect:function(){this.props.onSelect&&this.props.onSelect(this.props.output)},onOpenOutputURL:function(){this.props.onShowOutputUrlDialog&&this.props.onShowOutputUrlDialog(this.props.output,"url")},onOpenOutputEmbed:function(){this.props.onShowOutputUrlDialog&&this.props.onShowOutputUrlDialog(this.props.output,"embed")},onOpenOutputStatus:function(){this.props.onShowOutputStatusDialog&&this.props.onShowOutputStatusDialog(this.props.output)},onControlApp:function(){this.props.output&&this.props.output.appinstance_id&&window.open("/appinstances/"+this.props.output.appinstance_id+"/control","_blank")},onDelete:function(){this.props.onDelete&&this.props.onDelete(this.props.output)},onRename:function(){this.setState({renameActive:!0})},onRenameExecute:function(e){var t=e.name;this.currentRenameRequest&&this.currentRenameRequest.abort(),this.setState({renameBusy:!0}),this.currentRenameRequest=S().put("/apiv1/devices/"+this.props.output.id+"/metadata").set("Content-Type","application/json").send({name:t}).end(function(e,a){a.headers.location?window.location=a.headers.location:(this.currentRenameRequest=null,e&&console.log("error while renaming output: "+e),this.props.output.name=t,this.setState({renameBusy:!1}))}.bind(this))},onFinishRename:function(){this.setState({renameActive:!1})},onDetachApp:function(){this.props.onDetachApp&&this.props.onDetachApp(this.props.output)},onDoubleClick:function(){this.onOpenOutputURL()},render:function(){var e,t=this.props.output;if(!t)return null;e=t.appinstance_id?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"connected"},"A control app is attached to this device.")},o().createElement("i",{className:"fa fa-wifi job-status active"})):o().createElement("i",{className:"fa job-status inactive"});var a,i,n,s="";this.state.fetchingData?s=o().createElement("img",{style:{height:"40px",width:"40px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}):this.state.appName&&(s=this.state.appName),this.props.output.appinstance_id&&(a=o().createElement("a",{href:"javascript:",onClick:this.onControlApp},"Open Control App")),t.appinstance_id&&(i=o().createElement("a",{href:"javascript:",onClick:this.onDetachApp},"Detach Control App")),(a||i)&&(n=o().createElement("div",{style:{borderTop:"1px solid lightgray"}}));var l,r,c=o().createElement("td",{style:{textAlign:"center"}},o().createElement("div",{className:"btn-group dropdown-white",role:"group"},o().createElement("i",{className:"fa  fa-ellipsis-v","data-toggle":"dropdown",style:{padding:"20px 7px"}}),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{width:"200px"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onOpenOutputStatus},"Status"),o().createElement("a",{href:"javascript:",onClick:this.onOpenOutputURL},"Output URL"),o().createElement("a",{href:"javascript:",onClick:this.onOpenOutputEmbed},"Embed Code"),n,a,i,o().createElement("div",{style:{borderTop:"1px solid lightgray"}}),o().createElement("a",{href:"javascript:",onClick:this.onRename},"Rename"),o().createElement("a",{href:"javascript:",onClick:this.onDelete},"Delete")))));return l=this.state.renameBusy?o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick},o().createElement("img",{style:{height:"40px",width:"40px"},src:"/images/loading-bubbles-blue.svg",className:"loader"})):o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick},o().createElement(P.A,{text:t.name,paramName:"name",className:"",activeClassName:"output-item-edit",editing:this.state.renameActive,change:this.onRenameExecute,cancelEditing:this.onFinishRename,finishEditing:this.onFinishRename,preventDoubleClickEditing:!1})),this.props.usageWarning&&(r=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"You are over your output limit.")},o().createElement("i",{className:"fa fa-warning",style:{color:"#f7531b",fontSize:"15px",top:"1px",position:"relative",left:"4px"}})),this.props.style.backgroundColor="#feece7"),o().createElement("tr",{style:this.props.style},o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick,className:"col-status"},r),o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick,className:"col-status"},e),l,o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick},s),c)}});var Mn=a(9769);const On=o().createClass({displayName:"CreateOutputEditor",getInitialState:function(){return{name:"New Output",createBusy:!1}},shouldComponentUpdate:function(e,t){return!Mn.compareObject(e,this.props)||!Mn.compareObject(t,this.state)},componentWillUnmount:function(){},componentDidMount:function(){},componentWillReceiveProps:function(e){},focusFirstInput:function(){this.refs.firstInput&&setTimeout(function(){this.refs.firstInput.focus(),this.refs.firstInput.select()}.bind(this),500)},onChangeName:function(e){this.setState({name:e.target.value})},onCreate:function(){this.setState({createBusy:!0}),S().post("/apiv1/devices").send({name:this.state.name,type:2}).end(function(e,t){if(e)console.log("Error while creating output ",e);else{if(t.headers.location)return void(window.location=t.headers.location);this.props.onCreate&&this.props.onCreate(t.body)}this.setState({createBusy:!1,name:""})}.bind(this))},onCancel:function(){this.props.onCancel&&this.props.onCancel()},onKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),e.stopPropagation(),e.target.value.trim().length>0&&this.onCreate())},render:function(){var e,t;if(this.state.createBusy)e=o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"47px",margin:"18px"}});else{var a=!0;this.state.name.trim().length>0&&(a=!1),e=o().createElement("button",{className:"btn btn-primary",onClick:this.onCreate,disabled:a},"Create"),t=o().createElement("button",{className:"btn btn-secondary",onClick:this.onCancel,"data-dismiss":"modal","aria-label":"Close"},"Cancel")}return o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.onCancel},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Create Output")),o().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},o().createElement("div",{className:"device-config"},o().createElement("label",{className:"third"},"Name"),o().createElement("input",{className:"form-control align-left select-input",style:{width:"100%"},value:this.state.name,onChange:this.onChangeName,onKeyDown:this.onKeyDown,ref:"firstInput"}))),o().createElement("div",{className:"modal-footer",style:{borderRadius:"0px 0px 5px 5px"}},e,t)))}});a(15286);var Ln=a(9769);const Vn=o().createClass({displayName:"WebOutputStatusDialog",getInitialState:function(){return{appInstanceRequest:null,appInstanceLoading:!1,appInstance:"",deviceRequest:null,deviceLoading:!1,device:"",compositionRequest:null,compositionLoading:!1,composition:"",confirmDetachOutput:!1}},componentWillMount:function(){this.FetchDeviceInfo(this.props.deviceID),this.FetchAppInstanceInfo(this.props.appID)},shouldComponentUpdate:function(e,t){return!Ln.compareObject(e,this.props)||!Ln.compareObject(t,this.state)},componentWillReceiveProps:function(e){this.props.appID!=e.appID?this.FetchAppInstanceInfo(e.appID):this.props.compExtractId!=e.compExtractId&&this.FetchAppInstanceInfo(this.props.appID),this.props.deviceID!=e.deviceID&&this.FetchDeviceInfo(e.deviceID)},FetchAppInstanceInfo:function(e){this.setState({appInstance:null,composition:null}),e&&(this.setState({appInstanceLoading:!0}),this.appInstanceRequest&&this.appInstanceRequest.abort(),this.appInstanceRequest=S().get(Ln.appendAccessTokenUrl("/apiv1/appinstances/"+e)).end(function(t,a){if(t)N.A.add(N.A.TYPE.ERROR,{title:"Failed to load control app info "+e,description:t});else if(a.headers.location)return void(window.location=a.headers.location);var i=a.body;this.setState({appInstance:i,appInstanceLoading:!1}),i&&i.outputs&&i.outputs.length&&i.outputs[0]&&i.outputs[0].composition?this.FetchCompositionInfo(i.outputs[0].composition.id):this.setState({composition:null}),this.appInstanceRequest=null}.bind(this)))},FetchCompositionInfo:function(e){e?(this.setState({compositionLoading:!0}),this.compositionRequest&&this.compositionRequest.abort(),this.compositionRequest=S().post(Ln.appendAccessTokenUrl("/apiv1/browser/items")).send([{refId:e,type:"composition"}]).end(function(e,t){if(e)this.props.onNotification("Failed to fetch composition info","error",5,"tc"),this.setState({composition:null});else if(t.headers.location)return void(window.location=t.headers.location);t.body&&t.body[0]&&this.setState({composition:t.body[0]}),this.setState({compositionLoading:!1}),this.compositionRequest=null}.bind(this))):this.setState({composition:null})},FetchDeviceInfo:function(e){this.setState({device:null}),e&&(this.setState({deviceLoading:!0}),this.deviceRequest&&this.deviceRequest.abort(),this.deviceRequest=S().get(Ln.appendAccessTokenUrl("/apiv1/devices/"+e)).end(function(t,a){if(t)N.A.add(N.A.TYPE.ERROR,{title:"Failed to device info "+e,description:t});else if(a.headers.location)return void(window.location=a.headers.location);this.setState({device:a.body,deviceLoading:!1}),this.deviceRequest=null}.bind(this)))},open:function(){this.refs.OutputUrlDialog&&$(this.refs.OutputUrlDialog).modal("show")},close:function(){this.refs.OutputUrlDialog&&$(this.refs.OutputUrlDialog).modal("hide")},onDetachApp:function(){this.props.onDetachApp&&this.props.onDetachApp(this.state.device)},render:function(){var e,t,a,i=function(e,t,a,i){var n={width:"34px",height:"34px"};return"composition"===i&&e&&(n={width:"34px",height:"34px"}),o().createElement("div",{className:"component-object"},o().createElement(be.A,{imageUrl:e,defaultImageUrl:t,style:n}),o().createElement("div",{className:"component-details"},o().createElement("div",null,a.name),o().createElement("div",{style:{fontSize:"11px"}},a.id)))};this.state.compositionLoading||this.state.appInstanceLoading?e=o().createElement("div",{style:{width:"100%",marginTop:"17%"}},o().createElement("img",{style:{margin:"auto",display:"block"},src:"/images/loading-bubbles-blue.svg",className:"loader"})):(t=this.state.appInstance?i(this.state.appInstance.thumbnail,"/images/default-appInstance-icon.png",this.state.appInstance,"app"):o().createElement("div",{className:"component-object",style:{fontSize:"11px",padding:"0px"}},"No control app assigned to this output"),a=this.state.composition?i(this.state.composition.thumbnail,"/images/default-composition-icon.png",this.state.composition,"composition"):o().createElement("div",{className:"component-object",style:{fontSize:"11px"}},"No composition assigned to this output"),e=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Control Application")),o().createElement("td",null,t)),o().createElement("tr",null,o().createElement("td",null,""),o().createElement("td",{style:{paddingTop:"0px"}},o().createElement("span",{className:"help-text"},"This is the control application that is currently attached to this output."))),o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Composition")),o().createElement("td",null,a)),o().createElement("tr",null,o().createElement("td",null,""),o().createElement("td",{style:{paddingTop:"0px"}},o().createElement("span",{className:"help-text"},"This is the composition that is currently being sent to this output."))))));var n=!0;this.state.appInstance&&(n=!1);var s="Output Status";return this.state.device&&this.state.device.name&&(s="Output Status - "+this.state.device.name),o().createElement("div",{id:"outputDeviceStatus",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog",ref:"OutputUrlDialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},s)),o().createElement("div",{className:"modal-body"},o().createElement("div",{style:{display:"flex",justifyContent:"space-between"}},e)),o().createElement("div",{className:"modal-footer"},o().createElement("button",{className:"btn-detach-device","data-dismiss":"modal",disabled:n,onClick:this.onDetachApp},"Detach Output")))))}});var _n=a(53045),Fn=a(9769);const Bn=o().createClass({displayName:"SearchField",getInitialState:function(){return{searchValue:""}},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!Fn.compareObject(e,this.props)||!Fn.compareObject(t,this.state)},onChange:function(e){this.setState({searchValue:e.target.value}),"immediate"==this.props.mode&&this.props.onSearch&&this.props.onSearch(e.target.value)},onKeyDown:function(e){"Escape"==e.key&&this.clearSearchBox()},onKeyPress:function(e){"Enter"==e.key&&this.props.onSearch&&this.props.onSearch(this.state.searchValue)},clearSearchBox:function(){this.setState({searchValue:""}),this.props.onSearch&&this.props.onSearch("")},render:function(){var e=this.state.searchValue?"fa fa-times":"fa fa-times hidden",t=this.state.searchValue?"fa fa-search hidden":"fa fa-search",a="Search for something ...";return void 0!==this.props.placeholder&&(a=this.props.placeholder),o().createElement("div",{role:"search",className:"navbar-form-custom"},o().createElement("div",{className:"input-group search-wrapper",style:{width:"100%",height:"33px"}},o().createElement("span",{className:"search-icon"},o().createElement("i",{className:t}),o().createElement("i",{className:e,onClick:this.clearSearchBox})),o().createElement("input",{type:"text",placeholder:a,className:"portal-form-control search",name:"top-search",id:"top-search",onChange:this.onChange,onKeyDown:this.onKeyDown,onKeyPress:this.onKeyPress,value:this.state.searchValue,autoComplete:"off"})))}});var Un=a(9769);const Wn=o().createClass({displayName:"OutputManager",mixins:[D()],getInitialState:function(){return this.currentOutputRequest=null,this.accountDevicesSubscribe=null,{outputData:[],outputLoadInProgress:!1,searchValue:"",sortList:"Status",confirmDeleteOutput:!1,outputToDelete:null,selectedOutput:null,confirmDetachOutput:!1,outputToDetach:null}},componentDidMount:function(){this.setState({outputLoadInProgress:!0}),this.loadOutputs()},componentWillUnmount:function(){},loadOutputs:function(){this.currentOutputRequest&&this.currentOutputRequest.abort();var e=null;this.currentOutputRequest=S().get("apiv1/devices?type=2").set("Content-Type","application/json").end(function(t,a){if(a.headers.location)window.location=a.headers.location;else{if(this.currentOutputRequest=null,e=[],t)console.log("error while reading output: "+t),this.setState({outputLoadInProgress:!1});else for(var i=0,n=a.body.length;i<n;i++){var s=a.body[i];2==s.type&&e.push(s)}this.setState({outputData:e,outputLoadInProgress:!1})}}.bind(this))},onSearchChange:function(e){this.setState({searchValue:e})},onNotification:function(e,t,a,i){this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:a,position:i})},showCreateOutputDialog:function(){$("#CreateOutputModal").modal("show"),this.refs.CreateOutputModal.focusFirstInput()},createOutput:function(e){console.log("createOutput"),this.setState({outputLoadInProgress:!0}),this.loadOutputs(null),$("#CreateOutputModal").modal("hide")},onSortList:function(e){this.setState({sortList:e})},sortList:function(e){var t=function(e,t){var a=e.name,i=t.name;return null==a?-1:null==i?1:a==i?0:a.toUpperCase()<i.toUpperCase()?-1:1},a=function(e){return!!e.appinstance_id}.bind(this);e.sort(function(e,i){switch(this.state.sortList){case"Name":default:return t(e,i);case"Status":return a(e)==a(i)?t(e,i):0==a(e)?1:-1;case"Lifetime":return GetLifeTime(e)==GetLifeTime(i)?t(e,i):GetLifeTime(e)<GetLifeTime(i)?-1:1}}.bind(this))},getFilteredAndSortedList:function(){var e=[],t=this.state.searchValue;return t=t?t.toUpperCase():"",this.state.outputData&&this.state.outputData.length>0&&this.state.outputData.map(function(a,i){var n=a.name||"";""!=t&&-1==n.toUpperCase().indexOf(t)||e.push(a)}.bind(this)),this.sortList(e),e},onListElementSelected:function(e,t){},onDelete:function(e){e&&e.id&&this.setState({outputToDelete:e,confirmDeleteOutput:!0})},onDeleteExeute:function(){var e=this.state.outputToDelete,t=this.state.outputData;this.setState({outputData:[],outputLoadInProgress:!0,confirmDeleteOutput:!1,outputToDelete:null}),S().delete("/apiv1/devices/"+e.id).set("Content-Type","application/json").end(function(e,a){a.headers.location?window.location=a.headers.location:e?(console.log("error while deleting output: "+e),this.setState({outputData:t})):this.loadOutputs(null)}.bind(this))},onDetachApp:function(e){e&&e.id&&this.setState({outputToDetach:e,confirmDetachOutput:!0})},onDetachAppExecute:function(){var e=this.state.outputToDetach;this.setState({outputLoadInProgress:!0}),S().delete(Un.appendAccessTokenUrl("/apiv1/devices/"+e.id+"/appinstance")).set("Content-Type","application/json").end(function(e,t){t.headers.location?window.location=t.headers.location:e?(console.log("error while detaching app: "+e),this.setState({outputLoadInProgress:!1})):this.loadOutputs(null)}.bind(this))},onShowOutputUrlDialog:function(e,t){this.setState({selectedOutput:e},this.refs.WebOutputUrlModal.open(t))},onShowOutputStatusDialog:function(e){this.setState({selectedOutput:e},this.refs.WebOutputStatusModal.open)},render:function(){var e,t,a,i=this;if(1==this.state.outputLoadInProgress)e=o().createElement("tr",{key:"busy",style:{backgroundColor:"transparent"}},o().createElement("td",{colSpan:"9"},o().createElement("img",{style:{height:"40px",display:"block",margin:"20px auto"},src:"/images/loading-bubbles-blue.svg",className:"loader"})));else if(this.state.outputData&&0!==this.state.outputData.length){var n=window.singularUser.account.subscription.weboutput_limit;e=this.getFilteredAndSortedList().map(function(e,t){var a=!1;return n<=0&&(a=!0),n--,o().createElement(Tn,{key:e.id,style:{cursor:"pointer"},output:e,usageWarning:a,onSelect:this.onListElementSelected,onDelete:this.onDelete,onDetachApp:this.onDetachApp,onShowOutputUrlDialog:this.onShowOutputUrlDialog,onShowOutputStatusDialog:this.onShowOutputStatusDialog})}.bind(this))}else e=o().createElement("tr",{key:"message",style:{backgroundColor:"white"}},o().createElement("td",{colSpan:"8"},o().createElement("div",{className:"no-info-message"},"There are no outputs defined")));this.state.confirmDeleteOutput&&(t="Are you sure you want to delete output "+this.state.outputToDelete.name+"?"),this.state.confirmDetachOutput&&(a="Are you sure you want to detach the control app from output "+this.state.outputToDetach.name+"?");var s,l,r,c="",d="";if(this.state.selectedOutput){var p=this.state.selectedOutput;s=p.id,l=p.appinstance_id,c=window.singularUrlBase+"devices/"+p.encoded_id,d=p.encoded_id,r="Output URL - "+p.name}return o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{id:"outputManager-wrapper"},o().createElement(Cn,null),o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Output Manager"),o().createElement("div",{className:"right-area"})),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},o().createElement("button",{className:"btn btn-white",onClick:this.showCreateOutputDialog,style:{width:"150px"}},"New")),o().createElement("div",{className:"right-area"},o().createElement(Bn,{mode:"immediate",onSearch:this.onSearchChange}),o().createElement("div",{className:"dropdown-group dropdown-white"},o().createElement("button",{className:"btn btn-white","data-toggle":"dropdown"},o().createElement("i",{className:"fa fa-sort-amount-desc",style:{left:"10px",float:"left"}}),o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"145px"}},this.state.sortList),o().createElement("i",{className:"fa fa-caret-down",style:{right:"10px",left:"auto"}})),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{overflow:"hidden",right:"0px",top:"34px"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onSortList.bind(this,"Name")},"Name")),o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onSortList.bind(this,"Status")},"Status")))))),o().createElement("section",{className:"portal-content"},o().createElement("div",{style:{height:"calc(100% - 70px)",position:"relative",overflowY:"scroll",width:"60%",margin:"auto",top:"5px"}},o().createElement("table",{className:"portal-table",style:{userSelect:"none",fontSize:"14px"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"}}),o().createElement("th",{style:{width:"10%",textAlign:"center"},className:"Status"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"Status")},"Status"),o().createElement("th",{style:{width:"40%"},className:"Name"==this.state.sortList?"sortable sorted":"sortable",onClick:this.onSortList.bind(this,"Name")},"Name"),o().createElement("th",{style:{width:"40%"}},"App Name"),o().createElement("th",{style:{width:"5%",textAlign:"center"}}))),o().createElement("tbody",null,e)))),o().createElement("div",{id:"CreateOutputModal",className:"modal fade u-displaynone singular-modal singular-modal-white ",tabIndex:"-1",role:"dialog"},o().createElement(On,{onCreate:this.createOutput,ref:"CreateOutputModal"})),o().createElement(Vn,{deviceID:s,appID:l,onDetachApp:this.onDetachApp,onNotification:this.onNotification,ref:"WebOutputStatusModal"}),o().createElement("div",{className:"app-header-tools"},o().createElement(_n.A,{url:c,token:d,onNotification:this.onNotification,header:r,ref:"WebOutputUrlModal"})),o().createElement(si(),{show:1==this.state.confirmDeleteOutput,title:"",text:t,showCancelButton:!0,onConfirm:function(){i.setState({confirmDeleteOutput:!1}),i.onDeleteExeute()},onCancel:function(){i.setState({confirmDeleteOutput:!1})},onEscapeKey:function(){i.setState({confirmDeleteOutput:!1})},onOutsideClick:function(){i.setState({confirmDeleteOutput:!1})}}),o().createElement(si(),{show:1==this.state.confirmDetachOutput,title:"",text:a,showCancelButton:!0,onConfirm:function(){i.setState({confirmDetachOutput:!1}),i.onDetachAppExecute()},onCancel:function(){i.setState({confirmDetachOutput:!1})},onEscapeKey:function(){i.setState({confirmDetachOutput:!1})},onOutsideClick:function(){i.setState({confirmDetachOutput:!1})}})))}});var jn=a(7299),Yn=a(9769);const Hn=o().createClass({displayName:"OutputListItem",mixins:[D()],getInitialState:function(){return this.currentRenameRequest=null,{user:null,compID:null,appName:null,fetchingData:!1,renameActive:!1,renameBusy:!1}},componentWillMount:function(){},componentDidMount:function(){},componentWillUpdate:function(e,t){},componentWillUnmount:function(){},onSelect:function(){this.props.onSelect&&this.props.onSelect(this.props.dataStream)},onOpenDataStreamStatus:function(){this.props.onShowDataStreamStatusDialog&&this.props.onShowDataStreamStatusDialog(this.props.dataStream)},onDelete:function(){this.props.onDelete&&this.props.onDelete(this.props.dataStream)},onRename:function(){this.setState({renameActive:!0})},onRenameExecute:function(e){var t=e.name;this.currentRenameRequest&&this.currentRenameRequest.abort(),this.setState({renameBusy:!0}),this.currentRenameRequest=S().put("/apiv1/datastreams/"+this.props.dataStream.id).set("Content-Type","application/json").send({name:t}).end(function(e,a){a.headers.location?window.location=a.headers.location:(this.currentRenameRequest=null,e?this.onNotification("Cannot rename data stream","error",5,"tc"):this.props.dataStream.name=t,this.setState({renameBusy:!1}))}.bind(this))},onFinishRename:function(){this.setState({renameActive:!1})},onDoubleClick:function(){this.onOpenDataStreamStatus()},onCopyClipboard:function(e){this.props.onNotification&&this.props.onNotification(e+" copied to clipboard","success",5,"tc")},render:function(){var e=this.props.dataStream;if(!e)return null;var t,a,i=o().createElement("td",{style:{textAlign:"center"}},o().createElement("div",{className:"btn-group dropdown-white",role:"group"},o().createElement("i",{className:"fa  fa-ellipsis-v","data-toggle":"dropdown",style:{padding:"20px 7px"}}),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{width:"200px"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onOpenDataStreamStatus},"Status"),o().createElement("a",{href:"javascript:",onClick:this.onRename},"Rename"),o().createElement("a",{href:"javascript:",onClick:this.onDelete},"Delete")))));t=this.state.renameBusy?o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick},o().createElement("img",{style:{height:"40px",width:"40px"},src:"/images/loading-bubbles-blue.svg",className:"loader"})):o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick},o().createElement(P.A,{text:e.name,paramName:"name",className:"",activeClassName:"dataStream-item-edit",editing:this.state.renameActive,change:this.onRenameExecute,cancelEditing:this.onFinishRename,finishEditing:this.onFinishRename,preventDoubleClickEditing:!1})),this.props.usageWarning&&(a=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"You are over your data stream limit.")},o().createElement("i",{className:"fa fa-warning",style:{color:"#f7531b",fontSize:"15px",top:"1px",position:"relative",left:"4px"}})),this.props.style.backgroundColor="#feece7");var n={width:"220px",height:"auto",fontSize:"14px",border:"solid 1px #dadada",boxShadow:"none",color:"#808394",borderRadius:"4px",margin:"0px",userSelect:"all",background:"#fff",display:"inline-block"},s=o().createElement("td",{onClick:this.onSelect},o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement("input",{type:"text",className:"form-control v2",style:n,placeholder:"No Token generated",value:e.private_token,disabled:!0}),o().createElement(jn.A,{text:"https://datastream.singular.live/datastreams/"+e.private_token,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"Private Token")},o().createElement("button",{className:"tool-button",style:{fontSize:"12px",lineHeight:"35px",height:"35px",marginLeft:"2px",marginRight:"5px"}},o().createElement("i",{className:"fa fa-clipboard"}))))),l=o().createElement("td",{onClick:this.onSelect},o().createElement("div",{style:{display:"flex",alignItems:"center"}},o().createElement("input",{type:"text",className:"form-control v2",style:n,placeholder:"No Token generated",value:e.public_token,disabled:!0}),o().createElement(jn.A,{text:e.public_token,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"Public Token")},o().createElement("button",{className:"tool-button",style:{fontSize:"12px",lineHeight:"35px",height:"35px",marginLeft:"2px",marginRight:"5px"}},o().createElement("i",{className:"fa fa-clipboard"}))))),r=o().createElement("td",{style:{textAlign:"center"}},Yn.numberWithCommas(this.props.numberOfConnections));return o().createElement("tr",{style:this.props.style},o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick,className:"col-status"},a),o().createElement("td",{onClick:this.onSelect,onDoubleClick:this.onDoubleClick,className:"col-status"},e.id),t,s,l,r,i)}});var zn=a(9769);const Gn=o().createClass({displayName:"CreateDataStreamEditor",getInitialState:function(){return{name:"New Data Stream",createBusy:!1}},shouldComponentUpdate:function(e,t){return!zn.compareObject(e,this.props)||!zn.compareObject(t,this.state)},focusFirstInput:function(){this.refs.firstInput&&setTimeout(function(){this.refs.firstInput.focus(),this.refs.firstInput.select()}.bind(this),500)},onChangeName:function(e){this.setState({name:e.target.value})},onCreate:function(){this.setState({createBusy:!0}),S().post("/apiv1/datastreams").send({name:this.state.name}).end(function(e,t){if(e)this.onNotification("Cannot create data stream","error",5,"tc");else{if(t.headers.location)return void(window.location=t.headers.location);this.props.onCreate&&this.props.onCreate(t.body)}this.setState({createBusy:!1,name:""})}.bind(this))},onCancel:function(){this.props.onCancel&&this.props.onCancel()},onKeyDown:function(e){"Enter"==e.key&&(e.preventDefault(),e.stopPropagation(),e.target.value.trim().length>0&&this.onCreate())},render:function(){var e,t;if(this.state.createBusy)e=o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"47px",margin:"18px"}});else{var a=!0;this.state.name.trim().length>0&&(a=!1),e=o().createElement("button",{className:"btn btn-primary",onClick:this.onCreate,disabled:a},"Create"),t=o().createElement("button",{className:"btn btn-secondary",onClick:this.onCancel,"data-dismiss":"modal","aria-label":"Close"},"Cancel")}return o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.onCancel},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Create Data Stream")),o().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},o().createElement("div",{className:"device-config"},o().createElement("label",{className:"third"},"Name"),o().createElement("input",{className:"form-control align-left select-input",style:{width:"100%"},value:this.state.name,onChange:this.onChangeName,onKeyDown:this.onKeyDown,ref:"firstInput"}))),o().createElement("div",{className:"modal-footer",style:{borderRadius:"0px 0px 5px 5px"}},e,t)))}});var Kn=a(78450),$n=a.n(Kn),qn=a(95093),Jn=a(9769),Xn=a(62418);const Zn=o().createClass({displayName:"DataStreamStatusDialog",getInitialState:function(){return this.generateRequest=null,this.dataStreamID=null,this.updateIntervalHandler=null,{generateBusy:!1,dataStreamStatus:null,dataStreamPayload:null}},componentWillMount:function(){},componentDidMount:function(){var e=this;this.refs.DataStreamDialog&&$(this.refs.DataStreamDialog).on("hide.bs.modal",function(){e.close("modal")})},shouldComponentUpdate:function(e,t){return!Jn.compareObject(e,this.props)||!Jn.compareObject(t,this.state)},componentWillReceiveProps:function(e){},componentWillUnmount:function(){this.releaseAllHandlers()},releaseAllHandlers:function(){this.updateIntervalHandler&&(clearInterval(this.updateIntervalHandler),this.updateIntervalHandler=null),this.generateRequest&&(this.generateRequest.abort(),this.generateRequest=null),this.disconnectFromDataStream(),this.setState({dataStreamStatus:null,dataStreamPayload:null})},onDataStreamReceive:function(e,t){"message"==e&&this.setState({dataStreamPayload:t}),this.setState({dataStreamStatus:e})},connectToDataStream:function(e){this.setState({dataStreamStatus:null,dataStreamPayload:null}),e?this.dataStreamID!=e.id&&(this.dataStreamConnection=Jn.createDataStream(e.public_token,this.onDataStreamReceive,null),this.dataStreamID=e.id):this.disconnectFromDataStream()},disconnectFromDataStream:function(){this.dataStreamConnection&&(this.dataStreamConnection.close(),this.dataStreamConnection=null,this.dataStreamID=null)},open:function(){var e=this;this.setState({dataStreamStatus:null,dataStreamPayload:null}),this.connectToDataStream(this.props.dataStream),this.updateIntervalHandler&&clearInterval(this.updateIntervalHandler),this.updateIntervalHandler=setInterval(function(){e.setState({random:Math.random()})},1e3),this.refs.DataStreamDialog&&$(this.refs.DataStreamDialog).modal("show")},close:function(e){this.releaseAllHandlers(),this.disconnectFromDataStream(),this.refs.DataStreamDialog&&!e&&$(this.refs.DataStreamDialog).modal("hide")},generatePrivateToken:function(){this.generateToken("privatetoken")},generatePublicToken:function(){this.generateToken("publictoken")},generateToken:function(e){var t=this.props.dataStream.id;t&&(this.generateRequest&&this.generateRequest.abort(),this.setState({generateBusy:!0}),this.generateRequest=S().post("/apiv1/datastreams/"+t+"/"+e).end(function(e,t){if(e)this.onNotification("Cannot generate token for data stream","error",5,"tc");else if(t.headers.location)return void(window.location=t.headers.location);this.generateRequest=null,this.props.onReload(),this.setState({generateBusy:!1})}.bind(this)))},onCopyClipboard:function(e){this.props.onNotification&&this.props.onNotification(e+" copied to clipboard","success",5,"tc")},render:function(){var e=this.props.dataStream,t="Data Stream Status";e&&e.name&&(t="Data Stream Status - "+e.name);var a,i,n="Data has never been sent",s=JSON.stringify({});e&&e.payload&&(s=e.payload),this.state.dataStreamPayload&&(s=JSON.stringify(this.state.dataStreamPayload));try{var l=JSON.parse(s);if(l.payload&&(s=Xn.js(JSON.stringify(l.payload),{indent_size:2,indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,jslint_happy:!1,end_with_newline:!0,wrap_line_length:"0",indent_inner_html:!1,comma_first:!1,e4x:!1,indent_empty_lines:!1})),"message"!==this.state.dataStreamStatus)n="";else if(l.ts){var r=qn(l.ts);n=r.format("YYYY-MM-DD HH:mm:ss")+"    "+Jn.millisecondsToString(-r.diff(qn()+$n().ServerDate.getOffset()),"short")+" ago"}}catch(e){}switch(this.state.dataStreamStatus){case"connecting":a=o().createElement("div",null,o().createElement("i",{className:"fa gateway-status fa-circle pending",style:{padding:"5px"}}),"Connecting");break;case"open":case"message":a=o().createElement("div",null,o().createElement("i",{className:"fa gateway-status fa-circle active",style:{padding:"5px"}}),"Connected");break;case"error":a=o().createElement("div",null,o().createElement("i",{className:"fa gateway-status fa-exclamation-circle error",style:{padding:"5px"}}),"Cannot connect to data stream");break;default:a=o().createElement("div",null,o().createElement("i",{className:"fa gateway-status fa-circle inactive",style:{padding:"5px"}}),"Not connected")}i=1==this.props.numberOfConnections?"1 connection active":Jn.numberWithCommas(this.props.numberOfConnections)+" connections active";var c,d,p=o().createElement("div",{style:{display:"flex",flexDirection:"row",top:"3px",position:"relative",alignItems:"center",color:"rgb(154, 154, 154)"}},o().createElement("input",{type:"text",className:"form-control v2",style:{width:"300px",position:"relative",top:"3px"},value:n,disabled:!0}),a,o().createElement("div",{style:{flexGrow:"1",textAlign:"right"}},i));return c=!e||this.props.busy||this.state.generateBusy?o().createElement("img",{style:{height:"44px",width:"300px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}):o().createElement("div",{style:{top:"3px",position:"relative"}},o().createElement("input",{type:"text",className:"form-control v2",style:{width:"300px",display:"inline-block"},placeholder:"No Token generated",value:e.private_token,disabled:!0}),o().createElement("div",{className:"input-group-btn",style:{fontSize:"12px",display:"inline-block"}},o().createElement(jn.A,{text:e.private_token,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"Private Token")},o().createElement("button",{className:"tool-button"},o().createElement("i",{className:"fa fa-clipboard"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"regenerate"},"Generate token")},o().createElement("button",{tabIndex:"-1",onClick:this.generatePrivateToken,className:"tool-button"},o().createElement("i",{className:"fa fa-refresh fa-lg"}))))),d=!e||this.props.busy||this.state.generateBusy?o().createElement("img",{style:{height:"44px",width:"300px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}):o().createElement("div",{style:{top:"3px",position:"relative"}},o().createElement("input",{type:"text",className:"form-control v2",style:{width:"300px",display:"inline-block"},placeholder:"No Token generated",value:e.public_token,disabled:!0}),o().createElement("div",{className:"input-group-btn",style:{fontSize:"12px",display:"inline-block"}},o().createElement(jn.A,{text:e.public_token,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"Public Token")},o().createElement("button",{className:"tool-button"},o().createElement("i",{className:"fa fa-clipboard"}))),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"regenerate"},"Generate token")},o().createElement("button",{tabIndex:"-1",onClick:this.generatePublicToken,className:"tool-button"},o().createElement("i",{className:"fa fa-refresh fa-lg"}))))),o().createElement("div",{id:"dataStreamStatus",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog",ref:"DataStreamDialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{maxWidth:"90%",width:"1300px"}},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},t)),o().createElement("div",{className:"modal-body"},o().createElement("div",null,o().createElement("table",{style:{width:"100%"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"15%"}}),o().createElement("th",{style:{width:"85%"}}))),o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Private Token"),o().createElement("td",null,c)),o().createElement("tr",null,o().createElement("td",null),o().createElement("td",null,o().createElement("div",{style:{fontSize:"12px",color:"rgb(154, 154, 154)",position:"relative",top:"-3px",marginBottom:"5px"}},"Use the private token to send data to the stream. For more information about the REST API click"," ",o().createElement("a",{target:"_blank",href:"https://api.singular.live/#59563b90-8f36-453e-9f14-ee71d05813ff"},"here")))),o().createElement("tr",null,o().createElement("td",null,"Public Token"),o().createElement("td",null,d)),o().createElement("tr",null,o().createElement("td",null),o().createElement("td",null,o().createElement("div",{style:{fontSize:"12px",color:"rgb(154, 154, 154)",position:"relative",top:"-3px",marginBottom:"5px"}},"Use the public token to receive the data in the composition script. For more information click"," ",o().createElement("a",{target:"_blank",href:"https://support.singular.live/hc/en-us/articles/360058676471-Data-Streams"},"here")))),o().createElement("tr",{style:{height:"50px"}},o().createElement("td",null,o().createElement("div",{style:{position:"relative",top:"3px"}},"Last update")),o().createElement("td",null,p)),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"top"}},"Current Payload"),o().createElement("td",null,o().createElement("div",{style:{height:"500px",width:"100%"}},o().createElement(ea.A,{name:"dataStreamJson",id:"DataStream",className:"widget-version-json",width:"100%",height:"100%",value:s,disabled:!0,theme:"light"})))))))))))}}),Qn=o().createClass({displayName:"DataStreamManager",mixins:[D()],getInitialState:function(){return this.currentDataStreamRequest=null,this.currentDataStreamConnectionRequest=null,this.dataStreamConnectionInterval=null,{dataStreamData:[],dataStreamLoadInProgress:!1,dataStreamConnections:[],searchValue:"",sortList:"ID",confirmDeleteDataStream:!1,dataStreamToDelete:null,selectedDataStream:null}},componentDidMount:function(){var e=this;this.loadDataStreams(),this.dataStreamConnectionInterval=setInterval(function(){e.fetchDataStreamConnections()},5e3),this.fetchDataStreamConnections()},componentWillUnmount:function(){this.currentDataStreamRequest&&this.currentDataStreamRequest.abort(),this.currentDataStreamConnectionRequest&&this.currentDataStreamConnectionRequest.abort()},fetchDataStreamConnections:function(){this.currentDataStreamConnectionRequest&&this.currentDataStreamConnectionRequest.abort(),this.currentDataStreamConnectionRequest=S().get("apiv1/datastreams/clients").set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{this.currentDataStreamConnectionRequest=null;var a=[];e?(this.onNotification("Cannot read data stream connections","error",5,"tc"),this.setState({dataStreamLoadInProgress:!1})):a=t.body,this.setState({dataStreamConnections:a})}}.bind(this))},loadDataStreams:function(){this.setState({dataStreamLoadInProgress:!0}),this.currentDataStreamRequest&&this.currentDataStreamRequest.abort(),this.currentDataStreamRequest=S().get("apiv1/datastreams").set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{this.currentDataStreamRequest=null;var a=[];e?(this.onNotification("Cannot read data streams","error",5,"tc"),this.setState({dataStreamLoadInProgress:!1})):a=t.body;var i=this.state.selectedDataStream;i&&(i=a.find(function(e){if(i.id==e.id)return e})),this.setState({dataStreamData:a,selectedDataStream:i,dataStreamLoadInProgress:!1})}}.bind(this))},onSearchChange:function(e){this.setState({searchValue:e})},onNotification:function(e,t,a,i){this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:a,position:i})},showCreateDataStreamDialog:function(){$("#CreateDataStreamModal").modal("show"),this.refs.CreateDataStreamModal.focusFirstInput()},createDataStream:function(){this.setState({dataStreamLoadInProgress:!0}),this.loadDataStreams(),$("#CreateDataStreamModal").modal("hide")},onSortList:function(e){this.setState({sortList:e})},sortList:function(e){var t=function(e,t){var a=e.id,i=t.id;return null==a?-1:null==i?1:a==i?0:a<i?-1:1},a=function(e,a){var i=e.name,n=a.name;return null==i?-1:null==n?1:i==n?t(e,a):i.toUpperCase()<n.toUpperCase()?-1:1},i=function(e,t){var i=this.getNumberOfConnections(e),n=this.getNumberOfConnections(t);return null==i?-1:null==n?1:i==n?a(e,t):i>n?-1:1}.bind(this);e.sort(function(e,n){switch(this.state.sortList){case"Name":default:return a(e,n);case"ID":return t(e,n);case"Connected":return i(e,n)}}.bind(this))},getFilteredAndSortedList:function(){var e=[],t=this.state.searchValue;return t=t?t.toUpperCase():"",this.state.dataStreamData&&this.state.dataStreamData.length>0&&this.state.dataStreamData.map(function(a){if(""!=t){var i=a.name||"",n=a.private_token||"",s=a.public_token||"";if(a.id!=t&&-1==i.toUpperCase().indexOf(t)&&-1==n.toUpperCase().indexOf(t)&&-1==s.toUpperCase().indexOf(t))return}e.push(a)}.bind(this)),this.sortList(e),e},onDelete:function(e){e&&e.id&&this.setState({dataStreamToDelete:e,confirmDeleteDataStream:!0})},onDeleteExecute:function(){var e=this.state.dataStreamToDelete;this.setState({dataStreamLoadInProgress:!0,confirmDeleteDataStream:!1,dataStreamToDelete:null}),S().delete("/apiv1/datastreams/"+e.id).set("Content-Type","application/json").end(function(e,t){t.headers.location?window.location=t.headers.location:(e&&this.onNotification("Cannot delete data stream","error",5,"tc"),this.loadDataStreams())}.bind(this))},onShowDataStreamStatusDialog:function(e){this.setState({selectedDataStream:e},this.refs.DataStreamStatusModal.open)},getNumberOfConnections:function(e){var t=0;return e&&this.state.dataStreamConnections&&void 0!==this.state.dataStreamConnections[e.public_token]&&(t=this.state.dataStreamConnections[e.public_token]),t},render:function(){var e,t,a=this;if(1==this.state.dataStreamLoadInProgress)e=o().createElement("tr",{key:"busy",style:{backgroundColor:"transparent"}},o().createElement("td",{colSpan:"9"},o().createElement("img",{style:{height:"40px",display:"block",margin:"20px auto"},src:"/images/loading-bubbles-blue.svg",className:"loader"})));else if(this.state.dataStreamData&&0!==this.state.dataStreamData.length){var i=999999999;e=this.getFilteredAndSortedList().map(function(e,t){var a=!1;return i<=0&&(a=!0),i--,o().createElement(Hn,{key:e.id,style:{cursor:"pointer"},dataStream:e,numberOfConnections:this.getNumberOfConnections(e),usageWarning:a,onDelete:this.onDelete,onShowDataStreamStatusDialog:this.onShowDataStreamStatusDialog,onNotification:this.onNotification})}.bind(this))}else e=o().createElement("tr",{key:"message",style:{backgroundColor:"white"}},o().createElement("td",{colSpan:"8"},o().createElement("div",{className:"no-info-message"},"There are no data streams defined")));return this.state.confirmDeleteDataStream&&(t="Are you sure you want to delete data stream "+this.state.dataStreamToDelete.name+"?"),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{id:"dataStreamManager-wrapper"},o().createElement(Cn,null),o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Data Streams"),o().createElement("div",{className:"right-area"})),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},o().createElement("button",{className:"btn btn-white",onClick:this.showCreateDataStreamDialog,style:{width:"150px"}},"New")),o().createElement("div",{className:"right-area"},o().createElement(Bn,{mode:"immediate",onSearch:this.onSearchChange}),o().createElement("div",{className:"dropdown-group dropdown-white"},o().createElement("button",{className:"btn btn-white","data-toggle":"dropdown"},o().createElement("i",{className:"fa fa-sort-amount-desc",style:{left:"10px",float:"left"}}),o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"145px"}},this.state.sortList),o().createElement("i",{className:"fa fa-caret-down",style:{right:"10px",left:"auto"}})),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{overflow:"hidden"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onSortList.bind(this,"ID")},"ID")),o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onSortList.bind(this,"Name")},"Name")),o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.onSortList.bind(this,"Connected")},"Connected")))))),o().createElement("section",{className:"portal-content"},o().createElement("div",{style:{height:"calc(100% - 70px)",position:"relative",overflowY:"scroll",maxWidth:"90%",margin:"auto",top:"5px",width:"1500px"}},o().createElement("table",{className:"portal-table",style:{userSelect:"none",fontSize:"14px"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"}}),o().createElement("th",{style:{width:"5%",textAlign:"center"},className:"ID"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"ID")},"ID"),o().createElement("th",{style:{width:"25%"},className:"Name"==this.state.sortList?"sortable sorted":"sortable",onClick:this.onSortList.bind(this,"Name")},"Name"),o().createElement("th",{style:{width:"25%"}},"Private Token"),o().createElement("th",{style:{width:"25%"}},"Public Token"),o().createElement("th",{style:{width:"10%",textAlign:"center"},className:"Connected"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"Connected")},"# connected"),o().createElement("th",{style:{width:"5%",textAlign:"center"}}))),o().createElement("tbody",null,e)))),o().createElement("div",{id:"CreateDataStreamModal",className:"modal fade u-displaynone singular-modal singular-modal-white ",tabIndex:"-1",role:"dialog"},o().createElement(Gn,{onCreate:this.createDataStream,onNotification:this.onNotification,ref:"CreateDataStreamModal"})),o().createElement(Zn,{dataStream:this.state.selectedDataStream,numberOfConnections:this.getNumberOfConnections(this.state.selectedDataStream),onNotification:this.onNotification,onReload:this.loadDataStreams,busy:this.state.dataStreamLoadInProgress,ref:"DataStreamStatusModal"}),o().createElement(si(),{show:1==this.state.confirmDeleteDataStream,title:"",text:t,showCancelButton:!0,onConfirm:function(){a.setState({confirmDeleteDataStream:!1}),a.onDeleteExecute()},onCancel:function(){a.setState({confirmDeleteDataStream:!1})},onEscapeKey:function(){a.setState({confirmDeleteDataStream:!1})},onOutsideClick:function(){a.setState({confirmDeleteDataStream:!1})}})))}}),es=o().createClass({displayName:"WidgetVersion",getInitialState:function(){return{widgetJson:"{}",left:0,top:0,width:50,height:50,supportCustomAnimation:!1,supportInteractivity:!1,helpEnabled:!1,helpUrl:"",saveActive:!1}},componentWillMount:function(){this.setState({widgetJson:this.props.version.widgetJson,left:this.props.version.left,top:this.props.version.top,width:this.props.version.width,height:this.props.version.height,supportCustomAnimation:this.props.version.supportCustomAnimation,supportInteractivity:this.props.version.supportInteractivity,helpEnabled:this.props.version.helpEnabled,helpUrl:this.props.version.helpUrl})},componentWillReceiveProps:function(e){},saveVersion:function(){if(this.state.widgetJson!=this.props.version.widgetJson||this.state.left!=this.props.version.left||this.state.top!=this.props.version.top||this.state.width!=this.props.version.width||this.state.height!=this.props.version.height||this.state.supportCustomAnimation!=this.props.version.supportCustomAnimation||this.state.supportInteractivity!=this.props.version.supportInteractivity||this.state.helpEnabled!=this.props.version.helpEnabled||this.state.helpUrl!=this.props.version.helpUrl){var e={widgetJson:this.state.widgetJson,left:this.state.left,top:this.state.top,width:this.state.width,height:this.state.height,supportCustomAnimation:this.state.supportCustomAnimation,supportInteractivity:this.state.supportInteractivity,helpEnabled:this.state.helpEnabled,helpUrl:this.state.helpUrl};this.setState({saveActive:!0}),S().put("/widgets/"+this.props.version.widget_id+"/versions/"+this.props.version.version+"/metadata").send(e).end(function(e,t){if(this.setState({saveActive:!1}),e)N.A.add(N.A.TYPE.ERROR,{title:"Save Widget ID "+this.props.version.widget_id,description:e});else{if(t.headers.location)return void(window.location=t.headers.location);this.props.rebuildParentCallback&&this.props.rebuildParentCallback()}}.bind(this))}},ValueChanged:function(e,t){var a={};a[e]=t,this.setState(a)},handler:function(e){this.setState({widgetJson:e})},render:function(){var e,t=!0;if("development"==this.props.version.status&&(t=!1),1==this.state.saveActive)e=o().createElement("div",{className:"panel-body"},o().createElement("div",{className:"row browser-tree component-tree font-tree",style:{width:"100%",height:"100%"}},o().createElement("img",{style:{display:"block",margin:"0 auto"},src:"/images/loading-bubbles-blue.svg",className:"loader"})));else{var a="";this.state.helpUrl&&(a=this.state.helpUrl),e=o().createElement("div",null,o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"UI Definition for Version #",this.props.version.version," (",this.props.version.status,")"),o().createElement("div",{className:"group-body"},o().createElement(ea.A,{name:"widgetJson",id:"WV"+this.props.version.id,className:"widget-version-json",value:this.state.widgetJson,onValueChanged:this.ValueChanged,onSave:this.saveVersion,disabled:t,theme:"light"}))),o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"Default Properties"),o().createElement("div",{className:"group-body"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"2",style:{verticalAlign:"middle",textAlign:"left"}},"Transformation")),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle"}},"Left"),o().createElement("td",null,o().createElement(te.A,{name:"left",resetValue:"0.0",step:"1",format:"0.0",min:"0.0",max:"100.0",value:this.state.left,unit:"%",onValueChanged:this.ValueChanged,disabled:t,theme:"light"})),o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},"Top"),o().createElement("td",null,o().createElement(te.A,{name:"top",resetValue:"0.0",step:"1",format:"0.0",min:"0.0",max:"100.0",value:this.state.top,unit:"%",onValueChanged:this.ValueChanged,disabled:t,theme:"light"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle"}},"Width"),o().createElement("td",null,o().createElement(te.A,{name:"width",resetValue:"50.0",step:"1",format:"0.0",min:"0.0",max:"100.0",value:this.state.width,unit:"%",onValueChanged:this.ValueChanged,disabled:t,theme:"light"})),o().createElement("td",{style:{verticalAlign:"middle"}},"Height"),o().createElement("td",null,o().createElement(te.A,{name:"height",resetValue:"50.0",step:"1",format:"0.0",min:"0.0",max:"100.0",value:this.state.height,unit:"%",onValueChanged:this.ValueChanged,disabled:t,theme:"light"})))))),o().createElement("div",{className:"group-body"},o().createElement("table",{className:""},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},"Custom State Animation"),o().createElement("td",null,o().createElement(se.A,{name:"supportCustomAnimation",defaultValue:!1,value:this.state.supportCustomAnimation,disabled:t,onValueChanged:this.ValueChanged,theme:"light"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},"Interactive"),o().createElement("td",null,o().createElement(se.A,{name:"supportInteractivity",defaultValue:!1,value:this.state.supportInteractivity,disabled:t,onValueChanged:this.ValueChanged,theme:"light"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},"Help"),o().createElement("td",null,o().createElement(se.A,{name:"helpEnabled",defaultValue:!1,value:this.state.helpEnabled,disabled:t,onValueChanged:this.ValueChanged,theme:"light"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle"}},"URL"),o().createElement("td",null,o().createElement(lt.A,{name:"helpUrl",defaultValue:"",value:a,width:"500px",disabled:t||!this.state.helpEnabled,onValueChanged:this.ValueChanged,theme:"light"}))))))))}return o().createElement("div",null,e)}});var ts=a(68204),as=a.n(ts),is=a(9769),ns=a(82465);const ss=o().createClass({displayName:"WidgetInfo",getInitialState:function(){return this.widgetVersionHandler=null,this.shareAccountHandler=null,this.scShareToPreviousInputValue="",this.scShareToCurrentInputValue="",{deploykey:"",versions:[],selectedVersion:null,showBusyIcon:!1,showBusyShare:!0,shareAccounts:[],originalAccounts:[]}},componentWillMount:function(){this.getVersions(),this.props.widget.deploykey&&this.setState({deploykey:this.props.widget.deploykey})},componentDidMount:function(){this.readShareAccounts()},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},componentWillUnmount:function(){this.widgetVersionHandler&&this.widgetVersionHandler.abort(),this.shareAccountHandler&&this.shareAccountHandler.abort()},getVersions:function(){this.setState({showBusyIcon:!0}),this.widgetVersionHandler=S().get("/widgets/"+this.props.widget.id+"/versions").set("Content-Type","application/json").end(function(e,t){var a=[],i=-1;if(this.state.selectedVersion&&(i=this.state.selectedVersion.version),e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot get widget version info",description:e.message}),this.props.notificationSys.addNotification({message:"Cannot get widget version info",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);a=t.body}a.sort(function(e,t){return Number(t.version)-Number(e.version)});var n=null;if(a.length>0){-1==i&&(n=a[0]);for(var s=0;s<a.length;s++)if(a[s].version==i){n=a[s];break}}this.setState({versions:a,selectedVersion:n,showBusyIcon:!1}),this.widgetVersionHandler=null}.bind(this))},regenerateKey:function(){this.setState({deploykey:"Regenerating key..."}),S().post("/widgets/"+this.props.widget.id+"/regeneratekey").end(function(e,t){if(e){var a="Unknown Error";try{a=JSON.parse(e.response.text).error.message}catch(e){}this.setState({deploykey:a}),this.props.notificationSys.addNotification({message:a,level:"error",autoDismiss:5,position:"tc"})}else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({deploykey:t.body}),this.props.widget.deploykey=t.body}}.bind(this))},ValueChanged:function(){this.props.onNotifyChange&&this.props.onNotifyChange()},saveWidget:function(e){if(this.refs.widgetName.value!=this.props.widget.name||this.refs.widgetCategory.value!=this.props.widget.category){var t={name:this.refs.widgetName.value,category:this.refs.widgetCategory.value,access:"public"};S().put("/widgets/"+this.props.widget.id+"/edit").send(t).end(function(t,a){if(t){var i="Unknown Error";try{i=JSON.parse(t.response.text).error.message}catch(e){}console.log(i),this.props.notificationSys.addNotification({message:i,level:"error",autoDismiss:5,position:"tc"})}else{if(a.headers.location)return void(window.location=a.headers.location);this.props.notificationSys.addNotification({message:"The widget has been saved",level:"success",autoDismiss:5,position:"tc"}),e&&e()}}.bind(this))}if(this.state.shareAccounts.length||this.state.originalAccounts.length){for(var a=this.state.shareAccounts.slice(),i=0;i<a.length;)"invalid"!=a[i].className?i++:a.splice(i,1);this.setState({originalAccounts:a,shareAccounts:a});for(var n=[],s=0;s<a.length;s++)n.push(a[s].label);S().post("/apiv1/widgets/"+this.props.widget.id+"/share").send({targetAccountNames:n}).set("Content-Type","application/x-www-form-urlencoded").end(function(e,t){e&&(N.A.add(N.A.TYPE.ERROR,{title:"Cannot share widget "+this.props.widget.id+" with accounts "+n.string(),description:e.message}),this.props.notificationSys.addNotification({message:"Cannot widget "+this.props.widget.id+" with account "+n.string(),level:"error",autoDismiss:5,position:"tc"})),this.readShareAccounts()}.bind(this))}this.state.selectedVersion&&"development"==this.state.selectedVersion.status&&this.refs.WidgetVersion.saveVersion()},changeVersionStatus:function(e,t){this.setState({showBusyIcon:!0}),S().put("/widgets/"+e.widget_id+"/versions/"+e.version+"/status").send({status:t}).end(function(e,t){if(e){var a="Unknown Error";try{a=JSON.parse(e.response.text).error.message}catch(e){}console.log(a),this.setState({showBusyIcon:!1})}else{if(t.headers.location)return void(window.location=t.headers.location);this.getVersions()}}.bind(this))},selectVersion:function(e){this.setState({selectedVersion:e})},onShareAccountInputChange:function(e){return this.scShareToPreviousInputValue=this.scShareToCurrentInputValue,this.scShareToCurrentInputValue=e,e},onShareAccountBlur:function(e){var t=e.target.value;if(""==t&&""!=this.scShareToPreviousInputValue&&""==this.scShareToCurrentInputValue&&(t=this.scShareToPreviousInputValue),t){var a=this.state.shareAccounts.slice();a.push({className:"Select-create-option-placeholder",label:t,value:-1}),this.onShareAccountChange(a)}},onShareAccountChange:function(e){var t=this;this.setState({showBusyShare:!0});var a=[];this.scShareToPreviousInputValue="",this.scShareToCurrentInputValue="";for(var i=e.length,n=function(){if("Select-create-option-placeholder"==e[s].className){var n=e[s].label;S().post("/apiv1/accounts/availablename").set("Content-Type","application/json").send({name:n}).end(function(e,t){if(e)this.props.notificationSys.addNotification({message:"Cannot get account information",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);!1===t.body.result?a.push({className:"valid",label:n,value:n}):a.push({className:"invalid",label:n,value:"Invalid-"+Math.random()})}this.setState({shareAccounts:a}),0==--i&&this.setState({showBusyShare:!1})}.bind(t))}else a.push(e[s]),i--},s=0;s<e.length;s++)n();this.setState({shareAccounts:a}),0==i&&this.setState({showBusyShare:!1})},readShareAccounts:function(){this.setState({showBusyShare:!0}),this.shareAccountHandler&&this.shareAccountHandler.abort(),this.shareAccountHandler=S().get("/apiv1/widgets/"+this.props.widget.id+"/share").end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot get share account information for widget ID "+this.props.widget.id,description:e.message});else{for(var a=t.body,i=[],n=0,s=a.length;n<s;n++)i.push({className:"valid",label:a[n].target_account_name,value:a[n].target_account_name});this.setState({shareAccounts:i,originalAccounts:i,showBusyShare:!1})}this.shareAccountHandler=null}.bind(this))},render:function(){var e,t,a=function(e){var t,a="version-status-label",i="",n="";return this.state.selectedVersion&&this.state.selectedVersion==e&&(i="active",n="selectedDomElement"),"development"==e.status?(a+=" development",t=o().createElement("div",null,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"publish"},"Publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-upload",onClick:this.changeVersionStatus.bind(this,e,"published")})))):"archived"==e.status?(a+=" archived",t=o().createElement("div",null,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"publish"},"Publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-upload",onClick:this.changeVersionStatus.bind(this,e,"published")})),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"deprecate"},"Deprecate")},o().createElement("btn",{className:"btn btn-white v2 fa fa-ban",onClick:this.changeVersionStatus.bind(this,e,"deprecated")})))):"deprecated"==e.status?(a+=" deprecated",t=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"archive"},"Archive")},o().createElement("btn",{className:"btn btn-white v2 fa fa-archive",onClick:this.changeVersionStatus.bind(this,e,"archived")}))):"published"==e.status&&(a+=" published",t=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"un-publish"},"Un-publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-eye-slash",onClick:this.changeVersionStatus.bind(this,e,"archived")}))),o().createElement("tr",{key:e.id,className:i,style:void 0,ref:n},o().createElement("td",{className:a},""),o().createElement("td",{className:"version-icon",style:{cursor:"pointer"},onMouseDown:this.selectVersion.bind(this,e)},o().createElement(ve.A,{src:e.thumbnail,fallbackImage:is.getDefaultIconFromBrowserShortType(ns.WIDGET),initialImage:"/images/loading-bubbles-blue.svg"})),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle",textAlign:"center"},onMouseDown:this.selectVersion.bind(this,e)},e.version),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},e.status),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},ge()(e.updated_at).format("YYYY-MM-DD HH:mm:ss")),o().createElement("td",{style:{verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},t))}.bind(this),i=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{className:"version-status"},""),o().createElement("th",{style:{textAlign:"left",width:"10%"}}),o().createElement("th",{style:{textAlign:"left",width:"5%"}},"Version"),o().createElement("th",{style:{textAlign:"left",width:"15%"}},"Status"),o().createElement("th",{style:{textAlign:"left",width:"30%"}},"Date Modified"),o().createElement("th",{style:{textAlign:"left",width:"30%"}},"Action")));e=this.state.showBusyIcon?o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},i,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))))):o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},i,o().createElement("tbody",null,this.state.versions.map(a))),this.state.selectedVersion&&0==this.state.showBusyIcon&&(t=o().createElement(es,{key:this.props.widget.id+"_"+this.state.selectedVersion.id,version:this.state.selectedVersion,rebuildParentCallback:this.getVersions,onNotifyChange:this.props.onNotifyChange,ref:"WidgetVersion"}));var n=o().createElement("td",{className:this.state.showBusyShare?"validating":"",style:{position:"relative"}},o().createElement(as().Creatable,{className:"singularSelect creatable white",multi:!0,backspaceToRemoveMessage:"",onChange:this.onShareAccountChange,onBlur:this.onShareAccountBlur,onInputChange:this.onShareAccountInputChange,value:this.state.shareAccounts,placeholder:"Enter account name",arrowRenderer:function(){},menuRenderer:function(){},disabled:this.state.showBusyShare}),o().createElement("img",{src:"/images/loading-oval-blue.svg",className:"loader-oval"}));return o().createElement("div",{className:"widget-detail-body",style:{textShadow:"none"}},o().createElement("div",{className:"left-panel"},o().createElement("div",{className:"property-group",style:{width:"100%"}},o().createElement("div",{className:"group-title"},"Widget Details"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"",style:{maxWidth:"700px"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",width:"15%"}},o().createElement("div",{className:"singular-text-label"},"Deploy Key")),o().createElement("td",{style:{width:"85%"}},o().createElement("div",{className:"input-group",style:{width:"100%"}},o().createElement("input",{type:"text",className:"form-control v2",id:"deploykey",name:"deploykey",value:this.state.deploykey,disabled:!0}),o().createElement("span",{className:"input-group-btn"},o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":this.state.deploykey,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard fa-lg"})),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"regenerate"},"Regenerate")},o().createElement("button",{tabIndex:"-1",onClick:this.regenerateKey,className:"btn btn-white  icon-only"},o().createElement("i",{className:"fa fa-refresh fa-lg"}))))))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"ID")),o().createElement("td",null,o().createElement("div",{style:{textAlign:"left"},className:"singular-text-label"},this.props.widget.id))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Name")),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",id:"name",name:"name",defaultValue:this.props.widget.name,onChange:this.ValueChanged,ref:"widgetName"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Category")),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",id:"category",name:"category",defaultValue:this.props.widget.category,onChange:this.ValueChanged,ref:"widgetCategory"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Shared with")),n))))),o().createElement("div",{className:"widget-versions"},e)),o().createElement("div",{className:"right-panel"},o().createElement("div",{className:"widget-ui"},t)))}});a(90106);const os=o().createClass({displayName:"ApplicationToolbar",getInitialState:function(){this.sortAlphaCallback=null,this.layoutCallback=null,this.infoCallback=null;var e="Save (Ctrl + S)";return navigator.platform.toUpperCase().indexOf("MAC")>=0&&(e="Save (CMD + S)"),{sortAlphaMode:"AlphaAscending",layoutMode:"Grid",infoActive:!1,saveShortcut:e}},componentDidMount:function(){},SortAlphaClicked:function(e){this.setState({sortAlphaMode:e}),this.sortAlphaCallback&&this.sortAlphaCallback(e)},LayoutClicked:function(e){this.setState({layoutMode:e}),this.layoutCallback&&this.layoutCallback(e)},ToggleInfo:function(e){this.setState({infoActive:e}),this.infoCallback&&this.infoCallback(e)},render:function(){var e=function(e,t){if(null==e.type)return null;var a,i=!1;switch(e.disabled&&(i=!0),e.type){case"AddUser":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddUser"},"Add User")},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-user-plus fa-lg"})));case"InviteUser":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"InviteUser"},"Invite User")},o().createElement("button",{className:"btn btn-white",style:{width:"100px"},tabIndex:"-1",onClick:e.callback,disabled:i},"Invite User"));case"AddUserSSO":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"InviteUser"},"Add single sign-on user")},o().createElement("button",{className:"btn btn-white",style:{width:"100px"},tabIndex:"-1",onClick:e.callback,disabled:i},"Add SSO User"));case"AddWidget":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddWidget"},"Add Widget")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-plus-circle fa-lg"})));case"AddAppTemplate":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddAppTemplate"},"Add App")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-plus-circle fa-lg"})));case"AddAccount":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddAccount"},"Add Account")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-plus-circle fa-lg"})));case"Save":switch(e.state){case"Armed":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Save"},this.state.saveShortcut)},o().createElement("button",{className:"btn btn-white icon-only armed",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-save fa-lg"})));case"Busy":return o().createElement("button",{key:t,className:"btn btn-white icon-only",tabIndex:"-1"},o().createElement("i",{className:"fa fa-spinner fa-lg"}));default:return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Save"},this.state.saveShortcut)},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-save fa-lg"})))}case"Duplicate":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Duplicate"},"Duplicate")},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-copy fa-lg"})));case"Delete":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"Delete"},"Delete")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-trash fa-lg"})));case"SortAlpha":var n;n=null==e.mode?this.state.sortAlphaMode:e.mode,this.sortAlphaCallback=e.callback,"AlphaDescending"===n?(r="AlphaAscending",a="fa fa-sort-alpha-desc fa-lg",d="Sort alphabetically descending"):(r="AlphaDescending",a="fa fa-sort-alpha-asc fa-lg",d="Sort alphabetically ascending");var s=o().createElement(z(),{id:"Sort"},d);return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:s},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:this.SortAlphaClicked.bind(this,r),disabled:i},o().createElement("i",{className:a})));case"Divider":return o().createElement("div",{key:t,className:"dash-divider",disabled:i});case"Info":var l;return a="dash-button",(l=null==e.active?this.state.infoActive:e.active)&&(a="dash-button active"),this.infoCallback=e.callback,o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"ToggleInspector"},"Toggle Inspector")},o().createElement("div",{className:a,tabIndex:"-1",onClick:this.ToggleInfo.bind(this,!l),disabled:i},o().createElement("i",{className:"fa fa-info-circle fa-lg"})));case"Layout":var r,c,d;return c=null==e.mode?this.state.layoutMode:e.lmode,this.layoutCallback=e.callback,"List"===c?(r="Grid",a="fa fa-list fa-lg",d="Grid view"):(r="List",d="List view",a="fa fa-th-large fa-lg"),s=o().createElement(z(),{id:"Layout"},d),o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:s},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:this.LayoutClicked.bind(this,r),disabled:i},o().createElement("i",{className:a})));case"AddReleaseNote":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddReleaseNote"},"Add Release Note")},o().createElement("button",{className:"btn btn-white  icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-plus-circle fa-lg"})));case"UpdateReleaseNote":var p="btn btn-white  icon-only";return"Armed"===e.state&&(p+=" armed"),o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"UpdateReleaseNote"},"Update Release Note")},o().createElement("button",{className:p,tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-floppy-o fa-lg"})));case"CancelReleaseNote":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"CancelReleaseNote"},"Cancel Release Note")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-times fa-lg"})));case"DeleteReleaseNote":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"DelReleaseNote"},"Delete Release Note")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-trash-o fa-lg"})));case"AddConnection":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AddConnection"},"Add Connection")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-plus-circle fa-lg"})));case"UpdateConnection":return p="btn btn-white","Armed"===e.state&&(p+=" armed"),o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"UpdateConnection"},"Update Connection")},o().createElement("button",{className:p,tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-floppy-o fa-lg"})));case"CancelConnection":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"CancelConnection"},"Cancel Connection")},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-times fa-lg"})));case"DeleteConnection":return o().createElement(Y(),{key:t,placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"DelConnection"},"Delete Connection")},o().createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:e.callback,disabled:i},o().createElement("i",{className:"fa fa-trash-o fa-lg"})));default:return o().createElement("div",{key:t})}}.bind(this);return o().createElement("div",{className:"dashboard-toolbar",style:{display:"flex",marginLeft:"auto"}},this.props.configuration.map(e))}});var ls=a(9769),rs=a(82465);const cs=o().createClass({displayName:"WidgetEditor",_notificationSystem:null,getInitialState:function(){return{groupedWidgetList:{},widgetList:[],selectedWidget:null,widgetListFilter:"",saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:""}},componentDidMount:function(){var e=this;this.loadData(),this._notificationSystem=this.refs.notificationSystem,It.A.createShortcut("mod+s",function(){e.actionSave()},this.refs.topElement)},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},loadData:function(){this.setState({isLoading:!0,saveIconState:"Normal"}),S().get("/widgets/jsonpure?status=development").set("Content-Type","application/json").end(function(e,t){if(e)console.log(e);else{if(t.headers.location)return void(window.location=t.headers.location);var a=[];t.body.forEach(function(e,t){if(e.category){var i=e.category.replace(/,/g," "),n={name:e.name,id:e.id,categories:i,widget:e};a.push(n)}}),a.sort(function(e,t){return(e.name.toUpperCase()>t.name.toUpperCase())-.5}),this.setState({widgetList:a});var i=null;if(this.state.selectedWidget)for(var n=0,s=a.length;n<s;n++)if(a[n].id==this.state.selectedWidget.id){i=a[n];break}null==i&&a.length>0&&(i=a[0]),this.setState({selectedWidget:i})}this.setState({isLoading:!1})}.bind(this))},selectWidget:function(e){this.setState({selectedWidget:e,saveIconState:"Normal"})},actionAdd:function(){this.setState({isLoading:!0}),S().post("/widgets/new").send({name:"Default Name",access:"public",category:"Default"}).end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot create widget",description:e.message}),this._notificationSystem.addNotification({message:"Could not create new widget",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);var a=t.body,i=this.state.widgetList,n={name:a.name,id:a.id,categories:a.category,widget:a};i.push(n),i.sort(function(e,t){return(e.name.toUpperCase()>t.name.toUpperCase())-.5}),this.setState({selectedWidget:n,widgetList:i}),this._notificationSystem.addNotification({message:"A new widget has been created successfully ",level:"success",autoDismiss:5,position:"tc"})}this.setState({isLoading:!1})}.bind(this))},onNotifyChange:function(){this.setState({saveIconState:"Armed"})},actionSave:function(){this.setState({saveIconState:"Normal"}),null!=this.state.selectedWidget?this.refs.widgetInfo.saveWidget(this.loadData):this._notificationSystem.addNotification({message:"Could not save widget because no widget is selected",level:"warning",autoDismiss:5,position:"tc"})},openDeleteDialog:function(){null!=this.state.selectedWidget&&this.setState({confirmDelete:!0,confirmDeleteMessage:"Are you sure you want to delete widget "+this.state.selectedWidget.name+"?"})},actionDelete:function(){this.setState({saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:"",isLoading:!0}),null!=this.state.selectedWidget?S().delete("/widgets/"+this.state.selectedWidget.id).end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot delete widget",description:e.message}),this._notificationSystem.addNotification({message:"Could not delete widget",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);this.loadData(),this._notificationSystem.addNotification({message:"Widget was successfully deleted",level:"success",autoDismiss:5,position:"tc"})}this.setState({isLoading:!0})}.bind(this)):this._notificationSystem.addNotification({message:"Could not delete widget because no widget is selected",level:"warning",autoDismiss:5,position:"tc"})},onSearch:function(e){this.setState({widgetListFilter:e})},render:function(){var e,t,a=this,i=function(e,t){var a,i="";if(this.state.selectedWidget&&this.state.selectedWidget.id==e.id)i+=" active",a="selectedDomElement";else if(""!=this.state.widgetListFilter){var n=this.state.widgetListFilter.toUpperCase().trim();if(-1==e.name.toUpperCase().indexOf(n)&&-1==e.categories.toUpperCase().indexOf(n)&&-1==e.id.toString().indexOf(n))return null}return o().createElement("li",{key:"widget-"+t,className:i,onMouseDown:this.selectWidget.bind(this,e),ref:a},o().createElement("div",{className:"widget-name"},e.name),o().createElement("div",{className:"widget-category"},e.categories))}.bind(this);ls.getDefaultIconFromBrowserShortType(rs.WIDGET),this.state.isLoading?e=o().createElement("div",{style:{width:"100%",textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):(e=this.state.widgetList.length>0?o().createElement("div",{className:"navigator-wrapper"},o().createElement("ul",{className:"dashboard-tree large-items"},this.state.widgetList.map(i))):o().createElement("div",{style:{textAlign:"center",paddingTop:"20px"}},"No widgets have been created"),this.state.selectedWidget&&(this.state.selectedWidget.name,this.state.selectedWidget.thumbnail&&this.state.selectedWidget.thumbnail,t=o().createElement(ss,{key:this.state.selectedWidget.id,widget:this.state.selectedWidget.widget,onNotifyChange:this.onNotifyChange,ref:"widgetInfo",notificationSys:this._notificationSystem})));var n=[];return this.state.selectedWidget&&(n=[{type:"Delete",callback:this.openDeleteDialog},{type:"Save",callback:this.actionSave,state:this.state.saveIconState}]),o().createElement("div",{className:"height-100p",ref:"topElement"},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{className:"height-100p"},o().createElement(Cn,null),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("div",{className:"singular-browser-body"},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Widget Manager"),o().createElement("div",{className:"right-area"},"")),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},o().createElement("button",{id:"btnDropNewItem",type:"button",tabIndex:"-1",onClick:this.actionAdd,className:"btn btn-primary new-show-btn",style:{width:"125px"},"aria-expanded":"false"},"New Widget")),o().createElement("div",{className:"right-area"},o().createElement("div",null,o().createElement(Bn,{mode:"immediate",onSearch:this.onSearch,onSearchClick:this.onSearch,onClearSearchClick:this.onSearch.bind(this,"")})),o().createElement("div",null,o().createElement(os,{configuration:n}))),o().createElement("div",null)),o().createElement("nav",{className:"singular-browser-nav",style:{height:"calc(100% - 120px",borderRight:"solid 1px #ccc"}},e),o().createElement("div",{className:"singular-browser-content",style:{top:"120px"}},o().createElement("div",{className:"widget-detail-wrapper"},t))))),o().createElement(si(),{show:1==this.state.confirmDelete,title:"",text:this.state.confirmDeleteMessage,showCancelButton:!0,animation:!1,onConfirm:function(){a.setState({confirmDelete:!1}),a.actionDelete()},onCancel:function(){a.setState({confirmDelete:!1})},onEscapeKey:function(){a.setState({confirmDelete:!1})},onOutsideClick:function(){a.setState({confirmDelete:!1})}}))}});var ds=a(18093),ps=a.n(ds),ms=a(89603),us=a.n(ms),hs=a(40927),fs=a(15734),gs=a(95093),vs=a(82465),bs={toolbar:[[{font:[]}],[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike","blockquote","code-block"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],[{align:[]}],["link"],["clean"]]},ys=["header","bold","italic","underline","strike","blockquote","code-block","list","bullet","indent","align","link","color","background"];const Es=hs.createClass({displayName:"MarketplaceItem",getInitialState:function(){var e=this;return this.currentContentIndex=-1,this.browserComposition=null,this.browserApp=null,this.imageDropzone=[],this.videoDropzone=[],this.SortableItem=(0,pa.Zj)(function(e){var t=this,a=e.value,i=e.arrayIndex,n="Browse ...";if(a.element&&a.element.id){var s=mn().getDefaultIconFromBrowserShortType(a.element.type);a.element.thumbnail&&(s=a.element.thumbnail),n=hs.createElement("div",{className:"element-container"},hs.createElement("img",{src:s,className:"element-thumbnail"}),hs.createElement("span",{className:"element-name"},a.element.name))}var o,l,r="";if(a.displayVariants&&a.displayVariants.variants&&a.displayVariants.variants.length){r=JSON.stringify(a.displayVariants);var c=a.displayVariants;r=hs.createElement("div",{className:"display-variant-content"},hs.createElement("div",{className:"display-variant-header"},"Default variant: ",c.active),c.variants.map(function(e,t){return hs.createElement("div",{className:"display-variant-variant",key:t},hs.createElement("div",null,hs.createElement("b",null,e.name),": ",e.resolution),hs.createElement("div",null,e.description||"No description"))}))}else r=hs.createElement("div",{style:{paddingLeft:"30px"}},"No display variants");return o=this.state.imageUploadBusy?hs.createElement("div",{className:"button-list"},hs.createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{width:"30px",height:"30px"}})):a.imageURL?hs.createElement("div",{className:"button-list"},hs.createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:function(){return t.onContentListPropertyChanged("imageURL",i,"")}},hs.createElement("i",{className:"fa fa-times fa-lg"})),hs.createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":a.imageURL,"button-tabIndex":"-1"},hs.createElement("i",{className:"fa fa-clipboard fa-lg"}))):hs.createElement("div",{className:"button-list"},hs.createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:function(){return t.imageDropzone[i].open()}},hs.createElement("i",{className:"fa fa-upload fa-lg"}))),l=this.state.videoUploadBusy?hs.createElement("div",{className:"button-list"},hs.createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{width:"30px",height:"30px"}})):a.videoURL?hs.createElement("div",{className:"button-list"},hs.createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:function(){return t.onContentListPropertyChanged("videoURL",i,"")}},hs.createElement("i",{className:"fa fa-times fa-lg"})),hs.createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":a.videoURL,"button-tabIndex":"-1"},hs.createElement("i",{className:"fa fa-clipboard fa-lg"}))):hs.createElement("div",{className:"button-list"},hs.createElement("button",{className:"btn btn-white icon-only",tabIndex:"-1",onClick:function(){return t.videoDropzone[i].open()}},hs.createElement("i",{className:"fa fa-upload fa-lg"}))),hs.createElement("div",{key:i,className:"contentItem"},hs.createElement("button",{className:"btn btn-white element-icon",tabIndex:"-1",onClick:this.onContentListBrowseElement.bind(this,i)},n),hs.createElement("div",{className:"component name"},hs.createElement("div",{className:"detail-label"},"Name"),hs.createElement("div",null,hs.createElement("input",{type:"text",className:"form-control",value:a.name,onChange:function(e){return t.onContentListPropertyChanged("name",i,e.target.value)}}))),hs.createElement(ps(),{className:"component asset",onDrop:function(e){return t.onContentListUploadImage(i,e)},ref:function(e){return t.imageDropzone[i]=e},disableClick:!0,multiple:!1,accept:".jpg,.jpeg,.png,.webp,.gif,.svg",disablePreview:!0},hs.createElement("div",{className:"detail-label"},"Image"),hs.createElement("div",{className:"image-url"},hs.createElement("div",{className:"preview"},hs.createElement("img",{className:"small",src:a.imageURL,onError:function(e){e.currentTarget.src="/images/broken-file.png"}}),hs.createElement("img",{className:"large",src:a.imageURL,onError:function(e){e.currentTarget.src="/images/broken-file.png"}})),o)),hs.createElement(ps(),{className:"component asset",onDrop:function(e){return t.onContentListUploadVideo(i,e)},ref:function(e){return t.videoDropzone[i]=e},disableClick:!0,multiple:!1,accept:".webm,.mp4,.avi,.mov",disablePreview:!0},hs.createElement("div",{className:"detail-label"},"Video"),hs.createElement("div",{className:"image-url"},hs.createElement("div",{className:"preview"},hs.createElement("video",{className:"small",autoPlay:!0,muted:!0,loop:!0,src:a.videoURL+(this.state.videoCacheBuster?"?"+this.state.videoCacheBuster:"")}),hs.createElement("video",{className:"large",autoPlay:!0,muted:!0,loop:!0,src:a.videoURL+(this.state.videoCacheBuster?"?"+this.state.videoCacheBuster:"")})),l)),hs.createElement("div",{className:"display-variant-info"},r),hs.createElement("button",{className:"btn btn-white icon-only component delete",tabIndex:"-1",onClick:this.onContentListDelete.bind(this,i)},hs.createElement("i",{className:"fa fa-times fa-lg"})))}.bind(this)),this.SortableList=(0,pa.q6)(function(t){var a=t.items;return hs.createElement("div",{className:""},a.map(function(t,a){return hs.createElement(e.SortableItem,{key:a,index:a,value:t,arrayIndex:a})}))}),{duplicateBusy:!1,itemName:"",itemTags:[],itemDescription:"<p><br></p>",itemMarker:"",itemStatus:"draft",itemContent:{type:"",content:[]},itemDisplay:"",itemTagType:"",itemTagFunction:"",itemTagCategory:"",itemTagDataSource:"",itemTagTheme:"",itemFeatured:"",itemNewRelease:"",panelOpenProperties:!0,panelOpenDescription:!0,imageUploadBusy:!1,videoUploadBusy:!1,videoCacheBuster:null}},componentDidMount:function(){window.addEventListener("beforeunload",this.handleWindowClose,!1),this.componentDidUpdate(),this.assignLocalData(this.props.item)},componentWillUnmount:function(){window.removeEventListener("beforeunload",this.handleWindowClose)},componentDidUpdate:function(){var e=this;this.browserComposition=this.refs.compositionBrowserModal.refs.child,this.browserApp=this.refs.appinstanceBrowserModal.refs.child,this.browserComposition.filterByType("c"),this.browserApp.filterByType("ai"),$("#compBrowserModal"+vs.MARKETITEM_FULLNAME_MAP.c).on("shown.bs.modal",function(){e.browserComposition.modalPending&&(e.browserComposition.modalPending=!1)}),$("#compBrowserModal"+vs.MARKETITEM_FULLNAME_MAP.ai).on("shown.bs.modal",function(){e.browserApp.modalPending&&(e.browserApp.modalPending=!1)})},shouldComponentUpdate:function(e,t){return!mn().compareObject(t,this.state)||!mn().compareObject(e,this.props)},componentWillReceiveProps:function(e){this.props.item&&e.item&&this.props.item.id==e.item.id||this.assignLocalData(e.item)},handleWindowClose:function(e){var t=null;return this.didLocalDataChange()&&(e.preventDefault(),t="There are unsaved changes. Are you sure you want to continue?",(e||window.event).returnValue=t),t},assignLocalData:function(e){if(e){var t=[];try{t=(t=JSON.parse(e.tags)).length?t.map(function(e){return{className:"Select-create-option-placeholder",label:e,value:e}}):[]}catch(e){}var a={type:"",content:[]};try{a=JSON.parse(e.content)}catch(e){}this.setState({itemName:e.name,itemTags:t,itemContent:a,itemDescription:e.description,itemMarker:e.marker,itemStatus:e.status||"draft",itemDisplay:e.display||"",itemTagType:e.tag_type,itemTagFunction:e.tag_function,itemTagCategory:e.tag_category,itemTagDataSource:e.tag_datasource,itemTagTheme:e.tag_theme,itemFeatured:e.featured,itemNewRelease:e.new_release})}},didLocalDataChange:function(){if(!this.props.item)return!1;if(this.state.imageUploadBusy||this.state.videoUploadBusy)return!0;var e=this.props.item;if(this.state.itemName!=e.name||this.state.itemDescription!=e.description||this.state.itemMarker!=e.marker||this.state.itemStatus!=e.status||this.state.itemDisplay!=e.display||this.state.itemTagType!=e.tag_type||this.state.itemTagFunction!=e.tag_function||this.state.itemTagCategory!=e.tag_category||this.state.itemTagDataSource!=e.tag_datasource||this.state.itemTagTheme!=e.tag_theme||this.state.itemFeatured!=e.featured||this.state.itemNewRelease!=e.new_release)return!0;var t=this.state.itemTags.map(function(e){return e.value});return!((e.tags||!t.length)&&JSON.stringify(t)==e.tags&&(!e.content&&0==this.state.itemContent.content.length||JSON.stringify(this.state.itemContent)==e.content))},onSaveItem:function(){var e=this.state.itemTags.map(function(e){return e.value}),t={name:this.state.itemName,tags:JSON.stringify(e),content:JSON.stringify(this.state.itemContent),description:this.state.itemDescription,marker:this.state.itemMarker,status:this.state.itemStatus,display:this.state.itemDisplay,tag_type:this.state.itemTagType,tag_function:this.state.itemTagFunction,tag_category:this.state.itemTagCategory,tag_datasource:this.state.itemTagDataSource,tag_theme:this.state.itemTagTheme,featured:this.state.itemFeatured,new_release:this.state.itemNewRelease?gs(this.state.itemNewRelease).format():0};this.props.onSave(this.props.item.id,t)},onNotifyChange:function(){this.props.onNotifyChange&&(this.didLocalDataChange()?this.props.onNotifyChange("Armed"):this.props.onNotifyChange("Normal"))},onNameChanged:function(e){this.setState({itemName:e.target.value},this.onNotifyChange)},onTagsChanged:function(e){this.setState({itemTags:e},this.onNotifyChange)},onDescriptionChanged:function(e,t,a,i){i.getHTML(),this.setState({itemDescription:e},this.onNotifyChange)},onMarkerChanged:function(e){this.setState({itemMarker:e.target.value},this.onNotifyChange)},onItemStatusChanged:function(e){this.setState({itemStatus:e},this.onNotifyChange)},onItemFeaturedChanged:function(e){this.setState({itemFeatured:e},this.onNotifyChange)},onItemNewReleaseChanged:function(e){var t=0;e&&(t=new Date((new Date).valueOf()+864e5*e-1e3).valueOf()),this.setState({itemNewRelease:t},this.onNotifyChange)},onSelectionChanged:function(e,t){var a={};a[e]=t,this.setState(a)},onAddContentItem:function(e){var t=$.extend(!0,{},this.state.itemContent);t.type=e,t.content.push({name:"New Name",element:{id:null,thumbnail:"",name:"",type:e},imageURL:"",videoURL:""}),this.setState({itemContent:t},this.onNotifyChange)},onContentListDelete:function(e){var t=$.extend(!0,{},this.state.itemContent);t.content.splice(e,1),this.setState({itemContent:t},this.onNotifyChange)},controlBrowserDialog:function(e){switch(this.state.itemContent.type){case"composition":$("#compBrowserModal"+vs.MARKETITEM_FULLNAME_MAP.c).modal(e);break;case"app":$("#compBrowserModal"+vs.MARKETITEM_FULLNAME_MAP.ai).modal(e);break;default:return void console.log("invalid type in controlBrowserDialog ",this.state.itemContent.type)}},onContentListBrowseElement:function(e){this.currentContentIndex=e,this.controlBrowserDialog("show")},onSelectContentElement:function(e){this.controlBrowserDialog("hide"),this.setState({duplicateBusy:!0});var t,a={sendEmail:0,targetFolder:"root",target_email:"difita9671@aieen.com",toMarketplace:1};"composition"==this.state.itemContent.type?(a.comp_id=e.refId,t="/apiv1/compositions/duplicateto"):(a.app_id=e.refId,t="/apiv1/appinstances/duplicateto"),fs.post(t).send(a).end(function(t,a){var i=this;if(t)this.props.notificationSystem.addNotification({message:"Could not send item ID "+e.refId+" to marketplace",level:"error",autoDismiss:5,position:"tc"}),this.setState({duplicateBusy:!1});else{if(a.headers.location)return void(window.location=a.headers.location);var n=a.body,s=$.extend(!0,{},this.state.itemContent);if(s.content[this.currentContentIndex].element={id:n.id,name:n.name,thumbnail:n.thumbnail,type:n.type},s.content[this.currentContentIndex].name=n.name,"composition"!=this.state.itemContent.type){console.log("get the display variant data",n);var o="/apiv2/controlapps/"+n.token+"/displayvariants";fs.get(o).end(function(e,t){e?(console.log("Failed to get display variant data",e),s.content[i.currentContentIndex].displayVariants=null):(console.log("display variant data",t.body),s.content[i.currentContentIndex].displayVariants=t.body),i.setState({itemContent:s,duplicateBusy:!1},i.onNotifyChange)})}else this.setState({itemContent:s,duplicateBusy:!1},this.onNotifyChange)}}.bind(this))},onContentListPropertyChanged:function(e,t,a){var i=$.extend(!0,{},this.state.itemContent);i.content[t][e]=a,this.setState({itemContent:i},this.onNotifyChange)},monitorVideoUploadStatus:function(e,t){var a=this;fs.get(e+"?rand="+Math.random()).end(function(i,n){if(i)403===n.statusCode?setTimeout(function(){a.monitorVideoUploadStatus(e,t)},2e3):(a.setState({videoUploadBusy:!1}),a.props.notificationSystem.addNotification({message:"Failed to transcode video",level:"error",autoDismiss:5,position:"tc"}));else{var s;if(n.text)try{s=JSON.parse(n.text)}catch(e){}s&&"PROGRESSING"!==s.state||setTimeout(function(){a.monitorVideoUploadStatus(e,t)},2e3),"COMPLETED"!==s.state&&"FAILED"!==s.state||(a.setState({videoUploadBusy:!1}),"FAILED"===s.state?(a.props.notificationSystem.addNotification({message:"Failed to transcode video",level:"error",autoDismiss:5,position:"tc"}),a.onContentListPropertyChanged("videoURL",t,"")):a.setState({videoCacheBuster:Math.random()}))}})},onContentListUploadImage:function(e,t){var a=this;this.setState({imageUploadBusy:!0});var i=t[0].name;fs.post("/apiv1/transcoder/image/sign").send({ext:i.substring(i.lastIndexOf(".")+1,i.length)||i}).end(function(i,n){if(i)a.props.notificationSystem.addNotification({message:"Failed to authorize image upload",level:"error",autoDismiss:5,position:"tc"}),a.setState({imageUploadBusy:!1});else{if(n.headers.location)return void(window.location=n.headers.location);var s=n.body,o=s.url;fs.put(o).send(t[0]).end(function(t,i){a.setState({imageUploadBusy:!1}),t?(a.props.notificationSystem.addNotification({message:"Failed to upload image file",level:"error",autoDismiss:5,position:"tc"}),a.onContentListPropertyChanged("imageURL",e,"")):a.onContentListPropertyChanged("imageURL",e,s.output)})}})},onContentListUploadVideo:function(e,t){var a=this;this.setState({videoUploadBusy:!0}),fs.post("/apiv1/transcoder/video/sign").end(function(i,n){if(i)a.props.notificationSystem.addNotification({message:"Failed to authorize video upload",level:"error",autoDismiss:5,position:"tc"}),a.setState({videoUploadBusy:!1});else{if(n.headers.location)return void(window.location=n.headers.location);var s=n.body,o=s.status,l="https://assets.singular.live/library/mediaconvert/"+s.account+"/videos/"+s.file+".webm",r=s.url;a.onContentListPropertyChanged("videoURL",e,l),fs.put(r).send(t[0]).end(function(t,i){t?(a.props.notificationSystem.addNotification({message:"Failed to upload video file",level:"error",autoDismiss:5,position:"tc"}),a.setState({videoUploadBusy:!1}),a.onContentListPropertyChanged("videoURL",e,"")):a.monitorVideoUploadStatus(o,e)})}})},onSortEnd:function(e){var t=$.extend(!0,{},this.state.itemContent);t.content=ua()(t.content,e.oldIndex,e.newIndex),this.setState({itemContent:t},this.onNotifyChange)},render:function(){var e,t=this,a=["c","ai"].map(function(e){var t=vs.MARKETITEM_FULLNAME_MAP[e]+"BrowserModal",a="compBrowserModal"+vs.MARKETITEM_FULLNAME_MAP[e];return hs.createElement("div",{id:a,key:a,className:"modal fade u-displaynone singular-modal compBrowserModal",tabIndex:"-1",role:"dialog",style:{overflow:"hidden"}},hs.createElement("div",{id:"compBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},hs.createElement("div",{className:"modal-content"},hs.createElement("div",{className:"modal-body"},hs.createElement(kt.A,{rtdbFolderRef:window.singularRtdbCoreRef.child("accounts").child(window.singularUser.account.accountId).child("assets"),key:t,ref:t,modalId:a,browserTitle:vs.BROWSERITEM_NICENAME_MAP[e],showClose:!0,showInspector:!1,showTypeSelection:!1,showHeader:!1,showSearch:!1,enableRealtimeUpdate:!1,onItemDoubleClick:this.onSelectContentElement,useDefaultItemDoubleClick:!1,browserStyle:"composition-selector-modal",showRevisionSelection:!1,dblClicktoSelectedFolder:!1})))))}.bind(this));if(this.props.busy||!this.props.item||this.state.duplicateBusy)return(this.props.busy||this.state.duplicateBusy)&&(e=hs.createElement("div",{style:{width:"100%",textAlign:"center"}},hs.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))),hs.createElement("div",{className:"widget-detail-body developer-manager",style:{height:"auto"}},hs.createElement("div",{className:"details-panel",style:{visibility:"hidden",height:"0px"}},hs.createElement("div",{className:"details-panel-body",ref:"detailsPanelBody"})),e,hs.createElement("div",{key:"browserModelWindows"},a));var i,n,s="undefined";this.props.item.updated_at&&(s=gs(this.props.item.updated_at).format("YYYY-MM-DD HH:mm:ss"));var o=hs.createElement("button",{className:"btn btn-white",onClick:this.onAddContentItem.bind(this,"composition")},"Add Composition"),l=hs.createElement("button",{className:"btn btn-white",onClick:this.onAddContentItem.bind(this,"app")},"Add Control App");this.state.itemContent&&this.state.itemContent.type&&this.state.itemContent.content.length?(i=hs.createElement(this.SortableList,{items:this.state.itemContent.content,onSortEnd:this.onSortEnd,axis:"y",lockAxis:"y",distance:5,pressThreshold:5,lockToContainerEdges:!0,helperClass:"contentItemBackground",helperContainer:this.refs.detailsPanelBody}),n="composition"==this.state.itemContent.type?hs.createElement("div",{className:"buttons"},o):hs.createElement("div",{className:"buttons"},l)):n=hs.createElement("div",{className:"buttons"},o,l);var r,c=0;return this.state.itemNewRelease&&(c=mn().getMarketplaceNewReleaseDaysLeft(this.state.itemNewRelease))&&(r=c+" days left"),hs.createElement("div",{className:"widget-detail-body developer-manager",style:{height:"auto"}},hs.createElement("div",{className:"details-panel"},hs.createElement("div",{className:"details-panel-header"},hs.createElement("span",null,"Properties and metadata"),hs.createElement("button",{className:"btn btn-white icon-only v2",tabIndex:"-1",onClick:function(){return t.setState({panelOpenProperties:!t.state.panelOpenProperties})},style:{marginLeft:"auto"}},this.state.panelOpenProperties&&hs.createElement("i",{className:"fa fa-chevron-down"}),!this.state.panelOpenProperties&&hs.createElement("i",{className:"fa fa-chevron-up"}))),this.state.panelOpenProperties&&hs.createElement("div",{className:"details-panel-body",style:{paddingBottom:"2px"}},hs.createElement("table",{className:"details-table"},hs.createElement("thead",null,hs.createElement("tr",null,hs.createElement("th",{style:{width:"70%"}}),hs.createElement("th",{style:{width:"30%"}}))),hs.createElement("tbody",null,hs.createElement("tr",null,hs.createElement("td",null,hs.createElement("div",{className:"detail-label"},"Name"),hs.createElement("div",null,hs.createElement("input",{type:"text",className:"form-control",value:this.state.itemName,onChange:this.onNameChanged}))),hs.createElement("td",null,hs.createElement("div",{className:"detail-label"},"ID"),hs.createElement("div",null,hs.createElement("input",{type:"text",className:"form-control",value:this.props.item.id,disabled:"disabled"})))),hs.createElement("tr",null,hs.createElement("td",null,hs.createElement("div",{className:"detail-label"},"Tags"),hs.createElement("div",{style:{position:"relative",top:"2px"}},hs.createElement(as().Creatable,{className:"singularSelect creatable white",multi:!0,backspaceToRemoveMessage:"",onChange:this.onTagsChanged,value:this.state.itemTags,placeholder:"Enter tags",arrowRenderer:function(){},menuRenderer:function(){}}))),hs.createElement("td",null,hs.createElement("div",{className:"detail-label"},"Last saved"),hs.createElement("div",null,hs.createElement("input",{type:"text",className:"form-control",value:s,disabled:"disabled"})))),hs.createElement("tr",null,hs.createElement("td",{colSpan:"2"},hs.createElement("div",{className:"menu-panel"},hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Display"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemDisplay",selections:this.props.displaySelection,value:this.state.itemDisplay,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Type"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemTagType",useFilter:!0,selections:this.props.typeSelection,value:this.state.itemTagType,onEnterKey:function(e,a){return t.onSelectionChanged(e,a)},onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Function"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemTagFunction",useFilter:!0,selections:this.props.functionSelection,value:this.state.itemTagFunction,onEnterKey:function(e,a){return t.onSelectionChanged(e,a)},onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Category"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemTagCategory",useFilter:!0,selections:this.props.categorySelection,value:this.state.itemTagCategory,onEnterKey:function(e,a){return t.onSelectionChanged(e,a)},onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Data Source"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemTagDataSource",useFilter:!0,selections:this.props.dataSourceSelection,value:this.state.itemTagDataSource,onEnterKey:function(e,a){return t.onSelectionChanged(e,a)},onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Theme"),hs.createElement("div",{className:"selection-input"},hs.createElement(ae.A,{theme:"light",name:"itemTagTheme",useFilter:!0,selections:this.props.themeSelection,value:this.state.itemTagTheme,onEnterKey:function(e,a){return t.onSelectionChanged(e,a)},onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})))))),hs.createElement("tr",null,hs.createElement("td",{colSpan:"2"},hs.createElement("div",{className:"detail-label"},"Marker"),hs.createElement("div",{className:"image-url"},hs.createElement("div",{className:"preview"},hs.createElement("img",{className:"small",src:this.state.itemMarker,onError:function(e){e.currentTarget.src="/images/broken-file.png"}}),hs.createElement("img",{className:"large",src:this.state.itemMarker,onError:function(e){e.currentTarget.src="/images/broken-file.png"}})),hs.createElement("input",{type:"text",className:"form-control",value:this.state.itemMarker,onChange:this.onMarkerChanged})))),hs.createElement("tr",null,hs.createElement("td",{colSpan:"2"},hs.createElement("div",{className:"menu-panel split"},hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Status"),hs.createElement("div",{className:"dropdown dropdown-white modifier-toggle",style:{width:"110px",top:"-4px"}},hs.createElement("button",{className:"btn btn-white dropdown-toggle","data-toggle":"dropdown"},"published"==this.state.itemStatus?"Published":"Draft"),hs.createElement("ul",{className:"dropdown-menu dropdown-menu"},hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemStatusChanged.bind(this,"draft")},"Draft")),hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemStatusChanged.bind(this,"published")},"Published"))))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"Featured"),hs.createElement("div",{className:"dropdown dropdown-white modifier-toggle",style:{width:"110px",top:"-4px"}},hs.createElement("button",{className:"btn btn-white dropdown-toggle","data-toggle":"dropdown"},"1"===String(this.state.itemFeatured)?"Yes":"No"),hs.createElement("ul",{className:"dropdown-menu dropdown-menu"},hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemFeaturedChanged.bind(this,"0")},"No")),hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemFeaturedChanged.bind(this,"1")},"Yes"))))),hs.createElement("div",{className:"menu-group"},hs.createElement("div",{className:"detail-label"},"New Release"),hs.createElement("div",{className:"dropdown dropdown-white modifier-toggle",style:{width:"110px",top:"-4px"}},hs.createElement("button",{className:"btn btn-white dropdown-toggle","data-toggle":"dropdown"},0===c?"No":"Yes"),hs.createElement("ul",{className:"dropdown-menu dropdown-menu"},hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemNewReleaseChanged.bind(this,0)},"No")),hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemNewReleaseChanged.bind(this,7)},"7 days")),hs.createElement("li",null,hs.createElement("a",{onClick:this.onItemNewReleaseChanged.bind(this,14)},"14 days"))))),r&&hs.createElement("div",{style:{position:"relative",left:"-10px",top:"6px"}},r),hs.createElement("div",{className:"menu-group right"},hs.createElement("div",{className:"detail-label"},""),hs.createElement("div",{className:"input-group-btn",style:{top:"-3px",position:"relative"}},hs.createElement($t(),{className:"btn btn-white","data-clipboard-text":window.location.host+"/dashboard?templateLibraryItem="+this.props.item.id,"button-tabIndex":"-1",style:{height:"30px",float:"right",paddingLeft:"18px"}},hs.createElement("i",{className:"fa fa-clipboard fa-lg"}),hs.createElement("span",null,"Copy deep link"))))))))))),hs.createElement("div",{className:"details-panel"},hs.createElement("div",{className:"details-panel-header"},hs.createElement("span",null,"Description"),hs.createElement("button",{className:"btn btn-white icon-only v2",tabIndex:"-1",onClick:function(){return t.setState({panelOpenDescription:!t.state.panelOpenDescription})},style:{marginLeft:"auto"}},this.state.panelOpenDescription&&hs.createElement("i",{className:"fa fa-chevron-down"}),!this.state.panelOpenDescription&&hs.createElement("i",{className:"fa fa-chevron-up"}))),this.state.panelOpenDescription&&hs.createElement("div",{className:"details-panel-body"},hs.createElement(us(),{theme:"snow",modules:bs,formats:ys,value:this.state.itemDescription,onChange:this.onDescriptionChanged,preserveWhitespace:!0}))),hs.createElement("div",{className:"details-panel"},hs.createElement("div",{className:"details-panel-header"},hs.createElement("span",null,"Content and variants")),hs.createElement("div",{className:"details-panel-body",ref:"detailsPanelBody"},i,n)),hs.createElement("div",{key:"browserModelWindows"},a))}});var ws=o().createClass({displayName:"MarketplaceManager",_notificationSystem:null,getInitialState:function(){return{itemList:[],selectedItem:null,itemListFilter:"",saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:"",showNotSavedDialog:!1,futureSelectedItem:null,futureNewItem:!1,filterStatus:"",filterDisplay:"",filterType:"",filterCategory:"",filterDataSource:"",filterLayout:"",filterTheme:"",filterFunction:"",filterFeatured:"",filterNewRelease:""}},componentDidMount:function(){var e=this;this.loadData(),this._notificationSystem=this.refs.notificationSystem,It.A.createShortcut("mod+s",function(){e.actionSave()},this.refs.topElement)},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},shouldComponentUpdate:function(e,t){return!mn().compareObject(t,this.state)||!mn().compareObject(e,this.props)},loadData:function(){this.setState({isLoading:!0,saveIconState:"Normal"}),S().get("/apiv1/marketplace/items").set("Content-Type","application/json").end(function(e,t){if(e)this._notificationSystem.addNotification({message:"Could not fetch items from server",level:"error",autoDismiss:5,position:"tc"}),this.setState({isLoading:!1});else{if(t.headers.location)return void(window.location=t.headers.location);for(var a=t.body,i=0,n=a.length;i<n;i++){var s=a[i];if(s.tags||(s.tags=JSON.stringify([])),s.display||(s.display=""),s.tag_type||(s.tag_type=""),s.tag_function||(s.tag_function=""),s.tag_category||(s.tag_category=""),s.tag_layout||(s.tag_layout=""),s.tag_datasource||(s.tag_datasource=""),s.tag_theme||(s.tag_theme=""),s.content)try{s.contentObj=JSON.parse(s.content)}catch(e){s.contentObj=null}}a.sort(function(e,t){return(e.name.toUpperCase()>t.name.toUpperCase())-.5});var o=null;if(this.state.selectedItem)for(var l=0,r=a.length;l<r;l++)if(a[l].id==this.state.selectedItem.id){o=a[l];break}null==o&&a.length>0&&(o=a[0]),this.setState({itemList:a,selectedItem:o,isLoading:!1})}}.bind(this))},saveItem:function(e,t){this.setState({isLoading:!0,saveIconState:"Normal"}),S().put("apiv1/marketplace/items/"+e).send(t).end(function(t,a){if(t)this._notificationSystem.addNotification({message:"Could not save item "+e,level:"error",autoDismiss:5,position:"tc"}),this.setState({isLoading:!1});else{if(a.headers.location)return void(window.location=a.headers.location);this.loadData()}}.bind(this))},selectItem:function(e){e&&(!this.state.futureSelectedItem&&this.refs.marketplaceItem&&this.refs.marketplaceItem.didLocalDataChange()?this.setState({showNotSavedDialog:!0,futureSelectedItem:e}):this.setState({selectedItem:e,futureSelectedItem:null,saveIconState:"Normal"}))},actionAdd:function(){!this.state.futureNewItem&&this.refs.marketplaceItem&&this.refs.marketplaceItem.didLocalDataChange()?this.setState({showNotSavedDialog:!0,futureNewItem:!0}):(this.setState({isLoading:!0,futureNewItem:!1}),S().post("apiv1/marketplace/items").send({name:"New item",description:"<p><br></p>",tags:"[]",status:"draft"}).end(function(e,t){if(e)this._notificationSystem.addNotification({message:"Could not create new item",level:"error",autoDismiss:5,position:"tc"}),this.setState({isLoading:!1});else{if(this.setState({selectedItem:t.body}),t.headers.location)return void(window.location=t.headers.location);this.loadData()}}.bind(this)))},onNotifyChange:function(e){this.setState({saveIconState:e})},actionSave:function(){this.setState({saveIconState:"Normal"}),this.state.selectedItem?this.refs.marketplaceItem.onSaveItem():this._notificationSystem.addNotification({message:"Could not save item because no item is selected",level:"warning",autoDismiss:5,position:"tc"})},openDeleteDialog:function(){this.state.selectedItem&&this.setState({confirmDelete:!0,confirmDeleteMessage:"Are you sure you want to delete item "+this.state.selectedItem.name+"?"})},actionDelete:function(){this.setState({saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:"",isLoading:!0}),null!=this.state.selectedItem&&S().delete("apiv1/marketplace/items/"+this.state.selectedItem.id).end(function(e,t){if(e)this._notificationSystem.addNotification({message:"Could not delete item",level:"error",autoDismiss:5,position:"tc"}),this.setState({isLoading:!1});else{if(t.headers.location)return void(window.location=t.headers.location);this._notificationSystem.addNotification({message:"Item was successfully deleted",level:"success",autoDismiss:5,position:"tc"}),this.loadData()}}.bind(this))},onSearch:function(e){this.setState({itemListFilter:e})},onSelectionChanged:function(e,t){var a={};a[e]=t,this.setState(a)},render:function(){var e,t=this,a=!1,i=0,n=function(e,t){var n="",s="";if(""!=this.state.itemListFilter){var l=this.state.itemListFilter.toUpperCase().trim();if(-1==e.name.toUpperCase().indexOf(l)&&-1==e.id.toString().indexOf(l)&&-1==e.tags.toUpperCase().indexOf(l))return null}if(this.state.filterStatus&&e.status&&this.state.filterStatus!=e.status)return null;if(this.state.filterDisplay&&e.display&&this.state.filterDisplay!=e.display)return null;if(this.state.filterCategory&&this.state.filterCategory!=e.tag_category)return null;if(this.state.filterDataSource&&this.state.filterDataSource!=e.tag_datasource)return null;if(this.state.filterTheme&&this.state.filterTheme!=e.tag_theme)return null;if(this.state.filterFunction&&this.state.filterFunction!=e.tag_function)return null;if(""!==this.state.filterFeatured&&this.state.filterFeatured!==String(e.featured))return null;if(""!==this.state.filterNewRelease){var r=mn().getMarketplaceNewReleaseDaysLeft(e.new_release);if("0"===this.state.filterNewRelease&&r||"1"===this.state.filterNewRelease&&!r)return null}if(this.state.filterType&&this.state.filterType!=e.tag_type)return null;if(this.state.filterLayout){var c=!1;if(e.contentObj&&e.contentObj.content&&e.contentObj.content.length){var d=e.contentObj.content[0];d.displayVariants&&(c=mn().displayVariantHasLayout(d.displayVariants.variants,this.state.filterLayout))}if(!c)return null}i++,this.state.selectedItem&&this.state.selectedItem.id==e.id&&(n+=" active",s="selectedDomElement",a=!0);var p=o().createElement("span",{style:{color:"red",fontSize:"10px"}},"No tags assigned");if(e.tags)try{var m=JSON.parse(e.tags);m&&m.length&&(p=m.map(function(e,t){return o().createElement("span",{key:t,style:{background:"#f1f1f1",border:"1px solid #e5e6e7",borderRadius:"2px",color:"#333333",padding:"1px 2px 1px 2px",marginRight:"2px",fontSize:"10px"}},e)}))}catch(e){}var u=o().createElement("i",{className:"fa fa-edit",style:{color:"orange"}});return"published"==e.status&&(u=o().createElement("i",{className:"fa fa-check-circle",style:{color:"green"}})),o().createElement("li",{key:"widget-"+t,className:n,onMouseDown:this.selectItem.bind(this,e),ref:s},o().createElement("div",{style:{position:"absolute",left:"-2px",top:"14px"}},u),o().createElement("div",{className:"widget-name"},e.name),o().createElement("div",{className:"widget-category"},p))}.bind(this);this.state.isLoading?e=o().createElement("div",{style:{width:"100%",textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):this.state.itemList.length?(e=o().createElement("div",{className:"navigator-wrapper"},o().createElement("ul",{className:"dashboard-tree large-items"},this.state.itemList.map(n))),0==i&&(e=o().createElement("div",{style:{textAlign:"center",paddingTop:"20px"}},"No items match the filter"))):e=o().createElement("div",{style:{textAlign:"center",paddingTop:"20px"}},"No items have been created");var s,l=function(e,t){var a=[{id:"",title:"Any"},{id:"none",title:"None"}];if(e&&e.length){var i=[];e.map(function(e){var a=e[t];a&&"none"!==a&&-1===i.indexOf(a)&&i.push(a)}),i.sort(),i.map(function(e){a.push({id:e,title:e})})}return a},r=this.state.itemList,c=l(r,"tag_type"),d=l(r,"tag_function"),p=l(r,"tag_category"),m=l(r,"tag_datasource"),u=l(r,"tag_theme"),h=[{id:"",title:"Any"},{id:"uno",title:"UNO Portal"},{id:"dashboard",title:"Dashboard"}],f=[{id:"",title:"Any"},{id:"0",title:"No"},{id:"1",title:"Yes"}],g=[{id:"",title:"Any"},{id:"0",title:"No"},{id:"1",title:"Yes"}],v=[];return 0==this.state.isLoading&&this.state.selectedItem&&a&&(v=[{type:"Delete",callback:this.openDeleteDialog},{type:"Save",callback:this.actionSave,state:this.state.saveIconState}]),this.state.selectedItem&&a&&(s=o().createElement(Es,{item:this.state.selectedItem,busy:this.state.isLoading,onNotifyChange:this.onNotifyChange,onSave:this.saveItem,notificationSystem:this._notificationSystem,displaySelection:h,typeSelection:c,functionSelection:d,categorySelection:p,dataSourceSelection:m,themeSelection:u,featuredSelection:f,newReleaseSelection:g,ref:"marketplaceItem"})),o().createElement("div",{className:"height-100p",ref:"topElement"},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{id:"MarketplaceManager",className:"height-100p"},o().createElement(Cn,null),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("div",{className:"singular-browser-body"},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Template Library"),o().createElement("div",{className:"right-area"},"")),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},o().createElement("button",{id:"btnDropNewItem",type:"button",tabIndex:"-1",onClick:this.actionAdd,className:"btn btn-primary new-show-btn",style:{width:"125px"},"aria-expanded":"false"},"New ",this.props.title)),o().createElement("div",{className:"right-area"},o().createElement("div",{className:"search-and-menus"},o().createElement(Bn,{mode:"immediate",onSearch:this.onSearch,onSearchClick:this.onSearch,onClearSearchClick:this.onSearch.bind(this,"")}),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Status"),o().createElement(ae.A,{theme:"light",name:"filterStatus",selections:[{id:"",title:"Any"},{id:"draft",title:"Draft"},{id:"published",title:"Published"}],value:this.state.filterStatus,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Display"),o().createElement(ae.A,{theme:"light",name:"filterDisplay",selections:h,value:this.state.filterDisplay,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Type"),o().createElement(ae.A,{theme:"light",name:"filterType",selections:c,value:this.state.filterType,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Function"),o().createElement(ae.A,{theme:"light",name:"filterFunction",selections:d,value:this.state.filterFunction,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Category"),o().createElement(ae.A,{theme:"light",name:"filterCategory",selections:p,value:this.state.filterCategory,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Layout"),o().createElement(ae.A,{theme:"light",name:"filterLayout",selections:[{id:"",title:"Any"},{id:"landscape",title:"Landscape"},{id:"portrait",title:"Portrait"},{id:"square",title:"Square"},{id:"responsive",title:"Responsive"}],value:this.state.filterLayout,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Data Source"),o().createElement(ae.A,{theme:"light",name:"filterDataSource",selections:m,value:this.state.filterDataSource,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Theme"),o().createElement(ae.A,{theme:"light",name:"filterTheme",selections:u,value:this.state.filterTheme,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"Featured"),o().createElement(ae.A,{theme:"light",name:"filterFeatured",selections:f,value:this.state.filterFeatured,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}})),o().createElement("div",{className:"filter-menu"},o().createElement("div",null,"New Release"),o().createElement(ae.A,{theme:"light",name:"filterNewRelease",selections:g,value:this.state.filterNewRelease,onValueChanged:function(e,a){return t.onSelectionChanged(e,a)}}))),o().createElement("div",null,o().createElement(os,{configuration:v}))),o().createElement("div",null)),o().createElement("nav",{className:"singular-browser-nav",style:{borderRight:"solid 1px #ccc",height:"calc(100% - 120px"}},e),o().createElement("div",{className:"singular-browser-content",style:{top:"120px"}},o().createElement("div",{className:"widget-detail-wrapper"},s))))),o().createElement(si(),{show:1==this.state.confirmDelete,title:"",text:this.state.confirmDeleteMessage,showCancelButton:!0,animation:!1,onConfirm:function(){t.setState({confirmDelete:!1}),t.actionDelete()},onCancel:function(){t.setState({confirmDelete:!1})},onEscapeKey:function(){t.setState({confirmDelete:!1})},onOutsideClick:function(){t.setState({confirmDelete:!1})}}),o().createElement(si(),{show:1==this.state.showNotSavedDialog,title:"",text:"Changed you made were not saved.",showCancelButton:!0,confirmButtonText:"Save",cancelButtonText:"Discard",animation:!1,onConfirm:function(){t.setState({showNotSavedDialog:!1}),t.actionSave(),t.state.futureSelectedItem?t.selectItem(t.state.futureSelectedItem):t.actionAdd()},onCancel:function(){t.setState({showNotSavedDialog:!1}),t.state.futureSelectedItem?t.selectItem(t.state.futureSelectedItem):t.actionAdd()},onEscapeKey:function(){t.setState({showNotSavedDialog:!1})},onOutsideClick:function(){t.setState({showNotSavedDialog:!1})}}))}});const Ss=ws;function Ns(e){return Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ns(e)}function Cs(e,t,a){return(t=function(e){var t=function(e){if("object"!=Ns(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Ns(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ns(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var xs=a(9769),Is=a(82465);const ks=o().createClass({displayName:"CompositionSelector",getInitialState:function(){return this.compositionInfoXhrRequest=null,this.revisionXhrRequest=null,{compositionLoading:!1,compositionName:"Please select a composition",compositionThumbnail:null,compositionError:!1,revisionsLoading:!1,revisions:null}},componentWillMount:function(){this.FetchCompositionInfo(this.props.value)},componentDidMount:function(){this.browserRef=this.refs.browser.refs.child,this.browserRef.filterByType(Is.COMPOSITION)},componentWillReceiveProps:function(e){this.props.value&&e.value&&this.props.value.id!=e.value.id&&this.FetchCompositionInfo(e.value)},componentDidUpdate:function(){},componentWillUnmount:function(){this.compositionInfoXhrRequest&&this.compositionInfoXhrRequest.abort(),this.revisionXhrRequest&&this.revisionXhrRequest.abort()},FetchCompositionInfo:function(e){e?(this.setState({compositionLoading:!0}),this.compositionInfoXhrRequest&&this.compositionInfoXhrRequest.abort(),this.compositionInfoXhrRequest=S().post("/apiv1/browser/items").send([{refId:e.refId,type:"composition"}]).end(function(t,a){if(t)return N.A.add(N.A.TYPE.ERROR,{title:"Fetch composition info "+e.id,description:t}),this.setState(Cs(Cs(Cs({compositionName:"Cannot fetch composition info",revisions:null,compositionThumbnail:null,compositionLoading:!1},"revisions",null),"revisionsLoading",!1),"compositionError",!0)),void(this.compositionInfoXhrRequest=null);a.headers.location?window.location=a.headers.location:(a.body&&a.body[0]?(this.setState({compositionName:a.body[0].name,compositionThumbnail:a.body[0].thumbnail,compositionLoading:!1,compositionError:!1}),this.loadRevisions(a.body[0].id)):this.setState({compositionName:"Please select a composition",compositionThumbnail:null,compositionLoading:!1,revisions:null,revisionsLoading:!1,compositionError:!1}),this.compositionInfoXhrRequest=null)}.bind(this))):this.setState({compositionName:"Please select a composition",compositionThumbnail:null,compositionLoading:!1,compositionError:!1,revisions:null,revisionsLoading:!1})},loadRevisions:function(e){this.setState({revisionsLoading:!0}),this.revisionXhrRequest&&this.revisionXhrRequest.abort(),this.revisionXhrRequest=S().get("/apiv1/compositions/"+e+"/revisions").set("Content-Type","application/json").end(function(e,t){if(this.setState({revisionsLoading:!1}),e)this.setState({revisions:null}),N.A.add(N.A.TYPE.ERROR,{title:"Could not read revision list from server",description:e.message});else{if(t.headers.location)return void(window.location=t.headers.location);for(var a=[{id:"latest",title:"Current"}],i=0,n=t.body.length;i<n;i++)a.push({id:t.body[i].revision_id,title:t.body[i].description});this.setState({revisions:a}),this.revisionXhrRequest=null}}.bind(this))},OnChanged:function(e){if(this.props.onChange){var t={name:e.name,refId:e.refId,revisionId:e.revisionId};this.props.onChange(t),this.FetchCompositionInfo(t)}$("#compBrowserModal-"+this.props.index).modal("toggle")},compositionRevisionChanged:function(e,t){var a={name:this.props.value.name,refId:this.props.value.refId,revisionId:t};this.props.onChange(a)},onImportCompositinClicked:function(e,t){$("#".concat(t)).modal("show");var a=this.refs.browser.refs.child;a.modalPending&&(a.modalPending=!1)},render:function(){var e,t,a=this;if(xs.getDefaultIconFromBrowserShortType(Is.COMPOSITION),this.state.compositionThumbnail&&this.state.compositionThumbnail,1==this.state.revisionsLoading)e=o().createElement("div",{style:{width:"108px",textAlign:"center"}},o().createElement("img",{style:{width:"50px",height:"25px",display:"inline"},src:"/images/loading-bubbles-blue.svg",className:"loader"}));else if(this.state.revisions&&this.state.revisions.length){var i="latest";null!=this.props.value.revisionId&&null!=this.props.value.revisionId&&(i=this.props.value.revisionId),e=o().createElement(ae.A,{name:"revision",selections:this.state.revisions,value:i,onValueChanged:this.compositionRevisionChanged,theme:"light",inline:!0})}else e=o().createElement("div",{style:{width:"108px",textAlign:"center"}},o().createElement("span",{style:{lineHeight:"28px"}},"no revisions found"));var n="importCompButton-".concat(this.props.index),s="compBrowserModal-".concat(this.props.index);return t=1==this.state.compositionLoading?o().createElement("img",{className:"input-group loader",style:{width:"350px",height:"25px",display:"inline"},src:"/images/loading-bubbles-blue.svg"}):o().createElement("div",{className:"input-group",style:{width:"100%"}},o().createElement("div",{className:"input-group-btn dropdown-white"},o().createElement("button",{id:n,tabIndex:"-1",className:"btn btn-white icon-only",disabled:this.props.disabled,onClick:function(e){a.onImportCompositinClicked(n,s)}},o().createElement("i",{className:"fa fa-database"}))),o().createElement("input",{type:"text",className:"form-control v2",value:this.state.compositionName,disabled:"true",style:{color:this.state.compositionError?"red":""}}),o().createElement("div",{className:"input-group-btn dropdown-white"},e)),o().createElement("div",null,t,o().createElement("div",{id:s,className:"modal fade u-displaynone singular-modal compBrowserModal",tabIndex:"-1",role:"dialog"},o().createElement("div",{id:"compBrowserModalDoc",className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-body"},o().createElement(kt.A,{rtdbFolderRef:Dt.A.rtdbFolderRef(),showHeader:!0,browserStyle:"composition-selector-modal",browserTitle:"Composition",showSearch:!0,ref:"browser",showInspector:!1,showClose:!0,modalId:s,showRevisionSelection:!0,useDefaultItemDoubleClick:!1,onItemDoubleClick:this.OnChanged}))))))}}),Ds=o().createClass({displayName:"CompositionElement",getInitialState:function(){return{}},OnNameChanged:function(e){this.OnPropertyChanged("name",e.target.value)},OnPropertyChanged:function(e,t){this.props.OnPropertyChanged&&this.props.OnPropertyChanged(this.props.index,e,t)},OnDeleteElement:function(){this.props.OnDeleteElement&&this.props.OnDeleteElement(this.props.index)},render:function(){return o().createElement("tr",null,o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control v2 mousetrap",name:"name",value:this.props.value.name,onChange:this.OnNameChanged,disabled:this.props.disabled})),o().createElement("td",null,o().createElement(ks,{index:this.props.index,value:this.props.value.composition,onChange:this.OnPropertyChanged.bind(this,"composition"),disabled:this.props.disabled})))}}),As=o().createClass({displayName:"OutputElement",getInitialState:function(){return{}},OnNameChanged:function(e){this.OnPropertyChanged("name",e.target.value)},OnPropertyChanged:function(e,t){this.props.OnPropertyChanged&&this.props.OnPropertyChanged(this.props.index,e,t)},OnDeleteElement:function(){this.props.OnDeleteElement&&this.props.OnDeleteElement(this.props.index)},render:function(){return this.props.availableCompositions,o().createElement("tr",null,o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control v2 mousetrap",name:"name",value:this.props.value.name,onChange:this.OnNameChanged,disabled:this.props.disabled})))}});var Rs=a(9769);const Ps=o().createClass({displayName:"AppTemplateVersion",getInitialState:function(){return this.defaultCompositionElement={name:"Default",composition:null},this.defaultOutputElement={name:"Default",defaultComposition:0},{saveActive:!1,compositionElements:[],outputsElements:[]}},componentWillMount:function(){var e=!1,t=[];try{t=JSON.parse(this.props.version.compositions)}catch(e){}t||(t=[]),0==t.length&&(t.push(this.defaultCompositionElement),e=!0);var a=[];try{a=JSON.parse(this.props.version.outputs)}catch(e){}a||(a=[]),0==a.length&&(a.push(this.defaultOutputElement),e=!0),this.setState({compositionElements:t,outputElements:a,composition_managed_by_singular:this.props.version.composition_managed_by_singular,use_specific_comp:this.props.version.use_specific_comp}),e&&this.props.onNotifyChange&&this.props.onNotifyChange()},getCurrentVersionElement:function(){return{elements_version:this.props.version.version,composition_elements:this.state.compositionElements,output_elements:this.state.outputElements}},saveVersion:function(e){if(Rs.compareObject(this.props.version.compositionElements,this.state.compositionElements)&&Rs.compareObject(this.props.version.outputElements,this.state.outputElements)&&this.props.version.composition_managed_by_singular==this.state.composition_managed_by_singular&&this.props.version.use_specific_comp==this.state.use_specific_comp)e&&e(null,"done");else{var t={compositions:JSON.stringify(this.state.compositionElements),outputs:JSON.stringify(this.state.outputElements),composition_managed_by_singular:this.state.composition_managed_by_singular,use_specific_comp:this.state.use_specific_comp};this.setState({saveActive:!0}),S().put("/apptemplates/"+this.props.version.apptemplate_id+"/versions/"+this.props.version.version+"/metadata").send(t).end(function(t,a){if(this.setState({saveActive:!1}),t)N.A.add(N.A.TYPE.ERROR,{title:"Save appTemplate ID "+this.props.version.apptemplate_id,description:t}),e&&e(t);else{if(e&&e(null,"done"),a.headers.location)return void(window.location=a.headers.location);this.props.rebuildParentCallback&&this.props.rebuildParentCallback()}}.bind(this))}},CompositionElementChanged:function(e,t,a){for(var i=0,n=this.state.compositionElements.length;i<n;i++)i==e&&(this.state.compositionElements[e][t]=a);this.setState({compositionElements:this.state.compositionElements}),this.props.onNotifyChange&&this.props.onNotifyChange()},addCompositionElement:function(){var e=$.extend({},this.defaultCompositionElement);this.state.compositionElements.push(e),this.setState({compositionElements:this.state.compositionElements})},deleteCompositionElement:function(e){this.state.compositionElements.splice(e,1),this.setState({compositionElements:this.state.compositionElements});for(var t=!1,a=0,i=this.state.outputElements.length;a<i;a++)this.state.outputElements[a].defaultComposition==e&&(this.state.outputElements[a].defaultComposition=0,t=!0);t&&this.setState({outputElements:this.state.outputElements})},OutputElementChanged:function(e,t,a){for(var i=0,n=this.state.outputElements.length;i<n;i++)i==e&&(this.state.outputElements[i][t]=a);this.setState({outputElements:this.state.outputElements}),this.props.onNotifyChange&&this.props.onNotifyChange()},addOutputElement:function(){var e=$.extend({},this.defaultOutputElement);this.state.outputElements.push(e),this.setState({outputElements:this.state.outputElements})},deleteOutputElement:function(e){this.state.outputElements.splice(e,1),this.setState({outputElements:this.state.outputElements})},onManageCompositionChanged:function(e){this.setState({composition_managed_by_singular:e.target.checked}),this.props.onNotifyChange&&this.props.onNotifyChange()},onUseSpecificCompChanged:function(e){this.setState({use_specific_comp:e.target.checked}),this.props.onNotifyChange&&this.props.onNotifyChange()},render:function(){if(!this.props.version)return null;var e=!0;"development"==this.props.version.status&&(e=!1);for(var t=[],a=0,i=this.state.compositionElements.length;a<i;a++)t.push({id:a,title:this.state.compositionElements[a].name});var n,s=function(t,a){return o().createElement(Ds,{key:a,index:a,value:t,OnDeleteElement:this.deleteCompositionElement,OnPropertyChanged:this.CompositionElementChanged,disabled:e})}.bind(this),l=function(a,i){return o().createElement(As,{key:i,index:i,value:a,availableCompositions:t,OnDeleteElement:this.deleteOutputElement,OnPropertyChanged:this.OutputElementChanged,disabled:e})}.bind(this);return n=1==this.state.saveActive?o().createElement("div",{className:"panel-body"},o().createElement("div",{className:"row browser-tree component-tree font-tree",style:{width:"100%",height:"100%"}},o().createElement("img",{style:{display:"block",margin:"0 auto"},src:"/images/loading-bubbles-blue.svg",className:"loader"}))):o().createElement("div",null,o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"Default composition of the app"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"table",style:{marginBottom:"0px"}},o().createElement("tbody",null,this.state.compositionElements.map(s),o().createElement("tr",null,o().createElement("td",{style:{paddingTop:"5px",opacity:"0.65"}},"This composition will be used in the virtual app or if the app requires a specific composition")))))),o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"Output"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"table",style:{marginBottom:"0px"}},o().createElement("tbody",null,this.state.outputElements.map(l),o().createElement("tr",null,o().createElement("td",{style:{paddingTop:"5px",opacity:"0.65"}},'This name is used to identify the output and it should be called "Default"')))))),o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"Settings"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"table",style:{marginBottom:"0px"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{width:"20%"}},"Composition Managed By Singular"),o().createElement("td",null,o().createElement("label",{className:"switch",style:{marginBottom:"0px",marginTop:"5px"}},o().createElement("input",{type:"checkbox",className:"switch-input",id:"perUser",checked:this.state.composition_managed_by_singular,onChange:this.onManageCompositionChanged,disabled:e}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"})))),o().createElement("tr",null,o().createElement("td",{style:{width:"20%"}},"Use Specific Composition"),o().createElement("td",null,o().createElement("label",{className:"switch",style:{marginBottom:"0px",marginTop:"5px"}},o().createElement("input",{type:"checkbox",className:"switch-input",id:"perUser",checked:this.state.use_specific_comp,onChange:this.onUseSpecificCompChanged,disabled:e}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"})))))))),o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"API"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"table",style:{marginBottom:"0px"}},o().createElement("tbody",null,o().createElement("tr",{style:{height:"35px"}},o().createElement("td",{style:{width:"20%"}},"api.js"),o().createElement("td",null,this.props.version.api_code?o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":this.props.version.api_code,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard fa-lg"})):o().createElement("span",null,"Not defined"))),o().createElement("tr",{style:{height:"35px"}},o().createElement("td",{style:{width:"20%"}},"api.info"),o().createElement("td",null,this.props.version.api_info?o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":this.props.version.api_info,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard fa-lg"})):o().createElement("span",null,"Not defined"))),o().createElement("tr",{style:{height:"35px"}},o().createElement("td",{style:{width:"20%"}},"api.json"),o().createElement("td",null,this.props.version.api_json?o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":this.props.version.api_json,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard fa-lg"})):o().createElement("span",null,"Not defined")))))))),o().createElement("div",null,n)}});var Ts=a(9769),Ms=a(82465),Os=a(47500);const Ls=o().createClass({displayName:"AppTemplateInfo",_notificationSystem:null,getInitialState:function(){return this.appTemplateVersionHandler=null,this.shareAccountHandler=null,this.inSaveAppProcess=!1,this.scShareToPreviousInputValue="",this.scShareToCurrentInputValue="",{deploykey:"",vaKey:"",versions:[],selectedVersion:null,showBusyIcon:!1,showBusyShare:!0,loadCompData:!1,shareAccounts:[],originalAccounts:[]}},componentWillMount:function(){this.getVersions(),this.readShareAccounts(),this.setState({deploykey:this.props.appTemplate.deploykey,vaKey:this.props.appTemplate.virtualappinstance_key})},componentDidMount:function(){},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},componentWillUnmount:function(){this.appTemplateVersionHandler&&this.appTemplateVersionHandler.abort(),this.shareAccountHandler&&this.shareAccountHandler.abort()},getVersions:function(){this.setState({showBusyIcon:!0}),this.appTemplateVersionHandler&&this.appTemplateVersionHandler.abort(),this.appTemplateVersionHandler=S().get("/apptemplates/"+this.props.appTemplate.id+"/versions").set("Content-Type","application/json").end(function(e,t){var a=[],i=-1;if(this.state.selectedVersion&&(i=this.state.selectedVersion.version),e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot get appTemplate version info",description:e.message}),this.props.notificationSys.addNotification({message:"Cannot get app version info",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);a=t.body}a.sort(function(e,t){return Number(t.version)-Number(e.version)});var n=null;if(a.length>0){-1==i&&(n=a[0]);for(var s=0;s<a.length;s++)if(a[s].version==i){n=a[s];break}}this.setState({versions:a,selectedVersion:n,showBusyIcon:!1}),this.appTemplateVersionHandler=null}.bind(this))},regenerateKey:function(){this.setState({deploykey:"Regenerating key..."}),S().post("/apptemplates/"+this.props.appTemplate.id+"/regeneratekey").end(function(e,t){if(e){var a="Unknown Error";try{a=JSON.parse(e.response.text).error.message}catch(e){}this.props.notificationSys.addNotification({message:"Could not regenerate deploy key",level:"error",autoDismiss:5,position:"tc"}),this.setState({deploykey:a})}else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({deploykey:t.body}),this.props.appTemplate.deploykey=t.body}}.bind(this))},regenerateVaKey:function(){this.setState({vaKey:"Regenerating key..."}),S().post("/apptemplates/"+this.props.appTemplate.id+"/regeneratevakey").end(function(e,t){if(e){var a="Unknown Error";try{a=JSON.parse(e.response.text).error.message.message}catch(e){}this.props.notificationSys.addNotification({message:"Could not regenerate virtual app key",level:"error",autoDismiss:5,position:"tc"}),this.setState({vaKey:a})}else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({vaKey:t.body}),this.props.appTemplate.vaKey=t.body}}.bind(this))},resetVa:function(){this.state.vaKey?(this.setState({loadCompData:!0}),S().post("/apptemplates/"+this.props.appTemplate.id+"/resetva").end(function(e,t){if(this.setState({loadCompData:!1}),e){try{JSON.parse(e.response.text).error.message}catch(e){}this.props.notificationSys.addNotification({message:"Could not load composition data",level:"error",autoDismiss:5,position:"tc"})}else if(t.headers.location)return void(window.location=t.headers.location)}.bind(this))):this.regenerateVaKey()},ValueChanged:function(){this.props.onNotifyChange&&this.props.onNotifyChange()},saveappTemplate:function(e){var t=this;this.inSaveAppProcess?console.log("App in saving process..."):(this.inSaveAppProcess=!0,Os.waterfall([function(e){if(t.refs.appTemplateName.value!=t.props.appTemplate.name||t.refs.appTemplateCategory.value!=t.props.appTemplate.category){var a={name:t.refs.appTemplateName.value,category:t.refs.appTemplateCategory.value,access:"public"};S().put("/apptemplates/"+t.props.appTemplate.id+"/edit").send(a).end(function(t,a){if(t){var i="Unknown Error";try{i=JSON.parse(t.response.text).error.message}catch(e){}e(i)}else e(null,"done")})}else e(null,"done")},function(e,a){t.state.selectedVersion&&"development"==t.state.selectedVersion.status?t.refs.appTemplateVersion.saveVersion(function(e,t){e?a(e):a(null,"done")}):a(null,"done")},function(e,a){if(t.state.shareAccounts.length||t.state.originalAccounts.length){for(var i=t.state.shareAccounts.slice(),n=0;n<i.length;)"invalid"!=i[n].className?n++:i.splice(n,1);t.setState({originalAccounts:i,shareAccounts:i});for(var s=[],o=0;o<i.length;o++)s.push(i[o].label);S().post("/apiv1/apptemplates/"+t.props.appTemplate.id+"/share").send({targetAccountNames:s}).end(function(e,i){e&&(N.A.add(N.A.TYPE.ERROR,{title:"Cannot share app template "+t.props.appTemplate.id+" with accounts "+s.string(),description:e.message}),t.props.notificationSys.addNotification({message:"Cannot share app "+t.props.appTemplate.id+" with account "+s.string(),level:"error",autoDismiss:5,position:"tc"})),a(null,"done")})}else a(null,"done")}],function(a,i){t.inSaveAppProcess=!1,a?(console.error(a),t.props.notificationSys.addNotification({message:"Could not save app",level:"error",autoDismiss:5,position:"tc"})):(t.props.notificationSys.addNotification({message:"App template "+t.props.appTemplate.name+" has been saved",level:"success",autoDismiss:5,position:"tc"}),e&&e())}))},changeVersionStatus:function(e,t){this.setState({showBusyIcon:!0}),S().put("/apptemplates/"+e.apptemplate_id+"/versions/"+e.version+"/status").send({status:t}).end(function(e,t){if(e){var a="Unknown Error";try{a=JSON.parse(e.response.text).error.message}catch(e){}console.log(a),this.props.notificationSys.addNotification({message:"Could not change version status",level:"error",autoDismiss:5,position:"tc"}),this.setState({showBusyIcon:!1})}else{if(t.headers.location)return void(window.location=t.headers.location);this.props.notificationSys.addNotification({message:"App version status as been updated",level:"success",autoDismiss:5,position:"tc"}),this.getVersions()}}.bind(this))},selectVersion:function(e){this.setState({selectedVersion:e})},onShareAccountInputChange:function(e){return this.scShareToPreviousInputValue=this.scShareToCurrentInputValue,this.scShareToCurrentInputValue=e,e},onShareAccountBlur:function(e){var t=e.target.value;if(""==t&&""!=this.scShareToPreviousInputValue&&""==this.scShareToCurrentInputValue&&(t=this.scShareToPreviousInputValue),t){var a=this.state.shareAccounts.slice();a.push({className:"Select-create-option-placeholder",label:t,value:-1}),this.onShareAccountChange(a)}},onShareAccountChange:function(e){var t=this;this.setState({showBusyShare:!0});var a=[];this.scShareToPreviousInputValue="",this.scShareToCurrentInputValue="";for(var i=e.length,n=function(){if("Select-create-option-placeholder"==e[s].className){var n=e[s].label;S().post("/apiv1/accounts/availablename").set("Content-Type","application/json").send({name:n}).end(function(e,t){if(e)this.props.notificationSys.addNotification({message:"Cannot get account information",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);!1===t.body.result?a.push({className:"valid",label:n,value:n}):a.push({className:"invalid",label:n,value:"Invalid-"+Math.random()})}this.setState({shareAccounts:a}),0==--i&&this.setState({showBusyShare:!1})}.bind(t))}else a.push(e[s]),i--},s=0;s<e.length;s++)n();this.setState({shareAccounts:a}),0==i&&this.setState({showBusyShare:!1})},readShareAccounts:function(){this.setState({showBusyShare:!0}),this.shareAccountHandler&&this.shareAccountHandler.abort(),this.shareAccountHandler=S().get("/apiv1/apptemplates/"+this.props.appTemplate.id+"/share").end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot get share account information for app template ID "+this.props.appTemplate.id,description:e.message});else{for(var a=t.body,i=[],n=0,s=a.length;n<s;n++)i.push({className:"valid",label:a[n].target_account_name,value:a[n].target_account_name});this.setState({shareAccounts:i,originalAccounts:i,showBusyShare:!1})}this.shareAccountHandler=null}.bind(this))},render:function(){var e,t,a=function(e){var t,a="version-status-label",i="",n="";return this.state.selectedVersion&&this.state.selectedVersion==e&&(i="active",n="selectedDomElement"),"development"==e.status?(a+=" development",t=o().createElement("div",null,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"publish"},"Publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-upload",onClick:this.changeVersionStatus.bind(this,e,"published")})))):"archived"==e.status?(a+=" archived",t=o().createElement("div",null,o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"publish"},"Publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-upload",onClick:this.changeVersionStatus.bind(this,e,"published")})),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"deprecate"},"Deprecate")},o().createElement("btn",{className:"btn btn-white v2 fa fa-ban",onClick:this.changeVersionStatus.bind(this,e,"deprecated")})))):"deprecated"==e.status?(a+=" deprecated",t=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"archive"},"Archive")},o().createElement("btn",{className:"btn btn-white v2 fa fa-archive",onClick:this.changeVersionStatus.bind(this,e,"archived")}))):"published"==e.status&&(a+=" published",t=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"un-publish"},"Un-publish")},o().createElement("btn",{className:"btn btn-white v2 fa fa-eye-slash",onClick:this.changeVersionStatus.bind(this,e,"archived")}))),o().createElement("tr",{key:e.id,className:i,style:void 0,ref:n},o().createElement("td",{className:a},""),o().createElement("td",{className:"version-icon",style:{cursor:"pointer"},onMouseDown:this.selectVersion.bind(this,e)},o().createElement(ve.A,{src:e.thumbnail,fallbackImage:Ts.getDefaultIconFromBrowserShortType(Ms.APPTEMPLATE),initialImage:"/images/loading-bubbles.svg"})),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle",textAlign:"center"},onMouseDown:this.selectVersion.bind(this,e)},e.version),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},e.status),o().createElement("td",{style:{cursor:"pointer",verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},ge()(e.updated_at).format("YYYY-MM-DD HH:mm:ss")),o().createElement("td",{style:{verticalAlign:"middle"},onMouseDown:this.selectVersion.bind(this,e)},t))}.bind(this),i=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{className:"version-status"},""),o().createElement("th",{style:{textAlign:"left",width:"10%"}}),o().createElement("th",{style:{textAlign:"left",width:"5%"}},"Version"),o().createElement("th",{style:{textAlign:"left",width:"15%"}},"Status"),o().createElement("th",{style:{textAlign:"left",width:"30%"}},"Date Modified"),o().createElement("th",{style:{textAlign:"left",width:"30%"}},"Action")));e=this.state.showBusyIcon?o().createElement("div",{className:"property-group",style:{width:"100%"}},o().createElement("div",{className:"group-title"},"App Versions"),o().createElement("div",{className:"group-body"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))):o().createElement("div",null,o().createElement("div",{className:"property-group",style:{width:"calc(100% - 10px)",marginBottom:"0px"}},o().createElement("div",{className:"group-title"},"App Versions")),o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll",width:"calc(100% - 10px)"}},i,o().createElement("tbody",null,this.state.versions.map(a)))),this.state.selectedVersion&&0==this.state.showBusyIcon&&(t=o().createElement(Ps,{key:this.props.appTemplate.id+"_"+this.state.selectedVersion.id,version:this.state.selectedVersion,rebuildParentCallback:this.getVersions,onNotifyChange:this.props.onNotifyChange,ref:"appTemplateVersion"}));var n=o().createElement("td",{className:this.state.showBusyShare?"validating":"",style:{position:"relative"}},o().createElement(as().Creatable,{className:"singularSelect creatable white",multi:!0,backspaceToRemoveMessage:"",onChange:this.onShareAccountChange,onBlur:this.onShareAccountBlur,onInputChange:this.onShareAccountInputChange,value:this.state.shareAccounts,placeholder:"Enter account name",arrowRenderer:function(){},menuRenderer:function(){},disabled:this.state.showBusyShare}),o().createElement("img",{src:"/images/loading-oval-blue.svg",className:"loader-oval"})),s="";this.state.deploykey&&(s=this.state.deploykey);var l="";this.state.vaKey&&(l=this.state.vaKey);var r="";this.props.appTemplate.name&&(r=this.props.appTemplate.name);var c,d="";return this.props.appTemplate.category&&(d=this.props.appTemplate.category),c=this.state.loadCompData?o().createElement("btn",{className:"btn btn-white",disabled:!0,style:{position:"relative",top:"-5px",width:"120px",height:"28px",marginLeft:"5px",display:"flex",alignItems:"center",justifyContent:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"28px"}})):o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"reset-data"},"Reload the default composition into the virtual app")},o().createElement("btn",{className:"btn btn-white fa fa-refresh",onClick:this.resetVa,style:{position:"relative",top:"-5px",width:"120px",height:"28px",paddingTop:"8px",marginLeft:"5px"}},o().createElement("span",{style:{paddingLeft:"5px",fontFamily:"Lato"}},"Reload Comp"))),o().createElement("div",{className:"widget-detail-body",style:{textShadow:"none"}},o().createElement("div",{className:"left-panel"},o().createElement("div",{className:"property-group",style:{width:"calc(100% - 10px)"}},o().createElement("div",{className:"group-title"},"App Detail"),o().createElement("div",{className:"group-body"},o().createElement("table",{className:"",style:{width:"100%",maxWidth:"700px"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",width:"20%"}},o().createElement("div",{className:"singular-text-label"},"Deploy Key")),o().createElement("td",{style:{width:"80%"}},o().createElement("div",{className:"input-group",style:{width:"100%"}},o().createElement("input",{type:"text",className:"form-control v2",id:"deploykey",name:"deploykey",value:s,disabled:!0}),o().createElement("div",{className:"input-group-btn dropdown-white"},o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":s,"button-tabIndex":"-1"},o().createElement("i",{className:"fa fa-clipboard fa-lg"})),o().createElement("button",{type:"button",className:"btn btn-white dropdown-toggle expand-input-options","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{width:"150px",minWidth:"150px",left:"auto"}},o().createElement("li",{onClick:this.regenerateKey},o().createElement("a",null,"Regenerate Key"))))))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",width:"20%"}},o().createElement("div",{className:"singular-text-label"},"Virtual App Key")),o().createElement("td",{style:{width:"80%"}},o().createElement("div",{className:"input-group",style:{width:"100%"}},o().createElement("input",{type:"text",className:"form-control v2",id:"vaKey",name:"vaKey",value:l,disabled:!0}),o().createElement("div",{className:"input-group-btn dropdown-white"},o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":l,"button-tabIndex":"-1",style:{borderRadius:"0px"}},o().createElement("i",{className:"fa fa-clipboard fa-lg"})),o().createElement("button",{type:"button",className:"btn btn-white dropdown-toggle expand-input-options","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{borderTopLeftRadius:"0px",borderBottomLeftRadius:"0px"}},o().createElement("span",{className:"caret"})),o().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{width:"150px",minWidth:"150px",left:"auto"}},o().createElement("li",{onClick:this.regenerateVaKey},o().createElement("a",null,"Regenerate Key")))),c))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"ID")),o().createElement("td",null,o().createElement("div",{style:{textAlign:"left",minHeight:"28px",lineHeight:"28px"},className:"singular-text-label"},this.props.appTemplate.id))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Name")),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",id:"name",name:"name",defaultValue:r,onChange:this.ValueChanged,ref:"appTemplateName"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Category")),o().createElement("td",null,o().createElement("input",{type:"text",className:"form-control",id:"category",name:"category",defaultValue:d,onChange:this.ValueChanged,ref:"appTemplateCategory"}))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label"},"Shared with")),n))))),o().createElement("div",{className:"appTemplate-versions"},e)),o().createElement("div",{className:"right-panel"},o().createElement("div",{className:"appTemplate-ui"},t)))}}),Vs=o().createClass({displayName:"AppTemplateEditor",_notificationSystem:null,getInitialState:function(){return{groupedappTemplateList:{},appTemplateList:[],selectedappTemplate:null,appTemplateListFilter:"",saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:""}},componentDidMount:function(){var e=this;this.loadData(),this._notificationSystem=this.refs.notificationSystem,It.A.createShortcut("mod+s",function(){e.actionSave()},this.refs.topElement)},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},loadData:function(){this.setState({isLoading:!0,saveIconState:"Normal"}),S().get("/apptemplates/jsonpure?status=development").set("Content-Type","application/json").end(function(e,t){if(e)console.log(e),this._notificationSystem.addNotification({message:"Could not load app data",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);var a=[];t.body.forEach(function(e,t){if(e.category){var i=e.category.replace(/,/g," "),n={name:e.name,id:e.id,categories:i,appTemplate:e};a.push(n)}}),a.sort(function(e,t){return(e.name.toUpperCase()>t.name.toUpperCase())-.5}),this.setState({appTemplateList:a});var i=null;if(this.state.selectedappTemplate)for(var n=0,s=a.length;n<s;n++)if(a[n].id==this.state.selectedappTemplate.id){i=a[n];break}null==i&&a.length>0&&(i=a[0]),this.setState({selectedappTemplate:i})}this.setState({isLoading:!1})}.bind(this))},selectappTemplate:function(e){this.setState({selectedappTemplate:e,saveIconState:"Normal"})},actionAdd:function(){this.setState({isLoading:!0}),S().post("/apptemplates/new").send({name:"Default Name",access:"public",category:"Default"}).end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot create appTemplate",description:e.message}),this._notificationSystem.addNotification({message:"Could not create new app",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);var a=t.body,i=this.state.appTemplateList,n={name:a.name,id:a.id,categories:a.category,appTemplate:a};i.push(n),i.sort(function(e,t){return(e.name.toUpperCase()>t.name.toUpperCase())-.5}),this.setState({selectedappTemplate:n,appTemplateList:i})}this._notificationSystem.addNotification({message:"New app has been created successfully",level:"success",autoDismiss:5,position:"tc"}),this.setState({isLoading:!1})}.bind(this))},onNotifyChange:function(){this.setState({saveIconState:"Armed"})},actionSave:function(){this.setState({saveIconState:"Normal"}),null!=this.state.selectedappTemplate?this.refs.appTemplateInfo.saveappTemplate(this.loadData):(console.log("cannot save, no Apps selected"),this._notificationSystem.addNotification({message:"No app is selected to save",level:"error",autoDismiss:5,position:"tc"}))},openDeleteDialog:function(){null!=this.state.selectedappTemplate&&this.setState({confirmDelete:!0,confirmDeleteMessage:"Are you sure you want to delete control app "+this.state.selectedappTemplate.name+"?"})},actionDelete:function(){this.setState({saveIconState:"Normal",confirmDelete:!1,confirmDeleteMessage:"",isLoading:!0}),null!=this.state.selectedappTemplate?S().delete("/apptemplates/"+this.state.selectedappTemplate.id).end(function(e,t){if(e)N.A.add(N.A.TYPE.ERROR,{title:"Cannot delete App",description:e.message}),this._notificationSystem.addNotification({message:"Could not delete the app",level:"error",autoDismiss:5,position:"tc"});else{if(t.headers.location)return void(window.location=t.headers.location);this._notificationSystem.addNotification({message:"The app has been deleted",level:"success",autoDismiss:5,position:"tc"}),this.loadData()}this.setState({isLoading:!0})}.bind(this)):(console.log("cannot delete, no App selected"),this._notificationSystem.addNotification({message:"No app was selected to delete",level:"error",autoDismiss:5,position:"tc"}))},onSearch:function(e){this.setState({appTemplateListFilter:e})},render:function(){var e,t,a=this,i=function(e,t){var a,i="appTemplate-item";if(this.state.selectedappTemplate&&this.state.selectedappTemplate.id==e.id)i+=" active",a="selectedDomElement";else if(""!=this.state.appTemplateListFilter){var n=this.state.appTemplateListFilter.toUpperCase().trim();if(-1==e.name.toUpperCase().indexOf(n)&&-1==e.categories.toUpperCase().indexOf(n)&&-1==e.id.toString().indexOf(n))return null}return o().createElement("li",{key:"appTemplate-"+t,className:i,onMouseDown:this.selectappTemplate.bind(this,e),ref:a},o().createElement("div",{className:"widget-name"},e.name),o().createElement("div",{className:"widget-category"},e.categories))}.bind(this);this.state.isLoading?e=o().createElement("div",{style:{width:"100%",textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):(e=this.state.appTemplateList.length>0?o().createElement("div",{className:"navigator-wrapper"},o().createElement("ul",{className:"dashboard-tree large-items"},this.state.appTemplateList.map(i))):o().createElement("div",{style:{textAlign:"center",paddingTop:"20px"}},"No apps have been created"),this.state.selectedappTemplate&&(this.state.selectedappTemplate.name,this.state.selectedappTemplate.thumbnail,t=o().createElement(Ls,{key:this.state.selectedappTemplate.id,appTemplate:this.state.selectedappTemplate.appTemplate,onNotifyChange:this.onNotifyChange,ref:"appTemplateInfo",notificationSys:this._notificationSystem})));var n=[];return this.state.selectedappTemplate&&(n=[{type:"Delete",callback:this.openDeleteDialog},{type:"Save",callback:this.actionSave,state:this.state.saveIconState}]),o().createElement("div",{className:"height-100p",ref:"topElement"},o().createElement(li(),{ref:"notificationSystem",style:!1}),o().createElement("div",{className:"height-100p"},o().createElement(Cn,null),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("div",{className:"singular-browser-body"},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"App Manager"),o().createElement("div",{className:"right-area"},"")),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},o().createElement("button",{id:"btnDropNewItem",type:"button",tabIndex:"-1",onClick:this.actionAdd,className:"btn btn-primary new-show-btn",style:{width:"125px"},"aria-expanded":"false"},"New App")),o().createElement("div",{className:"right-area"},o().createElement("div",null,o().createElement(Bn,{mode:"immediate",onSearch:this.onSearch,onSearchClick:this.onSearch,onClearSearchClick:this.onSearch.bind(this,"")})),o().createElement("div",null,o().createElement(os,{configuration:n}))),o().createElement("div",null)),o().createElement("nav",{className:"singular-browser-nav",style:{height:"calc(100% - 120px",borderRight:"solid 1px #ccc"}},e),o().createElement("div",{className:"singular-browser-content",style:{top:"120px"}},o().createElement("div",{className:"widget-detail-wrapper"},t))))),o().createElement(si(),{show:1==this.state.confirmDelete,title:"",text:this.state.confirmDeleteMessage,showCancelButton:!0,animation:!1,onConfirm:function(){a.setState({confirmDelete:!1}),a.actionDelete()},onCancel:function(){a.setState({confirmDelete:!1})},onEscapeKey:function(){a.setState({confirmDelete:!1})},onOutsideClick:function(){a.setState({confirmDelete:!1})}}))}});var _s=a(45465),Fs=a.n(_s);const Bs=o().createClass({displayName:"CKEditor",getInitialState:function(){return this.elementName="editor_"+this.props.id,this.componentDidMount=this.componentDidMount.bind(this),{}},componentDidMount:function(){CKEDITOR.replace(this.elementName,{toolbar:[["Bold","Italic","-","NumberedList","BulletedList","-","Outdent","Indent"]]}),CKEDITOR.instances[this.elementName].on("change",function(){var e=CKEDITOR.instances[this.elementName].getData();this.props.onChange(e)}.bind(this))},setData:function(e){CKEDITOR.instances[this.elementName].setData(e)},render:function(){return o().createElement("textarea",{name:this.elementName})}});a(88170);const Us=o().createClass({displayName:"ReleaseNoteInfo",onInputChanged:function(e,t){this.props.onReleaseNoteInfoChanged&&("published_at"==e&&(t=ge()(t,"x").utc().format("YYYY-MM-DDTHH:mm:ss.000Z")),this.props.onReleaseNoteInfoChanged(e,t))},setDescriptionText:function(e){this.refs.txtDescEditor.setData(e)},render:function(){var e=this,t=this.props.releasenote,a=new Date;t.published_at&&(a=ge()(t.published_at).toDate());var i=o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Id"),o().createElement("td",{className:"field-col"},t.id)),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Title"),o().createElement("td",{className:"field-col"},o().createElement("input",{id:"txtTitle",name:"txtTitle",type:"text",value:t.title,className:"form-control",placeholder:"please enter Title",onChange:function(t){return e.onInputChanged("title",t.target.value)}}))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Status"),o().createElement("td",{className:"field-col"},o().createElement("select",{id:"ddlStatus",name:"ddlStatus",value:t.status,className:"form-control",onChange:function(t){return e.onInputChanged("status",t.target.value)}},o().createElement("option",{value:"published"},"Published"),o().createElement("option",{value:"draft"},"Draft")))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Published Time"),o().createElement("td",{className:"field-col dpk"},o().createElement(Fs(),{value:a,inputProps:{id:"dpkPublishedTime",placeholder:"please enter published time",readOnly:"true"},dateFormat:"MM/DD/YYYY",timeFormat:"HH:mm",ref:"dpkPublished",onChange:function(t){return e.onInputChanged("published_at",t)}}))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Url"),o().createElement("td",{className:"field-col"},o().createElement("input",{type:"text",value:t.url,className:"form-control",placeholder:"please enter Url",onChange:function(t){return e.onInputChanged("url",t.target.value)}}))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Type"),o().createElement("td",{className:"field-col"},o().createElement("select",{value:t.type,className:"form-control",onChange:function(t){return e.onInputChanged("type",t.target.value)}},o().createElement("option",{value:"update"},"Update"),o().createElement("option",{value:"new-feature"},"New Feature"),o().createElement("option",{value:"bug-fix"},"Bug Fix")))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Category"),o().createElement("td",{className:"field-col"},o().createElement("select",{value:t.category||"none",className:"form-control",onChange:function(t){return e.onInputChanged("category",t.target.value)}},o().createElement("option",{value:"none"},"No Category"),o().createElement("option",{value:"spark"},"Spark"),o().createElement("option",{value:"studio"},"Studio"),o().createElement("option",{value:"dashboard"},"Dashboard"),o().createElement("option",{value:"composer"},"Composer"),o().createElement("option",{value:"api"},"API")))),o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{verticalAlign:"top"}},"Description"),o().createElement("td",{className:"field-col"},o().createElement(Bs,{id:"txtDesc",value:t.description,onChange:function(t){return e.onInputChanged("description",t)},ref:"txtDescEditor"})))));return o().createElement("div",{style:{height:"100%"}},o().createElement("div",{className:"profile-properties",style:{marginRight:"0px"}},o().createElement("div",{className:"property-group",style:{width:"calc(100% - 20px)"}},o().createElement("div",{className:"group-title"},"Update details"),o().createElement("div",{className:"group-body"},i))))}});var Ws=a(88170);const js=o().createClass({displayName:"ReleaseNoteList",getInitialState:function(){return this.latestDeleteId=0,{releaseNotesData:[],showBusyIcon:!1,activeReleaseNote:this.getEmptyActiveReleaseNote(),confirmDelete:!1}},getEmptyActiveReleaseNote:function(){return{id:0,title:"",description:"",status:"draft",url:"",type:"update",published_at:new Date}},componentDidMount:function(){this.loadAllReleaseNotes()},loadAllReleaseNotes:function(){this.setState({releaseNotesData:[],showBusyIcon:!0}),0==this.state.activeReleaseNote.id&&this.refs.releaseNoteInfo.setDescriptionText(""),S().get("/apiv1/releasenotes").set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{var a,i=[];e?(console.log("error while reading release notes: "+e),this.setState({showBusyIcon:!1})):i=t.body,i.sort(function(e,t){return e.id>t.id?-1:e.id<t.id?1:0});for(var n=0;n<i.length;n++){var s=i[n];this.state.activeReleaseNote&&this.state.activeReleaseNote.id==s.id&&(a=s),this.latestDeleteId&&s.id<this.latestDeleteId&&(a?s.id>a&&(a=s):a=s)}a||(a=i.length?i[0]:this.getEmptyActiveReleaseNote()),this.setState({releaseNotesData:i,showBusyIcon:!1}),this.selectedReleaseNote(a),this.latestDeleteId=0}}.bind(this))},selectedReleaseNote:function(e){var t=this.state.activeReleaseNote;JSON.stringify(e)!=JSON.stringify(t)&&(this.setState({activeReleaseNote:e}),this.refs.releaseNoteInfo.setDescriptionText(e.description),this.props.onRowSelected&&this.props.onRowSelected())},onReleaseNoteInfoChanged:function(e,t){var a=this.state.activeReleaseNote,i={};$.extend(!0,i,a),i[e]=t,JSON.stringify(i)!=JSON.stringify(a)&&(this.setState({activeReleaseNote:i}),this.props.onInfoChanged&&this.props.onInfoChanged())},onReleaseNoteInfoAction:function(e){switch(e){case"Create":var t=this.state.activeReleaseNote;this.setState({showBusyIcon:!0}),t.id=0,S().post("/apiv1/releasenotes/").send(t).end(function(e,t){this.loadAllReleaseNotes()}.bind(this));break;case"Update":t=this.state.activeReleaseNote,this.setState({showBusyIcon:!0}),S().put("/apiv1/releasenotes/"+t.id).send(t).end(function(e,t){this.loadAllReleaseNotes()}.bind(this));break;case"Delete":this.setState({confirmDelete:!0});break;case"Cancel":this.setState({activeReleaseNote:this.getEmptyActiveReleaseNote()}),this.refs.releaseNoteInfo.setDescriptionText("")}},actionDelete:function(){1==this.state.confirmDelete&&this.setState({confirmDelete:!1});var e=this.state.activeReleaseNote;this.latestDeleteId=e.id,this.setState({showBusyIcon:!0}),S().delete("/apiv1/releasenotes/"+e.id).end(function(e,t){this.loadAllReleaseNotes()}.bind(this))},getDateTimeDisplayed:function(e){return e?ge()(e).format("MMMM DD, YYYY HH:mm"):""},render:function(){var e,t=this,a=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"}},"ID"),o().createElement("th",{style:{width:"35%",textAlign:"left"}},"Title"),o().createElement("th",{style:{width:"10%",textAlign:"center"}},"Status"),o().createElement("th",{style:{width:"10%",textAlign:"center"}},"Type"),o().createElement("th",{style:{width:"10%",textAlign:"center"}},"Category"),o().createElement("th",{style:{width:"15%",textAlign:"center"}},"Published"),o().createElement("th",{style:{width:"15%",textAlign:"center"}},"Modified"))),i=function(e){var t=this.props.search.toUpperCase();if(""!=t&&-1==e.title.toUpperCase().indexOf(t))return null;var a="";this.state.activeReleaseNote&&this.state.activeReleaseNote.id==e.id&&(a=" active");var i=Ws.STATUS_NAME_MAP[e.status]||"",n=Ws.TYPE_NAME_MAP[e.type]||"",s=Ws.CATEGORY_NAME_MAP[e.category]||"No Category";return o().createElement("tr",{key:e.id,onClick:this.selectedReleaseNote.bind(this,e),className:a},o().createElement("td",{style:{textAlign:"center"}},e.id),o().createElement("td",{style:{textAlign:"left"}},e.title),o().createElement("td",{style:{textAlign:"center"}},i),o().createElement("td",{style:{textAlign:"center"}},n),o().createElement("td",{style:{textAlign:"center"}},s),o().createElement("td",{style:{textAlign:"center",whiteSpace:"nowrap"}},this.getDateTimeDisplayed(e.published_at)),o().createElement("td",{style:{textAlign:"center",whiteSpace:"nowrap"}},this.getDateTimeDisplayed(e.updated_at)))}.bind(this);e=this.state.showBusyIcon?o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},a,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))))):o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},a,o().createElement("tbody",null,this.state.releaseNotesData.map(i)));var n=o().createElement(Us,{ref:"releaseNoteInfo",releasenote:this.state.activeReleaseNote,onReleaseNoteInfoAction:this.onReleaseNoteInfoAction,onReleaseNoteInfoChanged:this.onReleaseNoteInfoChanged});return o().createElement("div",{className:"profile-wrapper",style:{height:"calc(100% - 43px)"}},o().createElement("div",{className:"releasenote-administration-wrapper"},o().createElement("div",{className:"releasenote-list",style:{overflow:"scroll",height:"100%",marginLeft:"5px",marginTop:"10px",width:"calc(100% - 562px)"}},e),o().createElement("div",{className:"profile-wrapper"},n)),o().createElement(si(),{show:1==this.state.confirmDelete,title:"",text:"Are you sure you want to delete?",showCancelButton:!0,onConfirm:function(){t.actionDelete()},onCancel:function(){1==t.state.confirmDelete&&t.setState({confirmDelete:!1})},onEscapeKey:function(){1==t.state.confirmDelete&&t.setState({confirmDelete:!1})},onOutsideClick:function(){1==t.state.confirmDelete&&t.setState({confirmDelete:!1})}}))}}),Ys=o().createClass({displayName:"ReleaseNoteEditor",getInitialState:function(){return{searchValue:"",mode:"Create",saveIconState:"Normal"}},componentDidMount:function(){},onAdd:function(){this.onToolbarCallback("Create"),this.setState({mode:"Create"})},onUpdate:function(){this.onToolbarCallback("Update"),this.setState({mode:"Create"})},onCancel:function(){this.onToolbarCallback("Cancel"),this.setState({mode:"Create"})},onDelete:function(){this.onToolbarCallback("Delete"),this.setState({mode:"Create"})},onToolbarCallback:function(e){this.refs.releaseNoteList.onReleaseNoteInfoAction(e)},onRowSelected:function(){this.setState({mode:"Update",saveIconState:"Normal"})},onInfoChanged:function(){"Armed"!=this.state.saveIconState&&this.setState({saveIconState:"Armed"})},onSearchChange:function(e){this.setState({searchValue:e})},render:function(){var e=o().createElement(js,{search:this.state.searchValue,onRowSelected:this.onRowSelected,onInfoChanged:this.onInfoChanged,ref:"releaseNoteList"}),t=[];return"Create"==this.state.mode?t.push({type:"AddReleaseNote",callback:this.onAdd}):(t.push({type:"AddReleaseNote",callback:this.onAdd}),t.push({type:"UpdateReleaseNote",callback:this.onUpdate,state:this.state.saveIconState}),t.push({type:"CancelReleaseNote",callback:this.onCancel}),t.push({type:"DeleteReleaseNote",callback:this.onDelete})),o().createElement("div",{style:{height:"100%"}},o().createElement(Cn,null),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Release Notes"),o().createElement("div",{className:"right-area"})),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"}),o().createElement("div",{className:"right-area"},o().createElement(Bn,{mode:"immediate",onSearch:this.onSearchChange}),o().createElement(os,{configuration:t}))),o().createElement("div",{className:"singular-browser-body"},o().createElement("div",{className:"singular-browser-content",style:{width:"100%",left:"0px"}},o().createElement("div",{style:{height:"100%"}},e)))))}});function Hs(e){return Hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hs(e)}function zs(e,t,a){return(t=function(e){var t=function(e){if("object"!=Hs(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Hs(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hs(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Gs=a(88170);const Ks=o().createClass({displayName:"ViewReleasenotes",getInitialState:function(){return this.hasNoteData=!1,{navigateItems:[],releaseNotes:[],showBusyIcon:!1,searchValue:"",userLastSeenId:0,selectedMonthYear:ge()(new Date).format("MMMM YYYY"),currentMonthYear:ge()(new Date).format("MMMM YYYY"),currentMonthYearValue:ge()(new Date).format("YYYYMM")}},componentDidMount:function(){this.getUserReleaseNotes()},onSearch:function(e){this.setState({searchValue:e})},onChangeYear:function(e){this.setState({selectedMonthYear:e})},getUserReleaseNotes:function(){this.setState({navigateItems:[],userLastSeenId:0,releaseNotes:[],showBusyIcon:!0}),S().get("/apiv1/releasenotes/userreleasenotes").set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{var a=[],i=[],n=0;if(e)console.log("error while reading release notes: "+e);else{if(n=t.body.userLastSeenId,0==(a=t.body.data).length)a=[];else{var s="|"+this.state.currentMonthYear+"|";i.push({text:this.state.currentMonthYear,value:this.state.currentMonthYearValue});for(var o=0;o<a.length;o++){var l=ge()(a[o].published_at).format("MMMM YYYY"),r=(ge()(a[o].published_at).format("YYYYMM"),"|"+l+"|");s.indexOf(r)<0&&(i.push({text:l,value:ge()(a[o].published_at).format("YYYYMM")}),s+=r)}i.sort(function(e,t){return e.value>t.value?-1:e==t?0:1}),a.sort(function(e,t){var a=e.published_at,i=t.published_at;return a>i?-1:a==i?0:1})}this.setState({navigateItems:i,userLastSeenId:n,releaseNotes:a,showBusyIcon:!1})}}}.bind(this))},render:function(){this.state.selectedMonthYear.toString();var e,t,a=function(e){var t,a=e.text;return e.value,this.state.selectedMonthYear==a&&(t=" active"),o().createElement("li",{className:t,key:a,onClick:this.onChangeYear.bind(this,a)},o().createElement("span",{style:{display:"inline-block",top:"6px"}},o().createElement("div",{className:"asset-label"},a)))}.bind(this),i=function(e){if(ge()(e.published_at).format("MMMM YYYY")!=this.state.selectedMonthYear)return null;var t,a=this.state.searchValue.toUpperCase();if(""!=a&&-1==e.title.toUpperCase().indexOf(a))return null;0==this.hasNoteData&&(this.hasNoteData=!0);var i,n="";e.id>this.state.userLastSeenId&&(t=o().createElement("span",{className:"label label-info",style:{marginRight:"10px"}},"New"));var s,l=o().createElement("span",{className:"label label-default",style:{marginRight:"10px"}},Gs.CATEGORY_NAME_MAP[e.category]||"No Category");switch(i=ge()(e.published_at).format("MMMM DD, YYYY"),e.type){case"update":n=o().createElement("span",{style:{color:"#8bc34a",fontWeight:"300"}},"Update");break;case"new-feature":n=o().createElement("span",{style:{color:"#2196f3",fontWeight:"300"}},"New Feature");break;case"bug-fix":n=o().createElement("span",{style:{color:"#F44336",fontWeight:"300"}},"Bug Fix")}return e.url&&(s=o().createElement("div",null,o().createElement("a",{href:e.url,target:"_blank",className:"btn btn-primary"},"More Info"))),o().createElement("div",{className:"release-note"},o().createElement("h2",null,t,n," - ",e.title," "),o().createElement("div",{className:"update-datetime"},l,i),o().createElement("div",{dangerouslySetInnerHTML:{__html:e.description},className:"release-note-content"}),s)}.bind(this);return this.state.showBusyIcon?(e=o().createElement("ul",{className:"dashboard-tree"},o().createElement("ul",{id:"folder-tree-item-root"},o().createElement("img",{src:"/images/loading-bubbles.svg",className:"loader"}))),t=null):(e=o().createElement("ul",{className:"dashboard-tree"},o().createElement("ul",{id:"folder-tree-item-root"},this.state.navigateItems.map(a))),this.hasNoteData=!1,t=this.state.releaseNotes.map(i),0==this.hasNoteData&&(t=o().createElement("div",{style:zs(zs({width:"100% !important"},"width","100%"),"textAlign","center")},o().createElement("div",{className:"group-body"},o().createElement("div",{className:"col-xs-12 col-md-12 vcenter"},o().createElement("span",{className:"h3"},"We are polishing the engine, squishing the bugs, bolting on the shiny new parts. Updates will be posted soon!")))))),o().createElement("div",{className:"height-100p",style:{overflowY:"hidden"}},o().createElement(Cn,null),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("div",{className:"singular-browser-body",style:{height:"100%"}},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Release Notes"),o().createElement("div",{className:"right-area"},"")),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"},""),o().createElement("div",{className:"right-area"},o().createElement("div",null,o().createElement(Bn,{mode:"immediate",onSearch:this.onSearch,onSearchClick:this.onSearch,onClearSearchClick:this.onSearch.bind(this,"")})),o().createElement("div",null,"")),o().createElement("div",null)),o().createElement("nav",{className:"singular-browser-nav",style:{padding:"20px"}},o().createElement("div",{className:"navigator-wrapper"},e)),o().createElement("div",{className:"singular-browser-content",style:{top:"120px",height:"calc(100% - 180px)",left:"200px",width:"calc(100% - 200px)"}},o().createElement("div",{className:"singular-browser-content-scroll",style:{overflowY:"auto",height:"100%"}},o().createElement("div",{className:"release-note-wrapper"},o().createElement("h1",null,"Release Notes - ",this.state.selectedMonthYear.toString()),t))))))}});var $s=a(94948),qs=a.n($s);const Js=o().createClass({displayName:"UserInfo",getInitialState:function(){return{currentPassword:"",newPassword:"",repeatPassword:"",changePasswordState:!1,changePasswordError:"",passwordBusy:!1,currentAccountName:""}},componentWillMount:function(){this.setState({currentAccountName:this.props.accountName})},componentWillReceiveProps:function(e){(this.props.user&&!e.user||!this.props.user&&e.user||this.props.user.id!=e.user.id)&&this.cancelPassword(),e.accountName!=this.props.accountName&&this.setState({currentAccountName:e.accountName})},onPropertiesChanged:function(e,t){this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged(e,t.target.value)},onToggleChanged:function(e,t){this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged(e,t.target.checked)},onAccountNameChanged:function(e){this.setState({currentAccountName:e.target.value}),this.props.onAccountNameChanged&&this.props.onAccountNameChanged(e.target.value)},onCurrentPasswordChanged:function(e){this.setState({currentPassword:e.target.value}),this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged("currentpassword",e.target.value)},onNewPasswordChanged:function(e){this.setState({newPassword:e.target.value}),this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged("password",e.target.value)},onRepeatPasswordChanged:function(e){this.setState({repeatPassword:e.target.value}),this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged("repeatpassword",e.target.value)},changePassword:function(){this.setState({changePasswordState:!0,changePasswordError:""})},savePassword:function(){var e;if("UserAdministration"==this.props.mode){var t={userId:this.props.user.id,password:this.state.newPassword,confirmpassword:this.state.repeatPassword};e=S().put("/apiv1/users/changepasswordadmin").send(t)}else t={currentpassword:this.state.currentPassword,password:this.state.newPassword,confirmpassword:this.state.repeatPassword},e=S().put("/apiv1/users/changepassword").send(t);this.setState({passwordBusy:!0,changePasswordError:""}),e.end(function(e,t){if(e){var a=JSON.parse(t.text),i=a.error?a.error.message:a.message;this.props.onNotification("Cannot change password: "+i,"error",10,"tc"),this.setState({changePasswordError:i}),this.setState({passwordBusy:!1})}else{if(t.headers.location)return void(window.location=t.headers.location);"UserProfile"!=this.props.mode&&0==this.props.user.emailVerified&&this.props.user.id!=window.singularUser.account.accountAdminId?S().put("/apiv1/users/"+this.props.user.id+"/verify").end(function(e,t){if(e)this.props.onNotification("Cannot verify email: "+t.error.message,"error",10,"tc"),this.setState({passwordBusy:!1});else{if(t.headers.location)return void(window.location=t.headers.location);this.props.onActiveUserPropertiesChanged&&this.props.onActiveUserPropertiesChanged("emailVerified",!0),this.cancelPassword()}}.bind(this)):this.cancelPassword()}}.bind(this))},cancelPassword:function(){this.setState({changePasswordState:!1,currentPassword:"",newPassword:"",repeatPassword:"",changePasswordError:"",passwordBusy:!1})},onChangeEmail:function(){var e=this,t=this.props.user.id,a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;qs()({title:"Please enter a new email",input:"text",inputAttributes:{autocapitalize:"off",style:"color: #595959"},confirmButtonText:"Confirm",showLoaderOnConfirm:!0,onOpen:function(){qs().disableConfirmButton(),qs().getInput().addEventListener("keyup",function(e){a.test(e.target.value)?qs().enableConfirmButton():qs().disableConfirmButton()})},preConfirm:function(i){if(a.test(i)&&""!=i){var n=new FormData;n.append("user_id",t),n.append("email",i),fetch("/apiv1/users/changeemail/",{method:"PUT",body:n}).then(function(t){t.json().then(function(e){return{data:e,status:t.status}}).then(function(t){200!==t.status?qs()({title:"Failed to change email",text:t.data.error.message,type:"error"}):(e.props.loadAllUsers(),qs()({title:"Success",type:"success"}))})})}else qs().disableLoading(),qs().showValidationError("Please enter a valid email")}})},render:function(){if(!this.props.user)return null;var e,t,a={};$.extend(!0,a,this.props.user,this.props.mutatedUser),e=o().createElement("input",{type:"text",className:"form-control",disabled:!0,readOnly:!0,value:a.email}),0==a.emailVerified&&(t=o().createElement("span",{style:{position:"relative",top:"15px"}},"The email of this user hasn't been verified yet. The user has to follow the verification link that was sent to this email or you can change the password here to verify the user."));var i=o().createElement("div",{className:"details-panel",style:{margin:"10px auto 0px auto"}},o().createElement("div",{className:"details-panel-header"},"Details"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Created"),o().createElement("div",{style:{fontWeight:"300"}},ge()(a.created_at).format("YYYY-MM-DD HH:mm:ss")))),o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Modified"),o().createElement("div",{style:{fontWeight:"300"}},ge()(a.updated_at).fromNow())))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Last Login"),o().createElement("div",{style:{fontWeight:"300"}},a.lastloggedin_at?ge()(a.lastloggedin_at).fromNow():"never"))),o().createElement("td",null)))),t)),n=!1;"UserProfile"==this.props.mode&&(n=!0);var s,l,r,c,d,p,m,u,h=!1;if(a.id==window.singularUser.account.accountAdminId&&(h=!0),0==this.state.changePasswordState&&"CreateUser"!=this.props.mode)s=o().createElement("tr",null,o().createElement("td",{style:{padding:"0px"}},o().createElement("div",{style:{display:"flex",width:"100%"}},o().createElement("input",{type:"password",className:"form-control",readOnly:!0,disabled:!0,value:"fakePassword",style:{flex:"1"}}),o().createElement("button",{className:"btn btn-white",type:"button",onClick:this.changePassword,style:{left:"-10px",height:"30px",lineHeight:"1",position:"relative",top:"-5px",padding:"2px 15px"}},o().createElement("i",{className:"fa fa-pencil",style:{float:"none",position:"static"}})))));else{var f;"UserProfile"==this.props.mode&&(s=o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Password"),o().createElement("td",{className:"field-col"},o().createElement("input",{type:"password",className:"form-control",value:this.state.currentPassword,onChange:this.onCurrentPasswordChanged})))),f="UserProfile"==this.props.mode?"New":"Password",l=o().createElement("tr",null,o().createElement("td",{className:"label-col"},f),o().createElement("td",{className:"field-col"},o().createElement("input",{type:"password",className:"form-control",value:this.state.newPassword,onChange:this.onNewPasswordChanged}))),r=o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Repeat"),o().createElement("td",{className:"field-col"},o().createElement("input",{type:"password",className:"form-control",value:this.state.repeatPassword,onChange:this.onRepeatPasswordChanged}))),"CreateUser"!=this.props.mode&&(c=1==this.state.passwordBusy?o().createElement("tr",null,o().createElement("td",{className:"label-col"}),o().createElement("td",{className:"field-col"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"35px"}}))):"UserAdministration"===this.props.mode?o().createElement("tr",null,o().createElement("td",{style:{padding:"0px"},colSpan:"2"},o().createElement("div",{style:{display:"flex",justifyContent:"space-around"}},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",type:"button",onClick:this.savePassword,style:{width:"80px"}},"Save"),o().createElement("button",{className:"btn btn-white",tabIndex:"-1",type:"button",onClick:this.cancelPassword,style:{width:"80px",marginLeft:"10px"}},"Cancel")))):o().createElement("tr",null,o().createElement("td",{className:"label-col"}),o().createElement("td",{className:"field-col"},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",type:"button",onClick:this.savePassword,style:{width:"80px"}},"Save"),o().createElement("button",{className:"btn btn-white",tabIndex:"-1",type:"button",onClick:this.cancelPassword,style:{width:"80px",marginLeft:"10px"}},"Cancel"))));var g=this.state.changePasswordError;this.props.passwordError&&(g=this.props.passwordError),d=o().createElement("tr",null,o().createElement("td",{className:"label-col"}),o().createElement("td",{className:"field-col"},g))}return a.id==window.singularUser.account.accountAdminId&&(p=o().createElement("div",{style:{marginLeft:"30px"}},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"This is the admin user")},o().createElement("i",{className:"fa fa-diamond"})))),"UserProfile"==this.props.mode&&a.id==window.singularUser.account.accountAdminId&&(m=o().createElement("div",{className:"details-panel",style:{margin:"10px auto 0px auto"}},o().createElement("div",{className:"details-panel-header"},"Account"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Account Name"),o().createElement("div",null,o().createElement("input",{type:"text",className:"form-control",value:this.state.currentAccountName,onChange:this.onAccountNameChanged})))))))))),u=a.is_sso?o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Single sign-on"),o().createElement("div",null,"More info will be here"))):o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Password"),o().createElement("div",null,o().createElement("table",null,o().createElement("tbody",null,s,l,r,c,d))))),o().createElement("div",{className:"developer-manager",style:{height:this.props.height,overflow:"auto",padding:"0px 5px"}},o().createElement("div",{className:"details-panel",style:{margin:"10px auto 0px auto"}},o().createElement("div",{className:"details-panel-header"},"User Information ",p),o().createElement("div",{className:"details-panel-body"},"UserAdministration"!==this.props.mode&&o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"First name"),o().createElement("div",null,o().createElement("input",{type:"text",className:"form-control",value:a.firstName,onChange:this.onPropertiesChanged.bind(this,"firstName")})))),o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Last name"),o().createElement("div",null,o().createElement("input",{type:"text",className:"form-control",value:a.lastName?a.lastName:"",onChange:this.onPropertiesChanged.bind(this,"lastName")}))))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"top"}},o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Email Address"),o().createElement("div",null,e))),u))),"UserAdministration"===this.props.mode&&o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"First name"),o().createElement("div",null,o().createElement("input",{type:"text",className:"form-control",value:a.firstName,onChange:this.onPropertiesChanged.bind(this,"firstName")}))))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Last name"),o().createElement("div",null,o().createElement("input",{type:"text",className:"form-control",value:a.lastName?a.lastName:"",onChange:this.onPropertiesChanged.bind(this,"lastName")}))))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"detail-label"},"Email Address"),o().createElement("div",{style:{display:"flex",width:"100%"}},o().createElement("input",{type:"email",className:"form-control",readOnly:!0,disabled:!0,value:a.email,style:{flex:"1"}}),o().createElement("button",{className:"btn btn-white",type:"button",onClick:this.onChangeEmail,style:{left:"-10px",height:"30px",lineHeight:"1",position:"relative",top:"-5px",padding:"2px 15px"}},o().createElement("i",{className:"fa fa-pencil",style:{float:"none",position:"static"}}))))),o().createElement("tr",null,u))))),o().createElement("div",{className:"details-panel",style:{margin:"10px auto 0px auto"}},o().createElement("div",{className:"details-panel-header"},"User Settings"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"detail-label"},"User Administration")),o().createElement("td",null,o().createElement("label",{className:"switch"},o().createElement("input",{type:"checkbox",className:"switch-input",id:"perUser",checked:a.permUserManagement,onChange:this.onToggleChanged.bind(this,"permUserManagement"),disabled:n||h}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"})))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"detail-label"},"Developer Tools")),o().createElement("td",null,o().createElement("label",{className:"switch"},o().createElement("input",{type:"checkbox",className:"switch-input",id:"perDev",checked:a.permDevTool,onChange:this.onToggleChanged.bind(this,"permDevTool"),disabled:n}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"})))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{className:"detail-label"},"Server Status Notification Email")),o().createElement("td",null,o().createElement("label",{className:"switch"},o().createElement("input",{type:"checkbox",className:"switch-input",id:"perDev",checked:a.email_status_notification,onChange:this.onToggleChanged.bind(this,"email_status_notification"),disabled:n}),o().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),o().createElement("span",{className:"switch-handle"})))),o().createElement("tr",null,o().createElement("td",{colSpan:"2"},o().createElement("div",{className:"detail-label",style:{fontSize:"12px"}},"User settings can be changed by your account administrator in the User Administration panel"))))))),m,i)}}),Xs=o().createClass({displayName:"UserProfile",getInitialState:function(){return{user:{},mutatedUser:{},mutatedAccountName:window.singularUser.account.accountName||null,showBusyIcon:!1,saveIconState:"Normal"}},componentWillMount:function(){},componentDidMount:function(){this.loadProfile()},loadProfile:function(){this.setState({showBusyIcon:!0,user:null}),S().get("/apiv1/users/me").set("Content-Type","application/json").end(function(e,t){if(e)console.log("error while reading user profile: "+e),this.setState({showBusyIcon:!1});else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({user:t.body,showBusyIcon:!1})}}.bind(this))},onChange:function(e,t){var a=this.state.mutatedUser;a[e]=t,this.setState({mutatedUser:a}),"password"!=e&&"repeatpassword"!=e&&"currentpassword"!=e&&this.setState({saveIconState:"Armed"})},onAccountNameChanged:function(e){this.setState({saveIconState:"Armed",mutatedAccountName:e})},actionSave:function(){this.props.onNotification("Saving data","info",5,"tc"),this.setState({saveIconState:"Busy"}),E().parallel([function(e){var t={},a=!1;null!=this.state.mutatedUser.lastName&&(t.lastName=this.state.mutatedUser.lastName,a=!0),null!=this.state.mutatedUser.firstName&&(t.firstName=this.state.mutatedUser.firstName,a=!0),a?S().put("/apiv1/users/"+this.state.user.id+"/metadata").send(t).end(function(t,a){if(t)console.log("cannot save user data"),e("cannot save user data");else{if(a.headers.location)return void(window.location=a.headers.location);e(null,"done")}}.bind(this)):e(null,"done_nochange")}.bind(this),function(e){if(this.state.mutatedAccountName!=window.singularUser.account.accountName){var t={name:this.state.mutatedAccountName};S().post("/apiv1/accounts/rename").send(t).end(function(t,a){if(t)console.log("cannot rename account data"),e("cannot rename account data");else{if(a.headers.location)return void(window.location=a.headers.location);window.singularUser.account.accountName=this.state.mutatedAccountName,e(null,"done")}}.bind(this))}else e(null,"done_nochange")}.bind(this)],function(e,t){if(e)this.props.onNotification("Cannot save data","error",5,"tc");else{var a=t[0];t[1],"done"==a&&this.loadProfile(),this.props.onNotification("Data save successfully","success",5,"tc")}this.setState({saveIconState:"Normal"})}.bind(this))},render:function(){var e;e=1==this.state.showBusyIcon?o().createElement("div",{className:"loader-wrapper"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):o().createElement(Js,{user:this.state.user,mode:"UserProfile",mutatedUser:this.state.mutatedUser,accountName:window.singularUser.account.accountName,onActiveUserPropertiesChanged:this.onChange,onAccountNameChanged:this.onAccountNameChanged,onNotification:this.props.onNotification,height:"calc(100% - 75px)"});var t=[{type:"Save",callback:this.actionSave,state:this.state.saveIconState}];return o().createElement("div",{className:"profile-wrapper"},o().createElement("div",{className:"singular-browser-body-tools"},o().createElement(os,{configuration:t})),o().createElement("div",{style:{height:"100%"}},e))}});var Zs=a(8229),Qs=a.n(Zs);const eo=o().createClass({displayName:"UserAdministration",getInitialState:function(){return this.fetchUserRequest=null,{users:[],activeUser:null,mutateUserData:this.getDefaultNewUserData(),showBusyIcon:!1,createUserActive:!1,passwordError:null,confirmDelete:!1,confirmDeleteMessage:"",showTooManyUsersDialog:!1,tooManyUsersMessage:"",inviteUserMode:null,inviteUserEmailValid:!1,inviteUserEmail:"",inviteUserFirstName:"",inviteUserLastName:"",searchString:""}},getDefaultNewUserData:function(){return{firstName:"New",lastName:"User",permCompEditor:1}},componentDidMount:function(){this.loadAllUsers()},componentWillUnmount:function(){this.fetchUserRequest&&this.fetchUserRequest.abort()},componentDidUpdate:function(){if(this.refs.selectedDomElement){var e=n().findDOMNode(this.refs.selectedDomElement);e&&e.scrollIntoViewIfNeeded(!0)}},loadAllUsers:function(){this.setState({showBusyIcon:!0,users:[]}),this.fetchUserRequest=S().get("/apiv1/users").set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{var a=[];e?(this.props.onNotification("Error while reading users: "+e,"error",15,"tc"),this.selectActiveUserInList(),this.setState({showBusyIcon:!1})):a=t.body,a.sort(function(e,t){return e.email.localeCompare(t.email)}),this.setState({users:a}),this.selectActiveUserInList(),this.setState({showBusyIcon:!1}),this.fetchUserRequest=null}}.bind(this))},selectUser:function(e){var t={};$.extend(!0,t,e),this.setState({activeUser:e,mutateUserData:t,createUserActive:!1,passwordError:null}),this.onNotifyChange("selectUser")},onNotifyChange:function(e){"selectUser"!=e?this.setState({saveIconState:"Armed"}):this.setState({saveIconState:"Normal",createNewUser:!1})},selectActiveUserInList:function(){var e=null;if(null!=this.state.activeUser)for(var t=0,a=this.state.users.length;t<a;t++)if(this.state.users[t].id==this.state.activeUser.id){e=this.state.users[t];break}null!=e?this.selectUser(e):this.state.users.length>0?this.selectUser(this.state.users[0]):this.selectUser(null)},onActiveUserPropertiesChanged:function(e,t){var a={};$.extend(!0,a,this.state.mutateUserData),a[e]=t,this.setState({mutateUserData:a}),this.setState({mutateUserData:a}),("password"!=e&&"repeatpassword"!=e&&"currentpassword"!=e||1==this.state.createUserActive)&&this.onNotifyChange()},actionSave:function(){if(this.state.activeUser&&(0!==Object.keys(this.state.mutateUserData).length||this.state.mutateUserData.constructor!==Object)){var e=this.state.activeUser.id,t={};$.extend(!0,t,this.state.mutateUserData),1!=this.state.createUserActive?(this.setState({showBusyIcon:!0}),S().put("/apiv1/users/"+e+"/metadata").send(t).end(function(e,t){if(e)this.props.onNotification("Cannot save user data","error",15,"tc");else{if(t.headers.location)return void(window.location=t.headers.location);this.loadAllUsers()}}.bind(this))):this.createUserOnServer(t)}},actionAddUser:function(){this.setState({createUserActive:!0,mutateUserData:this.getDefaultNewUserData()})},onAddUserSSO:function(){this.setState({inviteUserMode:"AddSSO"}),$("#inviteUserModal").modal("show")},onInviteUser:function(){var e=window.singularUser.account.subscription.user_limit;if(this.state.users.length>=e){var t=1===e?"user":"users";this.setState({showTooManyUsersDialog:!0,tooManyUsersMessage:"You have reached the maximum number of "+e+" "+t+" for your plan. Please contact support to upgrade your subscription."})}else this.setState({inviteUserMode:"Invite"}),$("#inviteUserModal").modal("show")},actionSendInvite:function(){if($("#inviteUserModal").modal("hide"),0!=this.state.inviteUserEmailValid){var e;e="AddSSO"==this.state.inviteUserMode?"/apiv1/users/invitesso":"/apiv1/users/invite";var t={email:this.state.inviteUserEmail,firstName:this.state.inviteUserFirstName,lastName:this.state.inviteUserLastName,permDashboard:1,permCompEditor:1};S().post(e).send(t).end(function(e,t){if(e)t&&t.body&&t.body.error&&this.props.onNotification("Cannot invite user: "+t.body.error.message,"error",15,"tc");else{if(t.headers.location)return void(window.location=t.headers.location);this.loadAllUsers(),this.setState({inviteUserEmailValid:!1,inviteUserEmail:"",inviteUserFirstName:"",inviteUserLastName:""})}}.bind(this))}},inviteUserEmailChanged:function(e){var t=e.target.value;this.setState({inviteUserEmail:t,inviteUserEmailValid:Qs().email(t)})},inviteUserFirstNameChanged:function(e){this.setState({inviteUserFirstName:e.target.value})},inviteUserLastNameChanged:function(e){this.setState({inviteUserLastName:e.target.value})},createUserOnServer:function(e){S().post("/apiv1/users/").send(e).end(function(e,t){if(e)this.setState({passwordError:t.body.error.message});else{if(t.headers.location)return void(window.location=t.headers.location);var a=t.body;this.setState({activeUser:a,mutateUserData:{},createUserActive:!1,passwordError:null}),this.loadAllUsers()}}.bind(this))},openDeleteDialog:function(){null!=this.state.activeUser&&this.setState({confirmDelete:!0,confirmDeleteMessage:"Are you sure you want to delete user "+this.state.activeUser.email+"?"})},actionDeleteUser:function(){this.setState({showBusyIcon:!0,confirmDelete:!1,confirmDeleteMessage:""}),S().delete("/apiv1/users/"+this.state.activeUser.id).end(function(e,t){e&&(this.props.onNotification("Cannot delete user","error",15,"tc"),this.setState({showBusyIcon:!1})),this.loadAllUsers()}.bind(this))},onAddUser:function(){this.actionAddUser(),this.setState({createNewUser:!0})},onDeleteUser:function(){this.openDeleteDialog(),this.setState({saveIconState:"Normal",createNewUser:!1})},onSaveUser:function(){this.actionSave(),this.setState({saveIconState:"Normal",createNewUser:!1})},onSearchChange:function(e){this.setState({searchString:e})},render:function(){var e=this;if(!window.singularUser.account.permission.permUserManagement)return null;var t,a,i=!1,n=window.singularUser.account.subscription.user_limit,s=function(e){var t,a,s=this.state.searchString.toUpperCase();if(""!=s&&-1==e.email.toUpperCase().indexOf(s)&&-1==e.id.toString().indexOf(s))return null;n<=0&&(t=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"You are over your user limit.")},o().createElement("i",{className:"fa fa-warning",style:{color:"#f7531b",fontSize:"15px",top:"1px",position:"relative",left:"4px"}})),a={backgroundColor:"#feece7"}),n--;var l="",r=null;0==this.state.createUserActive&&this.state.activeUser&&this.state.activeUser.id==e.id&&(l=" active",r="selectedDomElement",i=!0,a=void 0);var c="never";e.lastloggedin_at&&(c=ge()(e.lastloggedin_at).fromNow());var d;return d=0==e.emailVerified?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"pending"},"Email address is not verified yet")},o().createElement("i",{className:"fa fa-circle account-status pending"})):e.id==window.singularUser.account.accountAdminId?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"This is the admin user")},o().createElement("i",{className:"fa fa-diamond account-status active"})):o().createElement("i",{className:"fa fa-circle account-status active"}),o().createElement("tr",{key:e.id,onMouseDown:this.selectUser.bind(this,e),className:l,style:a,ref:r},o().createElement("td",{style:{textAlign:"center"}},t),o().createElement("td",{style:{textAlign:"center"}},d),o().createElement("td",{style:{textAlign:"center"}},e.id),o().createElement("td",null,e.email),o().createElement("td",null,ge()(e.created_at).format("YYYY-MM-DD HH:mm:ss")),o().createElement("td",null,c))}.bind(this),l=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"2%",textAlign:"center"}},o().createElement("span",{className:"table-header"})),o().createElement("th",{style:{width:"5%",textAlign:"center"}},o().createElement("span",{className:"table-header"},"Status")),o().createElement("th",{style:{width:"7%",textAlign:"center"}},o().createElement("span",{className:"table-header"},"ID")),o().createElement("th",{style:{width:"46%"}},o().createElement("span",{className:"table-header"},"Email")),o().createElement("th",{style:{width:"20%"}},o().createElement("span",{className:"table-header"},"Created")),o().createElement("th",{style:{width:"20%"}},o().createElement("span",{className:"table-header"},"Last login")))),r="UserAdministration";1==this.state.createUserActive&&(r="CreateUser"),this.state.showBusyIcon?t=o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},l,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))))):(t=o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},l,o().createElement("tbody",null,this.state.users.map(s))),i&&(a=o().createElement(Js,{user:this.state.activeUser,mode:r,mutatedUser:this.state.mutateUserData,onActiveUserPropertiesChanged:this.onActiveUserPropertiesChanged,passwordError:this.state.passwordError,onNotification:this.props.onNotification,loadAllUsers:this.loadAllUsers,height:"100%"})));var c,d,p=[];if(1==this.state.createNewUser)p=[{type:"Save",callback:this.onSaveUser,state:this.state.saveIconState}];else{var m=!1;this.state.activeUser&&this.state.activeUser.id==window.singularUser.account.accountAdminId&&(m=!0),p=window.singularUser.account.is_sso?[{type:"InviteUser",callback:this.onInviteUser},{type:"AddUserSSO",callback:this.onAddUserSSO},{type:"Save",callback:this.onSaveUser,state:this.state.saveIconState},{type:"Delete",callback:this.onDeleteUser,disabled:m}]:[{type:"InviteUser",callback:this.onInviteUser},{type:"Save",callback:this.onSaveUser,state:this.state.saveIconState},{type:"Delete",callback:this.onDeleteUser,disabled:m}]}return"AddSSO"==this.state.inviteUserMode?(c="Add single sign-on user",d="Add User"):(c="Invite user",d="Send Invite"),o().createElement("div",{className:"profile-wrapper",style:{height:"100%"}},o().createElement("div",{className:"singular-browser-body-tools"},o().createElement("div",{className:"portal-search-wrapper",style:{padding:"10px"}},o().createElement(Bn,{mode:"immediate",onSearch:this.onSearchChange})),o().createElement(os,{configuration:p})),o().createElement("div",{className:"user-administration-wrapper"},o().createElement("div",{className:"user-list"},t),o().createElement("div",{className:"profile-wrapper"},a)),o().createElement(si(),{show:1==this.state.confirmDelete,title:"",text:this.state.confirmDeleteMessage,showCancelButton:!0,onConfirm:function(){e.setState({confirmDelete:!1}),e.actionDeleteUser()},onCancel:function(){e.setState({confirmDelete:!1})},onEscapeKey:function(){e.setState({confirmDelete:!1})},onOutsideClick:function(){e.setState({confirmDelete:!1})}}),o().createElement(si(),{show:this.state.showTooManyUsersDialog,title:"",text:this.state.tooManyUsersMessage,onConfirm:function(){e.setState({showTooManyUsersDialog:!1})},onCancel:function(){e.setState({showTooManyUsersDialog:!1})},onEscapeKey:function(){e.setState({showTooManyUsersDialog:!1})},onOutsideClick:function(){e.setState({showTooManyUsersDialog:!1})}}),o().createElement("div",{id:"inviteUserModal",className:"modal fade u-displaynone singular-modal singular-modal-white ",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title"},c)),o().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},o().createElement("table",{style:{width:"70%",margin:"auto"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Email")),o().createElement("td",null,o().createElement("input",{className:"form-control align-left text-input",type:"email",placeholder:"please enter email",onChange:this.inviteUserEmailChanged,value:this.state.inviteUserEmail}))),o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"First Name")),o().createElement("td",null,o().createElement("input",{className:"form-control align-left text-input",type:"text",placeholder:"",onChange:this.inviteUserFirstNameChanged,value:this.state.inviteUserFirstName}))),o().createElement("tr",null,o().createElement("td",null,o().createElement("span",{className:"lbl"},"Last Name")),o().createElement("td",null,o().createElement("input",{className:"form-control align-left text-input",type:"text",placeholder:"",onChange:this.inviteUserLastNameChanged,value:this.state.inviteUserLastName})))))),o().createElement("div",{className:"modal-footer"},o().createElement("button",{className:"btn btn-primary",onClick:this.actionSendInvite,disabled:!this.state.inviteUserEmailValid},d),o().createElement("button",{className:"btn btn-secondary","data-dismiss":"modal"},"Cancel"))))))}}),to=o().createClass({displayName:"AccountRemoval",getInitialState:function(){return{confirmDeleteText:""}},componentWillMount:function(){},componentDidMount:function(){},onTextChange:function(e){this.setState({confirmDeleteText:e})},openDeleteAccountModal:function(){$("#accountRemovalDialog").modal("show")},closeDeleteAccountModal:function(){$("#accountRemovalDialog").modal("hide")},processDeleteAccount:function(){var e=this;this.props.onNotification("Deleting Account","info",5,"tc"),E().series([function(e){S().delete("/apiv1/accounts/"+window.singularUser.account.accountId).set("Content-Type","application/json").end(function(t,a){t?e(t):e(null,"next")})}],function(t,a){t?(console.log(t),e.props.onNotification("Error while delete account: "+t,"error",15,"tc")):window.location.href="/users/logout"})},render:function(){var e=this,t="I am sure"==this.state.confirmDeleteText?"":"disable";return o().createElement("div",{className:"profile-wrapper",style:{height:"100%"}},o().createElement("div",{className:"singular-browser-body"},o().createElement("div",{className:"developer-manager"},o().createElement("div",{className:"details-panel"},o().createElement("div",{className:"details-panel-body text-center"},o().createElement("h1",{style:{color:"#f00"}},"!! WARNING !!"),o().createElement("h2",{style:{color:"#f00",paddingTop:"15px"}},"This will delete all data stored in your account and this operation cannot be undone."),o().createElement("p",{style:{paddingTop:"15px"}},o().createElement("a",{onClick:function(){return e.openDeleteAccountModal()},className:"btn btn-danger",style:{backgroundColor:"red",border:"solid 1px red",color:"white"}},"Delete Account")))))),o().createElement("div",{id:"accountRemovalDialog",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"vertical-alignment-helper"},o().createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeDeleteAccountModal},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Delete Account")),o().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},o().createElement("p",{style:{color:"#3E4042"}},'Are you sure you want to delete this account? Please type "I am sure" into the text box below.'),o().createElement("p",null,o().createElement("input",{type:"text",className:"form-control",value:this.state.confirmDeleteText,onChange:function(t){e.onTextChange(t.target.value)}}))),o().createElement("div",{className:"modal-footer"},o().createElement("button",{tabIndex:"-1",onClick:this.processDeleteAccount,className:"btn btn-primary",disabled:t},"Ok"),o().createElement("button",{tabIndex:"-1",onClick:this.closeDeleteAccountModal,className:"btn btn-secondary"},"Cancel")))))))}});var ao=a(15236),io=a(95093),no=a(9769);const so=o().createClass({displayName:"TimeSeries",getInitialState:function(){return{expand:!1}},componentWillMount:function(){},componentDidMount:function(){},onToggleInfo:function(){this.setState({expand:!this.state.expand})},render:function(){var e,t=this,a=function(e){return io(e).format("MMM D")}.bind(this),i=function(e){switch(this.props.chartYFormat){case"number":return no.numberWithCommas(e);case"shortnumber":return no.shortNumber(e);case"filesize":return no.humanFileSize(e);default:return e}}.bind(this),n=function(e){return["",i(e)]}.bind(this),s="fa fa-chevron-up";if(this.state.expand){var l,r;if(s="fa fa-chevron-down",this.props.chartYLimit&&(l=o().createElement(ao.N1,{type:"monotone",dataKey:this.props.chartYLimit,stroke:"red",animationDuration:500})),this.props.chartSymbol){var c=function(e){return o().createElement("rect",{x:e.cx-12,y:e.cy-6,fill:"rgb(247, 83, 27)",stroke:"darkred",width:"25",height:"12",rx:"3"})};r=this.props.chartData.map(function(e,a){if(e[t.props.chartSymbol])return o().createElement(ao.rR,{key:a,x:e[t.props.chartXKey],y:0,label:o().createElement(ao.JU,{value:no.shortNumber(e[t.props.chartSymbol]),position:"center",offset:25,fill:"#666",style:{fontSize:"8px"}}),shape:c})})}e=this.props.busy?o().createElement("div",{className:"chart"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{margin:"auto",position:"relative",display:"block",top:"125px"}})):o().createElement("div",{className:"chart"},o().createElement(ao.uf,{width:"100%",height:"100%"},o().createElement(ao.bl,{data:this.props.chartData,margin:{top:30}},o().createElement(ao.WX,{dataKey:this.props.chartXKey,tickFormatter:a,minTickGap:50,padding:{left:30,right:30}}),o().createElement(ao.h8,{tickFormatter:i,type:"number",allowDecimals:!1,width:100}),o().createElement(ao.dC,{stroke:"#ccc"}),o().createElement(ao.N1,{type:"monotone",dataKey:this.props.chartYKey,stroke:"#8884d8",animationDuration:500}),l,r,o().createElement(ao.m_,{formatter:n,labelFormatter:a,separator:"",cursor:!1}))))}var d=Number(this.props.limit);isNaN(d)&&(d=0);var p,m,u,h,f=Number(this.props.value);if(isNaN(f)&&(f=0),null==this.props.limit||999999==this.props.limit)p=o().createElement("span",null,i(f)," of"," ",o().createElement("span",{className:"infinite-symbol"},"")),m=o().createElement("div",{className:"neutral"},o().createElement("div",{className:"ok",style:{width:"0%"}}));else if(p=o().createElement("span",null,i(f)," of ",o().createElement("b",null,i(d))),f>=d){var g=d/f*100;m=o().createElement("div",{className:"over-limit"},o().createElement("div",{className:"ok",style:{width:g+"%"}})),u=d>0?Math.round(f/d*100)+"%":o().createElement("span",null,"")}else{var v=0;d>0&&(v=f/d*100,u=Math.round(v)+"%"),m=o().createElement("div",{className:"neutral"},o().createElement("div",{className:"ok",style:{width:v+"%"}}))}return h=this.props.symbolIcon&&this.props.symbolValue?o().createElement("div",{className:"symbol"},o().createElement("span",{style:{float:"right"}},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"symbol"},this.props.symbolInfo)},o().createElement("i",{className:"symbolIcon "+this.props.symbolIcon})),o().createElement("span",{className:"symbolValue"},no.numberWithCommas(this.props.symbolValue)))):o().createElement("div",{className:"symbol"}),o().createElement("div",{className:"timeseries"},o().createElement("div",{className:"header"},o().createElement("div",{className:"title"},this.props.title),o().createElement("div",{className:"info"},p),o().createElement("div",{className:"bar"},m),o().createElement("div",{className:"percent"},u),h,o().createElement("div",{className:"expand"},o().createElement("button",{className:"btn btn-white icon-only v2 pull-right",onClick:this.onToggleInfo,style:{padding:"5px 10px"}},o().createElement("i",{className:s})))),e)}});var oo=a(9769),lo="https://api.singular.live/#rate-limits";const ro=o().createClass({displayName:"UsageSummary",getInitialState:function(){return{expand:!0}},componentWillMount:function(){},componentDidMount:function(){},onToggleInfo:function(){this.setState({expand:!this.state.expand})},generateDataStatus:function(e){if(!e)return{status:"error",shortDescription:"No data available",longDescription:""};var t=window.singularUser.account.subscription,a=0,i=0,n={};e.forEach(function(e){void 0!==e.burst_api_violations&&(a+=e.burst_api_violations),void 0!==e.burst_data_violations&&(i+=e.burst_data_violations),void 0!==e.daily_api_limit&&void 0!==e.daily_api_usage&&e.daily_api_limit<e.daily_api_usage&&t.daily_api_limit<e.daily_api_usage&&(n.dailyApi=!0),void 0!==e.daily_data_limit&&void 0!==e.daily_data_usage&&e.daily_data_limit<e.daily_data_usage&&t.daily_data_limit<e.daily_data_usage&&(n.dailyData=!0),void 0!==e.daily_api_limit&&void 0!==e.sdk_daily_api_usage&&e.daily_api_limit<e.sdk_daily_api_usage&&t.daily_api_limit<e.sdk_daily_api_usage&&(n.dailySdkApi=!0),void 0!==e.daily_data_limit&&void 0!==e.sdk_daily_data_usage&&e.daily_data_limit<e.sdk_daily_data_usage&&t.daily_data_limit<e.sdk_daily_data_usage&&(n.dailySdkData=!0),void 0!==e.storage_limit&&void 0!==e.storage_usage&&e.storage_limit<e.storage_usage&&t.storage_limit<e.storage_usage&&(n.storage=!0),void 0!==e.user_limit&&void 0!==e.user_usage&&e.user_limit<e.user_usage&&t.user_limit<e.user_usage&&(n.user=!0),void 0!==e.weboutput_limit&&void 0!==e.weboutput_usage&&e.weboutput_limit<e.weboutput_usage&&t.weboutput_limit<e.weboutput_usage&&(n.output=!0)});var s,l=Object.keys(n).length,r="ok",c=o().createElement("span",null,"No usage violations recorded! Learn more about rate limits"," ",o().createElement("a",{target:"_blank",href:lo},"here"));if(a||i||l){var d=window.singularUser.account.subscription;if(a||i){var p=oo.numberWithCommas(a+i);"free"==d?(r="error",c=o().createElement("span",null,p," REST API limit violations recorded in the selected timeframe. API calls were rejected! Learn more about rate limits"," ",o().createElement("a",{target:"_blank",href:lo},"here"))):(r="warning",c=o().createElement("span",null,p," REST API limit violations recorded in the selected timeframe. Learn more about rate limits"," ",o().createElement("a",{target:"_blank",href:lo},"here")))}else r="warning",c=o().createElement("span",null,"Usage limit violations recorded.");s=o().createElement("div",{className:"description"},o().createElement("div",{className:"offset"}),o().createElement("div",{className:"info"},n.user&&o().createElement("span",null,"Users limit exceeded",o().createElement("br",null)),n.output&&o().createElement("span",null,"Output limit exceeded",o().createElement("br",null)),n.storage&&o().createElement("span",null,"Storage limit exceeded",o().createElement("br",null)),a>0&&o().createElement("span",null,oo.numberWithCommas(a)," REST API call burst violations",o().createElement("br",null)),i>0&&o().createElement("span",null,oo.numberWithCommas(i)," REST API data burst violations",o().createElement("br",null)),n.dailyApi&&o().createElement("span",null,"Daily REST API call limit exceeded",o().createElement("br",null)),n.dailyData&&o().createElement("span",null,"Daily REST API data limit exceeded",o().createElement("br",null)),n.dailySdkApi&&o().createElement("span",null,"Daily App SDK call limit exceeded",o().createElement("br",null)),n.dailySdkData&&o().createElement("span",null,"Daily App SDK data limit exceeded",o().createElement("br",null))))}return{status:r,shortDescription:c,longDescription:s}},render:function(){var e,t,a,i,n="fa fa-chevron-up";if(this.state.expand&&(n="fa fa-chevron-down"),this.props.busy)a=o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{margin:"-10px"}});else{var s=this.generateDataStatus(this.props.data);switch(t=s.shortDescription,e=this.state.expand?s.longDescription:o().createElement("div",null),s.status){case"warning":a=o().createElement("i",{className:"fa fa-exclamation-triangle",style:{color:"#ffa500"}});break;case"error":a=o().createElement("i",{className:"fa fa-exclamation-triangle",style:{color:"#ff9800"}});break;case"ok":case"default":a=o().createElement("i",{className:"fa fa-check-circle",style:{color:"#08a708"}})}}return e&&(i=o().createElement("button",{className:"btn btn-white icon-only v2 pull-right",onClick:this.onToggleInfo,style:{padding:"5px 10px"}},o().createElement("i",{className:n}))),o().createElement("div",{className:"usage-summary",style:{borderBottom:"1px solid lightgrey",paddingBottom:"15px"}},o().createElement("div",{className:"header"},o().createElement("div",{className:"title"},"Usage Status"),o().createElement("div",{className:"icon"},a),o().createElement("div",{className:"info"},t),o().createElement("div",{className:"expand"},i)),e)}});var co=a(79841);const po=o().createClass({displayName:"AccountStatus",getInitialState:function(){return this.fetchAccountStatusHandler,{accountStatusBusy:!1,accountStatusData:null,dateRange:"last30Days"}},componentWillMount:function(){this.fetchAccountStatus(this.state.dateRange)},fetchAccountStatus:function(e){var t=this;this.setState({accountStatusBusy:!0,accountStatusData:null}),this.fetchAccountStatusHandler&&this.fetchAccountStatusHandler.abort();var a=this.getDateRangeProperties(e),i={begin:a.begin,end:a.end,step:a.step,stepText:a.stepText};this.fetchAccountStatusHandler=S().post("/apiv1/subscription/usage",i).end(function(e,a){if(t.fetchAccountStatusHandler=null,e)t.setState({accountStatusBusy:!1}),t.props.onNotification&&t.props.onNotification("Failed to fetch account usage stats","error",5,"tc"),t.setState({accountStatusBusy:!1,accountStatusData:null});else{var i=window.singularUser.account.subscription;a.body.forEach(function(e){ge()(e.date).isSame(ge()(),"day")&&(e.burst_api_limit=i.burst_api_limit,e.burst_api_violations=i.burst_api_violations,e.burst_data_limit=i.burst_data_limit,e.burst_data_violations=i.burst_data_violations,e.daily_api_limit=i.daily_api_limit,e.daily_api_usage=i.daily_api_usage,e.daily_data_limit=i.daily_data_limit,e.daily_data_usage=i.daily_data_usage,e.sdk_daily_api_usage=i.sdk_daily_api_usage,e.sdk_daily_data_usage=i.sdk_daily_data_usage,e.storage_limit=i.storage_limit,e.storage_usage=i.storage_usage,e.user_limit=i.user_limit,e.user_usage=i.user_usage,e.weboutput_limit=i.weboutput_limit,e.weboutput_usage=i.weboutput_usage),e.daily_api_limit||(e.daily_api_limit=i.daily_api_limit),e.daily_data_limit||(e.daily_data_limit=i.daily_data_limit),e.weboutput_limit>999&&(e.weboutput_limit=void 0),e.user_limit>999&&(e.user_limit=void 0)}),t.setState({accountStatusBusy:!1,accountStatusData:a.body})}})},componentWillUnmount:function(){this.fetchAccountStatusHandler&&this.fetchAccountStatusHandler.abort()},selectDropdown:function(e){this.setState({dateRange:e}),this.fetchAccountStatus(e)},getDateRangeProperties:function(e){var t="Singular Usage Stats - ";switch(e){case"thisMonth":return{name:"This Month",begin:ge()().utc().startOf("month").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().endOf("month").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:86400,stepText:"day",filename:t+ge()().utc().startOf("month").format("YYYY-MM")+" daily"};case"previousMonth":return{name:"Previous Month",begin:ge()().utc().subtract(1,"months").startOf("month").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().subtract(1,"months").endOf("month").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:86400,stepText:"day",filename:t+ge()().utc().subtract(1,"months").format("YYYY-MM")+" daily"};case"thisYear":return{name:"This Year",begin:ge()().utc().startOf("year").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().endOf("year").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:86400,stepText:"day",filename:t+ge()().utc().startOf("year").format("YYYY")+" weekly"};case"previousYear":return{name:"Previous Year",begin:ge()().utc().subtract(1,"years").startOf("year").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().subtract(1,"years").endOf("year").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:604800,stepText:"week",filename:t+ge()().utc().subtract(1,"years").startOf("year").format("YYYY")+" weekly"};case"last52Weeks":return{name:"Last 52 Weeks",begin:ge()().utc().subtract(1,"years").startOf("day").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().endOf("day").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:604800,stepText:"week",filename:t+ge()().utc().subtract(1,"years").format("YYYY-MM-DD")+" until "+ge()().utc().format("YYYY-MM-DD")+" weekly"};default:return{name:"Last 30 Days",begin:ge()().utc().subtract(1,"months").startOf("day").format("YYYY-MM-DDTHH:mm:ss.000Z"),end:ge()().utc().endOf("day").format("YYYY-MM-DDTHH:mm:ss.000Z"),step:86400,stepText:"day",filename:t+ge()().utc().subtract(1,"months").format("YYYY-MM-DD")+" until "+ge()().utc().format("YYYY-MM-DD")+" daily"}}},render:function(){var e=this.getDateRangeProperties(this.state.dateRange),t=window.singularUser.account.subscription;return o().createElement("div",{className:"developer-manager",style:{height:"calc(100% - 9px)"}},o().createElement("div",{className:"details-panel",style:{height:"100%",display:"flex",flexDirection:"column",maxWidth:"70%"}},o().createElement("div",{className:"details-panel-header"},o().createElement("span",null,"Usage stats and history"),o().createElement("div",{className:"dropdown dropdown-white",style:{marginLeft:"auto"}},o().createElement("button",{tabIndex:"-1",className:"btn btn-white dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false",style:{width:"150px"}},e.name),o().createElement("ul",{className:"dropdown-menu"},o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"last30Days")},this.getDateRangeProperties("last30Days").name)),o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"thisMonth")},this.getDateRangeProperties("thisMonth").name)),o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"previousMonth")},this.getDateRangeProperties("previousMonth").name)),o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"last52Weeks")},this.getDateRangeProperties("last52Weeks").name)),o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"thisYear")},this.getDateRangeProperties("thisYear").name)),o().createElement("li",null,o().createElement("a",{className:"dropdown-item",onClick:this.selectDropdown.bind(this,"previousYear")},this.getDateRangeProperties("previousYear").name)))),o().createElement(co.A,{className:"btn btn-white",data:this.state.accountStatusData,filename:e.filename+".csv",tabIndex:"-1",disabled:this.state.accountStatusBusy,style:{marginLeft:"10px",width:"100px"}},"Export")),o().createElement("div",{className:"details-panel-body",style:{overflow:"scroll",height:"calc(100% - 35px)",padding:"5px 0px 10px 5px"}},o().createElement("div",{className:"account-status"},o().createElement(ro,{data:this.state.accountStatusData,busy:this.state.accountStatusBusy}),o().createElement(so,{title:"Users",limit:t.user_limit,value:t.user_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"user_usage",chartYLimit:"user_limit",chartYFormat:"number",busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"Outputs",limit:t.weboutput_limit,value:t.weboutput_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"weboutput_usage",chartYLimit:"weboutput_limit",chartYFormat:"number",busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"Storage",limit:t.storage_limit,value:t.storage_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"storage_usage",chartYLimit:"storage_limit",chartYFormat:"filesize",busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"REST API calls",limit:t.daily_api_limit,value:t.daily_api_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"daily_api_usage",chartYLimit:"daily_api_limit",chartYFormat:"shortnumber",chartSymbol:"burst_api_violations",symbolIcon:"fa fa-warning",symbolInfo:"REST API call burst violations today",symbolValue:t.burst_api_violations,busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"REST API data",limit:t.daily_data_limit,value:t.daily_data_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"daily_data_usage",chartYLimit:"daily_data_limit",chartYFormat:"filesize",chartSymbol:"burst_data_violations",symbolIcon:"fa fa-warning",symbolInfo:"REST API data burst violations today",symbolValue:t.burst_data_violations,busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"App SDK calls",limit:t.daily_api_limit,value:t.sdk_daily_api_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"sdk_daily_api_usage",chartYLimit:"daily_api_limit",chartYFormat:"shortnumber",busy:this.state.accountStatusBusy}),o().createElement("span",{className:"divider"}),o().createElement(so,{title:"App SDK data",limit:t.daily_data_limit,value:t.sdk_daily_data_usage,chartData:this.state.accountStatusData,chartXKey:"date",chartYKey:"sdk_daily_data_usage",chartYLimit:"daily_data_limit",chartYFormat:"filesize",busy:this.state.accountStatusBusy})))))}});const mo=o().createClass({displayName:"About",getInitialState:function(){return{showBusyIcon:!1}},componentDidMount:function(){this.loadAboutData()},loadAboutData:function(){this.setState({showBusyIcon:!0}),S().get("/apiv1/users/me").set("Content-Type","application/json").end(function(e,t){if(e)console.log("error while reading user profile: "+e),this.setState({showBusyIcon:!1});else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({showBusyIcon:!1})}}.bind(this))},render:function(){var e,t;return 1==this.state.showBusyIcon?e=o().createElement("div",{className:"loader-wrapper"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):(e=o().createElement("div",{className:"details-panel"},o().createElement("div",{className:"details-panel-header"},"Account and User Information"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Account Name"),o().createElement("div",{style:{fontWeight:"300"}},window.singularUser.account.accountName))),o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Account ID"),o().createElement("div",{style:{fontWeight:"300"}},window.singularUser.account.accountId)))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"User Name"),o().createElement("div",{style:{fontWeight:"300"}},window.singularUser.email))),o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"User ID"),o().createElement("div",{style:{fontWeight:"300"}},window.singularUser.id)))))))),t=o().createElement("div",{className:"details-panel"},o().createElement("div",{className:"details-panel-header"},"Singular Server Info"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"details-table"},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Version"),o().createElement("div",{style:{fontWeight:"300"}},"47"))),o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Build Number"),o().createElement("div",{style:{fontWeight:"300"}},"2000")))),o().createElement("tr",null,o().createElement("td",null,o().createElement("div",null,o().createElement("div",{className:"detail-label"},"Build Date"),o().createElement("div",{style:{fontWeight:"300"}},ge()("2024-11-21 10:00:00").format("YYYY-MM-DD HH:mm:ss")))),o().createElement("td",null,""))))))),o().createElement("div",{className:"profile-wrapper"},o().createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},e,t))}}),uo=o().createClass({displayName:"Billing",getInitialState:function(){return{invoices:[],busy:!0}},componentDidMount:function(){S().get("/paymentapi/listinvoices?limit=500").set("Accept","application/json").end(function(e,t){e?this.setState({invoices:[],busy:!1}):this.setState({invoices:t.body.data,busy:!1})}.bind(this))},downloadReceipt:function(e){window.open(e)},openReceipt:function(e){window.open(e)},render:function(){return this.state.busy?o().createElement("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{left:"50%",top:"40%",position:"absolute"}})):(e=0!=this.state.invoices.length||this.state.busy?this.state.invoices.map(function(e,t){var a="not paid";e.status_transitions&&e.status_transitions.paid_at&&(a=ge()(1e3*e.status_transitions.paid_at).format("YYYY-MM-DD HH:mm:ss"));var i="Unknown product",n=null,s=null;e.lines.data.length>0?(n=e.lines.data[0].period.start,s=e.lines.data[0].period.end):e.period_start&&e.period_end&&(n=e.period_start,s=e.period_end),n&&s&&(i="Subscription fee from "+ge()(1e3*n).format("YYYY-MM-DD")+" until "+ge()(1e3*s).format("YYYY-MM-DD"));var l=o().createElement("i",{className:"error fa fa-exclamation-circle"});e.paid&&(l=o().createElement("i",{className:"ok fa fa-check-circle"}));var r,c,d=(Number(e.amount_paid)/100).toFixed(2)+" "+e.currency.toUpperCase();return e.hosted_invoice_url&&(r=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"OpenInvoice"},"Open invoice")},o().createElement("button",{tabIndex:"-1",onClick:this.openReceipt.bind(this,e.hosted_invoice_url)},o().createElement("i",{className:"fa fa-external-link"})))),e.invoice_pdf&&(c=o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"DownloadInvoice"},"Download invoice pdf")},o().createElement("button",{tabIndex:"-1",onClick:this.downloadReceipt.bind(this,e.invoice_pdf)},o().createElement("i",{className:"fa fa fa-file-pdf-o"})))),o().createElement("div",{className:"billing-item",key:t},o().createElement("div",{className:"panel panel-default"},o().createElement("div",{className:"panel-body"},o().createElement("div",{className:"header"},o().createElement("div",{className:"status"},l),o().createElement("div",{className:"description"},i),o().createElement("div",{className:"links"},r,c)),o().createElement("div",{className:"tables"},o().createElement("div",{className:"id"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Transaction ID"),o().createElement("td",null,e.id)),o().createElement("tr",null,o().createElement("td",null,"Transaction Date"),o().createElement("td",null,a))))),o().createElement("div",{className:"amount"},o().createElement("table",null,o().createElement("tbody",null,o().createElement("tr",{style:{fontWeight:"bold"}},o().createElement("td",null,"Amount Paid"),o().createElement("td",{style:{textAlign:"right"}},d)))))))))}.bind(this)):o().createElement("div",{style:{padding:"50px",textAlign:"center",fontSize:"20px"}},"Billing history is empty"),o().createElement("div",{className:"billing-wrapper"},o().createElement("div",{className:"billing-list"},e)));var e}});var ho=a(40927),fo=a(15734),go=a(9769),vo=a(82445);const bo=ho.createClass({displayName:"Subscription",getInitialState:function(){var e=new URLSearchParams(window.location.search),t=!1;e.has("checkPaymentStatus")&&e.get("checkPaymentStatus")&&(t=!0);var a=!1;return e.has("showSubscriptionInfo")&&e.get("showSubscriptionInfo")&&(a=!0),this.paymentTimeoutHandler=null,this.paymentStatusHandler=null,this.checkPaymentStatusAttempt=5,{errorMessage:null,showLoading:!1,startupBusy:!0,checkPaymentStatus:t,showSubscriptionInfo:a}},componentDidMount:function(){var e=this;this.state.checkPaymentStatus&&(this.paymentTimeoutHandler=setInterval(function(){e.paymentStatusHandler&&e.paymentStatusHandler.abort(),e.paymentStatusHandler=fo.get("/apiv1/accounts/payment").end(function(t,a){e.paymentStatusHandler=null,t&&e.setState({errorMessage:"Cannot connect to subscription server"}),(t||a.body&&!a.body.payment_status||e.checkPaymentStatusAttempt--<=0)&&(clearInterval(e.paymentTimeoutHandler),window.location.href="/users/settings/subscription?showSubscriptionInfo=true")})},2e3)),this.getSubscription()},componentWillUnmount:function(){this.paymentTimeoutHandler&&clearInterval(this.paymentTimeoutHandler),this.paymentStatusHandler&&this.paymentStatusHandler.abort()},getSubscription:function(){var e=this;fo.get("/paymentapi/subscription").end(function(t,a){if(t)e.setState({errorMessage:"Cannot fetch subscription",showLoading:!1});else{var i=a.body.price;null==i&&(i=a.body.prices.sort(function(e,t){return(e.price>t.price)-.5})[0]),e.setState({startupBusy:!1,paymentInfo:a.body,selectedPrice:i,selectedPlan:a.body.selection})}})},onContactUs:function(e){window.open("https://www.singular.live/contact?tab=sales&plan="+e.plan,"_blank")},onCancel:function(){var e=this,t={cancelAt:"endPeriod",subscription:this.state.paymentInfo.subscription};this.setState({showLoading:!0},function(a){return fo.post("/paymentapi/cancelPlan").send(t).set("Accept","application/json").end(function(t,a){t?e.setState({errorMessage:"Failed to cancel subscription",showLoading:!1}):location.reload()})})},onCheckout:function(){var e=this;this.setState({showLoading:!0});var t="/paymentapi/session/?id="+this.state.selectedPrice.id;this.state.coupon&&(t+="&coupon="+this.state.coupon.id),fo.get(t).end(function(t,a){t?e.setState({errorMessage:a.body.message,showLoading:!1}):Stripe(a.body.stripe_pk).redirectToCheckout({sessionId:a.body.id})})},onSelectSubscription:function(e){this.setState({selectedPlan:e.currentTarget.dataset.value})},onSelectPrice:function(e){var t=e.currentTarget.dataset.value,a=this.state.paymentInfo.prices.filter(function(e){return e.id==t});this.setState({selectedPrice:a[0]})},onSelectCoupon:function(e){this.setState({coupon:e})},render:function(){var e=this;if(this.state.errorMessage)return ho.createElement("div",null,ho.createElement(si(),{show:null!=this.state.errorMessage,title:"",text:this.state.errorMessage,onConfirm:function(){e.setState({errorMessage:void 0,showLoading:!1})},onCancel:function(){e.setState({errorMessage:void 0,showLoading:!1})},onEscapeKey:function(){e.setState({errorMessage:void 0,showLoading:!1})},onOutsideClick:function(){e.setState({errorMessage:void 0,showLoading:!1})}}));if(this.state.showLoading&&!this.state.errorMessage||null==this.state.paymentInfo)return ho.createElement("div",{className:"singularLoader"},ho.createElement("img",{src:"/images/loading-bubbles-blue.svg"}));if(this.state.checkPaymentStatus)return ho.createElement("div",{className:"singularLoader"},"Waiting for payment system",ho.createElement("img",{src:"/images/loading-bubbles-blue.svg"}));var t,a,i,n,s,o=function(){if(e.state.startupBusy)return ho.createElement("div",{style:{height:"21px"}},ho.createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{margin:"auto",display:"block"}}));var t,a,i,n=e.state.paymentInfo.canceled?" (canceled)":"",s=e.state.paymentInfo.selection,o=vo.SubscriptionPlans.filter(function(e){return e.id==s})[0].title+n,l=e.state.paymentInfo.activeUntil?new Date(e.state.paymentInfo.activeUntil):null;if(l){var r,c=ge()(l).diff(ge()());r=e.state.paymentInfo.canceled&&"professional"==e.state.paymentInfo.subscription?"Renews on ":"Expires on ",t=c<-72e5?ho.createElement("p",{style:{color:"red",whiteSpace:"pre"}},r+ge()(l).format("YYYY-MM-DD HH:mm:ss")+"     "+go.millisecondsToString(-c,"short")+" ago"):ho.createElement("p",null,r+ge()(l).format("YYYY-MM-DD HH:mm:ss"))}return"PAYMENT_FAILED"==e.state.paymentInfo.paymentStatus&&(e.state.paymentInfo.charge_failed&&(i=" on "+ge()(e.state.paymentInfo.charge_failed).format("YYYY-MM-DD HH:mm:ss")),a=ho.createElement("span",{style:{color:"red",paddingLeft:"20px"}},"Payment failed ",i)),ho.createElement("div",{style:{height:"21px"}},ho.createElement("span",null,ho.createElement("b",null,o)),a,ho.createElement("span",{style:{float:"right"}},t))}(),l=(a=e.state.selectedPrice&&e.state.selectedPrice.id,i=e.state.selectedPrice?e.state.selectedPrice.price:0,n=ho.createElement("button",{className:"btn btn-primary",style:{width:"180px",marginRight:"30px"},onClick:e.onCheckout},"Subscribe"),e.state.paymentInfo.subscription&&"PAYMENT_FAILED"!==e.state.paymentInfo.paymentStatus&&(n=ho.createElement("button",{className:"btn btn-white",style:{width:"180px",margin:"0px 30px 0px 0px"},onClick:e.onCancel},"Downgrade to Free Subscription"),t=ho.createElement("div",{style:{display:"flex",alignItems:"center"}},ho.createElement("button",{className:"btn btn-primary",style:{width:"180px",margin:"0px"},onClick:function(){e.setState({showLoading:!0}),fo.post("/paymentapi/create-customer-portal-session").end(function(t,a){t?e.setState({errorMessage:"Cannot connect to Customer Portal"}):window.open(a.body.url),e.setState({showLoading:!1})})}},"Open Payment Portal"),ho.createElement("span",{style:{paddingLeft:"10px",color:"#b3b3b3"}},"Update payment method and billing information here")),1==e.state.paymentInfo.canceled&&(n=null)),ho.createElement("div",null,ho.createElement("div",{className:"payment-info-offset"}),ho.createElement("div",{style:{display:"flex"}},ho.createElement("div",{className:"singular-container-list",style:{width:"50%"}},e.state.paymentInfo.prices.sort(function(e,t){return(e.price>t.price)-.5}).map(function(t,i){var n=a==t.id?"radio-button-icon selected":"radio-button-icon",s=null!=e.state.paymentInfo.subscription,o=s?"singular-container-list-item-disabled":"singular-container-list-item",l=s?function(e){return null}:e.onSelectPrice;return ho.createElement("div",{className:o,key:i,"data-value":t.id,onClick:l,style:{paddingTop:"5px",paddingBottom:"5px"}},ho.createElement("div",{className:n}),ho.createElement("div",{style:{margin:"0px 10px"}},"$"+t.price+" / "+t.nickname))})),ho.createElement("div",{style:{width:"50%",alignSelf:"flex-end"}})),function(){var t,a;if(e.state.coupon){var n,s=e.state.coupon.percentOff,o=e.state.coupon.amountOff,l=0;s?(l=i*parseFloat(s)/100,n=ho.createElement("div",{className:"order-item"},"Discount (",s,"%)")):(o&&(l=parseFloat(o)),n=ho.createElement("div",{className:"order-item"},"Discount")),a=ho.createElement("div",{className:"order-list-item discount"},n,ho.createElement("div",{className:"order-item-total"},"-$",l.toLocaleString())),t=i-l}else t=i;return ho.createElement("div",{className:"order-list",style:{paddingTop:"0px"}},ho.createElement("div",{className:"order-list-item price"},ho.createElement("div",{className:"order-item"},"Price"),ho.createElement("div",{className:"order-item-price"},"$",i.toLocaleString())),a,ho.createElement("div",{className:"order-list-item total"},ho.createElement("div",{className:"order-item"},"Total"),ho.createElement("div",{className:"order-item-total"},"$",t.toLocaleString())))}(),ho.createElement("div",{style:{position:"relative",top:"-24px",left:"22px",display:"flex"}},n,t))),r=function(t){return t==e.state.paymentInfo.selection?void 0:ho.createElement("div",{style:{position:"relative",paddingLeft:"24px",top:"-24px"}},ho.createElement("div",{style:{borderTop:"1px solid #929292",marginRight:"24px",marginBottom:"15px"}}),ho.createElement("button",{className:"btn btn-primary",style:{width:"120px"},onClick:e.onContactUs.bind(e,{plan:t})},"Apply"))},c="nonprofit"!=e.state.paymentInfo.selection&&ho.createElement("div",{style:{position:"relative",paddingLeft:"24px",top:"-24px",marginTop:"18px"}},ho.createElement("div",{style:{borderTop:"1px solid #929292",marginRight:"24px",marginBottom:"15px"}}),ho.createElement("button",{className:"btn btn-primary",style:{width:"120px"},onClick:function(e){window.location.href="https://www.singular.live/schools"}},"Apply as a School"),ho.createElement("button",{className:"btn btn-primary",style:{width:"120px",marginLeft:"20px"},onClick:function(e){window.location.href="https://www.singular.live/nonprofits"}},"Apply as a Nonprofit")),d=(s=function(e,t,a,i){var n=t?"10px":"0px";return ho.createElement("div",{className:"details-panel",style:{marginBottom:"10px"}},ho.createElement("div",{className:"details-panel-header"},e),ho.createElement("div",{className:"details-panel-body"},ho.createElement("div",{className:"section-caption"},t),a?ho.createElement("p",{style:{marginTop:n}},a):null),i)},function(e){var t=function(e){return e.map(function(e,t){return ho.createElement("li",{key:t},e)})};switch(e){case"free":return s("Free Subscription",t(["Watermark","1 User","100 MB storage","Support Portal","Developer Portal"]));case"professional":return s("Professional Subscription",t(["No Watermark","Submit Support Tickets","3 Users","1 Output","2 GB storage","20,000 Daily API Calls"]),null,l);case"enterprise":return s("Enterprise Subscription",null,"Enterprise subscriptions are designed for users with bespoke requirements such as dedicated support, or a larger number of outputs or users. In addition, Enterprise subscriptions allow for custom fonts as well advanced features like client-side/on device rendering, interactivity and more.",r("enterprise"));case"nonprofit":return s("Schools and Nonprofit Subscription",t(["Non-commercial use","No Watermark","1 Output","1 GB storage"]),null,c);case"education":return s("Education Subscription",t(["Non-commercial use","No Watermark","1 Output","1 GB storage"]),"Education subscriptions are tailored for schools and educational institutions, offering an affordable option that provides the same limits and flexibility as standard plans. They are designed to support teaching, learning, and student projects while making advanced features accessible within an academic setting.",r("education"));case"event":return s("Event",null,"An Event subscription is intended for use on a specific event over a pre-defined time period where a monthly subscription is not suitable. The number of users, outputs and other account limits are bespoke and defined as part of the Event subscription agreement.",r("event"));case"trial":return s("Trial",null,"A Trial subscription provides access to the full advanced functionality of a Singular Enterprise License for a limited time. The number of users, outputs and other account limits are bespoke and defined as part of the trial.",r("trial"));default:return null}}(e.state.selectedPlan));return ho.createElement("div",{className:"subscription-manager-wrapper"},ho.createElement("div",{className:"developer-manager",style:{overflowX:"hidden",overfloY:"auto",height:"100%",width:"910px",margin:"auto"}},ho.createElement("div",{className:"details-panel"},ho.createElement("div",{className:"details-panel-header"},"Your current subscription"),ho.createElement("div",{className:"details-panel-body"},o)),ho.createElement("div",{className:"details-panel"},ho.createElement("div",{className:"details-panel-header"},"Select your subscription"),ho.createElement("div",{className:"details-panel-body",style:{padding:"5px 0px"}},vo.SubscriptionPlans.map(function(t,a){if(!e.state.startupBusy&&"unolite"!=t.id&&"unoplus"!=t.id&&"unopro"!=t.id&&"event-3days"!=t.id&&"event-7days"!=t.id&&"event-30days"!=t.id&&("nonprofit"!=t.id||"nonprofit"==e.state.paymentInfo.selection)){var i=e.state.selectedPlan==t.id?"radio-button-icon selected":"radio-button-icon",n="nonprofit"==e.state.paymentInfo.selection||"education"==e.state.paymentInfo.selection||"enterprise"==e.state.paymentInfo.selection||"event"==e.state.paymentInfo.selection;"professional"==e.state.paymentInfo.selection&&"free"==t.id&&(n=!0),"professional"==e.state.paymentInfo.selection&&null==e.state.paymentInfo.subscription&&(n=!0),"unolite"!=e.state.paymentInfo.selection&&"unoplus"!=e.state.paymentInfo.selection&&"unopro"!=e.state.paymentInfo.selection||(n=!0);var s=n?"singular-container-list-item-disabled":"singular-container-list-item";return ho.createElement("div",{className:s,key:a,"data-value":t.id,onClick:n?function(e){return null}:e.onSelectSubscription,style:{paddingTop:"5px",paddingBottom:"5px"}},ho.createElement("div",{className:i}),ho.createElement("div",{style:{margin:"0px 10px"}},t.title))}}))),d),ho.createElement(si(),{show:this.state.showSubscriptionInfo,title:"Subscription successful",text:"Please re-open or refresh any output URLs that were open before you upgraded your subscription to remove the watermark.",onConfirm:function(){e.setState({showSubscriptionInfo:!1})},onCancel:function(){e.setState({showSubscriptionInfo:!1})},onEscapeKey:function(){e.setState({showSubscriptionInfo:!1})},onOutsideClick:function(){e.setState({showSubscriptionInfo:!1})}}))}});var yo=a(9769);const Eo=o().createClass({displayName:"StorageInfo",getInitialState:function(){return this.fetchStorageHandler=null,{assetStorageBusy:!1,assetStorageData:null}},componentDidMount:function(){this.fetchStorage(this.props.accountId)},componentWillUnmount:function(){this.fetchStorageHandler&&this.fetchStorageHandler.abort()},componentWillReceiveProps:function(e){e.account&&this.props.accountId!=e.accountId&&this.fetchStorage(e.accountId)},fetchStorage:function(e){var t=this;void 0!==e&&(this.setState({assetStorageBusy:!0,assetStorageData:null}),this.fetchStorageHandler&&this.fetchStorageHandler.abort(),this.fetchStorageHandler=S().get("/apiv1/status/getCurrentSize?account="+e).end(function(e,a){t.fetchStorageHandler=null,e?(t.setState({assetStorageBusy:!1}),t.props.onNotification&&t.props.onNotification("Cannot Fetch Account Storage Information","error",5,"tc")):t.setState({assetStorageBusy:!1,assetStorageData:a.body})}))},render:function(){return null==this.props.accountId?null:(this.state.assetStorageBusy?e=o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{width:"50px",height:"40px",margin:"auto",display:"block"}}):(t=this.state.assetStorageData?this.state.assetStorageData:{images:{count:0,size:0},audios:{count:0,size:0},videos:{count:0,size:0},jsons:{count:0,size:0},data:{count:0,size:0},revisions:{count:0,size:0},compositions:{count:0,size:0},controlapps:{count:0,size:0},total:{count:0,size:0}},e=o().createElement("table",null,o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",null),o().createElement("th",null,"File Size"),o().createElement("th",null,"# items"),o().createElement("th",null))),o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Control App"),o().createElement("td",null,yo.humanFileSize(t.controlapps.size)),o().createElement("td",null,yo.numberWithCommas(t.controlapps.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Composition"),o().createElement("td",null,yo.humanFileSize(t.compositions.size)),o().createElement("td",null,yo.numberWithCommas(t.compositions.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Revision"),o().createElement("td",null,yo.humanFileSize(t.revisions.size)),o().createElement("td",null,yo.numberWithCommas(t.revisions.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Image"),o().createElement("td",null,yo.humanFileSize(t.images.size)),o().createElement("td",null,yo.numberWithCommas(t.images.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Audio"),o().createElement("td",null,yo.humanFileSize(t.audios.size)),o().createElement("td",null,yo.numberWithCommas(t.audios.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Video"),o().createElement("td",null,yo.humanFileSize(t.videos.size)),o().createElement("td",null,yo.numberWithCommas(t.videos.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"JSON"),o().createElement("td",null,yo.humanFileSize(t.jsons.size)),o().createElement("td",null,yo.numberWithCommas(t.jsons.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,"Data"),o().createElement("td",null,yo.humanFileSize(t.data.size)),o().createElement("td",null,yo.numberWithCommas(t.data.count)),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null,o().createElement("b",null,"Total")),o().createElement("td",null,o().createElement("b",null,yo.humanFileSize(t.total.size))),o().createElement("td",null,o().createElement("b",null,yo.numberWithCommas(t.total.count))),o().createElement("td",null))))),o().createElement("div",{className:"group-body storage-info-wrapper"},e));var e,t}}),wo=o().createClass({displayName:"AccountStorage",getInitialState:function(){return{}},componentWillMount:function(){},componentDidMount:function(){},render:function(){return o().createElement("div",{className:"developer-manager"},o().createElement("div",{className:"details-panel"},o().createElement("div",{className:"details-panel-header"},"Storage Stats"),o().createElement("div",{className:"details-panel-body"},o().createElement(Eo,{accountId:window.singularUser.account.accountId}))))}});a(95093);var So=a(9769),No=a(62418);const Co=o().createClass({displayName:"AccountAuditLogInfoDialog",getInitialState:function(){return{}},componentWillMount:function(){},componentDidMount:function(){},shouldComponentUpdate:function(e,t){return!So.compareObject(e,this.props)||!So.compareObject(t,this.state)},componentWillReceiveProps:function(e){},componentWillUnmount:function(){},open:function(){this.refs.AuditLogEventDialog&&$(this.refs.AuditLogEventDialog).modal("show")},close:function(){this.refs.AuditLogEventDialog&&$(this.refs.AuditLogEventDialog).modal("hide")},onCopyClipboard:function(e){this.props.onNotification&&this.props.onNotification(e+" copied to clipboard","success",5,"tc")},render:function(){var e=this.props.logEvent,t="Audit Log Event";e&&e.id&&(t+=" - "+e.id);var a={};if(e){a=JSON.stringify(e);try{var i=JSON.parse(a);a=No.js(JSON.stringify(i),{indent_size:2,indent_char:" ",max_preserve_newlines:"5",preserve_newlines:!0,keep_array_indentation:!1,break_chained_methods:!1,indent_scripts:"normal",brace_style:"collapse",space_before_conditional:!0,unescape_strings:!1,jslint_happy:!1,end_with_newline:!0,wrap_line_length:"0",indent_inner_html:!1,comma_first:!1,e4x:!1,indent_empty_lines:!1})}catch(e){}}return o().createElement("div",{id:"auditLogEvent",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog",ref:"AuditLogEventDialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"50%"}},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},t),o().createElement(jn.A,{text:a,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"Audit Log Event")},o().createElement("button",{className:"tool-button",style:{position:"absolute",right:"50px",top:"17px"}},o().createElement("i",{className:"fa fa-clipboard"})))),o().createElement("div",{className:"modal-body"},o().createElement("div",null,o().createElement("table",{style:{width:"100%"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"100%"}}))),o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,o().createElement("div",{style:{height:"500px",width:"100%"}},o().createElement(ea.A,{name:"dataStreamJson",id:"DataStream",className:"widget-version-json",width:"100%",height:"100%",value:a,disabled:!0,theme:"light"})))))))))))}});var xo=[{id:"All",title:"All"},{id:"asset.",title:"Asset"},{id:"app.",title:"Control App"},{id:"connection.",title:"Connection"},{id:"datanode.",title:"Data Node"},{id:"composition.",title:"Composition"},{id:"login.",title:"Login"},{id:"output.",title:"Output"},{id:"user.",title:"User"}];const Io=o().createClass({displayName:"AccountAuditLog",getInitialState:function(){var e=this;return this.updateIntervalHandler=null,this.fetchAuditLogRequest=null,this.allUsers=[],S().get("/apiv1/users/simple",function(t,a){t?e.props.onNotification("Error while reading users: "+t,"error",5,"tc"):(e.allUsers=a.body,e.allUsers.sort(function(e,t){return e.email.localeCompare(t.email)}),e.setState({redraw:Math.random()}))}),{searchString:"",loadingMoreBefore:!0,loadingMoreAfter:!1,auditLogs:[],selectedLogEvent:null,eventFilter:"All",userFilter:"All",gotoDate:ge()().utc()}},componentDidMount:function(){var e=this;this.fetchAuditLog("now"),this.updateIntervalHandler=setInterval(function(){e.setState({redraw:Math.random()})},5e3)},componentWillUnmount:function(){this.fetchAuditLogRequest&&this.fetchAuditLogRequest.abort(),this.updateIntervalHandler&&clearInterval(this.updateIntervalHandler)},fetchAuditLogForDate:function(e){this.setState({loadingMoreBefore:!0,loadingMoreAfter:!0,auditLogs:[]}),this.fetchAuditLogRequest=S().get("/apiv1/auditlogs?limit=10&ending_before="+e).set("Content-Type","application/json").end(function(t,a){if(a.headers.location)window.location=a.headers.location;else if(t)this.props.onNotification("Error while reading audit logs: "+t,"error",5,"tc"),this.setState({loadingMoreBefore:!1,loadingMoreAfter:!1});else{var i=a.body.data;0===i.length?this.fetchAuditLogRequest=S().get("/apiv1/auditlogs?limit=10&starting_after="+e).set("Content-Type","application/json").end(function(e,t){t.headers.location?window.location=t.headers.location:(e?this.props.onNotification("Error while reading audit logs: "+e,"error",5,"tc"):((i=t.body.data).sort(function(e,t){return t.id-e.id}),this.setState({auditLogs:i})),this.setState({loadingMoreBefore:!1,loadingMoreAfter:!1}))}.bind(this)):(i.sort(function(e,t){return t.id-e.id}),this.setState({auditLogs:i}),this.setState({loadingMoreBefore:!1,loadingMoreAfter:!1}))}}.bind(this))},fetchAuditLog:function(e,t){this.fetchAuditLogRequest&&(this.fetchAuditLogRequest.abort(),this.fetchAuditLogRequest=null);var a="";switch(e){case"before":this.state.auditLogs.length&&(a="&starting_after="+this.state.auditLogs[0].id),this.setState({loadingMoreBefore:!0});break;case"after":this.state.auditLogs.length&&(a="&ending_before="+this.state.auditLogs[this.state.auditLogs.length-1].id),this.setState({loadingMoreAfter:!0});break;case"date":return void this.fetchAuditLogForDate(t)}this.fetchAuditLogRequest=S().get("/apiv1/auditlogs?limit=100"+a).set("Content-Type","application/json").end(function(e,a){var i;a.headers.location?window.location=a.headers.location:(e?this.props.onNotification("Error while reading audit logs: "+e,"error",5,"tc"):((i=t?a.body.data:this.state.auditLogs.concat(a.body.data)).sort(function(e,t){return t.id-e.id}),this.setState({auditLogs:i})),this.setState({loadingMoreBefore:!1,loadingMoreAfter:!1}))}.bind(this))},onSearchChange:function(e){this.setState({searchString:e})},OnLoadMore:function(e){this.fetchAuditLog(e)},OnShowLogInfo:function(e){this.setState({selectedLogEvent:e},this.refs.AccountAudioLogInfoDialog.open)},OnEventFilter:function(e){this.setState({eventFilter:e})},OnUserFilter:function(e){this.setState({userFilter:e})},OnGotoDateChanged:function(e){var t=ge()(e,"x").utc();this.fetchAuditLog("date",t.format("YYYY-MM-DDTHH:mm:ss.000Z")),this.setState({gotoDate:t})},render:function(){var e,t,a,i,n,s=this,l=function(e){var t=function(e){var t;try{t=JSON.parse(e)}catch(e){}return t?t.email+" with ID "+t.userId+" from account "+t.account:e},a=function(e){var t=s.allUsers.find(function(t){return t.id==e});return t?t.email+" with ID "+e:" with ID "+e},i="";switch(e.event){case"login.success":i="User has successfully logged in";break;case"login.failed":i=e.value?"User login with invalid email "+e.value:"User login has failed";break;case"composition.created":i="Composition with ID "+e.target+" created";break;case"composition.deleted":i="Composition with ID "+e.target+" deleted";break;case"composition.viewed":i="Composition with ID "+e.target+" opened in composer";break;case"composition.duplicated":i="Composition with ID "+e.target+" copied to composition ID "+e.value;break;case"composition.script.viewed":i="Composition with ID "+e.target+" opened in the script editor";break;case"composition.sent":i="Composition with ID "+e.target+" sent to user "+t(e.value2)+" as composition ID "+e.value;break;case"composition.received":i="Composition with ID "+e.target+" received from user "+t(e.value2)+" who sent composition ID "+e.value;break;case"composition.snapshot.updated":i="The snapshot of composition with ID "+e.target+" was updated";break;case"composition.thumbnail.updated":i="The thumbnail of composition with ID "+e.target+" was updated";break;case"composition.revision.created":i="A revision with ID "+e.value+" of composition with ID "+e.target+" was created.";break;case"composition.revision.deleted":i="A revision with ID "+e.value+" of composition with ID "+e.target+" was deleted.";break;case"composition.revision.restored":i="A revision with ID "+e.value+" of composition with ID "+e.target+" was restored.";break;case"composition.token.created":i="A new access token for composition with ID "+e.target+" was created.";break;case"composition.downloaded":i="A composition with ID "+e.value2+" was created by downloading ID "+e.target+" from library ID "+e.value;break;case"app.created":i="App with ID "+e.target+" created";break;case"app.deleted":i="App with ID "+e.target+" deleted";break;case"app.viewed":i="App with ID "+e.target+" opened","access_token"==e.value&&(i+=" using access token "+e.value2);break;case"app.composition.imported":i="A composition with ID "+e.value+" imported into app with ID "+e.target;break;case"app.duplicated":i="App with ID "+e.target+" copied to app ID "+e.value;break;case"app.token.created":i="A new access token of app with ID "+e.target+" created";break;case"app.token.revoked":i="The access token of app with ID "+e.target+" revoked";break;case"app.sent":i="App with ID "+e.target+" sent to user "+t(e.value2)+" as app ID "+e.value;break;case"app.received":i="App with ID "+e.target+" received from user "+t(e.value2)+" who sent app ID "+e.value;break;case"app.thumbnail.updated":i="The thumbnail of app with ID "+e.target+" updated";break;case"app.downloaded":i="An app with ID "+e.value2+" was created by downloading ID "+e.target+" from library ID "+e.value;break;case"output.created":i="Output with ID "+e.target+" created";break;case"output.deleted":i="Output with ID "+e.target+" deleted";break;case"output.attached":i="Output with ID "+e.target+" was attached to app with ID "+e.value;break;case"output.detached":i="Output with ID "+e.target+" was detached from app with ID "+e.value;break;case"output.updated":i="Output with ID "+e.target+" updated";break;case"asset.created":i="Asset with ID "+e.target+" created";break;case"asset.deleted":i="Asset with ID "+e.target+" deleted";break;case"datanode.created":i="Data node with ID "+e.target+" created";break;case"datanode.deleted":i="Data node with ID "+e.target+" deleted";break;case"datanode.token.created":i="A new access token for data node with ID "+e.target+" was created.";break;case"datastream.created":i="Data stream with ID "+e.target+" created";break;case"datastream.deleted":i="Data stream with ID "+e.target+" deleted";break;case"datastream.token.updated":i="Data stream with ID "+e.target+" "+e.value.toLowerCase()+" token updated ";break;case"datastream.updated":i="Data stream with ID "+e.target+" updated";break;default:break;case"connection.deleted":i="Connection "+e.value+" has been deleted";break;case"connection.created":i="Connection "+e.value+" has been created";break;case"connection.updated":i="Connection "+e.value+" has been updated";break;case"user.created":i="User "+a(e.target)+" has been created";break;case"user.deleted":i="User "+a(e.target)+" has been deleted";break;case"user.active":i=e.value?"User "+a(e.target)+" has been activated":"User "+a(e.target)+"User has been de-activated";break;case"user.password":i="Password of user "+a(e.target)+" was changed";break;case"user.email":i="Email of user "+a(e.target)+" was changed from "+e.value+" to "+e.value2;break;case"user.permission.development":i=e.value?"Permission 'development' of user "+a(e.target)+" has been added":"Permission 'development' of user "+a(e.target)+" has been removed";break;case"user.permission.user_administration":i=e.value?"Permission 'user administration' of user "+a(e.target)+" has been added":"Permission 'user administration' of user "+a(e.target)+" has been removed"}return i},r=function(e){var t=e.split(",");return t&&0!=t.length?t[0]:"Unknown"},c=o().createElement("div",{className:"dropdown-group dropdown-white"},o().createElement("button",{className:"btn btn-white","data-toggle":"dropdown",style:{width:"200px",height:"33px"}},o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"150px",display:"inline-block"}},(e=xo,t=this.state.eventFilter,(a=e.find(function(e){return e.id==t}))?a.title:"unknown")),o().createElement("i",{className:"fa fa-caret-down",style:{top:"0px",position:"relative"}})),o().createElement("ul",{className:"dropdown-menu",style:{overflowX:"hidden",overflowY:"auto",right:"0px",top:"43px",maxHeight:"493px"}},xo.map(function(e,t){return o().createElement("li",{key:t},o().createElement("a",{href:"javascript:",onClick:s.OnEventFilter.bind(s,e.id)},e.title))}))),d=o().createElement("div",{className:"dropdown-group dropdown-white"},o().createElement("button",{className:"btn btn-white","data-toggle":"dropdown",style:{width:"200px",height:"33px"}},o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"150px",display:"inline-block"}},function(e){if("All"==e)return"All";var t=s.allUsers.find(function(t){return t.id==e.id});return t?t.email:"unknown"}(this.state.userFilter)),o().createElement("i",{className:"fa fa-caret-down",style:{top:"0px",position:"relative"}})),o().createElement("ul",{className:"dropdown-menu",style:{overflowX:"hidden",overflowY:"auto",right:"0px",top:"43px",maxHeight:"493px"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:this.OnUserFilter.bind(this,"All")},"All")),this.allUsers.map(function(e,t){return o().createElement("li",{key:t},o().createElement("a",{href:"javascript:",onClick:s.OnUserFilter.bind(s,e)},o().createElement("span",{style:{width:"100%",display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}},e.email)))}))),p=o().createElement("div",{style:{width:"120px",fontSize:"12px"}},o().createElement(Fs(),{value:this.state.gotoDate,className:"singular-date-time",inputProps:{placeholder:"Expiration Date",readOnly:"false"},dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm",onChange:this.OnGotoDateChanged})),m=this.state.auditLogs.filter(function(e,t){if(!("All"!==s.state.eventFilter&&0!==e.event.indexOf(s.state.eventFilter)||"All"!==s.state.userFilter&&e.actor!=s.state.userFilter.id)){var a=l(e),i=r(e.ip);if(""!==s.state.searchString){var n=s.state.searchString.toUpperCase(),o=s.allUsers.find(function(t){return e.actor==t.id}),c="",d="",p="",m="";if(o&&(m&&(m=String(e.actor)),o.firstName&&(c=o.firstName),o.lastName&&(d=o.lastName),o.email&&(p=o.email)),-1===e.event.toUpperCase().indexOf(n)&&-1===m.toUpperCase().indexOf(n)&&-1===c.toUpperCase().indexOf(n)&&-1===d.toUpperCase().indexOf(n)&&-1===p.toUpperCase().indexOf(n)&&-1===a.toUpperCase().indexOf(n)&&-1===i.toUpperCase().indexOf(n))return}return e}}),u=o().createElement("div",{style:{marginLeft:"100px"}},o().createElement(co.A,{className:"btn btn-white",data:m,filename:"AuditLogs.csv",tabIndex:"-1",style:{marginLeft:"auto",marginRight:"20px",width:"100px"}},"Export")),h=o().createElement("table",{className:"widget-version-list",style:{border:"0px",flex:"0 0 auto",width:"calc(100% - 10px)",marginBottom:"15px"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"51%",textAlign:"left"}},o().createElement("span",{className:"table-header"},"Event Description")),o().createElement("th",{style:{width:"25%",textAlign:"left"}},o().createElement("span",{className:"table-header"},"User")),o().createElement("th",{style:{width:"10%",textAlign:"center"}},o().createElement("span",{className:"table-header"},"Date")),o().createElement("th",{style:{width:"120px",textAlign:"center"}},o().createElement("span",{className:"table-header"},"IP Address")),o().createElement("th",{style:{width:"4%",textAlign:"center"}},o().createElement("span",{className:"table-header"}))))),f=o().createElement("table",{className:"widget-version-list",style:{border:"0px"}},o().createElement("thead",{style:{display:"none",overflowX:"hidden",overflowY:"scroll"}},o().createElement("tr",null,o().createElement("th",{style:{width:"51%",textAlign:"left"}}),o().createElement("th",{style:{width:"25%",textAlign:"left"}}),o().createElement("th",{style:{width:"10%",textAlign:"center"}}),o().createElement("th",{style:{width:"120px",textAlign:"center"}}),o().createElement("th",{style:{width:"4%",textAlign:"center"}}))),o().createElement("tbody",null,m.map(function(e,t){var a,i=l(e),n=r(e.ip);return i||(i=o().createElement("span",null,"")),o().createElement("tr",{key:t,style:{cursor:"default"}},o().createElement("td",{style:{width:"51%",textAlign:"left"}},o().createElement("span",null,o().createElement("b",null,e.event),o().createElement("br",null),o().createElement("span",{style:{fontSize:"11px"}},i))),o().createElement("td",{style:{width:"25%",textAlign:"left"}},function(e){var t=s.allUsers.find(function(t){return t.id==e});if(t){var a="";return t.firstName&&(a+=t.firstName+" "),t.lastName&&(a+=t.lastName),o().createElement("span",null,o().createElement("span",null,o().createElement("b",null,t.email)),o().createElement("br",null),o().createElement("span",{style:{fontSize:"11px"}},a))}return e?"Id "+e:""}(e.actor)),o().createElement("td",{style:{width:"10%",textAlign:"center"}},(a=e.created_at,o().createElement("span",null,o().createElement("b",null,ge()(a).fromNow()),o().createElement("br",null),o().createElement("span",{style:{fontSize:"11px"}},ge()(a).utc().format("YYYY-MM-DD HH:mm:ss"))))),o().createElement("td",{style:{width:"120px",textAlign:"center"}},o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"pre",maxWidth:"116px",display:"block"}},"",o().createElement("br",null),o().createElement("span",{style:{fontSize:"11px"}},n))),o().createElement("td",{style:{width:"4%",textAlign:"center"}},o().createElement("button",{className:"btn btn-white icon-only",style:{height:"28px",margin:"0px",position:"relative",transform:"scale(0.6)",top:"2px",right:"2px"},tabIndex:"-1",onClick:function(){return s.OnShowLogInfo(e)}},o().createElement("i",{className:"fa fa-info fa-lg"}))))}))),g=o().createElement("button",{className:"btn btn-white disabled",style:{height:"25px",width:"120px"}},o().createElement("img",{style:{height:"100%",padding:"0px"},src:"/images/loading-bubbles-blue.svg"}));return i=this.state.loadingMoreBefore?g:o().createElement("button",{className:"btn btn-white",onClick:function(){return s.OnLoadMore("before")},style:{height:"25px",width:"120px",lineHeight:"1"}},o().createElement("i",{className:"fa fa-arrow-up",style:{float:"none",position:"relative",left:"-10px",top:"0px"}}),"Load More",o().createElement("i",{className:"fa fa-arrow-up",style:{float:"none",position:"relative",left:"10px",top:"0px"}})),n=this.state.loadingMoreAfter?g:o().createElement("button",{className:"btn btn-white",onClick:function(){return s.OnLoadMore("after")},style:{height:"25px",width:"120px",lineHeight:"1"}},o().createElement("i",{className:"fa fa-arrow-down",style:{float:"none",position:"relative",left:"-10px",top:"0px"}}),"Load More",o().createElement("i",{className:"fa fa-arrow-down",style:{float:"none",position:"relative",left:"10px",top:"0px"}})),o().createElement("div",{className:"profile-wrapper",style:{height:"100%"}},o().createElement("div",{className:"singular-browser-body-tools"},o().createElement("div",{className:"portal-search-wrapper",style:{padding:"10px"}},o().createElement(Bn,{mode:"immediate",placeholder:"Full Text Search ...",onSearch:this.onSearchChange})),o().createElement("span",{style:{marginLeft:"auto",marginRight:"10px"}},"Filter Event"),c,o().createElement("span",{style:{marginLeft:"50px",marginRight:"10px"}},"Filter User"),d,o().createElement("span",{style:{marginLeft:"50px",marginRight:"10px"}},"Goto Date"),p,u),o().createElement("div",{className:"developer-manager",style:{height:"calc(100% - 60px)"}},o().createElement("div",{className:"details-panel",style:{height:"100%",maxWidth:"1400px"}},o().createElement("div",{className:"details-panel-body",style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%"}},h,o().createElement("div",{style:{flex:"0 0 auto",margin:"auto"}},i),o().createElement("div",{style:{flex:"1 1 auto",overflowX:"hidden",overflowY:"scroll"}},f),o().createElement("div",{style:{flex:"0 0 auto",margin:"auto"}},n)))),o().createElement(Co,{logEvent:this.state.selectedLogEvent,onNotification:this.props.onNotification,ref:"AccountAudioLogInfoDialog"}))}});var ko=a(86479),Do=a(98534);function Ao(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}a(10611);var Ro=60,Po=[{id:"uniqueIP",title:"Unique IP"},{id:"uniqueIPgraphicsSDK",title:"Unique IP with Graphics SDK"},{id:"graphicsSDK",title:"Graphics SDK Events"}],To=[{id:"2021",title:"2021"},{id:"2022",title:"2022"},{id:"2023",title:"2023"},{id:"2024",title:"2024"},{id:"2025",title:"2025"}],Mo=[{id:"all",title:"All"},{id:"1",title:"January"},{id:"2",title:"February"},{id:"3",title:"March"},{id:"4",title:"April"},{id:"5",title:"May"},{id:"6",title:"June"},{id:"7",title:"July"},{id:"8",title:"August"},{id:"9",title:"September"},{id:"10",title:"October"},{id:"11",title:"November"},{id:"12",title:"December"}];const Oo=o().createClass({displayName:"AccountAnalyticsUniqueIP",getInitialState:function(){return this.accountInfoRequest=null,this.accountReportRequest=null,{busy:!0,report:"uniqueIP",accountId:"43",accountInfo:"Pixellot",year:ge()().year(),month:ge()().month(),result:null,resultTotalDuration:0,resultTotalApps:0}},componentDidMount:function(){this.fetchData()},componentWillUnmount:function(){this.accountInfoRequest&&this.accountInfoRequest.abort(),this.accountReportRequest&&this.accountReportRequest.abort()},buildGraphicsSdkReport:function(e){var t=0,a=0,i=0,n=0,s=0,o=0,l=0,r=0;return e.forEach(function(e){"GRAPHICS_SDK"===e.INITIATOR?e.MINUTES>=Ro?(t++,a+=e.MINUTES):(i++,n+=e.MINUTES):e.MINUTES>=Ro?(s++,o+=e.MINUTES):(l++,r+=e.MINUTES)}),{numberOfCountedEventsGraphicsSDK:t,totalMinutesOfCountedEventsGraphicsSDK:a,numberOfIgnoredEventsGraphicsSDK:i,totalMinutesOfIgnoredEventsGraphicsSDK:n,numberOfCountedEventsControlApp:s,totalMinutesOfCountedEventsControlApp:o,numberOfIgnoredEventsControlApp:l,totalMinutesOfIgnoredEventsControlApp:r}},buildUniqueIpReport:function(e){var t,a=[],i="";e.forEach(function(e){i!=e.IP?(t&&a.push(Object.assign({},t)),t={IP:e.IP,duration:Number(e.TOTALMINUTES),appID:[e.APPID]}):(t.duration+=Number(e.TOTALMINUTES),0==t.appID.includes(e.APPID)&&t.appID.push(e.APPID)),i=e.IP}),t&&a.push(Object.assign({},t)),a=a.sort(function(e,t){return e.duration<t.duration?-1:e.duration>t.duration?1:0});var n=0,s=0;return a.forEach(function(e){e.numApp=e.appID.length,s+=e.appID.length,e.appID=e.appID.join(", "),e.duration=60*e.duration,n+=e.duration}),{report:a,totalDuration:n,totalApps:s}},fetchData:function(){var e,t=this;this.setState({busy:!0,result:null,resultTotalDuration:0,resultTotalApps:0}),this.accountReportRequest&&this.accountReportRequest.abort(),e="uniqueIP"===this.state.report||"uniqueIPgraphicsSDK"===this.state.report?"/apiv1/analytics/p_report?":"/apiv1/analytics/p_report2?","all"!==this.state.month&&(e+="month="+this.state.month+"&"),this.state.year&&(e+="year="+this.state.year+"&"),this.state.accountId&&(e+="account_id="+this.state.accountId),"uniqueIPgraphicsSDK"===this.state.report&&(e+="&includesdk=1"),this.accountReportRequest=S().get(e,function(e,a){if(e)t.props.onNotification("Failed to fetch analytics data","error",5,"tc"),t.setState({busy:!1,result:null});else{if("uniqueIP"===t.state.report||"uniqueIPgraphicsSDK"===t.state.report){var i=t.buildUniqueIpReport(a.body);t.setState({result:i.report,resultTotalDuration:i.totalDuration,resultTotalApps:i.totalApps})}else{var n=t.buildGraphicsSdkReport(a.body);t.setState({result:n,resultTotalDuration:0,resultTotalApps:0}),console.log(n)}t.setState({busy:!1})}t.accountReportRequest=null})},OnValueChanged:function(e,t){var a={result:void 0,exportData:void 0,busy:!0};a[e]=t,this.setState(a,this.fetchData)},fetchAccountInfo:function(e){var t=this;this.setState({accountInfo:"fetching"}),this.accountInfoRequest&&this.accountInfoRequest.abort(),e||0===e?this.accountInfoRequest=S().get("/apiv1/accounts/"+e,function(e,a){t.accountInfoRequest=null,e?t.setState({accountInfo:"error"}):t.setState({accountInfo:a.body.name})}):this.setState({accountInfo:"error"})},onAccountIdChange:function(e){var t=e.target.value;this.setState({accountId:t,accountInfo:"changed"})},exportCsvFile:function(){var e,t,a,i,n,s;if("graphicsSDK"===this.state.report)t=this.state.result,a=[],i=Object.keys(t),n=Object.values(t),a.push(i.join(",")),a.push(n.join(",")),e=a.join("\n");else{var o=this.state.result,l=function(e,t){return null===t?"":t},r=Object.keys(o[0]);e=[r.join(",")].concat((s=o.map(function(e){return r.map(function(t){return JSON.stringify(e[t],l)}).join(",")}),function(e){if(Array.isArray(e))return Ao(e)}(s)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return Ao(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ao(e,t):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).join("\r\n")}var c=new Blob([e],{type:"text/plain;charset=utf-8"});Gt().saveAs(c,"AnalyticsData.csv")},onAccountIdKeyDown:function(e){switch(e.key){case"Escape":this.setState({accountId:"0"});break;case"Tab":this.fetchData(),this.fetchAccountInfo(this.state.accountId)}},onAccountIdKeyPress:function(e){"Enter"===e.key&&(this.fetchData(),this.fetchAccountInfo(this.state.accountId))},render:function(){var e,t,a,i;return"error"==this.state.accountInfo?(e="Account ID not found",t=o().createElement("i",{className:"fa fa-times fa-lg"}),a="red"):"changed"==this.state.accountInfo?(e="Hit enter or tab to fetch account name",t=o().createElement("i",{className:"fa fa-exclamation-circle fa-lg"}),a="#898989"):"fetching"==this.state.accountInfo?(e="Fetching account name",t=o().createElement("i",{className:"fa fa-circle-o-notch fa-spin fa-fw"}),a="#898989"):(e=this.state.accountInfo,t=o().createElement("i",{className:"fa fa-info-circle fa-lg"}),a="green"),i=this.state.busy?o().createElement("div",{className:"center-in-parent"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):this.state.result?"graphicsSDK"===this.state.report?o().createElement("table",{className:"analytics-graphics-sdk"},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",null,"Type"),o().createElement("th",null,"#"),o().createElement("th",null,"Total Minutes"))),o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",null,"Graphics SDK events shorter than ",Ro," ","minutes"),o().createElement("td",null,mn().numberWithCommas(this.state.result.numberOfIgnoredEventsGraphicsSDK)),o().createElement("td",null,mn().formatMinutes(this.state.result.totalMinutesOfIgnoredEventsGraphicsSDK))),o().createElement("tr",null,o().createElement("td",null,"Graphics SDK events at least ",Ro," ","minutes long"),o().createElement("td",null,mn().numberWithCommas(this.state.result.numberOfCountedEventsGraphicsSDK)),o().createElement("td",null,mn().formatMinutes(this.state.result.totalMinutesOfCountedEventsGraphicsSDK))),o().createElement("tr",null,o().createElement("td",null,"Control app events shorter than ",Ro," ","minutes"),o().createElement("td",null,mn().numberWithCommas(this.state.result.numberOfIgnoredEventsControlApp)),o().createElement("td",null,mn().formatMinutes(this.state.result.totalMinutesOfIgnoredEventsControlApp))),o().createElement("tr",null,o().createElement("td",null,"Control app events at least ",Ro," minutes long"),o().createElement("td",null,mn().numberWithCommas(this.state.result.numberOfCountedEventsControlApp)),o().createElement("td",null,mn().formatMinutes(this.state.result.totalMinutesOfCountedEventsControlApp))),o().createElement("tr",null,o().createElement("td",{style:{fontWeight:"bold"}},"Total"),o().createElement("td",{style:{fontWeight:"bold"}},mn().numberWithCommas(this.state.result.numberOfCountedEventsGraphicsSDK+this.state.result.numberOfIgnoredEventsGraphicsSDK+this.state.result.numberOfCountedEventsControlApp+this.state.result.numberOfIgnoredEventsControlApp)),o().createElement("td",null,mn().formatMinutes(this.state.result.totalMinutesOfIgnoredEventsGraphicsSDK+this.state.result.totalMinutesOfCountedEventsGraphicsSDK+this.state.result.totalMinutesOfIgnoredEventsControlApp+this.state.result.totalMinutesOfCountedEventsControlApp))))):o().createElement("table",{className:"analytics-ip"},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",null,"#"),o().createElement("th",null,"IP"),o().createElement("th",null,"Duration"),o().createElement("th",null,"# App IDs"),o().createElement("th",null,"App IDs"))),o().createElement("tbody",null,this.state.result.map(function(e,t){return o().createElement("tr",{key:t},o().createElement("td",null,t+1),o().createElement("td",null,e.IP),o().createElement("td",null,mn().formatMinutes(Math.round(e.duration/60))),o().createElement("td",null,mn().numberWithCommas(e.numApp)),o().createElement("td",null,e.appID))}),o().createElement("tr",null,o().createElement("td",null),o().createElement("td",{style:{fontWeight:"bold"}},"Total"),o().createElement("td",{style:{fontWeight:"bold"}},mn().formatMinutes(Math.round(this.state.resultTotalDuration/60))),o().createElement("td",{style:{fontWeight:"bold"}},mn().numberWithCommas(this.state.resultTotalApps)),o().createElement("td",null)))):o().createElement("div",{className:"center-in-parent"},"Couldn't fetch info"),o().createElement("div",{className:"profile-wrapper account-analytics",style:{height:"100%"}},o().createElement("div",{className:"singular-browser-body-tools"},o().createElement(Do.A,{title:"Report",id:"report",width:"250px",selection:Po,value:this.state.report,OnValueChanged:this.OnValueChanged}),o().createElement("div",{style:{width:"20px"}}),o().createElement(Do.A,{title:"Year",id:"year",width:"150px",selection:To,value:this.state.year,OnValueChanged:this.OnValueChanged}),o().createElement("div",{style:{width:"20px"}}),o().createElement(Do.A,{title:"Month",id:"month",width:"150px",selection:Mo,value:this.state.month,OnValueChanged:this.OnValueChanged}),o().createElement("div",{style:{width:"20px"}}),o().createElement("div",null,"Account ID"),o().createElement("div",{style:{width:"100px",marginLeft:"10px",display:"flex",alignItems:"center"}},o().createElement("input",{type:"text",className:"form-control",onChange:this.onAccountIdChange,onKeyDown:this.onAccountIdKeyDown,onKeyPress:this.onAccountIdKeyPress,value:this.state.accountId,autoComplete:"off",style:{textAlign:"center",width:"80px",marginRight:"5px"}}),o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"AccountInfo"},e)},o().createElement("span",{style:{color:a,fontSize:"13px"}},t))),o().createElement("div",{style:{flexGrow:"1"}}),o().createElement("div",{style:{marginLeft:"50px"}},o().createElement("span",null,""),o().createElement("button",{className:"btn btn-white",disabled:!this.state.result,style:{height:"33px",display:"inline-block",padding:"5px 25px"},onClick:this.exportCsvFile},"Export"))),o().createElement("div",{className:"developer-manager",style:{height:"calc(100% - 60px)"}},o().createElement("div",{className:"details-panel",style:{height:"calc(100% - 20px)",maxWidth:"calc(100% - 10px)",marginLeft:"0px",overflowX:"hidden",overflowY:"scroll",padding:"10px"}},i)))}});var Lo=a(21163),Vo=o().createClass({displayName:"UserSettingsRouter",componentWillMount:function(){var e=this;this.unlisten=this.props.history.listen(function(t,a){e.props.onRouteChange&&e.props.onRouteChange(t,a)})},componentWillUnmount:function(){this.unlisten()},render:function(){return o().createElement("div",{className:"singular-browser-content"},this.props.children)}});const _o=(0,Lo.A)(Vo);var Fo=a(15734),Bo=a(95093),Uo=(a(9769),a(59018)),Wo=a(804);const jo=o().createClass({displayName:"MandrillReport",getInitialState:function(){return{webhookList:null,currentEvent:"All Events",availableEvents:["send","hard_bounce","soft_bounce","open","click","spam","unsub","reject"],fetchingDataBusy:!0,listData:null,utcOffset:Bo().utcOffset(),ranges:{Today:[Bo(),Bo()],Yesterday:[Bo().subtract(1,"days"),Bo().subtract(1,"days")],"Last 7 Days":[Bo().subtract(6,"days"),Bo()],"Last 30 Days":[Bo().subtract(29,"days"),Bo()],"This Month":[Bo().startOf("month"),Bo().endOf("month")],"Last Month":[Bo().subtract(1,"month").startOf("month"),Bo().subtract(1,"month").endOf("month")]},startDate:Bo().subtract(6,"days"),endDate:Bo(),chosenLabel:"Last 7 Days"}},onDateRangePicker:function(e,t){"apply"===e.type&&this.setState({startDate:t.startDate,endDate:t.endDate,chosenLabel:t.chosenLabel,fetchingDataBusy:!0},function(){this.loadMandrillInfo(function(e,t){console.log(t),this.setState({listData:t,fetchingDataBusy:!1})}.bind(this))}.bind(this))},setcurrentEvent:function(e){this.setState({currentEvent:e,fetchingDataBusy:!0},function(){this.loadMandrillInfo(function(e,t){this.setState({listData:t,fetchingDataBusy:!1})}.bind(this))}.bind(this))},componentWillMount:function(){this.loadMandrillInfo(function(e,t){this.setState({listData:t,fetchingDataBusy:!1})}.bind(this))},componentDidMount:function(){},loadMandrillInfo:function(e){Fo.get("/mandrill/list/").query({event:this.state.currentEvent,startDate:this.state.startDate.format("X"),endDate:this.state.endDate.format("X")}).set("Content-Type","application/json").end(function(t,a){e(t,a.body)})},render:function(){var e,t=this,a=this.state.currentEvent,i=this.state.availableEvents.map(function(e,t){var a=this;return o().createElement("li",{key:t},o().createElement("a",{href:"javascript:",onClick:function(){return a.setcurrentEvent(e)}},e))}.bind(this)),n=function(e,t){return o().createElement("tr",{key:t},o().createElement("td",{style:{width:"30%",textAlign:"left"}},e.webhook_id),o().createElement("td",{style:{width:"20%",textAlign:"center"}},e.event),o().createElement("td",{style:{width:"25%",textAlign:"center"}},e.email),o().createElement("td",{style:{width:"30%",textAlign:"right"}},Bo(e.ts).format("MMMM DD, YYYY HH:mm:ss")))}.bind(this);return e=1==this.state.fetchingDataBusy?o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"20px"}})))):this.state.listData&&0!=this.state.listData.length?o().createElement("tbody",null,this.state.listData.map(n)):o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("div",{style:{height:"20px",lineHeight:"20px"}},"Nothing to display")))),o().createElement("div",{className:"profile-wrapper"},o().createElement("div",{className:"singular-browser-body-tools"},o().createElement("div",{className:"dashboard-toolbar",style:{float:"right",width:"432px",display:"flex",justifyContent:"right",alignItems:"center",height:"100%"}},o().createElement("div",{style:{width:"170px",margin:"20px"}},o().createElement(Uo,{startDate:this.state.startDate,endDate:this.state.endDate,ranges:this.state.ranges,opens:"left",onEvent:this.onDateRangePicker},o().createElement(Wo.Button,{bsClass:"selected-date-range-btn btn btn-secondary",style:{width:"100%"}},o().createElement("div",{className:"pull-left"},o().createElement("i",{className:"fa fa-calendar",style:{marginLeft:"10px"}})),o().createElement("div",null,o().createElement("span",{style:{marginRight:"10px"}},this.state.chosenLabel))))),o().createElement("div",{style:{width:"200px"}},o().createElement("div",{className:"dropdown-group dropdown-white",role:"group",style:{width:"100%"}},o().createElement("button",{className:"btn btn-secondary","data-toggle":"dropdown",style:{width:"100%"}},o().createElement("i",{className:"fa fa-hdd-o",style:{left:"10px",float:"left"}}),o().createElement("span",{style:{textOverflow:"ellipsis",overflow:"hidden",display:"inline-block",whiteSpace:"nowrap",width:"145px"}},a),o().createElement("i",{className:"fa fa-caret-down",style:{position:"relative",top:"0px"}})),o().createElement("ul",{className:"dropdown-menu",style:{overflow:"hidden",right:"0px",top:"53px"}},o().createElement("li",null,o().createElement("a",{href:"javascript:",onClick:function(){return t.setcurrentEvent("All Events")}},"All Events")),i))))),o().createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},o().createElement("div",{className:"cards-wrapper",style:{height:"100%",padding:"0px"}},o().createElement("div",{className:"details-panel",style:{maxWidth:"90%"}},o().createElement("div",{className:"details-panel-header"},"Mandrill Email Report"),o().createElement("div",{className:"details-panel-body"},o().createElement("table",{className:"widget-version-list",style:{tableLayout:"fixed",margin:"0px"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"30%",textAlign:"left"}},"ID"),o().createElement("th",{style:{width:"25%",textAlign:"center"}},"Event"),o().createElement("th",{style:{width:"25%",textAlign:"center"}},"Email"),o().createElement("th",{style:{width:"20%",textAlign:"right"}},"Time"))),e))))))}});var Yo=a(40927),Ho=a(15734);a(95093),a(9769),a(40961);const zo=Yo.createClass({displayName:"CloudflareControl",getInitialState:function(){return{ClearAllCacheBusy:!1}},clearAllCache:function(e){Ho.post("/cloudflare/clearall").send({clearall:!0}).set("Content-Type","application/json").end(function(t,a){e(t,a.body)})},handleClearAllCache:function(){this.setState({ClearAllCacheBusy:!0}),this.clearAllCache(function(e,t){this.setState({ClearAllCacheBusy:!1})}.bind(this))},render:function(){var e;return e=1==this.state.ClearAllCacheBusy?Yo.createElement("div",null,Yo.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"20px"}})):Yo.createElement("div",null,Yo.createElement("input",{type:"submit",value:"Clear Cache",style:{color:"#000"},onClick:this.handleClearAllCache})),Yo.createElement("div",{className:"profile-wrapper"},Yo.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},Yo.createElement("div",{className:"cards-wrapper",style:{height:"100%",padding:"0px"}},Yo.createElement("div",{className:"details-panel"},Yo.createElement("div",{className:"details-panel-header"},"Cloudflare CDN"),Yo.createElement("div",{className:"details-panel-body"},e)))))}});var Go=a(40927),Ko=a(15734);const $o=Go.createClass({displayName:"BannerManagement",getInitialState:function(){return{showBusyIcon:!0}},componentDidMount:function(){this.loadBanners()},loadBanners:function(){var e=this;this.setState({showBusyIcon:!0}),Ko.get("/banners/admin").end(function(t,a){e.setState({showBusyIcon:!1,banners:a.body})})},onInputChanged:function(e,t){var a=this.state.banners;a[e]=t,this.setState({banners:a})},saveBanners:function(){var e=this,t=this.state.banners;this.setState({showBusyIcon:!0}),Ko.put("/banners").send({url:t.url,end_datetime:t.end_datetime,active:t.active}).end(function(t,a){e.setState({showBusyIcon:!1}),t?(console.error(t),e.props.onNotification("Failed to update banners","error",5,"tc")):e.props.onNotification("Banners updated successfully","success",5,"tc")})},render:function(){var e,t=this;if(1==this.state.showBusyIcon)e=Go.createElement("div",{className:"loader-wrapper"},Go.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}));else{var a=this.state.banners,i=a.url||"",n=a.end_datetime?ge()(a.end_datetime):ge()(),s="1"==a.active;e=Go.createElement("div",{className:"profile-wrapper"},Go.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},Go.createElement("div",{className:"cards-wrapper"},Go.createElement("div",{className:"details-panel",style:{maxWidth:"90%"}},Go.createElement("div",{className:"details-panel-header"},"Banners"),Go.createElement("div",{className:"details-panel-body"},Go.createElement("table",{className:"details-table"},Go.createElement("thead",null,Go.createElement("tr",null,Go.createElement("th",{style:{width:"10%",padding:"0px 10px 10px 10px"}},"Location"),Go.createElement("th",{style:{width:"10%",padding:"0px 10px 10px 10px"}},"Active"),Go.createElement("th",{style:{width:"60%",padding:"0px 10px 10px 10px"}},"URL"),Go.createElement("th",{style:{width:"20%",padding:"0px 10px 10px 10px",textAlign:"center"}},"Expires"))),Go.createElement("tbody",null,Go.createElement("tr",null,Go.createElement("td",null,Go.createElement("div",null,"Dashboard")),Go.createElement("td",null,Go.createElement("label",{className:"switch",style:{top:"4px"}},Go.createElement("input",{type:"checkbox",className:"switch-input",id:"active",checked:s,onChange:function(e){return t.onInputChanged("active",e.target.checked?"1":"0")}}),Go.createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),Go.createElement("span",{className:"switch-handle"}))),Go.createElement("td",null,Go.createElement("div",null,Go.createElement("input",{type:"text",value:i,className:"form-control",onChange:function(e){t.onInputChanged("url",e.target.value)},disabled:!s}))),Go.createElement("td",null,Go.createElement("div",null,Go.createElement(Fs(),{value:n,className:"singular-date-time",inputProps:{placeholder:"Date / Time",readOnly:"false"},dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm",onChange:function(e){return t.onInputChanged("end_datetime",ge()(e))},onClose:function(e){return t.onInputChanged("end_datetime",ge()(e))}})))))),Go.createElement("div",{style:{paddingTop:"100px"}},Go.createElement("input",{type:"button",className:"btn btn-primary",value:"Save",onClick:function(e){t.saveBanners()}})))))))}return e}});function qo(){var e,t,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",n=a.toStringTag||"@@toStringTag";function s(a,i,n,s){var r=i&&i.prototype instanceof l?i:l,c=Object.create(r.prototype);return Jo(c,"_invoke",function(a,i,n){var s,l,r,c=0,d=n||[],p=!1,m={p:0,n:0,v:e,a:u,f:u.bind(e,4),d:function(t,a){return s=t,l=0,r=e,m.n=a,o}};function u(a,i){for(l=a,r=i,t=0;!p&&c&&!n&&t<d.length;t++){var n,s=d[t],u=m.p,h=s[2];a>3?(n=h===i)&&(r=s[(l=s[4])?5:(l=3,3)],s[4]=s[5]=e):s[0]<=u&&((n=a<2&&u<s[1])?(l=0,m.v=i,m.n=s[1]):u<h&&(n=a<3||s[0]>i||i>h)&&(s[4]=a,s[5]=i,m.n=h,l=0))}if(n||a>1)return o;throw p=!0,i}return function(n,d,h){if(c>1)throw TypeError("Generator is already running");for(p&&1===d&&u(d,h),l=d,r=h;(t=l<2?e:r)||!p;){s||(l?l<3?(l>1&&(m.n=-1),u(l,r)):m.n=r:m.v=r);try{if(c=2,s){if(l||(n="next"),t=s[n]){if(!(t=t.call(s,r)))throw TypeError("iterator result is not an object");if(!t.done)return t;r=t.value,l<2&&(l=0)}else 1===l&&(t=s.return)&&t.call(s),l<2&&(r=TypeError("The iterator does not provide a '"+n+"' method"),l=1);s=e}else if((t=(p=m.n<0)?r:a.call(i,m))!==o)break}catch(t){s=e,l=1,r=t}finally{c=1}}return{value:t,done:p}}}(a,n,s),!0),c}var o={};function l(){}function r(){}function c(){}t=Object.getPrototypeOf;var d=[][i]?t(t([][i]())):(Jo(t={},i,function(){return this}),t),p=c.prototype=l.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Jo(e,n,"GeneratorFunction")),e.prototype=Object.create(p),e}return r.prototype=c,Jo(p,"constructor",c),Jo(c,"constructor",r),r.displayName="GeneratorFunction",Jo(c,n,"GeneratorFunction"),Jo(p),Jo(p,n,"Generator"),Jo(p,i,function(){return this}),Jo(p,"toString",function(){return"[object Generator]"}),(qo=function(){return{w:s,m}})()}function Jo(e,t,a,i){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}Jo=function(e,t,a,i){function s(t,a){Jo(e,t,function(e){return this._invoke(t,a,e)})}t?n?n(e,t,{value:a,enumerable:!i,configurable:!i,writable:!i}):e[t]=a:(s("next",0),s("throw",1),s("return",2))},Jo(e,t,a,i)}function Xo(e,t,a,i,n,s,o){try{var l=e[s](o),r=l.value}catch(e){return void a(e)}l.done?t(r):Promise.resolve(r).then(i,n)}function Zo(e){return function(){var t=this,a=arguments;return new Promise(function(i,n){var s=e.apply(t,a);function o(e){Xo(s,i,n,o,l,"next",e)}function l(e){Xo(s,i,n,o,l,"throw",e)}o(void 0)})}}var Qo,el,tl,al,il,nl=a(40927),sl=a(15734),ol=[{id:"email",title:"Send emails"},{id:"emailReport",title:"Email Report"},{id:"banner",title:"Manager banners"},{id:"bannerReport",title:"Banner Report"}],ll=[{id:"all",title:"All"},{id:"enterprise",title:"Enterprise"},{id:"professional",title:"Professional"}],rl=[{id:"nobanner",title:"No banners defined"}];const cl=nl.createClass({displayName:"UserInteractionManagement",getInitialState:function(){return this.xhrBannerRequest=null,this.xhrVoteRequest=null,this.xhrDeleteVotesRequest=null,this.xhrEmailTemplatesRequest=null,this.xhrEmailReportRequest=null,{showBusyIcon:!0,function:ol[0].id,banner:rl[0].id,zendeskFilter:ll[0].id,emailString:"",emailObjects:[],bannerReport:{},bannerReportLoading:!1,voteReport:[],voteReportLoading:!1,emailReport:{},emailReportLoading:!1,progressText:"",emailTemplates:[],template:"",dialogCallback:null,dialogTitle:"",dialogText:""}},componentDidMount:function(){this.setState({showBusyIcon:!1}),this.loadBannerReport(),this.loadEmailTemplates(),this.loadEmailReport()},componentWillUnmount:function(){this.xhrBannerRequest&&this.xhrBannerRequest.abort(),this.xhrVoteRequest&&this.xhrVoteRequest.abort(),this.xhrDeleteVotesRequest&&this.xhrDeleteVotesRequest.abort(),this.xhrEmailTemplatesRequest&&this.xhrEmailTemplatesRequest.abort(),this.xhrEmailReportRequest&&this.xhrEmailReportRequest.abort()},loadEmailTemplates:function(){var e=this;this.setState({emailTemplatesLoading:!0,emailTemplates:[]}),this.xhrEmailTemplatesRequest&&this.xhrEmailTemplatesRequest.abort(),this.xhrEmailTemplatesRequest=sl.get("/apiv2/campaigns/emailtemplates").end(function(t,a){e.xhrEmailTemplatesRequest=null,e.setState({emailTemplatesLoading:!1}),t?(console.error(t),e.props.onNotification("Failed to load email templates","error",5,"tc")):e.setState({emailTemplates:a.body,template:a.body[0].slug})})},loadBannerReport:function(){var e=this;this.setState({bannerReportLoading:!0,bannerReport:{}}),this.xhrBannerRequest&&this.xhrBannerRequest.abort(),this.xhrBannerRequest=sl.get("/apiv2/campaigns/banners").end(function(t,a){e.xhrBannerRequest=null,e.setState({bannerReportLoading:!1}),t?(console.error(t),e.props.onNotification("Failed to load banner report","error",5,"tc")):e.setState({bannerReport:a.body})})},loadVoteReport:function(e){var t=this;this.setState({voteReportLoading:!0,voteReport:[]}),this.xhrVoteRequest&&this.xhrVoteRequest.abort();var a="https://service.singular.live/v1/library/answers/"+encodeURIComponent(e)+"/49f7483b-9ae4-4b81-9c7d-84038761e589";this.xhrVoteRequest=sl.get(a).end(function(e,a){t.xhrVoteRequest=null,t.setState({voteReportLoading:!1}),e?(console.error(e),t.props.onNotification("Failed to load vote report","error",5,"tc")):t.setState({voteReport:a.body})})},loadEmailReport:function(){var e=this;this.setState({emailReportLoading:!0,emailReport:{}}),this.xhrVoteRequest&&this.xhrVoteRequest.abort(),this.xhrEmailReportRequest=sl.post("/apiv2/campaigns/sendstatus").end(function(t,a){if(e.xhrEmailReportRequest=null,e.setState({emailReportLoading:!1}),t)console.error(t),e.props.onNotification("Failed to load vote report","error",5,"tc");else{var i=a.body.reduce(function(e,t){return e[t.key]=(e[t.key]||0)+1,e},{});e.setState({emailReport:i})}})},deleteVotes:function(e){var t,a=this;this.setState({voteReportLoading:!0}),this.xhrDeleteVotesRequest&&this.xhrDeleteVotesRequest.abort(),e&&(t={questionId:e}),this.xhrDeleteVotesRequest=sl.delete("https://service.singular.live/v1/library/answers/49f7483b-9ae4-4b81-9c7d-84038761e589").set("Content-Type","application/json").send(t).end(function(e,t){a.xhrDeleteVotesRequest=null,a.setState({voteReportLoading:!1}),e?(console.error(e),a.props.onNotification("Failed to delete votes","error",5,"tc")):a.loadVoteReport(a.state.banner)})},functionChanged:function(e,t){this.setState({function:t}),"bannerReport"===t&&(this.loadBannerReport(),this.loadVoteReport(this.state.banner))},bannerChanged:function(e,t){this.setState({banner:t}),"bannerReport"===this.state.function&&(this.loadBannerReport(),this.loadVoteReport(t))},emailChanged:function(e,t){this.setState({template:t})},sendEmailBatch:(il=Zo(qo().m(function e(t){var a,i=this;return qo().w(function(e){for(;;)switch(e.n){case 0:return a=this.state.emailObjects.slice(),e.n=1,fetch("/apiv2/campaigns/emailstatus",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).then(function(e){return e.json()}).then(function(e){a=a.concat(e)}).catch(function(e){i.props.onNotification("Failed to fetch email status","error",5,"tc")});case 1:this.setState({emailObjects:a});case 2:return e.a(2)}},e,this)})),function(e){return il.apply(this,arguments)}),addEmailAddresses:(al=Zo(qo().m(function e(){var t,a,i,n=this;return qo().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this.state.emailString.match(/([a-zA-Z0-9._+-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi))||0===t.length){e.n=2;break}if(a=[],t.forEach(function(e){-1===n.state.emailObjects.findIndex(function(t){return t.email===e})&&-1===a.findIndex(function(t){return t===e})&&a.push(e)}),!(a.length>0)){e.n=2;break}return this.setState({showBusyIcon:!0,progressText:"Processing emails ..."}),i=function(){var e=Zo(qo().m(function e(){var t,i,s,o;return qo().w(function(e){for(;;)switch(e.n){case 0:t=100,i=0;case 1:if(!(i<a.length)){e.n=3;break}return s=a.slice(i,i+t),o=Math.round(i/a.length*100),n.setState({progressText:"Processing emails ".concat(o,"% of ").concat(mn().numberWithCommas(a.length))}),e.n=2,n.sendEmailBatch(s);case 2:i+=t,e.n=1;break;case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),e.n=1,i();case 1:this.setState({showBusyIcon:!1,progressText:""});case 2:this.setState({emailString:""});case 3:return e.a(2)}},e,this)})),function(){return al.apply(this,arguments)}),addEmailAddressesFromZendesk:(tl=Zo(qo().m(function e(){var t,a,i,n=this;return qo().w(function(e){for(;;)switch(e.n){case 0:return this.setState({showBusyIcon:!0,progressText:"Loading emails ..."}),e.n=1,fetch("/apiv2/campaigns/zendesk/api/v2/users/count.json").then(function(e){return e.json()}).then(function(e){return e.count.value}).catch(function(e){return n.props.onNotification("Failed to fetch number of emails from Zendesk","error",5,"tc"),0});case 1:if(0!==(t=e.v)){e.n=2;break}return this.setState({showBusyIcon:!1,progressText:""}),e.a(2);case 2:a="/apiv2/campaigns/zendesk/api/v2/users.json?page[size]=100",i=1;case 3:if(!a){e.n=5;break}return e.n=4,fetch(a).then(function(e){return e.json()}).then(function(){var e=Zo(qo().m(function e(a){var s,o,l,r;return qo().w(function(e){for(;;)switch(e.n){case 0:if(!(a.users&&a.users.length>0)){e.n=4;break}if(s=a.users.filter(function(e){return!!e.email&&("all"===n.state.zendeskFilter||n.state.zendeskFilter===e.user_fields.subscription_plan)}),!((o=s.map(function(e){return e.email})).length>0)){e.n=2;break}return e.n=1,n.sendEmailBatch(o);case 1:e.n=3;break;case 2:return e.n=3,new Promise(function(e){return setTimeout(e,500)});case 3:(l=Math.round(100*i/t*100))>100&&(l=100),n.setState({progressText:"Loading emails ".concat(l,"% of ").concat(mn().numberWithCommas(t))});case 4:if(!a.meta||!a.meta.has_more){e.n=5;break}return i++,r=a.links.next.replace("https://singularlive.zendesk.com","/apiv2/campaigns/zendesk"),e.a(2,r);case 5:return n.setState({showBusyIcon:!1,progressText:""}),e.a(2,null);case 6:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return n.setState({showBusyIcon:!1,progressText:""}),n.props.onNotification("Failed to load emails from Zendesk","error",5,"tc"),null});case 4:a=e.v,e.n=3;break;case 5:return e.a(2)}},e,this)})),function(){return tl.apply(this,arguments)}),clearEmailAddresses:function(){this.setState({emailObjects:[]})},sendEmails:(el=Zo(qo().m(function e(){var t,a,i,n,s,o=this;return qo().w(function(e){for(;;)switch(e.n){case 0:return t=this.state.template+" - "+Math.random().toString(36).substring(2,6),a=this.state.emailTemplates.find(function(e){return e.slug===o.state.template}),i="noreply@singular.live",a&&a.from_email&&(i=a.from_email),n=function(){var e=Zo(qo().m(function e(a){var n;return qo().w(function(e){for(;;)switch(e.n){case 0:return n=a.map(function(e){return e.email}),e.n=1,fetch("/apiv2/campaigns/sendemail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t,template:o.state.template,email:n,senderEmail:i})}).catch(function(e){o.props.onNotification("Failed to send emails","error",5,"tc")});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),this.setState({showBusyIcon:!0,progressText:"Activating banners..."}),s=function(){var e=Zo(qo().m(function e(){var t,a,i,s,l;return qo().w(function(e){for(;;)switch(e.n){case 0:t=o.state.emailObjects.filter(function(e){return"ok"===e.status||"notfound"===e.status}),a=100,i=0;case 1:if(!(i<t.length)){e.n=3;break}return s=t.slice(i,i+a),l=Math.round(i/t.length*100),o.setState({progressText:"Sending emails ".concat(l,"% of ").concat(mn().numberWithCommas(t.length))}),e.n=2,n(s);case 2:i+=a,e.n=1;break;case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),e.n=1,s();case 1:this.setState({showBusyIcon:!1,progressText:""}),this.loadEmailReport(),this.props.onNotification("Emails are being sent. Please check the email report for the status.","success",5,"tc");case 2:return e.a(2)}},e,this)})),function(){return el.apply(this,arguments)}),activateBanner:(Qo=Zo(qo().m(function e(){var t,a,i=this;return qo().w(function(e){for(;;)switch(e.n){case 0:return t=function(){var e=Zo(qo().m(function e(t){var a;return qo().w(function(e){for(;;)switch(e.n){case 0:return a=t.map(function(e){return e.email}),e.n=1,fetch("/apiv2/campaigns/banners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bannerId:i.state.banner,emails:a})}).catch(function(e){i.props.onNotification("Failed to activate banners","error",5,"tc")});case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),this.setState({showBusyIcon:!0,progressText:"Activating banners..."}),a=function(){var e=Zo(qo().m(function e(){var a,n,s,o,l;return qo().w(function(e){for(;;)switch(e.n){case 0:a=i.state.emailObjects.filter(function(e){return"ok"===e.status||"optout"===e.status}),n=100,s=0;case 1:if(!(s<a.length)){e.n=3;break}return o=a.slice(s,s+n),l=Math.round(s/a.length*100),i.setState({progressText:"Activating banners ".concat(l,"% of ").concat(mn().numberWithCommas(a.length))}),e.n=2,t(o);case 2:s+=n,e.n=1;break;case 3:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}(),e.n=1,a();case 1:this.setState({showBusyIcon:!1,progressText:""}),this.loadBannerReport(),this.props.onNotification("Banners are being activated. Please check the banner report for the status.","success",5,"tc");case 2:return e.a(2)}},e,this)})),function(){return Qo.apply(this,arguments)}),deactivateBanner:function(e){var t=this;this.setState({showBusyIcon:!0});var a="/apiv2/campaigns/banners";e&&(a+="/"+encodeURIComponent(e)),fetch(a,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(function(e){return e.text()}).then(function(e){t.setState({showBusyIcon:!1}),t.loadBannerReport(),t.props.onNotification("All banners deactivated successfully","success",5,"tc")}).catch(function(e){t.setState({showBusyIcon:!1}),t.prop.onNotification("Failed to deactivate all banners","error",5,"tc")})},showDialog:function(e,t,a){this.setState({dialogTitle:e,dialogText:t,dialogCallback:a},function(){$("#userIneractionManagementConfirmationDialog").modal("show")})},closeDialog:function(){$("#userIneractionManagementConfirmationDialog").modal("hide"),this.setState({dialogTitle:"",dialogText:"",dialogCallback:null})},render:function(){var e,t=this,a="banner"===this.state.function,i="email"===this.state.function,n="bannerReport"===this.state.function,s="emailReport"===this.state.function,o=function(){return nl.createElement("div",{className:"cards-wrapper",style:{height:"100%"}},nl.createElement("div",{className:"details-panel",style:{height:"100%",maxWidth:"80%"}},nl.createElement("div",{className:"details-panel-body",style:{height:"100%"}},nl.createElement("div",{className:"loader-wrapper"},nl.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})))))},l=function(e,t,a,i){return nl.createElement("div",{key:e,style:{display:"flex",gap:"20px",fontWeight:i?"bold":"default"}},nl.createElement("div",{className:"detail-label",style:{width:"400px",textAlign:"left"}},t),nl.createElement("div",{className:"detail-label",style:{width:"100px",textAlign:"right"}},a))};return 1==this.state.showBusyIcon?nl.createElement("div",{className:"loader-wrapper",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",width:"100%"}},nl.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}),""===this.state.progressText?null:this.state.progressText):nl.createElement("div",{className:"profile-wrapper"},nl.createElement("div",{className:"singular-browser-body-tools"},nl.createElement(Do.A,{title:"Function",id:"function",width:"250px",selection:ol,value:this.state.function,OnValueChanged:this.functionChanged}),nl.createElement("div",{style:{width:"50px"}}),a||i||n?nl.createElement("div",{style:{width:"370px",display:"flex",justifyContent:"flex-end"}},a||n?nl.createElement(Do.A,{title:"Banner ID",id:"banner",width:"250px",selection:rl,value:this.state.banner,OnValueChanged:this.bannerChanged}):null,i&&this.state.emailTemplatesLoading?nl.createElement(Do.A,{title:"Email Template",id:"email",width:"250px",selection:[{id:"loading",title:"Loading ..."}],value:"loading",OnValueChanged:this.emailChanged,disabled:!0}):null,i&&!this.state.emailTemplatesLoading?nl.createElement(Do.A,{title:"Email Template",id:"email",width:"250px",selection:t.state.emailTemplates.map(function(e){return{id:e.slug,title:e.name}}),value:this.state.template,OnValueChanged:this.emailChanged}):null):null,a||i?(e=function(e,a){var i=t.state.emailObjects.filter(function(e){return e.status===a}).length,n=!1;return"email"!==t.state.function||"deleted"!==a&&"optout"!==a&&"notverified"!==a||(n=!0),"banner"!==t.state.function||"deleted"!==a&&"notfound"!==a&&"notverified"!==a||(n=!0),nl.createElement("span",{style:{color:n?"red":""}},e,": ",mn().numberWithCommas(i))},nl.createElement("div",{style:{marginLeft:"30px"}},0===t.state.emailObjects.length?nl.createElement("span",null,"No emails"):null,t.state.emailObjects.length>0?nl.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"25px"}},nl.createElement("span",null,e("Valid","ok")),nl.createElement("span",null,e("Deleted","deleted")),nl.createElement("span",null,e("Opt Out","optout")),nl.createElement("span",null,e("Not Found","notfound")),nl.createElement("span",null,e("Not Verified","notverified"))):null)):null,nl.createElement("div",{style:{flexGrow:"1"}}),i?nl.createElement("div",{style:{display:"flex",gap:"10px"}},nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Send",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){return t.showDialog("Send Emails","Are you sure you want to send the emails?",t.sendEmails)},disabled:0===this.state.emailObjects.length})):null,a?nl.createElement("div",{style:{display:"flex",gap:"10px"}},nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Activate",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){return t.showDialog("Activate Banners","Are you sure you want to activate the banners?",t.activateBanner)},disabled:0===this.state.emailObjects.length||"nobanner"===this.state.banner}),nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Deactivate",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){return t.showDialog("Deactivate Banner","Are you sure you want to deactivate the banner?",function(){return t.deactivateBanner(t.state.banner)})},disabled:"nobanner"===this.state.banner}),nl.createElement("input",{type:"button",className:"btn btn-danger",value:"Deactivate all",style:{width:"120px",height:"35px",fontSize:"12px",marginLeft:"60px"},onClick:function(){return t.showDialog("Deactivate Banners","Are you sure you want to deactivate all banners?",t.deactivateBanner)}})):null,n?nl.createElement("div",{style:{display:"flex",gap:"10px"}},nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Reload",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){t.loadBannerReport(),t.loadVoteReport(t.state.banner)}}),nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Delete votes",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){return t.showDialog("Delete votes","Are you sure you want to delete votes?",function(){return t.deleteVotes(t.state.banner)})}}),nl.createElement("input",{type:"button",className:"btn btn-danger",value:"Delete all votes",style:{width:"120px",height:"35px",fontSize:"12px",marginLeft:"60px"},onClick:function(){return t.showDialog("Delete all votes","Are you sure you want to delete all votes?",t.deleteVotes)}})):null,s?nl.createElement("div",{style:{display:"flex",gap:"10px"}},nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Reload",style:{width:"120px",height:"35px",fontSize:"12px"},onClick:function(){t.loadEmailReport()}})):null),nl.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)"}},function(){if(!a&&!i)return null;var e,n,s=function(e,t,a,i,n){switch(i){case"ok":i="Valid";break;case"deleted":i="Deleted";break;case"optout":i="Opt Out";break;case"notfound":i="Not Found";break;case"notverified":i="Not Verified"}return nl.createElement("div",{key:e,style:{display:"flex",gap:"20px"}},nl.createElement("div",{className:"detail-label",style:{width:"50px",textAlign:"right"}},t),nl.createElement("div",{className:"detail-label",style:{width:"50px"}},a),nl.createElement("div",{className:"detail-label",style:{width:"100px"}},i),nl.createElement("div",{className:"detail-label"},n))};return nl.createElement("div",{className:"cards-wrapper",style:{height:"100%"}},nl.createElement("div",{className:"details-panel",style:{height:"100%",maxWidth:"80%"}},nl.createElement("div",{className:"details-panel-body user-interaction-wrapper",style:{height:"100%"}},nl.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"center"}},nl.createElement("div",{className:"detail-label",style:{width:"110px"}},"Email addresses"),nl.createElement("input",{type:"text",value:t.state.emailString,className:"form-control",style:{flex:"1 1 100px",maxWidth:"300px",height:"31px",position:"relative",top:"-1px"},onChange:function(e){t.setState({emailString:e.target.value})},onKeyPress:function(e){switch(e.key){case"Escape":t.setState({emailString:""});break;case"Enter":t.addEmailAddresses()}}}),nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Add",style:{position:"relative",top:"-1px"},onClick:function(e){t.addEmailAddresses()}}),nl.createElement("div",{style:{marginLeft:"50px"}},"Zendesk Contacts"),nl.createElement("div",null,nl.createElement("div",{className:"btn-group"},nl.createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-1px",height:"30px",margin:"2px 0px"}},(e=t.state.zendeskFilter,(n=ll.find(function(t){return t.id==e}))?n.title:0)),nl.createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},ll.map(function(e,a){return nl.createElement("li",{key:a},nl.createElement("a",{onClick:function(){t.setState({zendeskFilter:e.id})}},e.title))})))),nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Add",style:{position:"relative",top:"-1px"},onClick:function(e){t.addEmailAddressesFromZendesk()}}),nl.createElement("div",{style:{flexGrow:"1"}}),nl.createElement("input",{type:"button",className:"btn btn-primary",value:"Clear List",style:{position:"relative",top:"-1px"},onClick:function(e){t.clearEmailAddresses()}})),nl.createElement("div",{style:{display:"flex",flexDirection:"row",gap:"10px",alignItems:"flex-start",marginTop:"10px",height:"calc(100% - 25px)",overflowY:"scroll"}},nl.createElement("div",{className:"detail-label",style:{width:"110px"}}),nl.createElement("div",{style:{flex:"1 1 100px"}},0===t.state.emailObjects.length?nl.createElement("div",{className:"detail-label"},"No email addresses"):null,t.state.emailObjects.length>0?nl.createElement("div",{style:{display:"flex",flexDirection:"column"}},nl.createElement("span",{style:{fontWeight:"bold"}},s("header","#","ID","Status","Email")),t.state.emailObjects.map(function(e,t){return s(t,t+1,e.id,e.status,e.email)})):null)))))}(),function(){if(!n)return null;if(t.state.bannerReportLoading||t.state.voteReportLoading)return o();var e={};return t.state.voteReport.forEach(function(t){var a=t.answer;e[a]?e[a]+=1:e[a]=1}),e.close||(e.close=0),nl.createElement("div",{className:"cards-wrapper",style:{height:"100%"}},nl.createElement("div",{className:"details-panel",style:{height:"100%",maxWidth:"80%"}},nl.createElement("div",{className:"details-panel-body",style:{height:"100%"}},nl.createElement("div",{style:{display:"flex",flexDirection:"column"}},l("active","Active",mn().numberWithCommas(t.state.bannerReport[t.state.banner])),nl.createElement("div",{style:{height:"20px"}}),e.close?l("close","Closed",mn().numberWithCommas(e.close)):null,Object.keys(e).map(function(t,a){return"close"===t?null:l(a,t,mn().numberWithCommas(e[t]))})))))}(),function(){if(!s)return null;if(t.state.emailReportLoading)return o();var e=Object.keys(t.state.emailReport);return nl.createElement("div",{className:"cards-wrapper",style:{height:"100%"}},nl.createElement("div",{className:"details-panel",style:{height:"100%",maxWidth:"80%"}},nl.createElement("div",{className:"details-panel-body",style:{height:"100%"}},nl.createElement("div",{style:{display:"flex",flexDirection:"column"}},0===e.length?nl.createElement("span",null,"All emails have been sent"):l("template","Email Template","# of emails left",!0),e.map(function(e,a){return l(a,e,mn().numberWithCommas(t.state.emailReport[e]))})))))}(),nl.createElement("div",{id:"userIneractionManagementConfirmationDialog",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},nl.createElement("div",{className:"vertical-alignment-helper"},nl.createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},nl.createElement("div",{className:"modal-content"},nl.createElement("div",{className:"modal-header"},nl.createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeDialog},nl.createElement("span",{"aria-hidden":"true"},nl.createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),nl.createElement("h4",{className:"modal-title",id:"myModalLabel"},this.state.dialogTitle)),nl.createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},nl.createElement("p",{style:{color:"#555",textAlign:"center"}},this.state.dialogText)),nl.createElement("div",{className:"modal-footer"},nl.createElement("button",{tabIndex:"-1",onClick:function(){t.state.dialogCallback&&t.state.dialogCallback(),t.closeDialog()},className:"btn btn-primary"},"Ok"),nl.createElement("button",{tabIndex:"-1",onClick:this.closeDialog,className:"btn btn-secondary"},"Cancel"))))))))}});var dl=a(40927),pl=a(15734),ml=a(53209);const ul=dl.createClass({displayName:"CredentialsKey",getInitialState:function(){return{showBusyIcon:!0,userCredential:{}}},componentDidMount:function(){this.loadUserCredentialData()},loadUserCredentialData:function(){var e=this;this.setState({showBusyIcon:!0}),pl.get("/apiv1/accounts/credentials").end(function(t,a){e.setState({showBusyIcon:!1,userCredential:a.body})})},onInputChanged:function(e,t){var a=this.state.userCredential;a[e]=t,this.setState({userCredential:a})},saveCredentials:function(){var e=this,t=this.state.userCredential;this.setState({showBusyIcon:!0}),pl.put("/apiv1/accounts/credentials").send({client_id:t.client_id,client_secret:t.client_secret,redirect_uri:t.redirect_uri}).end(function(t,a){e.setState({showBusyIcon:!1}),t?(console.error(t),e.props.onNotification("Failed to update credentials","error",5,"tc")):e.props.onNotification("Credentials updated successfully","success",5,"tc")})},generateClientSecretKey:function(){this.onInputChanged("client_secret",ml(48).toString("hex"))},render:function(){var e,t=this;if(window.singularUser.id==window.singularUser.account.accountAdminId||window.singularUser.account.permission.permDevTool){var a=this.state.userCredential,i=a.client_id||"",n=a.client_secret||"",s=a.redirect_uri||"",o=!0,l=null,r=null;""!=s&&0==(o=new RegExp(/^(?:http(s)?:\/\/)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/gm).test(s))&&(l={border:"solid 1px red"},r=dl.createElement("span",{style:{color:"red",fontStyle:"italic"}},"( * Invalid URI format, URI need to start with (http:// OR https://) )"));var c=o;e=1==this.state.showBusyIcon?dl.createElement("div",{className:"loader-wrapper"},dl.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):dl.createElement("div",{className:"profile-wrapper"},dl.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},dl.createElement("div",{className:"cards-wrapper"},dl.createElement("div",{className:"details-panel",style:{maxWidth:"1000px"}},dl.createElement("div",{className:"details-panel-header"},"OAuth Client Credentials"),dl.createElement("div",{className:"details-panel-body"},dl.createElement("table",{className:"details-table"},dl.createElement("tbody",null,dl.createElement("tr",null,dl.createElement("td",null,dl.createElement("div",null,dl.createElement("div",{className:"detail-label"},"Client Id"),dl.createElement("div",null,dl.createElement("div",{className:"input-group",style:{width:"100%",borderCollapse:"unset"}},dl.createElement("input",{type:"text",className:"form-control v2",readOnly:!0,value:i,disabled:!0}),dl.createElement("span",{className:"input-group-btn"},dl.createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":i,"button-tabIndex":"-1",style:{height:"30px"}},dl.createElement("i",{className:"fa fa-clipboard fa-lg"})))))))),dl.createElement("tr",null,dl.createElement("td",null,dl.createElement("div",null,dl.createElement("div",{className:"detail-label"},"Client Secret"),dl.createElement("div",null,dl.createElement("div",{className:"input-group",style:{width:"100%",borderCollapse:"unset"}},dl.createElement("input",{type:"text",className:"form-control v2",readOnly:!0,value:n,disabled:!0}),dl.createElement("div",{className:"input-group-btn"},dl.createElement(Y(),{placement:"bottom",delayShow:500,overlay:dl.createElement(z(),{id:"generate"},"Generate new client secret key")},dl.createElement("button",{className:"btn btn-white icon-only",style:{height:"30px"},tabIndex:"-1",onClick:function(e){t.generateClientSecretKey()}},dl.createElement("i",{className:"fa fa-repeat fa-lg"})))),dl.createElement("div",{className:"input-group-btn"},dl.createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":n,"button-tabIndex":"-1",style:{height:"30px"}},dl.createElement("i",{className:"fa fa-clipboard fa-lg"})))))))),dl.createElement("tr",null,dl.createElement("td",{style:{paddingTop:"20px"}},dl.createElement("div",null,dl.createElement("div",{className:"detail-label"},"Callback URL ",r),dl.createElement("div",{className:"section-caption",style:{paddingLeft:"0px",marginBottom:"10px"}},"Please enter the URL that the user will be redirected to once they have logged in."),dl.createElement("div",null,dl.createElement("input",{type:"text",value:s,className:"form-control",style:l,onChange:function(e){t.onInputChanged("redirect_uri",e.target.value)}}))))),dl.createElement("tr",null,dl.createElement("td",null,dl.createElement("input",{type:"button",className:"btn btn-primary",value:"Save",disabled:!c,onClick:function(e){t.saveCredentials()}}))))))))))}else e=dl.createElement("div",{className:"profile-wrapper"},dl.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},dl.createElement("div",{className:"cards-wrapper"},dl.createElement("div",{className:"details-panel",style:{maxWidth:"1000px"}},dl.createElement("div",{className:"details-panel-header"},"OAuth Client Credentials"),dl.createElement("div",{className:"details-panel-body"},dl.createElement("span",{style:{color:"red"}},"Access Denied"))))));return e}});var hl=a(40927),fl=a(15734);const gl=hl.createClass({displayName:"AccountSSO",getInitialState:function(){return{showBusyIcon:!0,configuration:JSON.stringify({entryPoint:"",issuer:"",cert:""},null,2)}},componentDidMount:function(){this.load()},load:function(){var e=this;this.setState({showBusyIcon:!0}),fl.get("/apiv1/accounts/sso").end(function(t,a){e.setState({showBusyIcon:!1}),t?e.props.onNotification("Failed to load configuration","error",5,"tc"):a.body&&a.body.sso_config&&e.setState({configuration:a.body.sso_config})})},onInputChanged:function(e,t){this.setState({configuration:t})},save:function(){var e=this;this.setState({showBusyIcon:!0}),fl.put("/apiv1/accounts/sso").send({sso_config:this.state.configuration}).end(function(t,a){e.setState({showBusyIcon:!1}),t?e.props.onNotification("Failed to save configuration","error",5,"tc"):e.props.onNotification("Configuration saved successfully","success",5,"tc")})},render:function(){var e;if((window.singularUser.id==window.singularUser.account.accountAdminId||window.singularUser.account.permission.permDevTool)&&window.singularUser.account.is_sso)if(1==this.state.showBusyIcon)e=hl.createElement("div",{className:"loader-wrapper"},hl.createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}));else{var t=this.state.configuration;e=hl.createElement("div",{className:"profile-wrapper"},hl.createElement("div",{className:"developer-manager",style:{height:"100%",overflow:"auto"}},hl.createElement("div",{className:"cards-wrapper"},hl.createElement("div",{className:"details-panel",style:{maxWidth:"1000px"}},hl.createElement("div",{className:"details-panel-header"},"Single sign-on settings"),hl.createElement("div",{className:"details-panel-body"},hl.createElement("table",{className:"details-table"},hl.createElement("tbody",null,hl.createElement("tr",null,hl.createElement("td",null,hl.createElement("div",{style:{position:"relative"}},hl.createElement("div",{className:"input-group",style:{width:"calc(100% - 43px)",borderCollapse:"unset",display:"inline-block"}},hl.createElement(ea.A,{name:"configuration",id:"configuration",className:"widget-version-json",width:"100%",height:"500px",value:t,disabled:!1,theme:"light",onValueChanged:this.onInputChanged})),hl.createElement("span",{className:"input-group-btn",style:{marginTop:"0px",marginLeft:"5px",position:"absolute"}},hl.createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":t,"button-tabIndex":"-1",style:{height:"30px"}},hl.createElement("i",{className:"fa fa-clipboard fa-lg"})))))),hl.createElement("tr",null,hl.createElement("td",null,hl.createElement("input",{type:"button",className:"btn btn-primary",value:"Save",disabled:!1,onClick:this.save}))))))))))}else e=hl.createElement("div",{className:"profile-wrapper"},hl.createElement("div",{className:"developer-manager",style:{height:"calc(100% - 75px)",overflow:"auto"}},hl.createElement("div",{className:"cards-wrapper"},hl.createElement("div",{className:"details-panel",style:{maxWidth:"1000px"}},hl.createElement("div",{className:"details-panel-header"},"SAML Configuration"),hl.createElement("div",{className:"details-panel-body"},hl.createElement("span",{style:{color:"red"}},"Access Denied"))))));return e}});var vl=a(59577),bl=a(63533),yl=a(29437),El=o().createClass({displayName:"UserSettings",getInitialState:function(){return{saveIconState:"Normal",createNewUser:!1}},componentWillMount:function(){"production"===window.processMode&&"https:"!=location.protocol&&(location.href="https:"+window.location.href.substring(window.location.protocol.length))},componentDidMount:function(){},onRouteChange:function(e,t){this.forceUpdate()},onNotification:function(e,t,a,i){this.refs.appHeader.onNotification(e,t,a,i)},render:function(){var e=this;if("production"===window.processMode&&"https:"!=location.protocol)return!1;var t,a,i,n,s,l=window.singularUser.id==window.singularUser.account.accountAdminId,r=0==window.singularUser.account.accountId,c=window.singularUser.isImpersonated,d=window.singularUser.account.is_sso,p="enterprise"==window.singularUser.account.subscription.subscription_plan,m=window.singularUser.account.permission.permDevTool,u={top:"9px",cursor:"default"},h={width:"20px",textAlign:"center",top:"8px"},f={display:"inline-block",top:"8px"};window.singularUser.account.permission.permUserManagement&&(t=o().createElement(vl.A,{to:"/users/settings/useradmin",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-users",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"User Administration"))))),l&&(a=o().createElement(vl.A,{to:"/users/settings/deleteaccount",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-eraser",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Delete Account"))))),(c||(l||m)&&p)&&(i=o().createElement(vl.A,{to:"/users/settings/accountAuditLog",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-archive",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Audit Log"))))),(c||p||r)&&(n=o().createElement(vl.A,{to:"/users/settings/analytics",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-line-chart",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Analytics"))))),r&&(s=o().createElement(vl.A,{to:"/users/settings/analyticsSpecial",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-laptop",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Analytics Spcial")))));var g=!1;return(c||l||r)&&(g=!0),o().createElement(bl.A,{onChange:this.onRouteChange},o().createElement("div",{className:"height-100p"},o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement(Cn,{ref:"appHeader"}),o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Settings"),o().createElement("div",{className:"right-area"})),o().createElement("section",{className:"portal-content"},o().createElement("nav",{className:"singular-portal-nav"},o().createElement("div",{className:"navigator-wrapper"},o().createElement("ul",{className:"dashboard-tree"},o().createElement("ul",{id:"folder-tree-item-root"},o().createElement("li",{className:"subHeader",style:u},"Account"),o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/profile",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-user",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"My Profile")))),t,a,o().createElement(vl.A,{to:"/users/settings/accountStatus",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-bar-chart",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Usage")))),o().createElement(vl.A,{to:"/users/settings/accountStorage",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-database",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Storage")))),i,n,s),(l||m)&&o().createElement("li",{className:"subHeader",style:u},"Credentials"),(l||m)&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/credentialskey",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-key",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"OAuth Client")))),l&&d&&o().createElement(vl.A,{to:"/users/settings/sso",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-user-secret",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Single sign-on"))))),g&&o().createElement("li",{className:"subHeader",style:u},"Subscription"),g&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/subscription",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-envelope",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Subscription Manager")))),o().createElement(vl.A,{to:"/users/settings/billinghistory",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-usd",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Billing History"))))),r&&o().createElement("li",{className:"subHeader",style:u},"Singular Admin"),r&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/mandrillreport",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-envelope-o",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Mandrill Email Report"))))),r&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/cloudflare",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-external-link",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Cloudflare CDN"))))),r&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/banners",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-envelope-open-o",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"Banners"))))),r&&o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/userinteraction",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-handshake-o",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"User Interaction"))))),o().createElement("li",{className:"subHeader",style:u},"Platform"),o().createElement("ul",null,o().createElement(vl.A,{to:"/users/settings/about",activeClassName:"active"},o().createElement("li",null,o().createElement("i",{className:"fa fa-info",style:h}),o().createElement("span",{style:f},o().createElement("div",{className:"asset-label"},"About"))))))))),o().createElement(_o,{onRouteChange:this.onRouteChange},o().createElement(yl.A,{path:"/users/settings/profile",component:function(){return o().createElement(Xs,{onNotification:e.onNotification})}}),t&&o().createElement(yl.A,{path:"/users/settings/useradmin",component:function(){return o().createElement(eo,{onNotification:e.onNotification})}}),o().createElement(yl.A,{path:"/users/settings/accountStatus",component:function(){return o().createElement(po,{onNotification:e.onNotification})}}),o().createElement(yl.A,{path:"/users/settings/accountStorage",component:function(){return o().createElement(wo,null)}}),i&&o().createElement(yl.A,{path:"/users/settings/accountAuditLog",component:function(){return o().createElement(Io,{onNotification:e.onNotification})}}),n&&o().createElement(yl.A,{path:"/users/settings/analytics",component:function(){return o().createElement(ko.A,{mode:"settings",onNotification:e.onNotification})}}),r&&o().createElement(yl.A,{path:"/users/settings/analyticsSpecial",component:function(){return o().createElement(Oo,{onNotification:e.onNotification})}}),(l||m)&&o().createElement(yl.A,{path:"/users/settings/credentialskey",component:function(){return o().createElement(ul,{onNotification:e.onNotification})}}),l&&d&&o().createElement(yl.A,{path:"/users/settings/sso",component:function(){return o().createElement(gl,{onNotification:e.onNotification})}}),a&&o().createElement(yl.A,{path:"/users/settings/deleteaccount",component:function(){return o().createElement(to,{onNotification:e.onNotification})}}),g&&o().createElement(yl.A,{path:"/users/settings/subscription",component:function(){return o().createElement(bo,null)}}),g&&o().createElement(yl.A,{path:"/users/settings/billinghistory",component:function(){return o().createElement(uo,null)}}),r&&o().createElement(yl.A,{path:"/users/settings/mandrillreport",component:function(){return o().createElement(jo,null)}}),r&&o().createElement(yl.A,{path:"/users/settings/cloudflare",component:function(){return o().createElement(zo,null)}}),r&&o().createElement(yl.A,{path:"/users/settings/banners",component:function(){return o().createElement($o,{onNotification:e.onNotification})}}),r&&o().createElement(yl.A,{path:"/users/settings/userinteraction",component:function(){return o().createElement(cl,{onNotification:e.onNotification})}}),o().createElement(yl.A,{path:"/users/settings/about",component:function(){return o().createElement(mo,null)}}))))))}});const wl=El;function Sl(e){return Sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sl(e)}function Nl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function Cl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nl(Object(a),!0).forEach(function(t){xl(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nl(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function xl(e,t,a){return(t=function(e){var t=function(e){if("object"!=Sl(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Sl(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Sl(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Il=a(9769),kl=a(82445);const Dl=o().createClass({displayName:"AccountInfo",getInitialState:function(){return this.adjustingRenderTime=!1,this.fetchAccountHandler=null,this.fetchUserHandler=null,this.getLogHandler=null,{savingNotesBusy:!1,updateAccountBusy:!1,accountBusy:!1,accountData:null,changeLog:[],userBusy:!1,userData:null,mutatedAccount:null,infoPanelLarge:!0,featuresPanelLarge:!0,storagePanelLarge:!1}},componentDidMount:function(){this.props.account&&this.fetchAccount(this.props.account.id)},componentWillUnmount:function(){this.abortXhrRequests()},componentWillReceiveProps:function(e){e.account&&(!this.props.account||this.props.account&&this.props.account.id!=e.account.id)&&this.fetchAccount(e.account.id)},abortXhrRequests:function(){this.fetchAccountHandler&&(this.fetchAccountHandler.abort(),this.fetchAccountHandler=null),this.fetchUserHandler&&(this.fetchUserHandler.abort(),this.fetchUserHandler=null),this.getLogHandler&&(this.getLogHandler.abort(),this.getLogHandler=null)},fetchAccount:function(e){var t=this;this.setState({accountBusy:!0,accountData:null,userBusy:!1,userData:null}),this.abortXhrRequests(),this.fetchAccountHandler=S().get("/apiv1/accounts/"+e).end(function(e,a){if(t.fetchAccountHandler=null,e)t.setState({accountBusy:!1}),t.props.onNotification&&t.props.onNotification("Cannot Fetch Account Information","error",5,"tc");else{var i=a.body;null==i.app_concurrent_limit&&(i.app_concurrent_limit=0),null==i.burst_api_limit&&(i.burst_api_limit=0),null==i.daily_api_limit&&(i.daily_api_limit=0),null==i.storage_limit&&(i.storage_limit=0),null==i.noWatermark&&(i.noWatermark=0),t.setState({accountBusy:!1,accountData:i,mutatedAccount:Object.assign({},i)})}}),this.fetchUserHandler=S().get("/apiv1/users?account="+e).end(function(e,a){if(t.fetchUserHandler=null,e)t.setState({userBusy:!1}),t.props.onNotification&&t.props.onNotification("Cannot Fetch User Information","error",5,"tc");else{var i=a.body;i.sort(function(e,t){var a="",i="";return e.email&&(a=e.email.toLowerCase()),t.email&&(i=t.email.toLowerCase()),a<i?-1:a>i?1:0}),t.setState({userBusy:!1,userData:i})}}),this.getLogHandler=S().get("/apiv1/accounts/"+e+"/metadatalogs").end(function(e,a){t.getLogHandler=null,e?(t.setState({logBusy:!1}),t.props.onNotification&&t.props.onNotification("Cannot Fetch Change Log","error",5,"tc")):t.setState({logBusy:!1,changeLog:a.body})})},onShowViewLogsDialog:function(){$("#ShowLogModal").modal("show")},onShowEditNotesDialog:function(){$("#EditNotesModal").modal("show")},onSaveNotes:function(){var e=$(this.refs.accountNotes).val();this.setState({savingNotesBusy:!0}),S().put("/apiv1/accounts/"+this.props.account.id+"/metadata").send({info:e}).end(function(e,t){this.setState({savingNotesBusy:!1}),e?this.props.onNotification("Error while saving notes","error",5,"tc"):($("#EditNotesModal").modal("hide"),this.props.onRequestReload())}.bind(this))},onStripeIdClicked:function(e){e.target.select()},onCheckButtonChanged:function(e,t){var a=Object.assign({},this.state.mutatedAccount);"noWatermark"===e?t.target.checked?a.noWatermark=1:a.noWatermark=0:"movingWatermark"===e?t.target.checked?a.noWatermark=2:a.noWatermark=0:t.target.checked?a[e]=1:a[e]=0,this.setState({mutatedAccount:a})},verifyAccountEmail:function(e){var t={account_id:this.props.account.id};S().post("/apiv1/accounts/verifyemail",t).end(function(e,t){e?this.props.onNotification("Error while verifying email","error",5,"tc"):this.props.onNotification("Email has been verified","success",5,"tc")}.bind(this))},onImpersonateUser:function(e,t){this.props.onNotification("Impersonating to '"+t+"'","info",5,"tc"),S().post("/apiv1/accounts/impersonate").send({account_id:this.props.account.id,user_id:e}).end(function(e,t){e?(console.error(e),this.props.onNotification("Impersonate Error","error",5,"tc")):"success"==t.body.message?(this.props.onNotification("Impersonate Sucess waiting to redirect","success",5,"tc"),window.location=window.location.origin):this.props.onNotification("Impersonate Error","error",5,"tc")}.bind(this))},onNumberChanged:function(e,t){var a=Object.assign({},this.state.mutatedAccount);a[e]=t,this.setState({mutatedAccount:a})},onDropDownChanged:function(e,t){var a=Object.assign({},this.state.mutatedAccount);a[e]=t,"subscription_plan"==e&&(a=kl.GetDefaultAccountValues(t,a),"event-3days"!=t&&"event-7days"!=t&&"event-30days"!=t||(a.subscription_plan="event")),this.setState({mutatedAccount:a})},onExpirationDateChanged:function(e){var t=Object.assign({},this.state.mutatedAccount);t.expires_on=ge()(e,"x").utc().format("YYYY-MM-DDTHH:mm:ss.000Z"),this.setState({mutatedAccount:t})},onExecuteFeaturesSave:function(){this.setState({updateAccountBusy:!0}),this.props.onActiveAccountPropertiesChanged&&this.props.onActiveAccountPropertiesChanged(this.state.mutatedAccount),S().put("/apiv1/accounts/"+this.props.account.id+"/metadata").send(this.state.mutatedAccount).end(function(e,t){if(e)console.log("cannot save account data");else if(t.headers.location)return void(window.location=t.headers.location);this.setState({updateAccountBusy:!1}),this.fetchAccount(this.props.account.id)}.bind(this))},OnCancelFeatureSave:function(){this.setState({mutatedAccount:Object.assign({},this.state.accountData)})},onToggleInfo:function(){this.setState({infoPanelLarge:!this.state.infoPanelLarge})},onToggleFeatures:function(){this.setState({featuresPanelLarge:!this.state.featuresPanelLarge})},onToggleStorage:function(){this.setState({storagePanelLarge:!this.state.storagePanelLarge})},getStorageLimitTitle:function(e){var t=this,a=kl.StorageLimits.find(function(e){return e.id==t.state.mutatedAccount.storage_limit});return a?a.title:0},getDailyApiLimitTitle:function(e){var t=kl.DailyApiLimits.find(function(t){return t.id==e});return t?t.title:0},getDailyDataLimitTitle:function(e){var t=kl.DailyDataLimits.find(function(t){return t.id==e});return t?t.title:0},getBurstApiLimitTitle:function(e){var t=kl.BurstApiLimits.find(function(t){return t.id==e});return t?t.title:0},getBurstDataLimitTitle:function(e){var t=kl.BurstDataLimits.find(function(t){return t.id==e});return t?t.title:0},getSubscriptionTitle:function(e){var t=kl.SubscriptionPlans.find(function(t){return t.id==e});return t?t.title:"free"},render:function(){var e=this;if(this.state.updateAccountBusy||this.state.accountBusy||this.state.userBusy)return o().createElement("div",{style:{width:"100px",margin:"0 auto"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}));if(!this.props.account||!this.state.accountData||!this.state.userData)return null;var t,a,i=this.state.mutatedAccount;t=i.email_verified?o().createElement("td",{style:{height:"39px",color:"green"}},"Verified"):o().createElement("td",null,o().createElement("button",{className:"btn btn-white",tabIndex:"-1",onClick:this.verifyAccountEmail},"Manually Verify Email"));var n,s="fa fa-chevron-up";if(this.state.storagePanelLarge&&(a=o().createElement("div",{style:{width:"400px"}},o().createElement(Eo,{accountId:this.props.account.id})),s="fa fa-chevron-down"),this.state.userBusy)n=o().createElement("div",null,o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{width:"50px",height:"40px"}}));else{var l=function(e){var t,a;return t=0==e.emailVerified?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"pending"},"Email address is not verified yet")},o().createElement("i",{className:"fa fa-circle account-status pending"})):e.id==i.admin_user_id?o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"admin"},"This is the admin user")},o().createElement("i",{className:"fa fa-diamond account-status active"})):o().createElement("i",{className:"fa fa-circle account-status active"}),a=e.verified_email_link?o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":e.verified_email_link,"button-tabIndex":"-1",style:{height:"32px",margin:"0px",padding:"0px"}},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"verifyLink"},"Copy the verify link to the clipboard")},o().createElement("i",{className:"fa fa-clipboard fa-lg",style:{padding:"9px"}}))):o().createElement("button",{className:"btn btn-white",title:"impersonate",style:{height:"32px"},onClick:this.onImpersonateUser.bind(this,e.id,e.email)},o().createElement("i",{className:"fa fa-sign-in fa-lg",style:{left:"0px",top:"0px"}})),o().createElement("tr",{key:e.id},o().createElement("td",{style:{textAlign:"center"}},t),o().createElement("td",{style:{textAlign:"center"}},e.id),o().createElement("td",null,e.firstName," ",e.lastName),o().createElement("td",null,e.email),o().createElement("td",null,a))}.bind(this);n=o().createElement("div",{className:"property-group",style:{width:"100%",overflow:"hidden",margin:"0px",flexGrow:"1"}},o().createElement("div",{className:"group-title",style:{minHeight:"0px",padding:"5px 10px"}},"User List"),o().createElement("div",{className:"group-body",style:{height:"calc(100% - 35px)",width:"calc(100% - 10px)",overflowY:"scroll"}},o().createElement("table",{className:"widget-version-list"},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"}}),o().createElement("th",{style:{width:"10%",textAlign:"center"}},"ID"),o().createElement("th",{style:{width:"30%",textAlign:"left"}},"Name"),o().createElement("th",{style:{width:"45%",textAlign:"left"}},"Email"),o().createElement("th",{style:{width:"10%",textAlign:"center"}}))),o().createElement("tbody",null,this.state.userData.map(l)))))}var r,c,d=Il.compareObject(this.state.accountData,i),p=o().createElement("div",null,o().createElement("button",{className:"btn btn-secondary",style:{width:"100px",fontSize:"11px",padding:"3.75px 10px"},onClick:this.onExecuteFeaturesSave,disabled:d},"Save"),o().createElement("button",{className:"btn btn-secondary",style:{width:"100px",marginLeft:"5px",fontSize:"11px",padding:"3.75px 10px"},onClick:this.OnCancelFeatureSave,disabled:d},"Cancel"));if("free"!==i.subscription_plan){var m,u=new Date;if(i.expires_on){u=ge()(i.expires_on).toDate();var h=ge()(i.expires_on).diff(ge()());m=h<0?o().createElement("span",{style:{marginLeft:"20px",alignSelf:"center",color:"red"}},"Expired "+Il.millisecondsToString(-h,"short")+" ago"):o().createElement("span",{style:{marginLeft:"20px",alignSelf:"center"}},Il.millisecondsToString(h,"short")+" left")}r=o().createElement("div",{style:{display:"flex",alignSelf:"center"}},o().createElement("span",{style:{marginLeft:"20px",marginRight:"10px",alignSelf:"center"}},"Expires on"," "),o().createElement("div",{style:{width:"120px"}},o().createElement(Fs(),{value:u,className:"singular-date-time",inputProps:{placeholder:"Expiration Date",readOnly:"false"},dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm",onChange:this.onExpirationDateChanged})),m)}c=1==this.state.savingNotesBusy?o().createElement("div",{className:"modal-footer"},o().createElement("button",{className:"btn btn-secondary"},"Saving...")):o().createElement("div",{className:"modal-footer"},o().createElement("button",{className:"btn btn-primary",onClick:this.onSaveNotes},"OK"),o().createElement("button",{className:"btn btn-secondary","data-dismiss":"modal","aria-label":"Close"},"Cancel"));var f,g=function(t,a){return o().createElement("div",{key:a},o().createElement("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",width:"100%"}},o().createElement("div",null,ge()(t.created_at).format("YYYY-MM-DD HH:mm:ss")),o().createElement("div",null,"User ID ",t.created_by_user)),o().createElement("table",{style:{marginTop:"10px",marginBottom:"20px",width:"100%"}},o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"50%",textAlign:"left"}}),o().createElement("th",{style:{width:"50%",textAlign:"right"}}))),o().createElement("tbody",null,(n=JSON.parse(t.before),s=JSON.parse(t.request),i=Object.keys(s).reduce(function(e,t){return n[t]===s[t]?e:Cl(Cl({},e),{},xl({},t,s[t]))},{}),Object.keys(i).map(function(t,a){return o().createElement("tr",{key:a},o().createElement("td",null,function(e){switch(e){case"storage_limit":return"Storage Limit";case"daily_api_limit":return"Daily API Limit";case"burst_api_limit":return"Burst API Limit";case"daily_data_limit":return"Daily Data Limit";case"burst_data_limit":return"Burst Data Limit";case"subscription_plan":return"Subscription";case"expires_on":return"Expiration Date";case"user_limit":return"Number of users";case"weboutput_limit":return"Number of outputs";case"is_sso":return"Single Sign-on";case"noWatermark":return"Hide Watermark";case"app_concurrent_limit":return"Concurrent viewers";default:return e}}(t)),o().createElement("td",{style:{textAlign:"right"}},function(t,a){switch(t){case"storage_limit":return e.getStorageLimitTitle(a);case"daily_api_limit":return e.getDailyApiLimitTitle(a);case"burst_api_limit":return e.getBurstApiLimitTitle(a);case"daily_data_limit":return e.getDailyDataLimitTitle(a);case"burst_data_limit":return e.getBurstDataLimitTitle(a);case"subscription_plan":return e.getSubscriptionTitle(a);case"expires_on":return a?ge()(a).format("YYYY-MM-DD HH:mm:ss"):"No date defined";case"is_sso":case"noWatermark":return a?"On":"Off";default:return a}}(t,i[t])))})))));var i,n,s};f=this.state.logBusy?o().createElement("div",{style:{width:"100px",margin:"0 auto"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})):this.state.changeLog&&this.state.changeLog.length?o().createElement("div",{style:{maxWidth:"400px",margin:"0 auto"}},this.state.changeLog.map(function(e,t){return g(e,t)})):o().createElement("div",{style:{width:"100%",textAlign:"center"}},"No log messages exist");var v,b="";i.info&&(b=i.info);var y,E="fa fa-chevron-up";if(this.state.infoPanelLarge){E="fa fa-chevron-down";var w,S,N="Never";i.lastloggedin_at&&(N=ge()(i.lastloggedin_at).format("YYYY-MM-DD HH:mm:ss")),w="uno"==i.brand?"Uno":"Singular",S=i.use_datastore?"Datastore":"Firebase";var C="",x="";i.referral_code&&(x="https://overlays.uno/signup?ref="+(C=i.referral_code));var I="",k=!1;null!==i.referrer_account_id&&(I=i.referrer_account_id,i.referee_signup_date&&(k=!0)),v=o().createElement("div",{className:"group-body"},o().createElement("table",{style:{width:"65%",display:"inline-block"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{width:"20%"}},"Name"),o().createElement("td",{style:{width:"80%",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"}},i.name)),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Stripe Id"),o().createElement("td",null,i.stripe_customer_id?i.stripe_customer_id:"not registered")),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"S3 Storage Id"),o().createElement("td",null,i.uniq_id?i.uniq_id:"not available")),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Status"),t))),o().createElement("table",{style:{width:"35%",float:"right"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{width:"20%"}},"Created"),o().createElement("td",{style:{width:"80%"}},ge()(i.created_at).format("YYYY-MM-DD HH:mm:ss"))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Changed"),o().createElement("td",null,ge()(i.updated_at).format("YYYY-MM-DD HH:mm:ss"))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Last login"),o().createElement("td",null,N)),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Brand"),o().createElement("td",null,w)),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Storage"),o().createElement("td",null,S)),C&&o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{paddingRight:"20px"}},"Affiliate Link"),o().createElement("td",null,o().createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},C,o().createElement($t(),{className:"btn btn-white icon-only","data-clipboard-text":x,"button-tabIndex":"-1",style:{height:"22px",width:"22px",margin:"0px",padding:"0px",position:"relative",top:"-1px"}},o().createElement(Y(),{placement:"top",delayShow:500,overlay:o().createElement(z(),{id:"affiliateLink"},"Copy the affiliate link to the clipboard")},o().createElement("i",{className:"fa fa-clipboard fa-lg",style:{float:"none",fontSize:"12px"}})))))),I&&o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Referrer Account"),o().createElement("td",null,o().createElement("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},o().createElement("span",null,I),o().createElement("span",null,k?o().createElement("i",{className:"fa fa-check-circle",style:{color:"#58b848"}}):o().createElement("i",{className:"fa fa-exclamation-circle",style:{color:"#d8421a"}}))))))))}var D="fa fa-chevron-up";return this.state.featuresPanelLarge&&(D="fa fa-chevron-down",y=o().createElement("div",{className:"group-body"},o().createElement("table",{style:{width:"100%"}},o().createElement("tbody",null,o().createElement("tr",{style:{borderBottom:"1px solid #e3e3e3"}},o().createElement("td",{className:"label-col"},"Subscription"),o().createElement("td",{colSpan:"3"},o().createElement("div",{style:{display:"flex"}},o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getSubscriptionTitle(i.subscription_plan)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.SubscriptionPlans.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"subscription_plan",t.id)},t.title))})))),r))),o().createElement("tr",{style:{height:"5px"}}),o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{width:"10%"}},"Daily API Limit"),o().createElement("td",{style:{width:"40%"}},o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getDailyApiLimitTitle(i.daily_api_limit)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.DailyApiLimits.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"daily_api_limit",t.id)},t.title))}))))),o().createElement("td",{className:"label-col",style:{width:"10%"}},"Burst API Limit"),o().createElement("td",{style:{width:"40%"}},o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getBurstApiLimitTitle(i.burst_api_limit)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.BurstApiLimits.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"burst_api_limit",t.id)},t.title))})))))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Daily Data Limit"),o().createElement("td",null,o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getDailyDataLimitTitle(i.daily_data_limit)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.DailyDataLimits.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"daily_data_limit",t.id)},t.title))}))))),o().createElement("td",{className:"label-col"},"Burst Data Limit"),o().createElement("td",null,o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getBurstDataLimitTitle(i.burst_data_limit)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.BurstDataLimits.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"burst_data_limit",t.id)},t.title))})))))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Storage Limit"),o().createElement("td",null,o().createElement("div",{className:"form-group"},o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px",top:"-2px",height:"30px",margin:"2px 0px"}},this.getStorageLimitTitle(i.storage_limit)),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},kl.StorageLimits.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onDropDownChanged.bind(e,"storage_limit",t.id)},t.title))})))))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Number of Users"),o().createElement("td",null,o().createElement(te.A,{name:"user_limit",resetValue:"0",step:"1",format:"0",min:"1",max:"999999",value:i.user_limit,onValueChanged:this.onNumberChanged,theme:"light",width:"125px"})),o().createElement("td",{className:"label-col"},"Number of Outputs"),o().createElement("td",null,o().createElement(te.A,{name:"weboutput_limit",resetValue:"0",step:"1",format:"0",min:"0",max:"999999",value:i.weboutput_limit,onValueChanged:this.onNumberChanged,theme:"light",width:"125px"}))),o().createElement("tr",null,o().createElement("td",{className:"label-col",style:{height:"40px"}},"Hide Watermark"),o().createElement("td",null,o().createElement("div",{className:"checkbox"},o().createElement("div",{className:"bar",style:{position:"relative"}},o().createElement("input",{type:"checkbox",id:"chkWatermark",checked:1===i.noWatermark,onChange:function(t){e.onCheckButtonChanged("noWatermark",t)}}),o().createElement("label",{htmlFor:"chkWatermark",className:"checkbox-label"})))),o().createElement("td",{className:"label-col"+(1===i.noWatermark?" disabled":""),style:1===i.noWatermark?{color:"#999",opacity:.8}:{}},"Moving Watermark"),o().createElement("td",null,o().createElement("div",{className:"checkbox"},o().createElement("div",{className:"bar",style:{position:"relative"}},o().createElement("input",{type:"checkbox",id:"chkMovingWatermark",checked:2===i.noWatermark,disabled:1===i.noWatermark,onChange:function(t){e.onCheckButtonChanged("movingWatermark",t)}}),o().createElement("label",{htmlFor:"chkMovingWatermark",className:"checkbox-label"}))))),o().createElement("tr",null,o().createElement("td",{className:"label-col"},"Single sign-on"),o().createElement("td",null,o().createElement("div",{style:{display:"flex"}},o().createElement("div",{className:"checkbox"},o().createElement("div",{className:"bar",style:{position:"relative"}},o().createElement("input",{type:"checkbox",id:"chkIsSSO",checked:i.is_sso,onChange:function(t){e.onCheckButtonChanged("is_sso",t)}}),o().createElement("label",{htmlFor:"chkIsSSO",className:"checkbox-label"}))))),o().createElement("td",null),o().createElement("td",null)),o().createElement("tr",null,o().createElement("td",null),o().createElement("td",{colSpan:"3"},p)))))),o().createElement("div",{style:{height:"100%"}},o().createElement("div",{className:"profile-properties",style:{margin:"0px"}},o().createElement("div",{className:"property-group",style:{width:"100%",margin:"0px"}},o().createElement("div",{className:"group-title",style:{minHeight:"0px",padding:"5px 10px"}},"Info",o().createElement("button",{className:"btn btn-white icon-only v2 pull-right",style:{position:"relative",top:"-1px",margin:"0px",padding:"3.75px 10px"},tabIndex:"-1",onClick:this.onToggleInfo},o().createElement("i",{className:E}))),v),o().createElement("div",{className:"property-group",style:{width:"100%",margin:"0px"}},o().createElement("div",{className:"group-title",style:{minHeight:"0px",padding:"5px 10px"}},"Features",o().createElement("button",{className:"btn btn-white icon-only v2 pull-right",style:{position:"relative",top:"-1px",margin:"0px",padding:"3.75px 10px"},tabIndex:"-1",onClick:this.onToggleFeatures},o().createElement("i",{className:D}))),y),o().createElement("div",{className:"property-group",style:{width:"100%",margin:"0px"}},o().createElement("div",{className:"group-title",style:{minHeight:"0px",padding:"5px 10px"}},"Dashboard Storage Stats",o().createElement("button",{className:"btn btn-white icon-only v2 pull-right",style:{position:"relative",top:"-1px",margin:"0px",padding:"3.75px 10px"},tabIndex:"-1",onClick:this.onToggleStorage},o().createElement("i",{className:s}))),a),n),o().createElement("div",{id:"EditNotesModal",className:"modal fade u-displaynone singular-modal singular-modal-white ",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Add notes to the account")),o().createElement("div",{className:"modal-body",style:{borderRadius:"0px"}},o().createElement("textarea",{ref:"accountNotes",className:"form-control align-left text-input",defaultValue:b,onChange:function(){},style:{height:"250px"}})),c))),o().createElement("div",{id:"ShowLogModal",className:"modal fade u-displaynone singular-modal singular-modal-white ",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"50%",maxWidth:"800px"}},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close"},o().createElement("span",{"aria-hidden":"true"},o().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Change log of ",i.name)),o().createElement("div",{className:"modal-body",style:{height:"700px",minHeight:"700px",overflowY:"auto",color:"#808080"}},f)))))}});function Al(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}var Rl=a(9769),Pl=a(82445);const Tl=o().createClass({displayName:"AccountAdministration",getInitialState:function(){return this.accountSearch="",this.currentHhrRequest=null,{accounts:[],totalNumberOfAccounts:0,activeAccount:null,mutateAccountData:null,showBusyIcon:!1,progressMessage:"",sortList:"created",currentPageSize:250}},componentDidMount:function(){this.loadAccounts(this.accountSearch,this.props.filterBrand)},componentWillReceiveProps:function(e){e.filterBrand===this.props.filterBrand&&e.filterProperty===this.props.filterProperty||this.loadAccounts(this.accountSearch,e.filterBrand,e.filterProperty)},shouldComponentUpdate:function(e,t){return!Rl.compareObject(e,this.props)||!Rl.compareObject(t,this.state)},loadAccounts:function(e,t,a){var i=this;void 0===e&&(e=this.accountSearch),void 0===t&&(t=this.props.filterBrand),void 0===a&&(a=this.props.filterProperty),this.accountSearch=e||"",this.setState({showBusyIcon:!0,accounts:[]});var n="/apiv2/accounts?q="+encodeURIComponent(this.accountSearch);"all"!==t&&(n+="&brand="+t),"all"!==a&&(n+="&filter="+a),n+="&sort="+this.state.sortList,n+="&page=1&page_size="+this.state.currentPageSize,this.currentHhrRequest&&this.currentHhrRequest.abort(),this.currentHhrRequest=S().get(n).set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{if(i.currentHhrRequest=null,e)return i.props.onNotification("Error while reading accounts","error",5,"tc"),i.selectActiveAccountInList(),void i.setState({showBusyIcon:!1});var a=t.body,n=a.records.filter(function(e){return void 0!==e.id});i.setState({accounts:n,totalNumberOfAccounts:a.total},function(){i.selectActiveAccountInList(),i.setState({showBusyIcon:!1})})}})},selectAccount:function(e){this.setState({activeAccount:e}),this.props.onNotifyChange&&this.props.onNotifyChange("selectAccount")},selectActiveAccountInList:function(){var e=null;if(null!=this.state.activeAccount)for(var t=0,a=this.state.accounts.length;t<a;t++)if(this.state.accounts[t].id==this.state.activeAccount.id){e=this.state.accounts[t];break}null!=e?this.selectAccount(e):this.state.accounts.length>0?this.selectAccount(this.state.accounts[0]):this.selectAccount(null)},onActiveAccountPropertiesChanged:function(e){this.setState({mutateAccountData:Object.assign({},e)});var t=this.state.accounts.slice();for(var a in t)if(t[a].id==e.id){t[a]=e,this.setState({accounts:this.executeSortAccounts(t,this.state.sortList)});break}},onRequestReload:function(){this.loadAccounts()},onSearchChange:function(e){this.loadAccounts(e,this.props.filterBrand)},showEditNotesDialog:function(){this.refs.accountInfo.onShowEditNotesDialog&&this.refs.accountInfo.onShowEditNotesDialog()},showViewLogsDialog:function(){this.refs.accountInfo.onShowViewLogsDialog&&this.refs.accountInfo.onShowViewLogsDialog()},exportAccountData:function(){var e=this.state.accounts;for(var t in e)delete e[t].tenant_id,delete e[t].enableOnDeviceGraphics,delete e[t].is_activated,delete e[t].info,delete e[t].is_sso,delete e[t].use_datastore;var a,i=function(e,t){return null===t?"":t},n=Object.keys(e[0]),s=[n.join(",")].concat((a=e.map(function(e){return n.map(function(t){return JSON.stringify(e[t],i)}).join(",")}),function(e){if(Array.isArray(e))return Al(e)}(a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return Al(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Al(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).join("\r\n"),o=new Blob([s],{type:"text/plain;charset=utf-8"});Gt().saveAs(o,"Accounts.csv")},onSortList:function(e){var t=this;this.setState({sortList:e},function(){return t.loadAccounts()})},executeSortAccounts:function(e,t){var a=e.slice();return a.sort(function(e,a){switch(t){case"subscription":return e.subscription_plan==a.subscription_plan?e.name.localeCompare(a.name):e.subscription_plan.localeCompare(a.subscription_plan);case"name":default:return e.name.localeCompare(a.name);case"id":return e.id>a.id?1:e.id<a.id?-1:0;case"lastLogin":return e.lastloggedin_at==a.lastloggedin_at?e.name.localeCompare(a.name):e.lastloggedin_at?a.lastloggedin_at?e.lastloggedin_at>a.lastloggedin_at?-1:e.lastloggedin_at<a.lastloggedin_at?1:e.name.localeCompare(a.name):-1:1;case"created":return e.created_at==a.created_at?e.name.localeCompare(a.name):e.created_at?a.created_at?e.created_at>a.created_at?-1:e.created_at<a.created_at?1:e.name.localeCompare(a.name):-1:1;case"expirationDate":case"duration":return e.expires_on==a.expires_on?e.name.localeCompare(a.name):e.expires_on?a.expires_on?e.expires_on>a.expires_on?1:e.expires_on<a.expires_on?-1:e.name.localeCompare(a.name):-1:1;case"note":return e.info==a.info?e.name.localeCompare(a.name):e.info?a.info?e.name.localeCompare(a.name):-1:1}}),a},render:function(){var e,t,a=this,i=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"},className:"id"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"id")},o().createElement("span",null,"ID")),o().createElement("th",{style:{width:"5%",textAlign:"center"},className:"note"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"note")},o().createElement("span",null,"Note")),o().createElement("th",{style:{width:"27%",textAlign:"left "},className:"name"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"name")},o().createElement("span",null,"Name")),o().createElement("th",{style:{width:"8%",textAlign:"center"},className:"subscription"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"subscription")},o().createElement("span",null,"Subscription")),o().createElement("th",{style:{width:"14%",textAlign:"center"},className:"expirationDate"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"expirationDate")},o().createElement("span",null,"Expiration Date")),o().createElement("th",{style:{width:"14%",textAlign:"center"},className:"duration"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"duration")},o().createElement("span",null,"Duration")),o().createElement("th",{style:{width:"14%"},className:"created"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"created")},o().createElement("span",null,"Created")),o().createElement("th",{style:{width:"14%"},className:"lastLogin"==this.state.sortList?"col-status sortable sorted":"col-status sortable",onClick:this.onSortList.bind(this,"lastLogin")},o().createElement("span",null,"Last login"))));if(this.state.showBusyIcon)e=o().createElement("table",{className:"portal-table",style:{overflowY:"scroll",marginTop:"0px",marginBottom:"0px"}},i,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"})))));else{var n=this.state.accounts.map(function(e){if(!e||void 0===e.id)return null;var t,i,n,s=Pl.SubscriptionPlans.find(function(t){if(t.id==e.subscription_plan)return t}),l="Free";if(s&&(l=s.title),e.expires_on){t=ge()(e.expires_on).format("YYYY-MM-DD HH:mm:ss");var r=ge()(e.expires_on).diff(ge()());i=r<0?o().createElement("span",{style:{color:"red"}},"Expired ",Rl.millisecondsToString(-r,"short")+" ago"):o().createElement("span",null,Rl.millisecondsToString(r,"short")+" left")}e.lastloggedin_at&&(n=ge()(e.lastloggedin_at).format("YYYY-MM-DD HH:mm:ss"));var c,d="";return a.state.activeAccount&&a.state.activeAccount.id==e.id&&(d=" active"),e.info&&(c=o().createElement(Y(),{placement:"right",delayShow:500,overlay:o().createElement(z(),{id:"info"+e.id},e.info)},o().createElement("i",{className:"fa fa-sticky-note-o"}))),o().createElement("tr",{key:e.id,onMouseDown:a.selectAccount.bind(a,e),className:d},o().createElement("td",{style:{textAlign:"center"}},e.id),o().createElement("td",{style:{textAlign:"center"}},c),o().createElement("td",{style:{textAlign:"left",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"pre",maxWidth:"300px"}},e.name),o().createElement("td",{style:{textAlign:"center"}},l),o().createElement("td",{style:{textAlign:"center"}},t),o().createElement("td",{style:{textAlign:"center"}},i),o().createElement("td",{style:{textAlign:"center"}},ge()(e.created_at).format("YYYY-MM-DD HH:mm:ss")),o().createElement("td",{style:{textAlign:"center"}},n))});e=o().createElement("table",{className:"portal-table",style:{overflowY:"scroll",marginTop:"0px",marginBottom:"0px"}},i,o().createElement("tbody",null,n,0===a.state.accounts.length?o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("div",{style:{fontSize:"14px",padding:"10px"}},"No accounts to display"))):a.state.totalNumberOfAccounts<=a.state.currentPageSize?null:o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("button",{className:"btn btn-white",onClick:function(){a.setState({currentPageSize:a.state.currentPageSize+250},function(){a.loadAccounts()})}},"Load an additional ",250," accounts"))))),this.props.onNumberOfAccountsInList&&this.props.onNumberOfAccountsInList(this.state.totalNumberOfAccounts),t=o().createElement(Dl,{account:this.state.activeAccount,tenantAccounts:this.props.tenantAccounts,onActiveAccountPropertiesChanged:this.onActiveAccountPropertiesChanged,onRequestReload:this.onRequestReload,onNotification:this.props.onNotification,ref:"accountInfo"})}return o().createElement("div",{className:"profile-wrapper",style:{height:"100%",overflowY:"auto",width:"100%",position:"relative",top:"-11px"}},o().createElement("div",{className:"user-administration-wrapper",style:{marginRight:"-5px"}},o().createElement("div",{className:"user-list",style:{padding:"0px"}},e),o().createElement("div",{className:"profile-wrapper"},t)))}});var Ml=[{id:"all",title:"All"},{id:"notConfirmed",title:"Email not confirmed"},{id:"withWatermark",title:"With Watermark"},{id:"withoutWatermark",title:"Without Watermark"},{id:"storageFirebase",title:"Storage Firebase"},{id:"storageDataStore",title:"Storage Datastore"},{id:"ssoEnabled",title:"Single sign-on Enabled"},{id:"subscriptionFree",title:"Subscription - Free"},{id:"subscriptionProfessional",title:"Subscription - Professional"},{id:"subscriptionEnterprise",title:"Subscription - Enterprise"},{id:"subscriptionNonprofit",title:"Subscription - Nonprofit / Schools"},{id:"subscriptionEducation",title:"Subscription - Education"},{id:"subscriptionEvent",title:"Subscription - Event"},{id:"subscriptionTrial",title:"Subscription - Trial"},{id:"subscriptionUnoLite",title:"Subscription - Uno Lite"},{id:"subscriptionUnoPlus",title:"Subscription - Uno Plus"},{id:"withNotes",title:"With Notes"},{id:"login30days",title:"Last 30 days login"},{id:"login7days",title:"Last 7 days login"}],Ol=[{id:"all",title:"All"},{id:"singular",title:"Singular"},{id:"uno",title:"Uno"}];const Ll=o().createClass({displayName:"AccountSettings",getInitialState:function(){return this.AccountSearch="",{filterProperty:"all",filterBrand:"singular",numberOfAccountsInList:void 0}},shouldComponentUpdate:function(e,t){return!mn().compareObject(e,this.props)||!mn().compareObject(t,this.state)},onAccountSearchChange:function(e){this.AccountSearch=e},onAccountSearchClick:function(e){this.setState({}),this.refs.accountadmin.onSearchChange&&this.refs.accountadmin.onSearchChange(this.AccountSearch)},onAccountClearSearchClick:function(){this.AccountSearch="",this.refs.accountadmin.onSearchChange&&this.refs.accountadmin.onSearchChange(this.AccountSearch)},onFilterPropertyChanged:function(e){this.setState({filterProperty:e})},onFilterBrandChanged:function(e){this.setState({filterBrand:e})},showEditNotesDialog:function(){this.refs.accountadmin.showEditNotesDialog&&this.refs.accountadmin.showEditNotesDialog()},showViewLogDialog:function(){this.refs.accountadmin.showViewLogsDialog&&this.refs.accountadmin.showViewLogsDialog()},exportAccountData:function(){this.refs.accountadmin.showViewLogsDialog&&this.refs.accountadmin.exportAccountData()},onNotification:function(e,t,a,i){this.refs.appHeader.onNotification(e,t,a,i)},onNumberOfAccountsInList:function(e){e!=this.state.numberOfAccountsInList&&this.setState({numberOfAccountsInList:e})},render:function(){var e=this;return o().createElement("div",{style:{height:"100%"}},o().createElement(Cn,{useSearch:"true",onSearch:this.onAccountSearchChange,onSearchClick:this.onAccountSearchClick,onClearSearchClick:this.onAccountClearSearchClick,ref:"appHeader"}),o().createElement("div",{id:"singular-browser"},o().createElement("div",{className:"singular-browser-body"},o().createElement("div",{className:"singular-browser-content",style:{width:"100%",left:"0px",overflow:"hidden"}},o().createElement("div",{className:"singular-browser-body-tools",style:{height:"var(--nav-bar-height)",background:"var(--secondary-bg-color)",position:"relative",boxShadow:"inset rgba(0, 0, 0, 0.3) 0px 5px 10px 0px",textShadow:"none"}},o().createElement("ul",{className:"singular-browser-breadcrumb",style:{position:"relative",float:"left",top:"-8px"}},o().createElement("li",null,"Account Management")),o().createElement("div",{style:{float:"left",position:"relative",left:"20px",top:"16px"}},o().createElement("div",{className:"form-group"},o().createElement("label",{style:{color:"white"}},"Brand"),o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"200px",top:"-2px",height:"30px"}},Ol.find(function(t){return t.id==e.state.filterBrand}).title),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"none"}},Ol.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onFilterBrandChanged.bind(e,t.id)},t.title))}))))),o().createElement("div",{style:{float:"left",position:"relative",left:"50px",top:"16px"}},o().createElement("div",{className:"form-group"},o().createElement("label",{style:{color:"white"}},"Filter"),o().createElement("div",{className:"btn-group"},o().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"200px",top:"-2px",height:"30px"}},Ml.find(function(t){return t.id==e.state.filterProperty}).title),o().createElement("ul",{className:"dropdown-menu",style:{maxHeight:"400px"}},Ml.map(function(t,a){return o().createElement("li",{key:a},o().createElement("a",{onClick:e.onFilterPropertyChanged.bind(e,t.id)},t.title))}))))),void 0!==this.state.numberOfAccountsInList&&o().createElement("div",{style:{float:"left",position:"relative",left:"80px",top:"25px",color:"white"}},this.state.numberOfAccountsInList," accounts"),o().createElement("div",{className:"dashboard-toolbar",style:{float:"right"}},o().createElement("button",{className:"btn btn-white",tabIndex:"-1",style:{width:"120px",margin:"19px 7px 18px 0px",height:"30px"},onClick:this.exportAccountData},o().createElement("i",{className:"fa fa-download",style:{marginRight:"5px"}})," ","Export CVS"),o().createElement("button",{className:"btn btn-white",tabIndex:"-1",style:{width:"120px",margin:"19px 7px 18px 0px",height:"30px"},onClick:this.showViewLogDialog},o().createElement("i",{className:"fa fa-info",style:{marginRight:"5px"}})," ","View Log"),o().createElement("button",{className:"btn btn-white",tabIndex:"-1",style:{width:"120px",margin:"19px 7px 18px 0px",height:"30px"},onClick:this.showEditNotesDialog},o().createElement("i",{className:"fa fa-sticky-note-o",style:{marginRight:"5px"}})," ","Edit Notes"))),o().createElement("div",{style:{height:"100%"}},o().createElement(Tl,{id:"AccountAdministration",ref:"accountadmin",filterProperty:this.state.filterProperty,filterBrand:this.state.filterBrand,onNotification:this.onNotification,onNumberOfAccountsInList:this.onNumberOfAccountsInList}))))))}}),Vl=o().createClass({displayName:"VisitorHeader",getInitialState:function(){return{}},render:function(){return o().createElement("div",{className:"visitor-header"},o().createElement("div",{className:"top-bar"},o().createElement("div",{style:{width:"200px"}},o().createElement("a",{href:"/",tabIndex:"-1"},o().createElement("img",{src:"/images/logo-v2.png",style:{width:"80%"}})))),o().createElement("div",{className:"secondary-bar"}))}}),_l=o().createClass({displayName:"ForgotPassword",getInitialState:function(){return{status:"",failedStatus:"",validForm:!1,loading:!1}},recoverPassword:function(){this.setState({loading:!0});var e="";this.refs.inputEmail&&(e=this.refs.inputEmail.value),S().post("/users/forgotpassword").send({email:e}).end(function(e,t){if(e)this.setState({status:"",failedStatus:t.body.error.message,loading:!1});else{if(t.headers.location)return void(window.location=t.headers.location);this.setState({status:"Recover email has been sent. Please check your email",failedStatus:"",loading:!1})}}.bind(this))},checkFields:function(){var e=!1;if(this.refs.inputEmail){var t=this.refs.inputEmail.value;t&&Qs().email(t)&&(e=!0)}this.setState({validForm:e})},renderContent:function(){return this.state.status?o().createElement("div",null,o().createElement("div",{className:"large-icon"},o().createElement("i",{className:"fa fa-check"})),o().createElement("div",{className:"center-line"},o().createElement("span",{style:{maxWidth:"400px"}},"We have sent an email if the email exists in our system. Please check your inbox for instructions to recover your password")),o().createElement("div",{className:"login-area",style:{marginTop:"30px"}},o().createElement("button",{className:"btn btn-lg btn-primary btn-block",onClick:function(){return window.location.href="/users/login"}},"Login to your account"))):o().createElement("div",null,o().createElement("div",{className:"center-line",style:{textAlign:"center",marginBottom:"20px"}},"Instructions to recover your password will be sent to the email entered below"),o().createElement("div",{className:"field-list"},o().createElement("div",{className:"center-line"},o().createElement("div",{className:"form-field"},o().createElement("div",{className:"form-label"},"Email Address"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"email",className:"form-input",id:"email",name:"email",required:!0,autoFocus:!0,autoComplete:"off",onChange:this.checkFields,ref:"inputEmail"}))))),o().createElement("div",{className:"center-line"}),o().createElement("div",{className:"login-area",style:{marginBottom:"25px"}},this.state.loading&&o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"40px"}}),!this.state.loading&&o().createElement("button",{className:"btn btn-lg btn-primary btn-block",onClick:this.recoverPassword,disabled:!this.state.validForm},"Request new password")),o().createElement("div",{className:"center-line"},"Already have an account? ",o().createElement("a",{href:"/users/login"},"Login")),o().createElement("div",{className:"message-box"},this.state.failedStatus&&o().createElement("div",{className:"error-message"},this.state.failedStatus)))},render:function(){return o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner",style:{width:"40%"}},o().createElement("div",{className:"section-title"},"Forgot Password"),this.renderContent())))}}),Fl=o().createClass({displayName:"ResetPassword",getInitialState:function(){return{status:"",failedStatus:"",formValid:!1,passwordState:null,passwordValid:!1,revealPassword:!1}},handlePassword:function(e){var t,a=!1;e.target.value.length>0?(t="pass",a=!0):t="",this.setState({passwordState:t,passwordValid:a},function(){this.checkForm()}.bind(this))},checkForm:function(){var e=!1;this.state.passwordValid&&(e=!0),this.setState({formValid:e})},togglePasswordReveal:function(e){this.setState({revealPassword:!this.state.revealPassword})},render:function(){var e="password";return 1==this.state.revealPassword&&(e="text"),o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner",style:{width:"40%"}},o().createElement("div",{className:"section-title"},"Reset password"),o().createElement("form",{method:"POST",action:"/users/recoverpassword/"+window.singularEmailToken},o().createElement("input",{type:"hidden",id:"token",name:"token",value:window.singularEmailToken}),o().createElement("div",{className:"form-field "+this.state.passwordState},o().createElement("div",{className:"form-label"},"Password"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:e,className:"form-input",id:"password",name:"password",autoComplete:"off",required:!0,onChange:this.handlePassword,ref:"password"})),o().createElement("div",{className:"password-reveal",onClick:this.togglePasswordReveal},!this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye"}),this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye-slash"}),"Show")),o().createElement("div",{className:"login-area",style:{marginTop:"30px"}},o().createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",disabled:!this.state.formValid},"Continue"))),o().createElement("div",{className:"message-box"},window.recoverPwdMsg&&o().createElement("div",{className:"error-message"},window.recoverPwdMsg)))))}}),Bl=o().createClass({displayName:"InviteSetPassword",getInitialState:function(){return{validForm:!1,revealPassword:!1}},checkForm:function(){var e=!1;this.refs.password&&this.refs.password.value&&this.refs.password.value.length>0&&(e=!0),this.setState({validForm:e})},togglePasswordReveal:function(e){this.setState({revealPassword:!this.state.revealPassword})},render:function(){var e=this,t="password";return 1==this.state.revealPassword&&(t="text"),o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner",style:{width:"40%"}},o().createElement("div",{className:"section-title"},"Set Your Password"),o().createElement("form",{action:"/users/invitesetpassword",className:"",method:"post",ref:"form"},o().createElement("div",{className:"field-list"},o().createElement("div",{className:"form-field"},o().createElement("div",{className:"form-label"},"Password"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:t,className:"form-input",id:"password",name:"password",autoFocus:!0,autoComplete:"off",required:!0,onChange:this.checkForm,ref:"password"})),o().createElement("div",{className:"password-reveal",onClick:this.togglePasswordReveal},!this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye"}),this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye-slash"}),"Show"))),o().createElement("div",{className:"login-area",style:{marginTop:"25px",marginBottom:"10px"}},this.state.loading&&o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"40px"}}),!this.state.loading&&o().createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",disabled:!this.state.validForm,onClick:function(){e.setState({loading:!0}),e.refs.form.submit()}},"Log in")),o().createElement("input",{type:"hidden",id:"token",name:"token",value:window.singularEmailToken})))))}}),Ul=o().createClass({displayName:"Login",getInitialState:function(){return{emailDirtyClass:"",passwordDirtyClass:"",inValidForm:!1,revealPassword:!1,singleSignOn:!!window.singularLoginSSO,loading:!1}},componentDidMount:function(){sessionStorage.setItem("sendLoginAnalytics",!1)},checkFields:function(){var e="",t="",a=!0;this.refs.inputEmail&&this.refs.inputEmail.value.length>0&&(e=" dirty"),this.refs.inputPassword&&this.refs.inputPassword.value.length>0&&(t=" dirty"),0==this.state.singleSignOn?this.refs.inputEmail.value.length>0&&this.refs.inputPassword.value.length>0&&(a=!1):this.refs.inputEmail.value.length>0&&(a=!1),this.setState({emailDirtyClass:e,passwordDirtyClass:t,inValidForm:a})},onSingleSignOn:function(e){this.setState({singleSignOn:e})},togglePasswordReveal:function(e){this.setState({revealPassword:!this.state.revealPassword})},render:function(){var e=this;if(0==this.state.singleSignOn){var t="password";return 1==this.state.revealPassword&&(t="text"),o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner",style:{width:"40%"}},o().createElement("div",{className:"section-title"},"Login"),o().createElement("form",{action:window.location.pathname+window.location.search,className:"",method:"post",ref:"form"},o().createElement("div",{className:"field-list"},o().createElement("div",{className:"form-field"},o().createElement("div",{className:"form-label"},"Email Address"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"email",className:"form-input",id:"email",name:"email",required:!0,autoFocus:!0,autoComplete:"off",onChange:this.checkFields,ref:"inputEmail"}))),o().createElement("div",{className:"form-field"},o().createElement("div",{className:"form-label"},"Password"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:t,className:"form-input",id:"password",name:"password",autoComplete:"off",required:!0,onChange:this.checkFields,ref:"inputPassword"})),o().createElement("div",{className:"password-reveal",onClick:this.togglePasswordReveal},!this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye"}),this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye-slash"}),"Show"))),o().createElement("div",{className:"login-area",style:{marginTop:"25px",marginBottom:"10px"}},this.state.loading&&o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"40px"}}),!this.state.loading&&o().createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",disabled:this.state.inValidForm,onClick:function(){e.setState({loading:!0}),e.refs.form.submit()}},"Log in")),o().createElement("div",{className:"center-line",style:{marginBottom:"20px"}},o().createElement("div",{className:"checkbox",style:{position:"relative"}},o().createElement("div",{className:"bar"},o().createElement("input",{type:"checkbox",id:"remember",name:"remember"}),o().createElement("label",{htmlFor:"remember",className:"checkbox-label"}))),o().createElement("span",null,"Remember me")),o().createElement("div",{className:"center-line"},"Forgot Password?"," ",o().createElement("a",{href:"/users/forgotpassword"},"Click here")),o().createElement("div",{className:"center-line"},"Don't have an account? ",o().createElement("a",{href:"/users/signup"},"Sign up")),o().createElement("div",{className:"center-line"},o().createElement("a",{style:{cursor:"pointer"},onClick:this.onSingleSignOn.bind(this,!0)},"Login with Single sign-on"))),o().createElement("div",{className:"message-box"},window.singularLoginMessage&&o().createElement("div",{className:"error-message"},window.singularLoginMessage),window.singularLoginInfo&&o().createElement("span",{style:{color:"green"}},window.singularLoginInfo)),window.singularLoginClientId&&window.singularLoginRedirectUrl&&o().createElement("div",null,o().createElement("input",{type:"hidden",id:"client_id",name:"client_id",value:window.singularLoginClientId}),o().createElement("input",{type:"hidden",id:"redirect_uri",name:"redirect_uri",value:window.singularLoginRedirectUrl})))))}return o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner",style:{width:"40%"}},o().createElement("div",{className:"section-title"},"Single sign-on"),o().createElement("div",{style:{maxWidth:"300px",margin:"auto"}},o().createElement("form",{name:"singleSignForm",action:"/users/login/saml"+window.location.search,method:"post",ref:"form"},o().createElement("div",{className:"field-list"},o().createElement("div",{className:"form-field"},o().createElement("div",{className:"form-label"},"Email Address"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"email",className:"form-input",id:"email",name:"email",required:!0,autoFocus:!0,autoComplete:"off",onChange:this.checkFields,ref:"inputEmail"})))),o().createElement("div",{className:"center-line"}),o().createElement("div",{className:"login-area",style:{marginBottom:"25px"}},this.state.loading&&o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"40px"}}),!this.state.loading&&o().createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",disabled:this.state.inValidForm,onClick:function(){e.setState({loading:!0}),e.refs.form.submit()}},"Log in"))),o().createElement("div",{className:"center-line"},o().createElement("a",{style:{cursor:"pointer"},onClick:this.onSingleSignOn.bind(this,!1)},"Login using email and password")),o().createElement("div",{className:"message-box"},window.singularLoginSSOMessage&&o().createElement("div",{className:"error-message"},window.singularLoginSSOMessage),window.singularLoginInfo&&o().createElement("span",{style:{color:"green"}},window.singularLoginInfo))))))}}),Wl=o().createClass({displayName:"Signup",getInitialState:function(){return{emailState:"",emailMessage:null,emailValid:!1,firstNameState:"",firstNameValid:!1,lastNameState:"",lastNameValid:!1,passwordState:"",passwordValid:!1,revealPassword:!1,tos:!1,formValid:!1,creatingAccount:!1}},checkEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},handleBlurEmail:function(e){var t=this,a=e.target.value;0===a.length?this.setState({emailState:"",emailMessage:null,emailValid:!1},function(){return t.checkForm()}):this.checkEmail(a)?(this.setState({emailState:"busy"}),S().post("/apiv1/accounts/availableemail").send({email:a}).end(function(e,t){var a=this;e?this.setState({emailState:"error",emailMessage:"Error while verifying email address",emailValid:!1},function(){return a.checkForm()}):!0===t.body.result?this.setState({emailState:"error",emailMessage:"This email address is already in use",emailValid:!1},function(){return a.checkForm()}):this.setState({emailState:"ok",emailMessage:null,emailValid:!0},function(){return a.checkForm()})}.bind(this))):this.setState({emailState:"error",emailMessage:"This email address is invalid",emailValid:!1},function(){return t.checkForm()})},handleBlurFirstname:function(e){var t,a=!1;e.target.value.length>0?(t="ok",a=!0):t="",this.setState({firstNameState:t,firstNameValid:a},function(){this.checkForm()}.bind(this))},handleBlurLastname:function(e){var t,a=!1;e.target.value.length>0?(t="ok",a=!0):t="",this.setState({lastNameState:t,lastNameValid:a},function(){this.checkForm()}.bind(this))},handleBlurPassword:function(e){var t,a=!1;e.target.value.length>0?(t="ok",a=!0):t="",this.setState({passwordState:t,passwordValid:a},function(){this.checkForm()}.bind(this))},togglePasswordReveal:function(e){this.setState({revealPassword:!this.state.revealPassword})},handleConfirmTos:function(){this.setState({tos:!this.state.tos},function(){this.checkForm()}.bind(this))},checkForm:function(){var e=!1;this.state.firstNameValid&&this.state.lastNameValid&&this.state.emailValid&&this.state.passwordValid&&this.state.tos&&(e=!0),this.setState({formValid:e})},onCreateAccountClick:function(){this.setState({creatingAccount:!0}),this.refs.form.submit()},render:function(){var e=this,t="password";1==this.state.revealPassword&&(t="text");var a=function(e){return"busy"==e?o().createElement("i",{className:"field-input-status busy fa fa-circle-o-notch fa-spin"}):"error"==e?o().createElement("i",{className:"field-input-status error fa fa-times"}):"ok"==e?o().createElement("i",{className:"field-input-status ok fa fa-check"}):null},i=a(this.state.firstNameState),n=a(this.state.lastNameState),s=a(this.state.emailState),l=a(this.state.passwordState);return o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner"},o().createElement("div",{className:"section-title"},"Sign Up"),o().createElement("img",{className:"logo",src:"https://uploads-ssl.webflow.com/5e13cca706a3614f91004011/5fb6941223eddd42ee28ea20_Singular%20logo.png"}),o().createElement("div",{className:"info-message"},"Come join the live graphics revolution!"),o().createElement("div",{className:"join-account-message"},"Want to"," ",o().createElement("a",{href:"https://singularlive.zendesk.com/hc/en-us/articles/360020008571-How-do-I-invite-users-to-my-account-",target:"_blank"},"join an exisiting company account"),"?"),o().createElement("form",{id:"frmSignUP",className:"",method:"post",style:{maxWidth:"none"},ref:"form"},o().createElement("div",{className:"field-grid"},o().createElement("div",{className:"form-field "+this.state.firstNameState},o().createElement("div",{className:"form-label"},"First name"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"text",className:"form-input",id:"firstName",name:"firstName",required:!0,autoFocus:!0,onBlur:this.handleBlurFirstname}),i),o().createElement("div",{className:"form-error"},this.state.firstNameMessage)),o().createElement("div",{className:"form-field "+this.state.lastNameState},o().createElement("div",{className:"form-label"},"Last name"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"text",className:"form-input",id:"lastName",name:"lastName",required:!0,onChange:this.handleBlurLastname}),n),o().createElement("div",{className:"form-error"},this.state.lastNameMessage)),o().createElement("div",{className:"form-field "+this.state.emailState},o().createElement("div",{className:"form-label"},"Email Address"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:"email",className:"form-input",id:"email",name:"email",required:!0,autoComplete:"off",onBlur:this.handleBlurEmail}),s),o().createElement("div",{className:"form-error"},this.state.emailMessage)),o().createElement("div",{className:"form-field "+this.state.passwordState},o().createElement("div",{className:"form-label"},"Password"),o().createElement("div",{className:"form-input-container"},o().createElement("input",{type:t,className:"form-input",id:"password",name:"password",autoComplete:"off",required:!0,onBlur:this.handleBlurPassword,ref:"password"}),l),o().createElement("div",{className:"form-error"}),o().createElement("div",{className:"password-reveal",onClick:this.togglePasswordReveal},!this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye"}),this.state.revealPassword&&o().createElement("i",{className:"fa fa-eye-slash"}),"Show"))),o().createElement("div",{className:"terms-of-service"},o().createElement("div",{className:"checkbox",style:{position:"relative"}},o().createElement("div",{className:"bar"},o().createElement("input",{type:"checkbox",id:"termsAccepted",name:"termsAccepted",required:!0,onChange:this.handleConfirmTos}),o().createElement("label",{htmlFor:"termsAccepted",className:"checkbox-label"}))),o().createElement("span",{style:{marginLeft:"10px"}},"I agree to the Singular.Live"," ",o().createElement("a",{href:"http://www.singular.live/terms-of-service",target:"_blank"},"Terms of Service")," ")),window.singularLoginClientId&&window.singularLoginRedirectUrl&&o().createElement("div",null,o().createElement("input",{type:"hidden",id:"client_id",name:"client_id",value:window.singularLoginClientId}),o().createElement("input",{type:"hidden",id:"response_type",name:"response_type",value:window.singularLoginResponseType}),o().createElement("input",{type:"hidden",id:"redirect_uri",name:"redirect_uri",value:window.singularLoginRedirectUrl})),o().createElement("div",{className:"signup-area"},this.state.creatingAccount&&o().createElement("img",{src:"/images/loading-bubbles-blue.svg",style:{height:"40px",width:"175px"}}),!this.state.creatingAccount&&o().createElement("button",{className:"btn btn-lg btn-primary btn-block",onClick:function(){return e.onCreateAccountClick()},disabled:!this.state.formValid,style:{width:"175px"}},"Create Account"),o().createElement("div",{style:{marginLeft:"15px"}},"Already have an account? ",o().createElement("a",{href:"/users/login"},"Login here")))),o().createElement("div",{className:"message-box"},window.singularLoginMessage&&o().createElement("div",{className:"error-message"},window.singularLoginMessage),window.singularLoginInfo&&o().createElement("span",{style:{color:"green"}},window.singularLoginInfo)))))}}),jl=o().createClass({displayName:"SignupSuccess",componentDidMount:function(){window.singularEmail||(window.location.href="/users/login")},render:function(){return o().createElement("div",{className:"singular-layout login-section"},o().createElement(Vl,null),o().createElement("div",{className:"section-body"},o().createElement("div",{className:"login-inner"},o().createElement("div",{className:"section-title"},"Email Verification"),o().createElement("div",{style:{fontSize:"16px",textAlign:"center"}},o().createElement("div",{style:{marginBottom:"15px"}},"A confirmation email has been sent to"),o().createElement("div",{style:{color:"#38a6e1"}},window.singularEmail),o().createElement("div",{style:{marginTop:"15px"}},"Please check your inbox and follow the link in the email to activate your Singular.live account")))))}});a(5556);var Yl=a(10611),Hl=a(9769),zl=a(83384);const Gl=o().createClass({displayName:"FontInfo",getInitialState:function(){return this.accountSearch="",this.uploadFontFaceSrc={},this.scCopyToPreviousInputValue="",this.scCopyToCurrentInputValue="",this.originalActiveFont=null,this.originalFontFaceList=[],this.nextAccount=null,this.nextActiveFont=null,this.turnOffForm=!1,this.processMode="",this.processId=null,{fontList:[],showBusyIcon:!0,showBusyIcon1:!1,showBusyIcon2:!1,activeFont:null,fontFaceList:[],hasUpdateFont:!1,accountNameValues:[]}},componentDidMount:function(){var e=this;$(document).mouseup(function(t){var a=n().findDOMNode(e.refs.dropdownMenu),i=$(a);Hl.getMouseEventType(t)!=zl.MOUSE_RIGHT_CLICK&&(i.is(t.target)||0!==i.has(t.target).length||i.removeClass("show"))})},componentWillReceiveProps:function(e){e.account&&((this.props.account?this.props.account.id:-1)==e.account.id&&1!=this.turnOffForm||(this.nextAccount=null,this.turnOffForm=!1,this.loadFontList(e.account.id,!0,!0,!0)))},ensureToMoveOut:function(e){e.preventDefault();var t="You're navigating out of this page. Are you sure to discard change?";return(e||window.event).returnValue=t,t},componentWillUpdate:function(e,t){t.hasUpdateFont?window.addEventListener("beforeunload",this.ensureToMoveOut):window.removeEventListener("beforeunload",this.ensureToMoveOut)},checkHasUpdateFont:function(e,t){var a=!1;for(var i in t){var n=t[i];if(0==a&&(1==n.isNew||1==n.isEdit||1==n.isDelete)){a=!0;break}}return 0==a&&this.originalActiveFont.family!=e.family&&(a=!0),a},getHasUpdateFlag:function(){return this.state.hasUpdateFont},turnOffFontInfoForm:function(){this.turnOffForm=!0,this.setState({showBusyIcon:!0,showBusyIcon1:!0,showBusyIcon2:!0,hasUpdateFont:!1})},loadFontList:function(e,t,a,i){var n=this,s=this.state.fontList,o=this.state.activeFont,l=this.state.fontFaceList,r=this.state.hasUpdateFont,c=null;0==a&&(c={},Object.assign(c,o)),this.originalActiveFont=c,this.setState({fontList:t?[]:s,activeFont:a?null:o,showBusyIcon:t,showBusyIcon2:!1,fontFaceList:i?[]:l,hasUpdateFont:!i&&r});var d="/apiv1/fonts/list?account_id="+e;E().series([function(e){S().get(d).set("Content-Type","application/json").end(function(t,a){var i=[];t?e(t,i):(i=a.body,e(null,i))})},function(e){0==a&&1==i?(n.loadFontFaceList(o.id),e(null,"done")):e(null,"done")}],function(e,t){e&&console.log(e),n.setState({showBusyIcon:!1,showBusyIcon1:!1,fontList:t[0]})})},selectFont:function(e,t){var a=!0,i=this.state.activeFont;if(i&&(a=i.id!=e.id),a)if(1==this.state.hasUpdateFont&&0==t)this.nextActiveFont=e,this.showWarningFontNotSaveModal(null);else{this.nextActiveFont=null,this.uploadFontFaceSrc={};var n={};Object.assign(n,e),this.originalActiveFont=n,this.setState({activeFont:e,hasUpdateFont:!1}),this.loadFontFaceList(e.id)}},setFontItemInBusy:function(e){var t=this.state.fontList;for(var a in t)t[a].id==e&&(t[a].is_busy=!0);this.setState({fontList:t})},setFontFaceItemInBusy:function(e){var t=this.state.fontFaceList;for(var a in t)t[a].id==e&&(t[a].is_busy=!0);this.setState({fontFaceList:t})},doPurgeCSSFont:function(e,t){S().delete("/apiv1/fonts/purge/"+e).send({family:t}).end(function(e,t){e&&console.warn("Purge Font CSS Error:",e)})},onActiveFontInputChanged:function(e,t){var a=this.state.activeFont,i=this.state.fontFaceList;if("family"===e&&(a.family=t,i.length>0))for(var n in i){var s=i[n];if(s.family=t,s.isInDB){var o=this.originalFontFaceList.filter(function(e,t){return e.id.toLowerCase()==s.id.toLowerCase()});if(o.length>0){var l=!1;(o[0].family||"")!=(s.family||"")&&(l=!0),s.isEdit=l}}}this.setState({activeFont:a,fontFaceList:i,hasUpdateFont:this.checkHasUpdateFont(a,i)})},onAddNewFont:function(){var e=this,t=this.state.fontList;t.unshift({id:Yl.v4(),is_busy:!0}),this.setState({fontList:t}),this.props.onNotification("Adding new font","info",5,"tc"),S().post("/apiv1/fonts").send({family:"New Font",account_id:this.props.account.id}).set("Content-Type","application/json").end(function(t,a){t?(console.error(t),e.props.onNotification("Can not add new font","error",5,"tc")):e.props.onNotification("New font was added","success",5,"tc");var i=a.body;e.doPurgeCSSFont(i.id,i.family),e.loadFontList(e.props.account.id,!1,!1,!1)})},onUpdateFont:function(){var e=this,t=this.state.activeFont,a=this.state.fontFaceList,i=(t.family||"").trim();this.setFontItemInBusy(t.id),t.family=i,this.setState({activeFont:t,fontFaceList:[],showBusyIcon2:!0}),this.props.onNotification("Saving font","info",5,"tc"),E().series([function(e){S().put("/apiv1/fonts/"+t.id).send({family:i.trim()}).set("Content-Type","application/json").end(function(t,a){t?e(t):e(null,a)})},function(t){var i=new FormData;for(var n in e.uploadFontFaceSrc){var s=e.uploadFontFaceSrc[n];s instanceof File&&i.append("file-"+n,s)}i.append("savedata",JSON.stringify(a)),S().put("/apiv1/fonts/faces/save").send(i).end(function(e,a){e?t(e):t(null,a)})}],function(a,n){a?(console.error(a),e.props.onNotification("ERROR cannot update font","error",5,"tc")):e.props.onNotification("Font has been saved","success",5,"tc"),e.doPurgeCSSFont(t.id,i.trim()),e.uploadFontFaceSrc={},e.loadFontList(e.props.account.id,!1,!1,!0)})},doDeleteFont:function(e){var t=this;this.setFontItemInBusy(e);var a=!1,i="";this.state.activeFont&&(i=this.state.activeFont.family,(a=e==this.state.activeFont.id)&&this.setState({showBusyIcon2:!0})),this.props.onNotification("Deleting font","info",5,"tc"),S().delete("/apiv1/fonts/"+e).set("Content-Type","application/json").end(function(n,s){n?(console.error(n),t.props.onNotification("Can not delete font","error",5,"tc")):t.props.onNotification("Font has been deleted","success",5,"tc"),t.doPurgeCSSFont(e,i),t.loadFontList(t.props.account.id,!1,a,a)})},loadFontFaceList:function(e){var t=this;this.setState({showBusyIcon2:!0,fontFaceList:[],hasUpdateFont:!1}),this.originalFontFaceList=[];var a="/apiv1/fonts/faces/"+e;E().waterfall([function(e){S().get(a).set("Content-Type","application/json").end(function(t,a){var i=[];t?e(t,i):(i=a.body,e(null,i))})}],function(e,a){var i=[];e?(console.error(e),t.props.onNotification("Error while loading font face list","error",5,"tc")):(i=a).forEach(function(e,a){e.url_type="upload";var i={};Object.assign(i,e),t.originalFontFaceList.push(i),e.isInDB=!0,e.isNew=!1,e.isEdit=!1,e.isDelete=!1}),t.setState({showBusyIcon2:!1,fontFaceList:i})})},createNewFontFaceObject:function(e,t){var a=ge()().utc().format("YYYY-MM-DDTHH:mm:ss.000")+"Z";return{family:t,font_id:e,format:"WOFF",id:Yl.v4(),src:"",stretch:null,style:null,created_at:a,updated_at:a,weight:"400",isInDB:!1,isDelete:!1,isEdit:!1,isNew:!0,url_type:"upload"}},onFontFaceInputChanged:function(e,t,a){var i=this.state.fontFaceList;if(i.length>0)for(var n in i){var s=i[n];if(s.id==e){switch(t){case"style":s.style=a;break;case"stretch":s.stretch=a;break;case"weight":s.weight=a;break;case"format":s.format=a;break;case"urltype-upload":case"urltype-custom":s.url_type=a;break;case"src-custom":s.src=a;break;case"src-file":if(a&&a[0]){var o=a[0];s.src=o.name,s.file=o,this.uploadFontFaceSrc[e]=o}else this.uploadFontFaceSrc[e]=null}if(s.isInDB){var l=this.originalFontFaceList.filter(function(t,a){return t.id.toLowerCase()==e.toLowerCase()});if(l.length>0){var r=l[0],c=!1,d=r.style||"",p=r.stretch||"",m=r.weight||"",u=r.format||"",h=r.url_type||"",f=r.src||"",g=s.style||"",v=s.stretch||"",b=s.weight||"",y=s.format||"",E=s.url_type||"",w=s.src||"";d==g&&p==v&&m==b&&u==y&&h==E&&f==w||(c=!0),s.isEdit=c}}break}}this.setState({fontFaceList:i,hasUpdateFont:this.checkHasUpdateFont(this.state.activeFont,i)})},onAddNewFontFace:function(){var e=this.state.activeFont,t=this.state.fontFaceList||[];e.family=e.family.trim(),t.forEach(function(e,t){var a=e.family.trim();e.family=a});var a=this.createNewFontFaceObject(e.id,e.family);t.unshift(a),this.setState({activeFont:e,fontFaceList:t,hasUpdateFont:this.checkHasUpdateFont(e,t)})},doDeleteFontFace:function(e){var t=[],a=this.state.fontFaceList;for(var i in a){var n=a[i];n.isInDB?(n.id==e&&(n.isDelete=!0),t.push(n)):n.id==e?this.uploadFontFaceSrc[e]&&delete this.uploadFontFaceSrc[e]:t.push(n)}this.processId=null,this.processMode="",this.setState({fontFaceList:t,hasUpdateFont:this.checkHasUpdateFont(this.state.activeFont,t)})},contextMenu:function(e){n().findDOMNode(this.refs.dropdownTrigger);var t=$(n().findDOMNode(this.refs.dropdownMenu));$(".dropdown-menu").removeClass("show");var a=0,i=0;this.browserRect&&(a=-this.browserRect.left-15,i=-15);var s=t.width(),o=t.height();e.pageX+s>window.innerWidth?t.css("left",e.pageX-s-5+a+"px"):t.css("left",e.pageX+5+a+"px"),e.pageY+o>window.innerHeight?t.css("top",e.pageY-o+i+"px"):t.css("top",e.pageY+i+"px"),this.refs.contextMenuWrapper.classList.contains("open")||t.toggleClass("show"),e.stopPropagation(),e.preventDefault()},closeContextMenu:function(){var e=n().findDOMNode(this.refs.dropdownMenu);$(e).removeClass("show")},deleteFont:function(){var e=this.state.activeFont;e?this.showConfirmDeleteModal(e.id,"delete-font"):console.error("No active font in state")},handleAccountNameChange:function(e){var t=[];this.scCopyToPreviousInputValue="",this.scCopyToCurrentInputValue="";for(var a=0;a<e.length;a++)if("Select-create-option-placeholder"==e[a].className){t.push({className:"checking",label:e[a].label,value:e[a].value}),this.setState({checkingAccountName:!0,progressingText:"Checking... account name"});var i=e[a].label;i=i.trim(),S().post(Hl.appendAccessTokenUrl("/apiv1/accounts/checkname")).send({name:i}).set("Content-Type","application/x-www-form-urlencoded").end(function(e,t){var a="invalid";this.setState({checkingAccountName:!1,progressingText:""});var n=i;e&&400!=t.body.code?console.error(t.body.error.message):t.body.id>=0&&(a="valid",n=t.body.id);for(var s=[],o=0;o<this.state.accountNameValues.length;o++)this.state.accountNameValues[o].label==i?s.push({className:a,label:i,value:n}):s.push(this.state.accountNameValues[o]);this.setState({accountNameValues:s})}.bind(this))}else t.push(e[a]);this.setState({accountNameValues:t})},handleInputAccountNameChange:function(e){return this.scCopyToPreviousInputValue=this.scCopyToCurrentInputValue,this.scCopyToCurrentInputValue=e,e},handleAccountNameBlur:function(e){var t=e.target.value;if(""==t&&""!=this.scCopyToPreviousInputValue&&""==this.scCopyToCurrentInputValue&&(t=this.scCopyToPreviousInputValue),t){var a=this.state.accountNameValues.slice();a.push({className:"Select-create-option-placeholder",label:t,value:t}),this.handleAccountNameChange(a)}},showCopyFont:function(){$("#makeCopyToModal").modal("show")},closeCopyFont:function(){$("#makeCopyToModal").modal("hide")},submitCopyFont:function(){if(this.state.accountNameValues&&this.state.accountNameValues.length){this.setState({progressingText:"Copying Font in processing...",copyingInProgress:!0});for(var e=this.state.activeFont.id,t=this.state.activeFont.family,a=[],i=0;i<this.state.accountNameValues.length;i++)a.push({id:this.state.accountNameValues[i].value,name:this.state.accountNameValues[i].label,class_name:this.state.accountNameValues[i].className});this.props.onNotification("Copying font","info",5,"tc"),S().post(Hl.appendAccessTokenUrl("/apiv1/fonts/copy")).send({font_id:e,font_family:t.trim(),accounts:a}).end(function(e,t){e&&400!=t.body.code?(console.error(t.body.error.message),this.props.onNotification("Copying font failed","error",5,"tc"),this.setState({progressingText:t.body.error.message,copyingInProgress:!1})):(this.props.onNotification("Copying font completed","success",5,"tc"),this.setState({progressingText:"",accountNameValues:[],copyingInProgress:!1}),$("#makeCopyToModal").modal("hide"))}.bind(this))}else console.error("submitCopyFont: no target accounts")},showWarningFontNotSaveModal:function(e){e&&(this.nextAccount=e),$("#warningFontNotSaveModal").modal("show")},closeWarningFontNotSaveModal:function(){$("#warningFontNotSaveModal").modal("hide")},confirmNoChange:function(){if($("#warningFontNotSaveModal").modal("hide"),this.nextAccount)this.props.onConfirmNoChangeFontData(this.nextAccount);else{var e=this.state.fontList,t=this.originalActiveFont;if(t)for(var a=0;a<e.length;a++)e[a]&&e[a].id==t.id&&(e[a].family=t.family);this.setState({fontList:e});var i=this.nextActiveFont;this.selectFont(i,!0)}},showConfirmDeleteModal:function(e,t){this.processId=e,this.processMode=t,$("#confirmDeleteModal").modal("show")},closeConfirmDeleteModal:function(){$("#confirmDeleteModal").modal("hide")},confirmDeleteFontFace:function(){$("#confirmDeleteModal").modal("hide"),this.processId&&("delete-font"==this.processMode?this.doDeleteFont(this.processId):"delete-fontface"==this.processMode&&this.doDeleteFontFace(this.processId))},render:function(){var e,t=this;if(this.props.account){var a,i=["","normal","italic","oblique","light","regular"],n=["","normal","condensed","ultra-condensed","extra-condensed","semi-condensed","expanded","semi-expanded","extra-expanded","ultra-expanded"],s=[{value:"",display:""},{value:"100",display:"100 Thin (Hairline)"},{value:"200",display:"200 Extra Light (Ultra Light)"},{value:"300",display:"300 Light"},{value:"400",display:"400 Normal (Regular)"},{value:"500",display:"500 Medium"},{value:"600",display:"600 Semi Bold (Demi Bold)"},{value:"700",display:"700 Bold"},{value:"800",display:"800 Extra Bold (Ultra Bold)"},{value:"900",display:"900 Black (Heavy)"},{value:"950",display:"950 Extra Black (Ultra Black)"}],l=["TTF","OTF","WOFF","WOFF2"],r=function(e,t){return o().createElement("option",{key:t,value:e},e)},c=function(e,t){var a=e.value||"",i=e.display||a;return o().createElement("option",{key:t,value:a},i)};if(this.state.showBusyIcon)a=o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))));else{var d,p=function(e){var t="row div-item";return e.is_busy?o().createElement("div",{key:e.id,className:t},o().createElement("div",{className:"col-lg-12 text-center"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{height:"30px"}}))):(this.state.activeFont&&this.state.activeFont.id==e.id&&(t+=" active"),o().createElement("div",{key:e.id,className:t},o().createElement("div",{className:"col-12",onMouseDown:this.selectFont.bind(this,e,!1),onContextMenu:this.contextMenu},o().createElement("label",{className:"label-item"},e.family," (",o().createElement("a",{href:e.url,target:"_blank"},"view css"),")"))))}.bind(this),m=function(e){var t=this;if(!e.isDelete){if(e.is_busy)return o().createElement("div",{key:e.id,className:"row div-item",style:{paddingBottom:"15px"}},o().createElement("div",{className:"col-md-12 col-lg-12 text-center",style:{height:"240px"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader",style:{marginTop:"100px"}})));var a,d="rbUrlType_"+e.id,p="rdb1_"+e.id,m="rdb2_"+e.id,u="upload"==(e.url_type||"upload");return a=u?o().createElement("div",{style:{marginTop:"2px",marginBottom:"2px"}},o().createElement("label",{className:"label-item"},e.src),o().createElement("input",{type:"file",onChange:function(a){t.onFontFaceInputChanged(e.id,"src-file",a.target.files),a.target.value=null}})):o().createElement("div",{style:{marginTop:"2px",marginBottom:"2px"}},o().createElement("input",{type:"text",className:"form-control",value:e.src,onChange:function(a){return t.onFontFaceInputChanged(e.id,"src-custom",a.target.value)}})),o().createElement("div",{key:e.id,className:"row div-item",style:{paddingBottom:"15px"}},o().createElement("div",{className:"col-2 d-flex align-items-center"},o().createElement("label",{className:"label-item"},"Style")),o().createElement("div",{className:"col-10"},o().createElement("select",{className:"form-control pull-left",style:{width:"60%",marginTop:"2px",marginBottom:"2px"},value:e.style||"",onChange:function(a){return t.onFontFaceInputChanged(e.id,"style",a.target.value)}},i.map(r)),o().createElement("button",{className:"btn btn-white pull-right",onClick:function(){t.showConfirmDeleteModal(e.id,"delete-fontface")}},o().createElement("i",{className:"fa fa-close",style:{left:"0px",top:"0px"}}))),o().createElement("div",{className:"col-2 d-flex align-items-center"},o().createElement("label",{className:"label-item"},"Weight")),o().createElement("div",{className:"col-10"},o().createElement("select",{className:"form-control pull-left",style:{width:"60%",marginTop:"2px",marginBottom:"2px"},value:e.weight||"",onChange:function(a){return t.onFontFaceInputChanged(e.id,"weight",a.target.value)}},s.map(c))),o().createElement("div",{className:"col-2 d-flex align-items-center"},o().createElement("label",{className:"label-item"},"Stretch")),o().createElement("div",{className:"col-10"},o().createElement("select",{className:"form-control",style:{width:"60%",marginTop:"2px",marginBottom:"2px"},value:e.stretch||"",onChange:function(a){return t.onFontFaceInputChanged(e.id,"stretch",a.target.value)}},n.map(r))),o().createElement("div",{className:"col-2 d-flex align-items-center"},o().createElement("label",{className:"label-item"},"Format")),o().createElement("div",{className:"col-10"},o().createElement("select",{className:"form-control",style:{width:"60%",marginTop:"2px",marginBottom:"2px"},value:e.format||"",onChange:function(a){return t.onFontFaceInputChanged(e.id,"format",a.target.value)}},l.map(r))),o().createElement("div",{className:"col-2 d-flex align-items-center"},o().createElement("label",{className:"label-item"},"Url")),o().createElement("div",{className:"col-10"},o().createElement("input",{id:p,name:d,type:"radio",checked:u,onChange:function(a){return t.onFontFaceInputChanged(e.id,"urltype-upload","upload")}})," ",o().createElement("label",{htmlFor:p,style:{color:"#676a6c",cursor:"pointer"}},"Upload"),o().createElement("input",{id:m,name:d,type:"radio",checked:!u,onChange:function(a){return t.onFontFaceInputChanged(e.id,"urltype-custom","custom")}})," ",o().createElement("label",{htmlFor:m,style:{color:"#676a6c",cursor:"pointer"}},"Custom")),o().createElement("div",{className:"col-2 d-flex align-items-center"}),o().createElement("div",{className:"col-10"},a))}}.bind(this);d=this.state.showBusyIcon1?o().createElement("div",{className:"row div-item"},o().createElement("div",{className:"col-md-12 col-lg-12 text-center"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))):this.state.fontList.map(p);var u,h=this.state.activeFont?this.state.activeFont.family:"";u=this.state.showBusyIcon2?o().createElement("div",{className:"row div-item"},o().createElement("div",{className:"col-md-12 col-lg-12 text-center"},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))):this.state.fontFaceList.map(m);var f,g,v=this.state.activeFont&&0==this.state.showBusyIcon2,b=this.state.activeFont&&0==this.state.showBusyIcon2,y=this.state.activeFont&&this.state.hasUpdateFont&&0==this.state.showBusyIcon2,E="btn btn-white";b&&(E="btn btn-primary",f=function(){t.onAddNewFontFace()});var w="btn btn-white";y&&(w="btn btn-primary",g=function(){t.onUpdateFont()}),a=o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{className:"div-list",style:{width:"30%",verticalAlign:"top"}},o().createElement("div",{style:{borderBottom:"solid 1px #e7eaec",margin:"0px"}},o().createElement("div",{className:"row",style:{paddingLeft:"5px",paddingTop:"0px",paddingRight:"5px",paddingBottom:"5px"}},o().createElement("div",{className:"col-6 d-flex align-items-end"},o().createElement("span",{style:{fontSize:"16px",fontWeight:"bold"}},"Font Name")),o().createElement("div",{className:"col-6 d-flex align-items-end flex-column"},o().createElement("button",{className:"btn btn-primary",onClick:function(){t.onAddNewFont()}},o().createElement("i",{className:"fa fa-plus-circle"})," Font")))),o().createElement("div",{style:{overflowY:"auto",height:"calc(100% - 35px)"}},d)),o().createElement("td",{className:"div-list",style:{width:"70%",verticalAlign:"top",borderLeft:"solid 1px #e7eaec"}},o().createElement("div",{style:{borderBottom:"solid 1px #e7eaec",margin:"0px"}},o().createElement("div",{className:"row",style:{paddingLeft:"5px",paddingTop:"0px",paddingRight:"5px",paddingBottom:"5px"}},o().createElement("div",{className:"col-6 d-flex align-items-end"},o().createElement("input",{type:"text",className:"form-control",disabled:!v,value:h,onChange:function(e){return t.onActiveFontInputChanged("family",e.target.value)}})),o().createElement("div",{className:"col-6 d-flex align-items-end flex-column"},o().createElement("div",null,o().createElement("button",{className:E,style:{marginRight:"10px",marginLeft:"0px",marginTop:"0px",marginBottom:"0px"},onClick:f,disabled:!b},o().createElement("i",{className:"fa fa-plus-circle",style:{float:"none",top:"0px",left:"0px",position:"relative"}})," Font Face"),o().createElement("button",{className:w,style:{marginRight:"0px",marginLeft:"0px",marginTop:"0px",marginBottom:"0px"},onClick:g,disabled:!y},o().createElement("i",{className:"fa fa-save",style:{float:"none",top:"0px",left:"0px",position:"relative"}})," Save"))))),o().createElement("div",{style:{overflowY:"auto",height:"calc(100% - 35px)"}},u))))}e=o().createElement("div",{className:"property-group",style:{width:"100%",height:"calc(100% - 10px)",marginBottom:"0px"}},o().createElement("div",{className:"group-title"},"Font Management (",this.props.account.id," : ",this.props.account.name,")"),o().createElement("div",{className:"group-body",style:{height:"calc(100% - 50px)"}},o().createElement("table",{style:{width:"100%",height:"100%"}},a)),o().createElement("div",{className:"dropdown-grey",ref:"contextMenuWrapper"},o().createElement("i",{ref:"dropdownTrigger",className:"fa fa-ellipsis-v","data-toggle":"dropdown",style:{display:"none"}}),o().createElement("ul",{ref:"dropdownMenu",className:"dropdown-menu",role:"menu",style:{position:"fixed",minWidth:"100px"},onClick:this.closeContextMenu},o().createElement("li",{onClick:this.showCopyFont},o().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Make a copy")),o().createElement("li",{className:"divider"}),o().createElement("li",{onClick:this.deleteFont},o().createElement("a",{tabIndex:"-1",className:"u-cursor-pointer"},"Delete")))),o().createElement("div",{id:"makeCopyToModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"vertical-alignment-helper"},o().createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeCopyFont},o().createElement("span",{"aria-hidden":"true"},"")),o().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Copy Font to Accounts")),o().createElement("div",{className:"modal-body"},o().createElement("table",{className:"table",style:{maxWidth:"1200px",backgroundColor:"#FFF"}},o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left"}},o().createElement("div",{className:"singular-text-label",style:{color:"#808080"}},"Font name")),o().createElement("td",{style:{position:"relative"}},o().createElement("label",{style:{fontSize:"11px"}},h))),o().createElement("tr",null,o().createElement("td",{style:{verticalAlign:"middle",textAlign:"left",width:"100px"}},o().createElement("div",{className:"singular-text-label",style:{color:"#808080"}},"Copy to")),o().createElement("td",{className:this.state.checkingAccountName?"validating":"",style:{position:"relative"}},o().createElement(as().Creatable,{className:"singularSelect creatable",multi:!0,backspaceToRemoveMessage:"",onChange:this.handleAccountNameChange,onBlur:this.handleAccountNameBlur,onInputChange:this.handleInputAccountNameChange,value:this.state.accountNameValues,placeholder:"Enter the account name",promptTextCreator:this.newItemLabel,arrowRenderer:function(){},menuRenderer:function(){},disabled:this.state.copyingInProgress}),o().createElement("img",{src:"/images/loading-oval.svg",className:"loader-oval",style:{top:"11px"}}))))),o().createElement("div",{style:{verticalAlign:"middle",textAlign:"center",height:"30pxG"}},this.state.progressingText)),o().createElement("div",{className:"modal-footer"},o().createElement("button",{tabIndex:"-1",onClick:this.submitCopyFont,className:"btn btn-primary",disabled:this.state.checkingAccountName||this.state.copyingInProgress},"Copy"),o().createElement("button",{tabIndex:"-1",onClick:this.closeCopyFont,className:"btn btn-secondary"},"Cancel")))))),o().createElement("div",{id:"warningFontNotSaveModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"vertical-alignment-helper"},o().createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeWarningFontNotSaveModal},o().createElement("span",{"aria-hidden":"true"},"")),o().createElement("h4",{className:"modal-title"},"Warning")),o().createElement("div",{className:"modal-body"},o().createElement("label",{style:{lineHeight:"1.5"}},"The changes you made were not saved."),o().createElement("br",null),o().createElement("label",{style:{lineHeight:"1.5"}},"Do you want to discard the changes?")),o().createElement("div",{className:"modal-footer"},o().createElement("button",{tabIndex:"-1",onClick:this.confirmNoChange,className:"btn btn-primary"},"OK"),o().createElement("button",{tabIndex:"-1",onClick:this.closeWarningFontNotSaveModal,className:"btn btn-secondary"},"Cancel")))))),o().createElement("div",{id:"confirmDeleteModal",className:"modal fade u-displaynone singular-modal-white",tabIndex:"-1",role:"dialog"},o().createElement("div",{className:"vertical-alignment-helper"},o().createElement("div",{className:"modal-dialog vertical-align-center",role:"document"},o().createElement("div",{className:"modal-content"},o().createElement("div",{className:"modal-header"},o().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.closeConfirmDeleteModal},o().createElement("span",{"aria-hidden":"true"},"")),o().createElement("h4",{className:"modal-title"},"Warning")),o().createElement("div",{className:"modal-body"},o().createElement("label",{style:{lineHeight:"1.5"}},"Are your sure you want to delete?")),o().createElement("div",{className:"modal-footer"},o().createElement("button",{tabIndex:"-1",onClick:this.confirmDeleteFontFace,className:"btn btn-primary"},"OK"),o().createElement("button",{tabIndex:"-1",onClick:this.closeConfirmDeleteModal,className:"btn btn-secondary"},"Cancel")))))))}else e=o().createElement("div",null);return e}}),Kl=o().createClass({displayName:"FontAccountList",getInitialState:function(){return this.accountSearch="",this.nextAccountSearch=null,{accounts:[],activeAccount:null,showBusyIcon:!1}},componentDidMount:function(){this.nextAccountSearch=null},onSearchChange:function(e,t){var a=t||!1;this.refs.refFontInfo?0==this.refs.refFontInfo.getHasUpdateFlag()||1==a?(this.loadAllAccounts(e),this.nextAccountSearch=null):(this.refs.refFontInfo.showWarningFontNotSaveModal(this.state.activeAccount),this.nextAccountSearch=e):this.loadAllAccounts(e)},selectActiveAccountInList:function(){var e=null;if(null!=this.state.activeAccount)for(var t=0,a=this.state.accounts.length;t<a;t++)if(this.state.accounts[t].id==this.state.activeAccount.id){e=this.state.accounts[t];break}null!=e?this.selectAccount(e,!1):this.state.accounts.length>0?this.selectAccount(this.state.accounts[0],!1):this.selectAccount(null,!1)},loadAllAccounts:function(e){var t=this;this.accountSearch=e||"",this.setState({showBusyIcon:!0,accounts:[]}),E().series([function(e){var a=encodeURIComponent(t.accountSearch);S().get("/apiv1/accounts?brand=singular&q="+a).set("Content-Type","application/json").end(function(t,a){var i=[];t?e(t,i):((i=a.body).sort(function(e,t){return e.name.localeCompare(t.name)}),e(null,i))})}],function(e,a){e&&console.log(e),t.setState({showBusyIcon:!1,accounts:a[0]}),t.selectActiveAccountInList()})},selectAccount:function(e,t){var a=this,i=function(e){a.setState({activeAccount:e})},n=this.state.activeAccount?this.state.activeAccount.id:-1;this.refs.refFontInfo&&n!=e.id?0==this.refs.refFontInfo.getHasUpdateFlag()||1==t?i(e):this.refs.refFontInfo.showWarningFontNotSaveModal(e):i(e)},onConfirmNoChangeFontData:function(e){null!=this.nextAccountSearch?(this.refs.refFontInfo.turnOffFontInfoForm(),this.onSearchChange(this.nextAccountSearch,!0)):this.selectAccount(e,!0)},render:function(){var e,t=this,a=o().createElement("thead",null,o().createElement("tr",null,o().createElement("th",{style:{width:"5%",textAlign:"center"}},o().createElement("span",{className:"table-header"},"Active")),o().createElement("th",{style:{width:"5%",textAlign:"center"}},o().createElement("span",{className:"table-header"},"ID")),o().createElement("th",{style:{width:"60%"}},o().createElement("span",{className:"table-header"},"Name")),o().createElement("th",{style:{width:"30%"}},o().createElement("span",{className:"table-header"},"Created"))));return e=this.state.showBusyIcon?o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},a,o().createElement("tbody",null,o().createElement("tr",null,o().createElement("td",{colSpan:"100%",style:{textAlign:"center"}},o().createElement("img",{src:"/images/loading-bubbles-blue.svg",className:"loader"}))))):o().createElement("table",{className:"widget-version-list",style:{overflowY:"scroll"}},a,o().createElement("tbody",null,this.state.accounts.map(function(e,a){var i="";return t.state.activeAccount&&t.state.activeAccount.id==e.id&&(i=" active"),o().createElement("tr",{key:e.id,onMouseDown:t.selectAccount.bind(t,e,!1),className:i},o().createElement("td",{style:{textAlign:"center"}},o().createElement("i",{className:"fa fa-circle account-status active"})),o().createElement("td",{style:{textAlign:"center"}},e.id),o().createElement("td",null,e.name),o().createElement("td",null,ge()(e.created_at).format("MMMM DD, YYYY HH:mm:ss")))}))),o().createElement("div",{className:"profile-wrapper",style:{height:"calc(100% - 50px)",width:"100%"}},o().createElement("div",{className:"user-administration-wrapper",style:{height:"100%",overflowY:"hidden"}},o().createElement("div",{className:"user-list",style:{width:"49%"}},e),o().createElement("div",{className:"profile-wrapper",style:{width:"50%",height:"100%"}},o().createElement(Gl,{ref:"refFontInfo",account:this.state.activeAccount,fbRef:this.props.fbRef,onNotification:this.props.onNotification,onConfirmNoChangeFontData:function(e){t.onConfirmNoChangeFontData(e)}}))))}}),$l=o().createClass({displayName:"FontManager",getInitialState:function(){return this.search="",{page:"fontmanager",searchValue:""}},componentDidMount:function(){},showPage:function(e){this.setState({page:e,searchValue:""})},onInfoChanged:function(){"Armed"!=this.state.saveIconState&&this.setState({saveIconState:"Armed"})},onNotification:function(e,t,a,i){this.refs.applicationHeaderRef.onNotification(e,t,a,i)},onSearchChange:function(e){this.search=e,this.selectedRef.onSearchChange(this.search)},render:function(){var e,t=this;return this.state.mode,this.state.page,e="fontmanager"===this.state.page?o().createElement(Kl,{fbRef:this.fbRef,search:this.state.searchValue,onRowSelected:this.onRowSelected,onSaveProcessComplete:this.onSaveProcessComplete,onInfoChanged:this.onInfoChanged,ref:function(e){t.selectedRef=e},onNotification:this.onNotification}):o().createElement("div",null),o().createElement("div",{style:{height:"100%",overflow:"hidden"}},o().createElement(Cn,{ref:"applicationHeaderRef"}),o().createElement("div",{id:"singular-browser",className:"portal"},o().createElement("section",{className:"nav-bar"},o().createElement("div",{className:"left-area"},"Font Manager"),o().createElement("div",{className:"right-area"})),o().createElement("section",{className:"secondary nav-bar"},o().createElement("div",{className:"left-area"}),o().createElement("div",{className:"right-area"},o().createElement(Bn,{onSearch:this.onSearchChange}),o().createElement(os,{configuration:[]}),void 0)),o().createElement("div",{className:"singular-browser-body"},o().createElement("nav",{className:"singular-browser-nav",style:{height:"100%"}},o().createElement("div",{className:"navigator-wrapper"},o().createElement("ul",{className:"dashboard-tree"},o().createElement("ul",{id:"folder-tree-item-root"},o().createElement("li",{className:"fontmanager"==this.state.page?"active":"",onClick:this.showPage.bind(this,"fontmanager")},o().createElement("i",{className:"fa fa-font",style:{width:"20px",textAlign:"center",top:"8px"}}),o().createElement("span",{style:{display:"inline-block",top:"8px"}},o().createElement("div",{className:"asset-label"},"Font Manager"))))))),o().createElement("div",{className:"singular-browser-content"},o().createElement("div",{style:{height:"calc(100% - 75px)"}},e)))))}});var ql=a(46642);const Jl=o().createClass({displayName:"AnalyicsDemo",getInitialState:function(){return this.cubejsApi=(0,ql.Ay)(window.singularUser.analyticsToken,{apiUrl:"https://singular-analytics.herokuapp.com/cubejs-api/v1"}),{}},componentDidMount:function(){var e=this;this.cubejsApi.load({measures:[],timeDimensions:[{dimension:"SESSIONS.createdAt",granularity:"minute",dateRange:["2021-04-12T23:00:00.000","2021-04-12T24:00:00.000"]}],order:{"SESSIONS.count":"desc"},dimensions:["SESSIONS.createdAt","SESSIONS.count"],filters:[{member:"SESSIONS.elementId",operator:"equals",values:["414038"]},{member:"SESSIONS.domain",operator:"equals",values:["PROD"]}],ungrouped:"true"}).then(function(t){console.log(t.chartPivot()),e.setState({resultSet:t})}).catch(function(e){console.error(e.message)})},render:function(){var e=this.state.resultSet;if(!e)return!1;var t=function(e){return M()(e).format("0,0")},a=function(e){return ge()(e).format("MMM DD")},i=["#7DB3FF","#49457B","#FF7C78","#FF0000"];return o().createElement(ao.uf,{width:"100%",height:800},o().createElement(ao.Es,{data:e.chartPivot()},o().createElement(ao.WX,{tickFormatter:a,dataKey:"x"}),o().createElement(ao.h8,{tickFormatter:t}),e.seriesNames().map(function(e,t){return o().createElement(ao.yP,{stackId:"a",dataKey:e.key,name:e.key.split(",")[0],fill:i[t]})}),o().createElement(ao.s$,null),o().createElement(ao.m_,{labelFormatter:a,formatter:t})))}});var Xl=a(48287).Buffer;function Zl(e){return Zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zl(e)}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}function er(e,t,a){return(t=function(e){var t=function(e){if("object"!=Zl(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=Zl(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Zl(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var tr=a(10611),ar=a(9769),ir=a(84433),nr=a(56574);a(97909).polyfill();var sr=function(e){if(!e)return[];var t=[];if(e.groups)for(var a in e.groups){var i=e.groups[a].items;if(i)for(var n in i){var s=e.tiles[n];if(s){"composition"==s.type&&t.push(s.id);var o=h.A.getWidgetById(s.widget,s.version);o&&o.model&&o.model.fields&&Array.isArray(o.model.fields)&&o.model.fields.forEach(function(a){"composition"==a.type&&e.data&&""!=e.data[n][a.id]&&t.push(e.data[n][a.id])})}}}return t},or=!1,lr=!1,rr=function(e){lr=!0;var t=document.createElement("div");t.id="__logout__",document.body.appendChild(t),n().render(o().createElement(C.A,{delay:e||0}),t)},cr=document.createElement("div");cr.id="amOnline",document.body.appendChild(cr);var dr=function(){n().render(o().createElement(I.A,null),cr),lr=!0},pr=document.getElementById("widgetEditor");pr&&(n().render(o().createElement(cs,null),pr),rr());var mr=document.getElementById("appTemplateEditor");mr&&(n().render(o().createElement(Vs,null),mr),rr());var ur=document.getElementById("marketplaceManager");ur&&(n().render(o().createElement(Ss,null),ur),rr());var hr=document.getElementById("releasenotesEditor");hr&&(n().render(o().createElement(Ys,null),hr),rr());var fr=document.getElementById("viewReleasenotes");fr&&(n().render(o().createElement(Ks,null),fr),rr());var gr=document.getElementById("userSettings");gr&&(n().render(o().createElement(wl,null),gr),rr());var vr=document.getElementById("accountSettings");vr&&(n().render(o().createElement(Ll,null),vr),rr());var br=document.getElementById("forgotPasswordMain");br&&(n().render(o().createElement(_l,null),br),lr=!0);var yr=document.getElementById("resetPasswordMain");yr&&(n().render(o().createElement(Fl,null),yr),lr=!0);var Er=document.getElementById("inviteSetPassword");Er&&(n().render(o().createElement(Bl,null),Er),lr=!0);var wr=document.getElementById("loginMain");wr&&(n().render(o().createElement(Ul,null),wr),lr=!0);var Sr=document.getElementById("signupMain");Sr&&(n().render(o().createElement(Wl,null),Sr),lr=!0);var Nr=document.getElementById("signupSuccess");Nr&&(n().render(o().createElement(jl,null),Nr),lr=!0);var Cr=document.getElementById("fontEditor");Cr&&(n().render(o().createElement($l,null),Cr),rr());var xr=document.getElementById("deleteAccount");xr&&(n().render(o().createElement(to,null),xr),rr());var Ir=document.getElementById("accountStorage");Ir&&(n().render(o().createElement(wo,null),Ir),rr());var kr=document.getElementById("analytics");kr&&(n().render(o().createElement(Jl,null),kr),rr());var Dr=document.querySelector("[data-singular-nofirebase]");window.singularAppInstance&&window.singularAppInstance.datastore&&window.singularUser&&window.singularUser.isAccessToken||Dr||u.A.connect(function(e,t){if(e&&console.log(e),!t)return or=!0,void(!1===lr&&dr());var a,i=[],s={timerId:null},r=function(e,t,a,i){var n={activeKey:er({},e,window.singularUser.name)};if(window.location.href.indexOf("/script")>=0&&window.location.href.indexOf("/compositions/")>=0){var s=window.singularUser;n.userInfo=er({},s.id,s.name)}a.update(n),d(e,a),t.child(i).child(e).onDisconnect().remove(),a.child("activeKey").child(e).onDisconnect().remove()},d=function(e,t){if(!window.singularScene)return null;var a="script"==window.location.href.match(/\/([^\/]+)[\/]?$/)[1]?window.singularUser.id:window.singularUser.firstName,i=function(n,s,o){if(n===e){var l=s.timerId;t.child("activeKey").update(er({},e,a)),t.update({ts:m.A.database.ServerValue.TIMESTAMP}),l||(s.timerId=setInterval(function(e){return i(n,s)},6e4)),o&&o(n,s)}},n=function(e,t){return i(e,t)};!function(e,t,i){t.child("activeKey").once("value",function(n){var s=n.val();if(s){var o=Object.keys(s)[0];t.child("activeKey").set(er({},e,a),function(a){return t.child("activeKey").child(e).onDisconnect().remove()}),i&&i(o)}else i&&i(null)})}(e,t,function(e){return i(e,s,n)})},u=function(e){return!e||!e.ts||new Date-new Date(e.ts)>6e4};window.singularScene&&S().get("/dashboard/file/"+window.singularScene.fid+"/folders",function(e,t){e||(i=t.body,window.singularScene.foldersToUpdateRecent=i)});var f=p()(function(e,t,a,n){i.forEach(function(e){"favorties"!=e?t.child("notification_folders").child(e).child("ts").set(m.A.database.ServerValue.TIMESTAMP):t.child("users").child(window.singularUser.id).child("notification_folders").child(e).child("ts").set(m.A.database.ServerValue.TIMESTAMP)});var s=e?er({},e,window.singularUser.firstName):null;a.update({activeKey:s,lastModifiedBy:window.singularUser.firstName,updated_at:m.A.database.ServerValue.TIMESTAMP})},5e3);window.compEditorMessage=function(e){console.log(e)},document.getElementById("onairLive")||(document.body.style.overflow="hidden"),n().render(o().createElement(x.A,null),cr);var v=document.getElementById("compositionEditor"),y=function(e){e.id;var t=e.off,a=s.timerId;t&&a&&clearInterval(a)};if(v){window.compEditorMessage=function(e){window.compEditorRef.onMessage(e)};var w,C={},I=new(c())(null,t.key);if(l.A.init(t,I,"preview",!0),window.singularScene.datastore){var k=new(c())(null);new(b())(k,window.singularScene.datastore,window.singularScene.pv).then(function(e){var t=e.update;w=t})}var D=null,A=function(e,t,a,i){window.compEditorRef&&window.compEditorRef.onSaveToFirebase&&window.compEditorRef.onSaveToFirebase(e,t,a,i)},R=function(){var e=JSON.stringify(D);e=e.replace(/\s/g,"");var t=Xl.byteLength(e,"utf8");A("saving","",t),T(),window.singularScene.fid&&"0"!=window.singularScene.fid&&M>2&&(D.ts=Date.now(),f(a,H,P,t))},P=(H=t.root.child("accounts").child(window.singularScene.account_id).child("assets")).child("files").child(window.singularScene.fid),T=p()(function(){window.compEditorRef&&window.compEditorRef.saveCompositionDuration();var e={},t=(e=ar.extend(!0,D)).reloadPageAfterWritten,a=e.saveScript;if(delete e.reloadPageAfterWritten,delete e.saveScript,delete e.restore,e&&!$.isEmptyObject(e))try{A("saving");var i=Date.now();nr.uploadCompositionJSON(JSON.stringify(e),window.singularScene.id,null,function(n,s){if(n)A("error",n),console.log(n);else{nr.updateCompositionMetadata({id:window.singularScene.id,size:s.fileSize,s3_comp:1},function(e,t){e&&console.error(e)});var o=function(){A("done",void 0,void 0,Date.now()-i),t&&location.reload()};a?nr.uploadCompositionJSON(JSON.stringify({overlayScript:e.script,subCompScripts:e.compositionProps.scripts}),window.singularScene.id,"script",function(e,t){nr.updateCompositionMetadata({id:window.singularScene.id,s3_script:1},function(e,t){e&&console.error(e)}),o()}):o()}});var n={};e.ts&&(n.ts=e.ts),e.mainComposition&&(e.compositions[e.mainComposition]&&e.compositions[e.mainComposition].settings&&e.compositions[e.mainComposition].settings.defaultAppID?n["compositions.".concat(e.mainComposition,".settings.defaultAppID")]=e.compositions[e.mainComposition].settings.defaultAppID:n["compositions.".concat(e.mainComposition,".settings.defaultAppID")]=null),Object.keys(n).length>0&&w&&w(n)}catch(e){N.A.add(N.A.TYPE.ERROR,{title:"Cannot save data to database",description:e.message}),A("error",e.message)}},1e3),M=0;I.on("value",function(e,t,a){if(M++,"editor-only"!=a&&(D=e.val())&&D.uiSettings){var i=!0===D.uiSettings.autoSaveEnabled||void 0===D.uiSettings.autoSaveEnabled,n=D.reloadPageAfterWritten;i||n?R():A("changed")}});P.once("value",function(e){var i=e.val(),s=u(i);if(i&&i.activeKey&&!i.dontAsk&&!s){var c=i.activeKey[Object.keys(i.activeKey)[0]];n().render(o().createElement(Ei,{disableOutsideClick:!0,rtdbFileRef:P,activeUser:c}),v)}else{P.child("dontAsk").remove();var d={};d[a=tr.v4()]=!0;var p="editingIds";t.child(p).set(d,function(e){e?(alert("Cannot connect to realtime database."),window.location.href="/dashboard"):(function(e){window.singularMessage=function(e){if("processAction"==e.type){if(e.compId)switch(e.state){case"in":window.compEditorRef.compositionNavControl(e.compId,"In");break;case"out":window.compEditorRef.compositionNavControl(e.compId,"Out");break;case"toggle":"In"==I.child("compositionStates").child(e.compId).val()?window.compEditorRef.compositionNavControl(e.compId,"Out"):window.compEditorRef.compositionNavControl(e.compId,"In")}}else l.A.controlLib.OnairScript&&l.A.controlLib.OnairScript.handle_onSingularMessage(e),e&&e.params&&"background"==e.params.type||console.log("Message to JavaScript: ",e)},E().waterfall([function(e){ir.readFromS3OrFirebase(t,e)},function(e,t){h.A.loadWidgetsFromCompositions(e.compositions,!0,function(a){a&&alert("Error while initializing widgets: "+a),t(null,e)})},function(a,i){try{!function(){try{var e=0,i=0,n=a.compositions;for(var s in n){var o=n[s];if(o.data&&o.tiles)for(var l in o.data)-1==Object.keys(o.tiles).indexOf(l)&&(e++,i+=Xl.byteLength(JSON.stringify(a.compositions[s].data[l]),"utf8"),t.child("compositions").child(s).child("data").child(l).remove(),delete a.compositions[s].data[l])}0!=i&&console.log("Found",e,"orphan elements, size",parseFloat(i/1024).toFixed(2),"Kb")}catch(e){console.error(e.message)}}(),function(){try{var e=0,i=0,n=a.compositions;for(var s in n){var o=n[s];if(o.groups&&o.tiles){var l={};for(var r in o.groups)if(o.groups[r].items)for(var c in o.groups[r].items)l[c]=c;for(var d in l)-1==Object.keys(o.tiles).indexOf(d)&&(e++,i+=Xl.byteLength(JSON.stringify(a.compositions[s].data[d]),"utf8"),i+=Xl.byteLength(JSON.stringify(a.compositions[s].tiles[d]),"utf8"),t.child("compositions").child(s).child("data").child(d).remove(),t.child("compositions").child(s).child("tiles").child(d).remove(),delete a.compositions[s].data[d],delete a.compositions[s].tiles[d])}}0!=i&&console.log("Found",e,"orphan tiles, size",parseFloat(i/1024).toFixed(2),"Kb")}catch(e){console.error(e.message)}}(),function(){try{var e=a.compositions,i=function(e,t){var a=[t],i=a.slice();do{var n=[];a.forEach(function(t){n=n.concat(sr(e[t]))}),i=i.concat(n),a=n.slice(),n=[]}while(a.length>0);return i}(e,t.key);for(var n in e)-1==i.indexOf(n)&&(t.child("compositions").child(n).remove(),t.child("compositionStates").child(n).remove(),t.child("compositionProps").child("durations").child(n).remove(),t.child("compositionProps").child("logicLayers").child(n).remove(),t.child("compositionProps").child("scripts").child(n).remove(),t.child("compositionProps").child("timeline2Active").child(n).remove(),delete a.compositions[n],delete a.compositionStates[n],delete a.compositionProps.durations[n],delete a.compositionProps.logicLayers[n],delete a.compositionProps.scripts[n],delete a.compositionProps.timeline2Active[n]);for(var s in a.compositionProps.scripts)a.compositions[s]||"global"==s||(t.child("compositionProps").child("scripts").child(s).remove(),delete a.compositionProps.scripts[s])}catch(e){console.error(e.message)}}(),function(){var e=a.compositions;for(var t in e){var i=e[t];if(i.groups)for(var n in i.groups)if(null!=i.groups[n].effects){var s=i.groups[n].items;if(s)for(var o in s){var l=i.tiles[o];l&&"composition"==l.type&&null==e[o]&&delete i.groups[n].items[o]}}else delete i.groups[n];if(i.tiles)for(var n in i.tiles)null!=i.tiles[n].effects||delete i.tiles[n]}}()}catch(e){}!function(){try{var e=a.tempCompositions;for(var i in e)t.child("compositions").child(i).remove(),t.child("compositionStates").child(i).remove(),delete a.compositions[i],delete a.compositionStates[i];t.child("tempCompositions").remove()}catch(e){console.error(e.message)}}();var s=a,r=JSON.stringify(s);r=r.replace(/\s/g,"");var c=Xl.byteLength(r,"utf8");for(var d in I.update(s,!1,!1),Object.keys(I.child("compositionProps/scripts").val()))C[d]=!0;n().render(o().createElement(yi,{editingId:e,rtdbRef:t,sbRef:I,rootTimelines:l.A.rootTimelines,onOff:y,onManualSave:R,initialCompositionSize:c,ref:function(e){window.compEditorRef=e}}),v),i()}],function(e){e&&(alert(e),window.location.href="/dashboard")})}(a),r(a,t,P,p),rr())})}})}var O=document.getElementById("onairLive");if(O&&"compositionPreview"==window.onairMode){var L=new(c())(null,t.key);l.A.init(t,L,"preview"),ir.readFromS3OrFirebase(t,function(e,a){L.set(a,!1,!1),window.singularMessage=function(){},n().render(o().createElement(wi.A,{rtdbRef:t,rootRtdbRef:t,sbRef:L,windowAdaptationGlobals:window.singularAdaptationGlobals,displayVariant:window.singularDisplayVariant,onCompositionReady:function(e){return l.A.set({onAirRef:e,composition:L.val(),mainComposition:L.key})},mainComposition:t.key,interactiveMode:"composition",rootTimelines:l.A.rootTimelines}),O)});try{var V,_=new URLSearchParams(window.location.search),F={},B=function(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return Ql(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ql(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw s}}}}(_.entries());try{for(B.s();!(V=B.n()).done;){var U=V.value;F[U[0]]=U[1]}}catch(e){B.e(e)}finally{B.f()}g().parseQuery(F)}catch(e){}}var W=document.getElementById("compositionScript");if(W){var j,Y=new(c())(null,t.key);l.A.init(t,Y,"preview",!0),a=tr.v4();var H,z=(H=t.root.child("accounts").child(window.singularScene.account_id).child("assets")).child("files").child(window.singularScene.fid).child("scriptEditor"),G=function(){f(a,H,P)},K=function(e){j=Y.val();var i,s={},l={};for(var c in j.compositions)j.compositions[c].dataSources&&j.compositions[c].dataSources.composition&&j.compositions[c].dataSources.composition.controlNode&&(s[c]=j.compositions[c].dataSources.composition.controlNode.payload),l[c]=j.compositionStates[c];for(var d in i=j.adaptationGlobals)"string"==typeof i[d]&&""==i[d]&&delete i[d];ir.readFromS3OrFirebase(t,function(c,d){if(c)return alert(c),void(window.location.href="/dashboard");for(var p in d.compositionProps.scripts)null==d.compositions[p]&&"global"!=p&&delete d.compositionProps.scripts[p];h.A.loadWidgetsFromCompositions(d.compositions,!1,function(c){for(var p in Y.set(d,!1,!1),d.compositions)d.compositions[p].settings&&d.compositions[p].settings.linkTimeline&&delete l[p];for(var p in window.singularMessage=function(e){if("processAction"==e.type)switch(console.log("Event Control Subcomp "+e.compId+". Command state "+e.state),e.state){case"in":window.scriptEditorReference.compositionNavControl(e.compId,"In");break;case"out":window.scriptEditorReference.compositionNavControl(e.compId,"Out");break;case"toggle":"In"==Y.child("compositionStates").child(e.compId).val()?window.scriptEditorReference.compositionNavControl(e.compId,"Out"):window.scriptEditorReference.compositionNavControl(e.compId,"In")}else e&&e.params&&"background"==e.params.type||console.log("Message to JavaScript: ",e)},d.compositions)if(d.compositions[p].dataSources&&d.compositions[p].dataSources.composition&&d.compositions[p].dataSources.composition.controlNode)for(var h in s[p])void 0!==d.compositions[p].dataSources.composition.controlNode&&void 0!==d.compositions[p].dataSources.composition.controlNode.payload&&void 0!==d.compositions[p].dataSources.composition.controlNode.payload[h]||delete s[p][h];var f=function(e){n().render(o().createElement(vn,{editingId:e,onOff:y,forceReload:Math.random(),lastPayloads:s,lastStates:l,lastAdaptationGlobals:i,onReload:K,rtdbRef:t,rootRtdbRef:t,sbRef:Y,mainComposition:t.key,interactiveMode:"composition",onSave:G,ref:function(e){window.scriptEditorReference=e}}),W);var a=window.singularUser.id,r=window.singularUser.firstName,c=e?er({},e,a):null;z.update({activeKey:c,userInfo:er({},a,r),lastModifiedBy:r,updated_at:m.A.database.ServerValue.TIMESTAMP})};z.once("value",function(i){if(e)f(a);else{var s=i.val(),l=u(s);if(s&&s.activeKey&&!s.dontAsk&&!l){var c=s.activeKey,d=c[Object.keys(c)[0]],p=s.userInfo[d];n().render(o().createElement(Ei,{disableOutsideClick:!0,rtdbFileRef:z,activeUser:p,isScriptEditor:!0}),W)}else{z.child("dontAsk").remove(),a=tr.v4();var m="seEditingIds";t.child(m).set(er({},a,!0),function(e){e?(alert("Cannot connect to realtime database."),window.location.href="/dashboard"):(r(a,t,z,m),f(a))})}}})})})};K(),rr()}var q=document.getElementById("dashboardManager");q&&(n().render(o().createElement(Dn,{rtdbFolderRef:window.singularRtdbCoreRef.child("accounts").child(window.singularUser.account.accountId).child("assets")}),q),rr(3e3));var J=document.getElementById("externalBrowser");J&&(n().render(o().createElement(Pn,{rtdbFolderRef:window.singularRtdbCoreRef.child("accounts").child(window.singularUser.account.accountId).child("assets")}),J),lr=!0);var X=document.getElementById("outputManager");X&&(n().render(o().createElement(Wn,{rtdbRef:t}),X),rr());var Z=document.getElementById("datastreamManager");Z&&(n().render(o().createElement(Qn,{rtdbRef:t}),Z),rr())}),or&&!1===lr&&(dr(),lr=!0)},94151:function(e,t,a){function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}e.exports=function(e,t){var a=function(a,n,s){if(this.parentEl="body",this.element=t(a),this.startDate=e().startOf("day"),this.endDate=e().endOf("day"),this.minDate=!1,this.maxDate=!1,this.dateLimit=!1,this.autoApply=!1,this.singleDatePicker=!1,this.showDropdowns=!1,this.showWeekNumbers=!1,this.showISOWeekNumbers=!1,this.showCustomRangeLabel=!0,this.timePicker=!1,this.timePicker24Hour=!1,this.timePickerIncrement=1,this.timePickerSeconds=!1,this.linkedCalendars=!0,this.autoUpdateInput=!0,this.alwaysShowCalendars=!1,this.ranges={},this.opens="right",this.element.hasClass("pull-right")&&(this.opens="left"),this.drops="down",this.element.hasClass("dropup")&&(this.drops="up"),this.buttonClasses="btn btn-sm",this.applyClass="btn-success",this.cancelClass="btn-default",this.locale={direction:"ltr",format:e.localeData().longDateFormat("L"),separator:" - ",applyLabel:"Apply",cancelLabel:"Cancel",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:e.weekdaysMin(),monthNames:e.monthsShort(),firstDay:e.localeData().firstDayOfWeek()},this.callback=function(){},this.isShowing=!1,this.leftCalendar={},this.rightCalendar={},"object"===i(n)&&null!==n||(n={}),"string"==typeof(n=t.extend(this.element.data(),n)).template||n.template instanceof t||(n.template='<div class="daterangepicker dropdown-menu"><div class="calendar left"><div class="daterangepicker_input"><input class="input-mini form-control" type="text" name="daterangepicker_start" value="" /><i class="fa fa-calendar"></i><div class="calendar-time"><div></div><i class="fa fa-clock-o"></i></div></div><div class="calendar-table"></div></div><div class="calendar right"><div class="daterangepicker_input"><input class="input-mini form-control" type="text" name="daterangepicker_end" value="" /><i class="fa fa-calendar"></i><div class="calendar-time"><div></div><i class="fa fa-clock-o"></i></div></div><div class="calendar-table"></div></div><div class="ranges"><div class="range_inputs"><button class="applyBtn" disabled="disabled" type="button"></button> <button class="cancelBtn" type="button"></button></div></div></div>'),this.parentEl=n.parentEl&&t(n.parentEl).length?t(n.parentEl):t(this.parentEl),this.container=t(n.template).appendTo(this.parentEl),"object"===i(n.locale)&&("string"==typeof n.locale.direction&&(this.locale.direction=n.locale.direction),"string"==typeof n.locale.format&&(this.locale.format=n.locale.format),"string"==typeof n.locale.separator&&(this.locale.separator=n.locale.separator),"object"===i(n.locale.daysOfWeek)&&(this.locale.daysOfWeek=n.locale.daysOfWeek.slice()),"object"===i(n.locale.monthNames)&&(this.locale.monthNames=n.locale.monthNames.slice()),"number"==typeof n.locale.firstDay&&(this.locale.firstDay=n.locale.firstDay),"string"==typeof n.locale.applyLabel&&(this.locale.applyLabel=n.locale.applyLabel),"string"==typeof n.locale.cancelLabel&&(this.locale.cancelLabel=n.locale.cancelLabel),"string"==typeof n.locale.weekLabel&&(this.locale.weekLabel=n.locale.weekLabel),"string"==typeof n.locale.customRangeLabel)){(u=document.createElement("textarea")).innerHTML=n.locale.customRangeLabel;var o=u.value;this.locale.customRangeLabel=o}if(this.container.addClass(this.locale.direction),"string"==typeof n.startDate&&(this.startDate=e(n.startDate,this.locale.format)),"string"==typeof n.endDate&&(this.endDate=e(n.endDate,this.locale.format)),"string"==typeof n.minDate&&(this.minDate=e(n.minDate,this.locale.format)),"string"==typeof n.maxDate&&(this.maxDate=e(n.maxDate,this.locale.format)),"object"===i(n.startDate)&&(this.startDate=e(n.startDate)),"object"===i(n.endDate)&&(this.endDate=e(n.endDate)),"object"===i(n.minDate)&&(this.minDate=e(n.minDate)),"object"===i(n.maxDate)&&(this.maxDate=e(n.maxDate)),this.minDate&&this.startDate.isBefore(this.minDate)&&(this.startDate=this.minDate.clone()),this.maxDate&&this.endDate.isAfter(this.maxDate)&&(this.endDate=this.maxDate.clone()),"string"==typeof n.applyClass&&(this.applyClass=n.applyClass),"string"==typeof n.cancelClass&&(this.cancelClass=n.cancelClass),"object"===i(n.dateLimit)&&(this.dateLimit=n.dateLimit),"string"==typeof n.opens&&(this.opens=n.opens),"string"==typeof n.drops&&(this.drops=n.drops),"boolean"==typeof n.showWeekNumbers&&(this.showWeekNumbers=n.showWeekNumbers),"boolean"==typeof n.showISOWeekNumbers&&(this.showISOWeekNumbers=n.showISOWeekNumbers),"string"==typeof n.buttonClasses&&(this.buttonClasses=n.buttonClasses),"object"===i(n.buttonClasses)&&(this.buttonClasses=n.buttonClasses.join(" ")),"boolean"==typeof n.showDropdowns&&(this.showDropdowns=n.showDropdowns),"boolean"==typeof n.showCustomRangeLabel&&(this.showCustomRangeLabel=n.showCustomRangeLabel),"boolean"==typeof n.singleDatePicker&&(this.singleDatePicker=n.singleDatePicker,this.singleDatePicker&&(this.endDate=this.startDate.clone())),"boolean"==typeof n.timePicker&&(this.timePicker=n.timePicker),"boolean"==typeof n.timePickerSeconds&&(this.timePickerSeconds=n.timePickerSeconds),"number"==typeof n.timePickerIncrement&&(this.timePickerIncrement=n.timePickerIncrement),"boolean"==typeof n.timePicker24Hour&&(this.timePicker24Hour=n.timePicker24Hour),"boolean"==typeof n.autoApply&&(this.autoApply=n.autoApply),"boolean"==typeof n.autoUpdateInput&&(this.autoUpdateInput=n.autoUpdateInput),"boolean"==typeof n.linkedCalendars&&(this.linkedCalendars=n.linkedCalendars),"function"==typeof n.isInvalidDate&&(this.isInvalidDate=n.isInvalidDate),"function"==typeof n.isCustomDate&&(this.isCustomDate=n.isCustomDate),"boolean"==typeof n.alwaysShowCalendars&&(this.alwaysShowCalendars=n.alwaysShowCalendars),0!=this.locale.firstDay)for(var l=this.locale.firstDay;l>0;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),l--;var r,c,d;if(void 0===n.startDate&&void 0===n.endDate&&t(this.element).is("input[type=text]")){var p=t(this.element).val(),m=p.split(this.locale.separator);r=c=null,2==m.length?(r=e(m[0],this.locale.format),c=e(m[1],this.locale.format)):this.singleDatePicker&&""!==p&&(r=e(p,this.locale.format),c=e(p,this.locale.format)),null!==r&&null!==c&&(this.setStartDate(r),this.setEndDate(c))}if("object"===i(n.ranges)){for(d in n.ranges){r="string"==typeof n.ranges[d][0]?e(n.ranges[d][0],this.locale.format):e(n.ranges[d][0]),c="string"==typeof n.ranges[d][1]?e(n.ranges[d][1],this.locale.format):e(n.ranges[d][1]),this.minDate&&r.isBefore(this.minDate)&&(r=this.minDate.clone());var u,h=this.maxDate;this.dateLimit&&h&&r.clone().add(this.dateLimit).isAfter(h)&&(h=r.clone().add(this.dateLimit)),h&&c.isAfter(h)&&(c=h.clone()),this.minDate&&c.isBefore(this.minDate,this.timepicker?"minute":"day")||h&&r.isAfter(h,this.timepicker?"minute":"day")||((u=document.createElement("textarea")).innerHTML=d,o=u.value,this.ranges[o]=[r,c])}var f="<ul>";for(d in this.ranges)f+='<li data-range-key="'+d+'">'+d+"</li>";this.showCustomRangeLabel&&(f+='<li data-range-key="'+this.locale.customRangeLabel+'">'+this.locale.customRangeLabel+"</li>"),f+="</ul>",this.container.find(".ranges").prepend(f)}"function"==typeof s&&(this.callback=s),this.timePicker||(this.startDate=this.startDate.startOf("day"),this.endDate=this.endDate.endOf("day"),this.container.find(".calendar-time").hide()),this.timePicker&&this.autoApply&&(this.autoApply=!1),this.autoApply&&"object"!==i(n.ranges)?this.container.find(".ranges").hide():this.autoApply&&this.container.find(".applyBtn, .cancelBtn").addClass("hide"),this.singleDatePicker&&(this.container.addClass("single"),this.container.find(".calendar.left").addClass("single"),this.container.find(".calendar.left").show(),this.container.find(".calendar.right").hide(),this.container.find(".daterangepicker_input input, .daterangepicker_input > i").hide(),this.timePicker?this.container.find(".ranges ul").hide():this.container.find(".ranges").hide()),(void 0===n.ranges&&!this.singleDatePicker||this.alwaysShowCalendars)&&this.container.addClass("show-calendar"),this.container.addClass("opens"+this.opens),void 0!==n.ranges&&"right"==this.opens&&this.container.find(".ranges").prependTo(this.container.find(".calendar.left").parent()),this.container.find(".applyBtn, .cancelBtn").addClass(this.buttonClasses),this.applyClass.length&&this.container.find(".applyBtn").addClass(this.applyClass),this.cancelClass.length&&this.container.find(".cancelBtn").addClass(this.cancelClass),this.container.find(".applyBtn").html(this.locale.applyLabel),this.container.find(".cancelBtn").html(this.locale.cancelLabel),this.container.find(".calendar").on("click.daterangepicker",".prev",t.proxy(this.clickPrev,this)).on("click.daterangepicker",".next",t.proxy(this.clickNext,this)).on("mousedown.daterangepicker","td.available",t.proxy(this.clickDate,this)).on("mouseenter.daterangepicker","td.available",t.proxy(this.hoverDate,this)).on("mouseleave.daterangepicker","td.available",t.proxy(this.updateFormInputs,this)).on("change.daterangepicker","select.yearselect",t.proxy(this.monthOrYearChanged,this)).on("change.daterangepicker","select.monthselect",t.proxy(this.monthOrYearChanged,this)).on("change.daterangepicker","select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",t.proxy(this.timeChanged,this)).on("click.daterangepicker",".daterangepicker_input input",t.proxy(this.showCalendars,this)).on("focus.daterangepicker",".daterangepicker_input input",t.proxy(this.formInputsFocused,this)).on("blur.daterangepicker",".daterangepicker_input input",t.proxy(this.formInputsBlurred,this)).on("change.daterangepicker",".daterangepicker_input input",t.proxy(this.formInputsChanged,this)),this.container.find(".ranges").on("click.daterangepicker","button.applyBtn",t.proxy(this.clickApply,this)).on("click.daterangepicker","button.cancelBtn",t.proxy(this.clickCancel,this)).on("click.daterangepicker","li",t.proxy(this.clickRange,this)).on("mouseenter.daterangepicker","li",t.proxy(this.hoverRange,this)).on("mouseleave.daterangepicker","li",t.proxy(this.updateFormInputs,this)),this.element.is("input")||this.element.is("button")?this.element.on({"click.daterangepicker":t.proxy(this.show,this),"focus.daterangepicker":t.proxy(this.show,this),"keyup.daterangepicker":t.proxy(this.elementChanged,this),"keydown.daterangepicker":t.proxy(this.keydown,this)}):this.element.on("click.daterangepicker",t.proxy(this.toggle,this)),this.element.is("input")&&!this.singleDatePicker&&this.autoUpdateInput?(this.element.val(this.startDate.format(this.locale.format)+this.locale.separator+this.endDate.format(this.locale.format)),this.element.trigger("change")):this.element.is("input")&&this.autoUpdateInput&&(this.element.val(this.startDate.format(this.locale.format)),this.element.trigger("change"))};return a.prototype={constructor:a,setStartDate:function(t){"string"==typeof t&&(this.startDate=e(t,this.locale.format)),"object"===i(t)&&(this.startDate=e(t)),this.timePicker||(this.startDate=this.startDate.startOf("day")),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.round(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement),this.minDate&&this.startDate.isBefore(this.minDate)&&(this.startDate=this.minDate.clone(),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.round(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement)),this.maxDate&&this.startDate.isAfter(this.maxDate)&&(this.startDate=this.maxDate.clone(),this.timePicker&&this.timePickerIncrement&&this.startDate.minute(Math.floor(this.startDate.minute()/this.timePickerIncrement)*this.timePickerIncrement)),this.isShowing||this.updateElement(),this.updateMonthsInView()},setEndDate:function(t){"string"==typeof t&&(this.endDate=e(t,this.locale.format)),"object"===i(t)&&(this.endDate=e(t)),this.timePicker||(this.endDate=this.endDate.endOf("day")),this.timePicker&&this.timePickerIncrement&&this.endDate.minute(Math.round(this.endDate.minute()/this.timePickerIncrement)*this.timePickerIncrement),this.endDate.isBefore(this.startDate)&&(this.endDate=this.startDate.clone()),this.maxDate&&this.endDate.isAfter(this.maxDate)&&(this.endDate=this.maxDate.clone()),this.dateLimit&&this.startDate.clone().add(this.dateLimit).isBefore(this.endDate)&&(this.endDate=this.startDate.clone().add(this.dateLimit)),this.previousRightTime=this.endDate.clone(),this.isShowing||this.updateElement(),this.updateMonthsInView()},isInvalidDate:function(){return!1},isCustomDate:function(){return!1},updateView:function(){this.timePicker&&(this.renderTimePicker("left"),this.renderTimePicker("right"),this.endDate?this.container.find(".right .calendar-time select").removeAttr("disabled").removeClass("disabled"):this.container.find(".right .calendar-time select").attr("disabled","disabled").addClass("disabled")),this.endDate?(this.container.find('input[name="daterangepicker_end"]').removeClass("active"),this.container.find('input[name="daterangepicker_start"]').addClass("active")):(this.container.find('input[name="daterangepicker_end"]').addClass("active"),this.container.find('input[name="daterangepicker_start"]').removeClass("active")),this.updateMonthsInView(),this.updateCalendars(),this.updateFormInputs()},updateMonthsInView:function(){if(this.endDate){if(!this.singleDatePicker&&this.leftCalendar.month&&this.rightCalendar.month&&(this.startDate.format("YYYY-MM")==this.leftCalendar.month.format("YYYY-MM")||this.startDate.format("YYYY-MM")==this.rightCalendar.month.format("YYYY-MM"))&&(this.endDate.format("YYYY-MM")==this.leftCalendar.month.format("YYYY-MM")||this.endDate.format("YYYY-MM")==this.rightCalendar.month.format("YYYY-MM")))return;this.leftCalendar.month=this.startDate.clone().date(2),this.linkedCalendars||this.endDate.month()==this.startDate.month()&&this.endDate.year()==this.startDate.year()?this.rightCalendar.month=this.startDate.clone().date(2).add(1,"month"):this.rightCalendar.month=this.endDate.clone().date(2)}else this.leftCalendar.month.format("YYYY-MM")!=this.startDate.format("YYYY-MM")&&this.rightCalendar.month.format("YYYY-MM")!=this.startDate.format("YYYY-MM")&&(this.leftCalendar.month=this.startDate.clone().date(2),this.rightCalendar.month=this.startDate.clone().date(2).add(1,"month"));this.maxDate&&this.linkedCalendars&&!this.singleDatePicker&&this.rightCalendar.month>this.maxDate&&(this.rightCalendar.month=this.maxDate.clone().date(2),this.leftCalendar.month=this.maxDate.clone().date(2).subtract(1,"month"))},updateCalendars:function(){var e,t,a,i;this.timePicker&&(this.endDate?(e=parseInt(this.container.find(".left .hourselect").val(),10),t=parseInt(this.container.find(".left .minuteselect").val(),10),a=this.timePickerSeconds?parseInt(this.container.find(".left .secondselect").val(),10):0,this.timePicker24Hour||("PM"===(i=this.container.find(".left .ampmselect").val())&&e<12&&(e+=12),"AM"===i&&12===e&&(e=0))):(e=parseInt(this.container.find(".right .hourselect").val(),10),t=parseInt(this.container.find(".right .minuteselect").val(),10),a=this.timePickerSeconds?parseInt(this.container.find(".right .secondselect").val(),10):0,this.timePicker24Hour||("PM"===(i=this.container.find(".right .ampmselect").val())&&e<12&&(e+=12),"AM"===i&&12===e&&(e=0))),this.leftCalendar.month.hour(e).minute(t).second(a),this.rightCalendar.month.hour(e).minute(t).second(a)),this.renderCalendar("left"),this.renderCalendar("right"),this.container.find(".ranges li").removeClass("active"),null!=this.endDate&&this.calculateChosenLabel()},renderCalendar:function(a){var i,n=(i="left"==a?this.leftCalendar:this.rightCalendar).month.month(),s=i.month.year(),o=i.month.hour(),l=i.month.minute(),r=i.month.second(),c=e([s,n]).daysInMonth(),d=e([s,n,1]),p=e([s,n,c]),m=e(d).subtract(1,"month").month(),u=e(d).subtract(1,"month").year(),h=e([u,m]).daysInMonth(),f=d.day();(i=[]).firstDay=d,i.lastDay=p;for(var g=0;g<6;g++)i[g]=[];var v=h-f+this.locale.firstDay+1;v>h&&(v-=7),f==this.locale.firstDay&&(v=h-6);for(var b=e([u,m,v,12,l,r]),y=(g=0,0),E=0;g<42;g++,y++,b=e(b).add(24,"hour"))g>0&&y%7==0&&(y=0,E++),i[E][y]=b.clone().hour(o).minute(l).second(r),b.hour(12),this.minDate&&i[E][y].format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")&&i[E][y].isBefore(this.minDate)&&"left"==a&&(i[E][y]=this.minDate.clone()),this.maxDate&&i[E][y].format("YYYY-MM-DD")==this.maxDate.format("YYYY-MM-DD")&&i[E][y].isAfter(this.maxDate)&&"right"==a&&(i[E][y]=this.maxDate.clone());"left"==a?this.leftCalendar.calendar=i:this.rightCalendar.calendar=i;var w="left"==a?this.minDate:this.startDate,S=this.maxDate,N=("left"==a?this.startDate:this.endDate,"ltr"==this.locale.direction?{left:"chevron-left",right:"chevron-right"}:{left:"chevron-right",right:"chevron-left"}),C='<table class="table-condensed">';C+="<thead>",C+="<tr>",(this.showWeekNumbers||this.showISOWeekNumbers)&&(C+="<th></th>"),w&&!w.isBefore(i.firstDay)||this.linkedCalendars&&"left"!=a?C+="<th></th>":C+='<th class="prev available"><i class="fa fa-'+N.left+'"></i></th>';var x=this.locale.monthNames[i[1][1].month()]+i[1][1].format(" YYYY");if(this.showDropdowns){for(var I=i[1][1].month(),k=i[1][1].year(),D=S&&S.year()||k+5,A=w&&w.year()||k-50,R=k==A,P=k==D,T='<select class="monthselect">',M=0;M<12;M++)(!R||M>=w.month())&&(!P||M<=S.month())?T+="<option value='"+M+"'"+(M===I?" selected='selected'":"")+">"+this.locale.monthNames[M]+"</option>":T+="<option value='"+M+"'"+(M===I?" selected='selected'":"")+" disabled='disabled'>"+this.locale.monthNames[M]+"</option>";T+="</select>";for(var O='<select class="yearselect">',L=A;L<=D;L++)O+='<option value="'+L+'"'+(L===k?' selected="selected"':"")+">"+L+"</option>";x=T+(O+="</select>")}if(C+='<th colspan="5" class="month">'+x+"</th>",S&&!S.isAfter(i.lastDay)||this.linkedCalendars&&"right"!=a&&!this.singleDatePicker?C+="<th></th>":C+='<th class="next available"><i class="fa fa-'+N.right+'"></i></th>',C+="</tr>",C+="<tr>",(this.showWeekNumbers||this.showISOWeekNumbers)&&(C+='<th class="week">'+this.locale.weekLabel+"</th>"),t.each(this.locale.daysOfWeek,function(e,t){C+="<th>"+t+"</th>"}),C+="</tr>",C+="</thead>",C+="<tbody>",null==this.endDate&&this.dateLimit){var V=this.startDate.clone().add(this.dateLimit).endOf("day");S&&!V.isBefore(S)||(S=V)}for(E=0;E<6;E++){for(C+="<tr>",this.showWeekNumbers?C+='<td class="week">'+i[E][0].week()+"</td>":this.showISOWeekNumbers&&(C+='<td class="week">'+i[E][0].isoWeek()+"</td>"),y=0;y<7;y++){var _=[];i[E][y].isSame(new Date,"day")&&_.push("today"),i[E][y].isoWeekday()>5&&_.push("weekend"),i[E][y].month()!=i[1][1].month()&&_.push("off"),this.minDate&&i[E][y].isBefore(this.minDate,"day")&&_.push("off","disabled"),S&&i[E][y].isAfter(S,"day")&&_.push("off","disabled"),this.isInvalidDate(i[E][y])&&_.push("off","disabled"),i[E][y].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")&&_.push("active","start-date"),null!=this.endDate&&i[E][y].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")&&_.push("active","end-date"),null!=this.endDate&&i[E][y]>this.startDate&&i[E][y]<this.endDate&&_.push("in-range");var F=this.isCustomDate(i[E][y]);!1!==F&&("string"==typeof F?_.push(F):Array.prototype.push.apply(_,F));var B="",U=!1;for(g=0;g<_.length;g++)B+=_[g]+" ","disabled"==_[g]&&(U=!0);U||(B+="available"),C+='<td class="'+B.replace(/^\s+|\s+$/g,"")+'" data-title="r'+E+"c"+y+'">'+i[E][y].date()+"</td>"}C+="</tr>"}C+="</tbody>",C+="</table>",this.container.find(".calendar."+a+" .calendar-table").html(C)},renderTimePicker:function(e){if("right"!=e||this.endDate){var t,a,i,n=this.maxDate;if(!this.dateLimit||this.maxDate&&!this.startDate.clone().add(this.dateLimit).isAfter(this.maxDate)||(n=this.startDate.clone().add(this.dateLimit)),"left"==e)a=this.startDate.clone(),i=this.minDate;else if("right"==e){a=this.endDate.clone(),i=this.startDate;var s=this.container.find(".calendar.right .calendar-time div");if(""!=s.html()&&(a.hour(s.find(".hourselect option:selected").val()||a.hour()),a.minute(s.find(".minuteselect option:selected").val()||a.minute()),a.second(s.find(".secondselect option:selected").val()||a.second()),!this.timePicker24Hour)){var o=s.find(".ampmselect option:selected").val();"PM"===o&&a.hour()<12&&a.hour(a.hour()+12),"AM"===o&&12===a.hour()&&a.hour(0)}a.isBefore(this.startDate)&&(a=this.startDate.clone()),n&&a.isAfter(n)&&(a=n.clone())}t='<select class="hourselect">';for(var l=this.timePicker24Hour?0:1,r=this.timePicker24Hour?23:12,c=l;c<=r;c++){var d=c;this.timePicker24Hour||(d=a.hour()>=12?12==c?12:c+12:12==c?0:c);var p=a.clone().hour(d),m=!1;i&&p.minute(59).isBefore(i)&&(m=!0),n&&p.minute(0).isAfter(n)&&(m=!0),d!=a.hour()||m?t+=m?'<option value="'+c+'" disabled="disabled" class="disabled">'+c+"</option>":'<option value="'+c+'">'+c+"</option>":t+='<option value="'+c+'" selected="selected">'+c+"</option>"}for(t+="</select> ",t+=': <select class="minuteselect">',c=0;c<60;c+=this.timePickerIncrement){var u=c<10?"0"+c:c;p=a.clone().minute(c),m=!1,i&&p.second(59).isBefore(i)&&(m=!0),n&&p.second(0).isAfter(n)&&(m=!0),a.minute()!=c||m?t+=m?'<option value="'+c+'" disabled="disabled" class="disabled">'+u+"</option>":'<option value="'+c+'">'+u+"</option>":t+='<option value="'+c+'" selected="selected">'+u+"</option>"}if(t+="</select> ",this.timePickerSeconds){for(t+=': <select class="secondselect">',c=0;c<60;c++)u=c<10?"0"+c:c,p=a.clone().second(c),m=!1,i&&p.isBefore(i)&&(m=!0),n&&p.isAfter(n)&&(m=!0),a.second()!=c||m?t+=m?'<option value="'+c+'" disabled="disabled" class="disabled">'+u+"</option>":'<option value="'+c+'">'+u+"</option>":t+='<option value="'+c+'" selected="selected">'+u+"</option>";t+="</select> "}if(!this.timePicker24Hour){t+='<select class="ampmselect">';var h="",f="";i&&a.clone().hour(12).minute(0).second(0).isBefore(i)&&(h=' disabled="disabled" class="disabled"'),n&&a.clone().hour(0).minute(0).second(0).isAfter(n)&&(f=' disabled="disabled" class="disabled"'),a.hour()>=12?t+='<option value="AM"'+h+'>AM</option><option value="PM" selected="selected"'+f+">PM</option>":t+='<option value="AM" selected="selected"'+h+'>AM</option><option value="PM"'+f+">PM</option>",t+="</select>"}this.container.find(".calendar."+e+" .calendar-time div").html(t)}},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").is(":focus")||this.container.find("input[name=daterangepicker_end]").is(":focus")||(this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.locale.format)),this.endDate&&this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.locale.format)),this.singleDatePicker||this.endDate&&(this.startDate.isBefore(this.endDate)||this.startDate.isSame(this.endDate))?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled"))},move:function(){var e,a={top:0,left:0},i=t(window).width();this.parentEl.is("body")||(a={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()},i=this.parentEl[0].clientWidth+this.parentEl.offset().left),e="up"==this.drops?this.element.offset().top-this.container.outerHeight()-a.top:this.element.offset().top+this.element.outerHeight()-a.top,this.container["up"==this.drops?"addClass":"removeClass"]("dropup"),"left"==this.opens?(this.container.css({top:e,right:i-this.element.offset().left-this.element.outerWidth(),left:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):"center"==this.opens?(this.container.css({top:e,left:this.element.offset().left-a.left+this.element.outerWidth()/2-this.container.outerWidth()/2,right:"auto"}),this.container.offset().left<0&&this.container.css({right:"auto",left:9})):(this.container.css({top:e,left:this.element.offset().left-a.left,right:"auto"}),this.container.offset().left+this.container.outerWidth()>t(window).width()&&this.container.css({left:"auto",right:0}))},show:function(e){this.isShowing||(this._outsideClickProxy=t.proxy(function(e){this.outsideClick(e)},this),t(document).on("mousedown.daterangepicker",this._outsideClickProxy).on("touchend.daterangepicker",this._outsideClickProxy).on("click.daterangepicker","[data-toggle=dropdown]",this._outsideClickProxy).on("focusin.daterangepicker",this._outsideClickProxy),t(window).on("resize.daterangepicker",t.proxy(function(e){this.move(e)},this)),this.oldStartDate=this.startDate.clone(),this.oldEndDate=this.endDate.clone(),this.previousRightTime=this.endDate.clone(),this.updateView(),this.container.show(),this.move(),this.element.trigger("show.daterangepicker",this),this.isShowing=!0)},hide:function(e){this.isShowing&&(this.endDate||(this.startDate=this.oldStartDate.clone(),this.endDate=this.oldEndDate.clone()),this.startDate.isSame(this.oldStartDate)&&this.endDate.isSame(this.oldEndDate)||this.callback(this.startDate,this.endDate,this.chosenLabel),this.updateElement(),t(document).off(".daterangepicker"),t(window).off(".daterangepicker"),this.container.hide(),this.element.trigger("hide.daterangepicker",this),this.isShowing=!1)},toggle:function(e){this.isShowing?this.hide():this.show()},outsideClick:function(e){var a=t(e.target);"focusin"==e.type||a.closest(this.element).length||a.closest(this.container).length||a.closest(".calendar-table").length||(this.hide(),this.element.trigger("outsideClick.daterangepicker",this))},showCalendars:function(){this.container.addClass("show-calendar"),this.move(),this.element.trigger("showCalendar.daterangepicker",this)},hideCalendars:function(){this.container.removeClass("show-calendar"),this.element.trigger("hideCalendar.daterangepicker",this)},hoverRange:function(e){if(!this.container.find("input[name=daterangepicker_start]").is(":focus")&&!this.container.find("input[name=daterangepicker_end]").is(":focus")){var t=e.target.getAttribute("data-range-key");if(t==this.locale.customRangeLabel)this.updateView();else{var a=this.ranges[t];this.container.find("input[name=daterangepicker_start]").val(a[0].format(this.locale.format)),this.container.find("input[name=daterangepicker_end]").val(a[1].format(this.locale.format))}}},clickRange:function(e){var t=e.target.getAttribute("data-range-key");if(this.chosenLabel=t,t==this.locale.customRangeLabel)this.showCalendars();else{var a=this.ranges[t];this.startDate=a[0],this.endDate=a[1],this.timePicker||(this.startDate.startOf("day"),this.endDate.endOf("day")),this.alwaysShowCalendars||this.hideCalendars(),this.clickApply()}},clickPrev:function(e){t(e.target).parents(".calendar").hasClass("left")?(this.leftCalendar.month.subtract(1,"month"),this.linkedCalendars&&this.rightCalendar.month.subtract(1,"month")):this.rightCalendar.month.subtract(1,"month"),this.updateCalendars()},clickNext:function(e){t(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add(1,"month"):(this.rightCalendar.month.add(1,"month"),this.linkedCalendars&&this.leftCalendar.month.add(1,"month")),this.updateCalendars()},hoverDate:function(e){if(t(e.target).hasClass("available")){var a=t(e.target).attr("data-title"),i=a.substr(1,1),n=a.substr(3,1),s=t(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.calendar[i][n]:this.rightCalendar.calendar[i][n];this.endDate&&!this.container.find("input[name=daterangepicker_start]").is(":focus")?this.container.find("input[name=daterangepicker_start]").val(s.format(this.locale.format)):this.endDate||this.container.find("input[name=daterangepicker_end]").is(":focus")||this.container.find("input[name=daterangepicker_end]").val(s.format(this.locale.format));var o=this.leftCalendar,l=this.rightCalendar,r=this.startDate;this.endDate||this.container.find(".calendar tbody td").each(function(e,a){if(!t(a).hasClass("week")){var i=t(a).attr("data-title"),n=i.substr(1,1),c=i.substr(3,1),d=t(a).parents(".calendar").hasClass("left")?o.calendar[n][c]:l.calendar[n][c];d.isAfter(r)&&d.isBefore(s)||d.isSame(s,"day")?t(a).addClass("in-range"):t(a).removeClass("in-range")}})}},clickDate:function(e){if(t(e.target).hasClass("available")){var a=t(e.target).attr("data-title"),i=a.substr(1,1),n=a.substr(3,1),s=t(e.target).parents(".calendar").hasClass("left")?this.leftCalendar.calendar[i][n]:this.rightCalendar.calendar[i][n];if(this.endDate||s.isBefore(this.startDate,"day")){if(this.timePicker){var o=parseInt(this.container.find(".left .hourselect").val(),10);this.timePicker24Hour||("PM"===(c=this.container.find(".left .ampmselect").val())&&o<12&&(o+=12),"AM"===c&&12===o&&(o=0));var l=parseInt(this.container.find(".left .minuteselect").val(),10),r=this.timePickerSeconds?parseInt(this.container.find(".left .secondselect").val(),10):0;s=s.clone().hour(o).minute(l).second(r)}this.endDate=null,this.setStartDate(s.clone())}else if(!this.endDate&&s.isBefore(this.startDate))this.setEndDate(this.startDate.clone());else{var c;this.timePicker&&(o=parseInt(this.container.find(".right .hourselect").val(),10),this.timePicker24Hour||("PM"===(c=this.container.find(".right .ampmselect").val())&&o<12&&(o+=12),"AM"===c&&12===o&&(o=0)),l=parseInt(this.container.find(".right .minuteselect").val(),10),r=this.timePickerSeconds?parseInt(this.container.find(".right .secondselect").val(),10):0,s=s.clone().hour(o).minute(l).second(r)),this.setEndDate(s.clone()),this.autoApply&&(this.calculateChosenLabel(),this.clickApply())}this.singleDatePicker&&(this.setEndDate(this.startDate),this.timePicker||this.clickApply()),this.updateView(),e.stopPropagation()}},calculateChosenLabel:function(){var e=!0,t=0;for(var a in this.ranges){if(this.timePicker){if(this.startDate.isSame(this.ranges[a][0])&&this.endDate.isSame(this.ranges[a][1])){e=!1,this.chosenLabel=this.container.find(".ranges li:eq("+t+")").addClass("active").html();break}}else if(this.startDate.format("YYYY-MM-DD")==this.ranges[a][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[a][1].format("YYYY-MM-DD")){e=!1,this.chosenLabel=this.container.find(".ranges li:eq("+t+")").addClass("active").html();break}t++}e&&(this.showCustomRangeLabel?this.chosenLabel=this.container.find(".ranges li:last").addClass("active").html():this.chosenLabel=null,this.showCalendars())},clickApply:function(e){this.hide(),this.element.trigger("apply.daterangepicker",this)},clickCancel:function(e){this.startDate=this.oldStartDate,this.endDate=this.oldEndDate,this.hide(),this.element.trigger("cancel.daterangepicker",this)},monthOrYearChanged:function(e){var a=t(e.target).closest(".calendar").hasClass("left"),i=a?"left":"right",n=this.container.find(".calendar."+i),s=parseInt(n.find(".monthselect").val(),10),o=n.find(".yearselect").val();a||(o<this.startDate.year()||o==this.startDate.year()&&s<this.startDate.month())&&(s=this.startDate.month(),o=this.startDate.year()),this.minDate&&(o<this.minDate.year()||o==this.minDate.year()&&s<this.minDate.month())&&(s=this.minDate.month(),o=this.minDate.year()),this.maxDate&&(o>this.maxDate.year()||o==this.maxDate.year()&&s>this.maxDate.month())&&(s=this.maxDate.month(),o=this.maxDate.year()),a?(this.leftCalendar.month.month(s).year(o),this.linkedCalendars&&(this.rightCalendar.month=this.leftCalendar.month.clone().add(1,"month"))):(this.rightCalendar.month.month(s).year(o),this.linkedCalendars&&(this.leftCalendar.month=this.rightCalendar.month.clone().subtract(1,"month"))),this.updateCalendars()},timeChanged:function(e){var a=t(e.target).closest(".calendar"),i=a.hasClass("left"),n=parseInt(a.find(".hourselect").val(),10),s=parseInt(a.find(".minuteselect").val(),10),o=this.timePickerSeconds?parseInt(a.find(".secondselect").val(),10):0;if(!this.timePicker24Hour){var l=a.find(".ampmselect").val();"PM"===l&&n<12&&(n+=12),"AM"===l&&12===n&&(n=0)}if(i){var r=this.startDate.clone();r.hour(n),r.minute(s),r.second(o),this.setStartDate(r),this.singleDatePicker?this.endDate=this.startDate.clone():this.endDate&&this.endDate.format("YYYY-MM-DD")==r.format("YYYY-MM-DD")&&this.endDate.isBefore(r)&&this.setEndDate(r.clone())}else if(this.endDate){var c=this.endDate.clone();c.hour(n),c.minute(s),c.second(o),this.setEndDate(c)}this.updateCalendars(),this.updateFormInputs(),this.renderTimePicker("left"),this.renderTimePicker("right")},formInputsChanged:function(a){var i=t(a.target).closest(".calendar").hasClass("right"),n=e(this.container.find('input[name="daterangepicker_start"]').val(),this.locale.format),s=e(this.container.find('input[name="daterangepicker_end"]').val(),this.locale.format);n.isValid()&&s.isValid()&&(i&&s.isBefore(n)&&(n=s.clone()),this.setStartDate(n),this.setEndDate(s),i?this.container.find('input[name="daterangepicker_start"]').val(this.startDate.format(this.locale.format)):this.container.find('input[name="daterangepicker_end"]').val(this.endDate.format(this.locale.format))),this.updateView()},formInputsFocused:function(e){this.container.find('input[name="daterangepicker_start"], input[name="daterangepicker_end"]').removeClass("active"),t(e.target).addClass("active"),t(e.target).closest(".calendar").hasClass("right")&&(this.endDate=null,this.setStartDate(this.startDate.clone()),this.updateView())},formInputsBlurred:function(t){if(!this.endDate){var a=this.container.find('input[name="daterangepicker_end"]').val(),i=e(a,this.locale.format);i.isValid()&&(this.setEndDate(i),this.updateView())}},elementChanged:function(){if(this.element.is("input")&&this.element.val().length&&!(this.element.val().length<this.locale.format.length)){var t=this.element.val().split(this.locale.separator),a=null,i=null;2===t.length&&(a=e(t[0],this.locale.format),i=e(t[1],this.locale.format)),(this.singleDatePicker||null===a||null===i)&&(i=a=e(this.element.val(),this.locale.format)),a.isValid()&&i.isValid()&&(this.setStartDate(a),this.setEndDate(i),this.updateView())}},keydown:function(e){9!==e.keyCode&&13!==e.keyCode||this.hide()},updateElement:function(){this.element.is("input")&&!this.singleDatePicker&&this.autoUpdateInput?(this.element.val(this.startDate.format(this.locale.format)+this.locale.separator+this.endDate.format(this.locale.format)),this.element.trigger("change")):this.element.is("input")&&this.autoUpdateInput&&(this.element.val(this.startDate.format(this.locale.format)),this.element.trigger("change"))},remove:function(){this.container.remove(),this.element.off(".daterangepicker"),this.element.removeData()}},t.fn.daterangepicker=function(e,i){return this.each(function(){var n=t(this);n.data("daterangepicker")&&n.data("daterangepicker").remove(),n.data("daterangepicker",new a(n,e,i))}),this},a}(a(95093),$)}},a={};function i(e){var n=a[e];if(void 0!==n)return n.exports;var s=a[e]={id:e,loaded:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=t,i.c=a,i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},e=[],i.O=(t,a,n,s)=>{if(!a){var o=1/0;for(d=0;d<e.length;d++){for(var[a,n,s]=e[d],l=!0,r=0;r<a.length;r++)(!1&s||o>=s)&&Object.keys(i.O).every(e=>i.O[e](a[r]))?a.splice(r--,1):(l=!1,s<o&&(o=s));if(l){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[a,n,s]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={27:0,524:0};i.O.j=t=>0===e[t];var t=(t,a)=>{var n,s,[o,l,r]=a,c=0;if(o.some(t=>0!==e[t])){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(r)var d=r(i)}for(t&&t(a);c<o.length;c++)s=o[c],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(d)},a=self.webpackChunkSingular=self.webpackChunkSingular||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=i.O(void 0,[967,822,956,12,77,247,761,964,128,274,490,515,878,900,547,459,953],()=>i(i.s=93381));n=i.O(n)})();