/*! For license information please see controlapp.7ba60c20.js.LICENSE.txt */
(()=>{var e,t={16918:(e,t,n)=>{function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var a=n(82327),o=[],r=[],s=!1,l=!1,c=[],d=[],p=function(e){return"object"===i(e)&&null!==e?0==Object.keys(e).length:null==e||null==e},u=function(e,t){this._parent=null,this.name=t||"",this.children={},this.type="object",this.value=null,this.active=!0,this.callbacks={value:[],child_added:[],child_removed:[],child_changed:[]},e&&this.set(e)},h=function(e){var t=new u;return t.value=e,t.type="value",t.children=null,t},m=function(e){var t=new u;t.type="array";for(var n=0;n<e.length;n++)Array.isArray(e[n])?t.children[n]=m(e[n]):"object"==i(e[n])?t.children[n]=f(e[n]):t.children[n]=h(e[n]),t.children[n].name=n,t.children[n]._parent=t;return t},f=function(e){var t=new u;for(var n in t.type="object",e)if(e.hasOwnProperty(n)){var a=null;(a=Array.isArray(e[n])?m(e[n]):"object"==i(e[n])?f(e[n]):h(e[n])).name=n,a._parent=t,t.children[n]=a}return t},v=function(e,t){var n;n=t||(new Date).getTime(),c.push([n,e])},g=function(){return c.pop()},w=function(e,t){var n;n=t||(new Date).getTime(),d.push([n,e])},y=function(){return d.pop()};u.prototype._undoStackTimestampInverval=1e3,u.prototype.beginBatch=function(){s=!0,(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&v("batch")},u.prototype.endBatch=function(){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s=!1,(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&v("batch");var t=[];r.forEach(function(e){-1==t.indexOf(e)&&t.push(e)}),r=[],e&&t.forEach(function(e){e.notify("value")}),this.removeHeadUndoStack()},u.prototype._emptyNodeNull=function(){l=!0},u.prototype.child=function(e){"string"!=typeof e&&(e=String(e));var t=e.split("/");if(t&&t.length>1){var n=e.indexOf("/"),i=e.substr(n+1);return this.child(t[0]).child(i)}return this.children||(this.children={},this.type="object"),this.children[e]||(this.children[e]=new u,this.children[e].name=e,this.children[e]._parent=this),this.children[e]},u.prototype.push=function(){var e=a.guid();return this.children[e]=new u,this.children[e].name=e,this.children[e]._parent=this,this.children[e]},u.prototype.set=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;return o=[],t&&(v([this,this.val()]),d=[],this.removeHeadUndoStack()),null==e||Array.isArray(e)&&0==e.length||"object"==i(e)&&p(e)?this.remove(t):"object"==i(e)?(Array.isArray(e)?this.type="array":this.type="object",this.update(e,!1,!0,a,n)):this.update(e,!1,!0,a,n),this},u.prototype.setWithPriority=function(e,t){console.warn("setWithPriority is not implemented"),this.set(e)},u.prototype.setPriority=function(e){console.warn("setPriority is not implemented")},u.prototype.update=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(void 0!==e){var l=0==this.active;this.active=!0;var c=this.parent;if(!r||c.active){for(;c;)c.active=!0,c=c.parent;if(o=[],t&&(v([this,this.val()]),d=[],this.removeHeadUndoStack()),"object"==i(e)&&null!=e){var p=f(e),u=!1,h=!1;if("object"==this.type&&Array.isArray(e)||"array"==this.type&&!Array.isArray(e))for(var m in this.children){var g=this.children[m];delete this.children[m],this.notify("child_removed",g)}if(this.children||(this.children={}),this.type="object",Array.isArray(e)&&(this.type="array"),1==n&&e){var w=Object.keys(e);for(var y in this.children)if(-1==w.indexOf(y)){h=!0;var b=this.children[y];this.notify("child_removed",b),b.reset()}}for(var x in p.children)this.children[x]?this.children[x].updateObject(p.children[x],n,s):(u=!0,this.children[x]=p.children[x],this.children[x]._parent=this,this.children[x].name=x,this.notify("child_added",this.children[x]));this.value=null,(u||h||l)&&o.push(this)}else{var E=this.value!==e;this.type="value",(E||l||s)&&(this.children=null,this.value=e,o.push(this))}var S=[];o.forEach(function(e){for(var t=e.parent;t;)-1==S.indexOf(t)&&S.push(t),t=t.parent;-1==S.indexOf(e)&&S.push(e)}),S.forEach(function(e){e.notify("value",null,a)}),S=[],o=[];for(var A=this,I=this.parent;I;)A.notified_child_added_to_parent||(A.notified_child_added_to_parent=!0,A.parent.notify("child_added",A)),A=I,I=I.parent;return this}}},u.prototype.updateObject=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=0==this.active;this.active=!0;var a=!1,r=!1;if("value"==e.type?(a=this.value!==e.value,this.value=e.value,this.type=e.type):"object"!=e.type&&"array"!=e.type||(a=this.value!==e.value,this.children||(this.children={}),this.type=e.type),1==t&&e.children){var s=Object.keys(e.children);for(var l in this.children)if(-1==s.indexOf(l)&&this.children[l]){r=!0;var c=this.children[l];this.notify("child_removed",c),c.reset()}}var d=!1;for(var p in e.children)this.children[p]?this.children[p].updateObject(e.children[p],t,n):(d=!0,this.children[p]=e.children[p],this.children[p]._parent=this,this.children[p].name=p,this.notify("child_added",this.children[p]));(d||a||r||i||n)&&o.push(this)},u.prototype.undo=function(){if(0!=c.length)for(var e=c[c.length-1][0];c.length>0;){var t=g(),n=t[1];if(Array.isArray(n)){var i=n[0],a=n[1];w([i,i.val()],t[0]),i.set(a,!1)}else if("batch"==n){this.beginBatch(!1);for(var o=[],r=g();"batch"!=r[1];)o.push(r),r=g();w("batch",t[0]),o.forEach(function(e){var t=e[1][0],n=e[1][1];w([t,t.val()],e[0]),t.set(n,!1)}),w("batch",r[0]),this.endBatch(!1)}if(0==c.length)break;if(e-c[c.length-1][0]>=this._undoStackTimestampInverval)break}},u.prototype.redo=function(){if(0!=d.length)for(var e=d[d.length-1][0];d.length>0;){var t=y(),n=t[1];if(Array.isArray(n)){var i=n[0],a=n[1];v([i,i.val()],t[0]),i.set(a,!1)}else if("batch"==n){this.beginBatch(!1);var o=[],r=y();for(v("batch",t[0]);"batch"!=r[1];)o.push(r),r=y();o.forEach(function(e){var t=e[1][0],n=e[1][1];v([t,t.val()],e[0]),t.set(n,!1)}),v("batch",r[0]),this.endBatch(!1)}if(0==d.length)break;if(d[d.length-1][0]-e>=this._undoStackTimestampInverval)break}},u.prototype.removeUndo=function(){c=[],d=[]},u.prototype.undoStackCount=function(){return c.length},u.prototype.redoStackCount=function(){return d.length},u.prototype.removeHeadUndoStack=function(){if(!s&&c.length>9999)if(Array.isArray(c[0]))c.splice(0,1);else{var e=0;if("batch"==c[0]){for(e++;"batch"!=c[e];)e++;e++,c.splice(0,e)}}},u.prototype.remove=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if("object"!=this.type||null!=this.value||Array.isArray(this.children)||0!=Object.keys(this.children).length){for(var t in e&&(v([this,this.val()]),d=[],this.removeHeadUndoStack()),this.parent&&this.parent.notify("child_removed",this),this.children){var n=this.children[t];this.notify("child_removed",n)}this.reset();for(var i=this.parent;i;)i.notify("value"),i=i.parent;this.notify("value")}},u.prototype.reset=function(){for(var e in this.active=!1,this.notified_child_added_to_parent=!1,this.children)this.children[e].reset()},u.prototype.notify=function(e,t,n){var i=this;this.callbacks[e].forEach(function(a){"value"==e?s?r.push(i):a(i,!1,n):a(t)})},u.prototype.get=function(){if("array"==this.type){var e=[];for(var t in this.children){var n=this.children[t].get();this.children[t].active&&(Array.isArray(n)?n.length>0&&e.push(n):"object"==i(n)&&p(n)||e.push(n))}return e}if("object"==this.type){var a={};for(var o in this.children){var r=this.children[o].get();this.children[o].active&&(Array.isArray(r)?r.length>0&&(a[o]=r):"object"==i(r)&&p(r)||(a[o]=r))}return l&&0==Object.keys(a).length?null:a}return this.value},u.prototype.val=function(){return this.get()},u.prototype.exists=function(){return null!=this.get()&&!p(this.get())},u.prototype.once=function(e,t){t&&t(this)},u.prototype.on=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t)if(this.callbacks[e]){if(this.callbacks[e].push(t),n)if("value"==e)t(this,!0);else if("child_added"==e)for(var i in this.children)t(this.children[i]),this.children[i].notified_child_added_to_parent=!0}else console.error("Invalid event");else console.error("Try to bind on empty callback")},u.prototype.off=function(e,t){if(t){var n=this.callbacks[e].indexOf(t);-1!=n&&this.callbacks[e].splice(n,1)}else this.callbacks[e]=[]},u.prototype.toString=function(){for(var e=this.name,t=this.parent;t;)e=t.name+"/"+e,t=t.parent;return e},u.prototype.__defineGetter__("key",function(){return this.name}),u.prototype.__defineGetter__("ref",function(){return this.toString()}),u.prototype.__defineGetter__("root",function(){for(var e=this;e.parent;)e=e.parent;return e}),u.prototype.__defineGetter__("parent",function(){return this._parent}),e.exports=u},33287:(e,t,n)=>{var i=n(57437);e.exports={getDefaultLayout:function(e){return{visible:!0,left:0,leftUnit:"%",top:0,topUnit:"%",zPos:0,width:100,widthUnit:"%",height:100,heightUnit:"%",lockSize:!0,scaleX:100,scaleY:100,lockScale:!0,rotateX:0,rotateY:0,rotateZ:0,skewX:0,skewY:0,behavior:[],updateAnimation:{active:!1,alwaysExecute:!1,in:{duration:.5,effect:"fade",property:"none",easing:{easing:"power1",inOut:"out"}},out:{duration:.5,effect:"fade",property:"none",easing:{easing:"power1",inOut:"in"}},offset:.5},anchor:{x:50,y:50},zindex:e}},getRotateFromLayout:function(e){return{x:e.rotateX,y:e.rotateY,z:e.rotateZ}},getScaleFromLayout:function(e){return{x:e.scaleX/100,y:e.scaleY/100,z:(e.scaleX+e.scaleY)/200}},getCSSTransform:function(e,t){var n="",i={translateZ:0,rotateX:0,rotateY:0,rotateZ:0,scaleX:1,scaleY:1,scaleZ:1,skewX:0,skewY:0},a=!1;t&&t.perspectiveActive&&(a=!0);var o=e.zPos||0;return 0==a&&(o=0),i.translateZ=o,0!=i.translateZ&&(n+="translateZ("+i.translateZ+"px) "),i.scaleX=e.scaleX/100,1!=i.scaleX&&(n+="scaleX("+i.scaleX+") "),i.scaleY=e.scaleY/100,1!=i.scaleY&&(n+="scaleY("+i.scaleY+") "),a&&(i.scaleZ=(Number(e.scaleX)+Number(e.scaleY))/200,1!=i.scaleZ&&(n+="scaleZ("+i.scaleZ+") ")),i.rotateX=0==a?0:e.rotateX,0!=i.rotateX&&(n+="rotateX("+i.rotateX+"deg) "),i.rotateY=0==a?0:e.rotateY,0!=i.rotateY&&(n+="rotateY("+i.rotateY+"deg) "),i.rotateZ=e.rotateZ,0!=i.rotateZ&&(n+="rotateZ("+i.rotateZ+"deg) "),i.skewX=e.skewX,i.skewY=e.skewY,0==i.skewX&&0==i.skewY||(i.skewX=Math.min(Math.max(i.skewX,-89.9),89.9),i.skewY=Math.min(Math.max(i.skewY,-89.9),89.9),n+="skew("+i.skewX+"deg, "+i.skewY+"deg) "),{transform:n,transformObj:i}},layoutToStyle:function(e,t,n,i,a){return i||(i={}),this.layoutToStyleTransform(e,t,n,i,a),this.layoutToStyleEffect(e,t,n,i),this.layoutGetShadow(e,t,n,i),this.layoutGetMaskStyle(e,t,n,i),this.layoutGetBlur(e,t,n,i),this.layoutGetBlendModeStyle(e,t,n,i),i},layoutToStyleTransform:function(e,t,n,a,o){a||(a={}),e.visible&&"0"!==e.visible&&"false"!==e.visible?a.visibility="inherit":a.visibility="hidden";var r=this.getCSSTransform(e,t).transform;a.transform=r;var s=e.leftUnit||"%",l=e.topUnit||"%",c=e.widthUnit||"%",d=e.heightUnit||"%",p=e.width,u=e.height,h=(100-p)*e.anchor.x/100,m=(100-u)*e.anchor.y/100,f=Number(e.left)+h;f&&(a.left=f+s);var v=Number(e.top)+m;if(v&&(a.top=v+l),a.width=e.width+c,a.height=e.height+d,50==e.anchor.x&&50==e.anchor.y||(a.transformOrigin=e.anchor.x+"% "+e.anchor.y+"%"),t&&t.perspectiveActive&&(a.transformStyle="preserve-3d"),void 0!==e.groupClipChildren&&1==e.groupClipChildren&&(a.overflow="hidden",void 0!==e.groupBorderRadiusMode))if(e.groupBorderRadiusMode){var g=e.groupBorderRadiusValueTL*o.width/100;a.borderRadius=g+"px"}else{var w=e.groupBorderRadiusValueTL||0,y=e.groupBorderRadiusValueTR||0,b=e.groupBorderRadiusValueBL||0,x=e.groupBorderRadiusValueBR||0,E=w*o.width/100,S=y*o.width/100,A=b*o.width/100,I=x*o.width/100;a.borderRadius=E+"px "+S+"px "+A+"px "+I+"px"}return a.zIndex=-e.zindex,a.position="absolute",void 0!==e.opacity&&e.opacity!=i.opacity&&(a.opacity=e.opacity/100),a},layoutToStyleEffect:function(e,t,n,a){return a||(a={}),a.filter="",void 0!==e.filterBrightness&&e.filterBrightness!=i.filterBrightness&&(a.filter+=" brightness("+e.filterBrightness+"%)"),void 0!==e.filterContrast&&e.filterContrast!=i.filterContrast&&(a.filter+=" contrast("+e.filterContrast+"%)"),void 0!==e.filterGrayscale&&e.filterGrayscale!=i.filterGrayscale&&(a.filter+=" grayscale("+e.filterGrayscale+"%)"),void 0!==e.filterHueRotate&&e.filterHueRotate!=i.filterHueRotate&&(a.filter+=" hue-rotate("+e.filterHueRotate+"deg)"),void 0!==e.filterInvert&&e.filterInvert!=i.filterInvert&&(a.filter+=" invert("+e.filterInvert+"%)"),void 0!==e.filterSaturate&&e.filterSaturate!=i.filterSaturate&&(a.filter+=" saturate("+e.filterSaturate+"%)"),void 0!==e.filterSepia&&e.filterSepia!=i.filterSepia&&(a.filter+=" sepia("+e.filterSepia+"%)"),""!==a.filter&&(a.WebkitFilter=a.filter),t&&t.perspectiveActive&&(a.transformStyle="preserve-3d",e.backfaceVisibility||(a.backfaceVisibility="hidden")),a},layoutGetShadow:function(e,t,n,a){if(a||(a={}),void 0!==e.filterDropShadowMode&&e.filterDropShadowMode!=i.filterDropShadowMode){var o=e.filterDropShadowX||i.filterDropShadowX,r=e.filterDropShadowY||i.filterDropShadowY,s=e.filterDropShadowBlur||i.filterDropShadowBlur,l=e.filterDropShadowSpread||i.filterDropShadowSpread,c=e.filterDropShadowColor||i.filterDropShadowColor,d=e.filterDropShadowInset?"inset":"";"box"==e.filterDropShadowMode?a.boxShadow=d+" "+o+"px "+r+"px "+s+"px "+l+"px rgba("+c.r+","+c.g+","+c.b+","+c.a+")":(void 0===a.filter&&(a.filter=""),a.filter+=" drop-shadow("+o+"px "+r+"px "+s+"px rgba("+c.r+","+c.g+","+c.b+","+c.a+")) ",a.filter&&(a.WebkitFilter=a.filter))}return a},layoutGetMaskStyle:function(e,t,n,i){return i},layoutGetBlur:function(e,t,n,a){return void 0!==a&&""!=a||(a={}),void 0!==e.filterBlur&&e.filterBlur!=i.filterBlur&&(void 0===a.filter&&(a.filter=""),a.filter+="blur("+e.filterBlur+"px)",a.filter&&(a.WebkitFilter=a.filter)),a},layoutGetBlendModeStyle:function(e,t,n,i){return{}}}},36683:(e,t,n)=>{"use strict";var i=n(40961),a=n.n(i),o=n(40927),r=n.n(o),s=n(74316),l=n(79378),c=n(34357),d=n(15734),p=n.n(d),u=n(17334),h=n.n(u),m=n(37321),f=n.n(m),v=n(73700),g=n(15032),w=n(13023),y=n(7299),b=n(15286),x=n.n(b),E=n(9769),S=new RegExp(/^[0-9A-Za-z]{22}$/i);const A=r().createClass({displayName:"AppInstanceSharePanel",getInitialState:function(){return{controlUrl:"app/"+window.singularAppInstance.id+"/control",shareAppUrl:"",shareApiUrl:"",shareToken:"",shareDialogOpen:!1,backDropClass:"",busy:!1,getBusy:!1,hideAppHeader:!1,layout:"responsive"}},shouldComponentUpdate:function(e,t){return!E.compareObject(e,this.props)||!E.compareObject(t,this.state)},getShareUrl:function(){window.singularUser.isAccessToken||(this.setState({getBusy:!0}),p().post("/apiv1/shareurls/url").send({url:"/"+this.state.controlUrl}).set("Content-Type","application/json").end(function(e,t){if(e)w.A.add(w.A.TYPE.ERROR,{title:"Control App share url read error",description:"Cannot read share url info of Control App "+window.singularAppInstance.id});else{if(t.headers.location)return void(window.location=t.headers.location);t.body.token&&(S.test(t.body.token)?this.buildShareUrls(t.body.token):this.setState({shareAppUrl:window.singularUrlBase+this.state.controlUrl+"?access_token="+t.body.token,shareApiUrl:"",shareToken:""}))}this.setState({getBusy:!1})}.bind(this)))},revokeToken:function(){window.singularUser.isAccessToken||(this.setState({busy:!0}),p().delete("/apiv1/shareurls").send({url:"/"+this.state.controlUrl}).set("Content-Type","application/json").end(function(e,t){if(e)w.A.add(w.A.TYPE.ERROR,{title:"Control App share url delete error",description:"Cannot delete share url info of Control App "+window.singularAppInstance.id});else{if(t.headers.location)return void(window.location=t.headers.location);this.buildShareUrls("")}this.setState({busy:!1})}.bind(this)))},generateToken:function(){window.singularUser.isAccessToken||(this.setState({busy:!0}),p().post("/apiv1/shareurls").send({url:"/"+this.state.controlUrl}).set("Content-Type","application/json").end(function(e,t){if(e)w.A.add(w.A.TYPE.ERROR,{title:"App Instance share url revoke error",description:"Cannot delete revoke url info of App Instance "+window.singularAppInstance.id});else{if(t.headers.location)return void(window.location=t.headers.location);this.buildShareUrls(t.body.token)}this.setState({busy:!1})}.bind(this)))},buildShareUrls:function(e){""==e?this.setState({shareAppUrl:"",shareApiUrl:"",shareToken:""}):this.setState({shareAppUrl:window.singularUrlBase+"control/"+e,shareApiUrl:window.singularUrlBase+"apiv2/controlapps/"+e+"/control",shareToken:e})},open:function(){""==this.state.shareAppUrl&&this.getShareUrl(),$("#appAccessModal").modal("show")},onCopyClipboard:function(e){this.props.onNotification&&this.props.onNotification(e+" copied to clipboard","success",5,"tc")},onHideAppHeaderChanged:function(e){this.setState({hideAppHeader:e.target.checked})},convertLayoutToName:function(e){switch(e){case"vertical":return"Vertical";case"horizontal":return"Horizontal";default:return"Responsive"}},onLayoutChanged:function(e){this.setState({layout:e})},render:function(){var e=!1;window.singularAppInstance&&window.singularAppInstance.apptemplate&&57==window.singularAppInstance.apptemplate.id&&(e=!0);var t,n,i,a,o,s=this.state.shareAppUrl;return s&&(this.state.hideAppHeader&&(s+="?noHeader=true"),"responsive"!==this.state.layout&&(this.state.hideAppHeader?s+="&uiLayout="+this.state.layout:s+="?uiLayout="+this.state.layout)),""!=s?(t=r().createElement(x(),{value:s}),n=r().createElement(y.A,{text:s,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"App URL")},r().createElement("i",{className:"fa fa-clipboard text-input-clipboard"}))):t=1==this.state.getBusy?r().createElement("img",{style:{height:"100%",padding:"40px"},src:"/images/loading-bubbles-blue.svg"}):r().createElement("div",{style:{fontSize:"90px",color:"#CCC",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},r().createElement("i",{className:"fa fa-share-alt","aria-hidden":"true"})),""!=this.state.shareApiUrl&&(i=r().createElement(y.A,{text:this.state.shareApiUrl,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,"API URL")},r().createElement("i",{className:"fa fa-clipboard text-input-clipboard"}))),""!=this.state.shareToken&&(a=r().createElement(y.A,{text:this.state.shareToken,onCopy:this.onCopyClipboard.bind(this,"Share token")},r().createElement("i",{className:"fa fa-clipboard text-input-clipboard"}))),o=this.state.busy?r().createElement("div",{style:{textAlign:"center"}},r().createElement("img",{style:{height:"73px",padding:"15px"},src:"/images/loading-bubbles-blue.svg",className:"loader"})):r().createElement("div",{style:{textAlign:"center"}},r().createElement("button",{className:"btn btn-secondary",onClick:this.generateToken},"Generate Token")),r().createElement("div",{id:"appAccessModal",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog"},r().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"80%",maxWidth:"1000px",minWidth:"600px"}},r().createElement("div",{className:"modal-content"},r().createElement("div",{className:"modal-header"},r().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},r().createElement("span",{"aria-hidden":"true"},r().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),r().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Manage Access")),r().createElement("div",{className:"modal-body"},r().createElement("div",{style:{textAlign:"center",height:"140px"}},t),r().createElement("div",null,r().createElement("div",{style:{display:"flex",width:"100%",marginBottom:"20px"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"75px",padding:"10px 0px"}},"App URL"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 75px)"}},r().createElement("div",{className:"form-control align-left text-input grouped",style:{height:"33px",marginBottom:"2px"}},r().createElement("span",{style:{width:"calc(100% - 33px)",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",whiteSpace:"nowrap"}},s||"Click Generate below to create a URL"),n),r().createElement("div",{id:"appSharePanelBody",style:{height:"auto"}},r().createElement("div",{className:"composition-settings-table",style:{display:"flex",alignItems:"center"}},r().createElement("div",{style:{color:"rgb(51, 51, 51)",paddingRight:"10px"}},"Hide App Header"),r().createElement("label",{className:"switch",style:{margin:"5px 0px"}},r().createElement("input",{className:"switch-input",style:{visibility:"inherit"},type:"checkbox",checked:this.state.hideAppHeader,onChange:this.onHideAppHeaderChanged}),r().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),r().createElement("span",{className:"switch-handle"})),e&&r().createElement("div",{style:{color:"rgb(51, 51, 51)",paddingLeft:"20px",paddingRight:"10px"}},"App UI Layout"),e&&r().createElement("div",{className:"btn-group"},r().createElement("button",{type:"button",tabIndex:"-1",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",style:{width:"170px"}},this.convertLayoutToName(this.state.layout)),r().createElement("ul",{className:"dropdown-menu"},["responsive","vertical","horizontal"].map(function(e,t){return r().createElement("li",{key:t},r().createElement("a",{onClick:this.onLayoutChanged.bind(this,e)},this.convertLayoutToName(e)))}.bind(this)))))),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"This URL gives access to the control app user interface, typically for operators or third party applications"))),r().createElement("div",{style:{display:"flex",width:"100%",marginBottom:"20px"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"75px",padding:"10px 0px"}},"API URL"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 75px)"}},r().createElement("div",{className:"form-control align-left text-input grouped",style:{height:"33px",marginBottom:"2px"}},r().createElement("span",{style:{width:"calc(100% - 33px)",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",whiteSpace:"nowrap"}},this.state.shareApiUrl),i),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"This URL gives access to the control app REST API"))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"75px",padding:"10px 0px"}},"App Token"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 75px)"}},r().createElement("div",{className:"form-control align-left text-input grouped",style:{height:"33px",marginBottom:"2px"}},r().createElement("span",{style:{width:"calc(100% - 33px)",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",whiteSpace:"nowrap"}},this.state.shareToken),a),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"The control app token can be used by Graphics SDK and Overlay SDK")))),o,r().createElement("div",{style:{color:"#888",fontSize:"12px",textAlign:"center"}},r().createElement("i",{className:"fa fa-exclamation-triangle"})," Generating an access token provides access to the control app to anyone who has the link, no login required")))))}});var I=n(95093),N=n.n(I),C=n(87195),O=n.n(C),k=n(58776),T=n.n(k);const _=r().createClass({displayName:"AppInstanceVersionPanel",getInitialState:function(){return this.appInstanceID=window.singularAppInstance.id,this.appTemplateID=window.singularAppInstance.apptemplate.id,this.appTemplateVersion=window.singularAppInstance.apptemplate.version,this.appTemplateStatus=null,this.appTemplateVersions=[],{showBusyIcon:!1,currentVersionchangeDate:null,isVersionUpToDate:!1,isDeveloperVersion:!1,debugDataTraffic:!1}},componentWillMount:function(){},componentWillReceiveProps:function(e){},getVersion:function(){window.singularUser.isAccessToken||0==this.appTemplateVersions.length&&(this.setState({showBusyIcon:!0,isVersionUpToDate:!1,isDeveloperVersion:!1,currentVersionchangeDate:null}),this.widgetVersionGetHandler=p().get("/apptemplates/"+this.appTemplateID+"/versions?access_token="+window.singularAccessToken).set("Content-Type","application/json").end(function(e,t){var n=[];if(e);else{if(t.headers.location)return void(window.location=t.headers.location);n=t.body}n.sort(function(e,t){return e.version<t.version?1:e.version>t.version?-1:0}),this.appTemplateVersions=n,this.initializeEditor(),this.setState({showBusyIcon:!1})}.bind(this)))},initializeEditor:function(){for(var e=this.appTemplateVersions,t=!1,n=!1,i=null,a=0,o=e.length;a<o;a++)e[a].version==this.appTemplateVersion&&(i=e[a].updated_at,this.appTemplateStatus=e[a].status,"published"==e[a].status&&(t=!0),"development"==e[a].status&&(n=!0));this.setState({currentVersionchangeDate:i,isVersionUpToDate:t,isDeveloperVersion:n})},generateVersionSelection:function(){var e=this.appTemplateVersions;if(e){for(var t=[],n=0,i=e.length;n<i;n++)"deprecated"!=e[n].status&&t.push({id:e[n].version,title:e[n].status});return{value:this.props.appInstance.version,selection:t}}},changeVersionOfAppTemplate:function(e){p().put("/apiv1/appinstances/"+this.appInstanceID+"/apptemplateversion").send({version:e}).end(function(e,t){if(e);else{if(t.headers.location)return void(window.location=t.headers.location);window.location.reload()}}.bind(this))},upgradeToPublishedVersion:function(){for(var e=0,t=this.appTemplateVersions.length;e<t;e++)if("published"==this.appTemplateVersions[e].status){this.changeVersionOfAppTemplate(this.appTemplateVersions[e].version);break}},render:function(){var e=this,t=this.props.appInstance;if(t){window.singularUser.account.permission.permDevTool&&window.singularAppInstance.apptemplate.id;var n,i,a,o,s=r().createElement("span",null," ",window.singularAppInstance.apptemplate.name);n=t.datastore?"Datastore":"Firebase",1==this.state.isDeveloperVersion||this.state.isVersionUpToDate;var l=this.appTemplateVersion;if(this.appTemplateStatus&&(l+=" ( "+this.appTemplateStatus+" )"),0!=this.state.isVersionUpToDate||this.state.isDeveloperVersion||(a=r().createElement(O(),{placement:"top",delayShow:500,overlay:r().createElement(T(),{id:"upgrade-widget-tooltip"},"Upgrade app to latest version")},r().createElement("button",{tabIndex:"-1",className:"btn btn-white v2",style:{minWidth:"auto",width:"35px",height:"28px",margin:"0px 0px 0px 5px"},onClick:this.upgradeToPublishedVersion},r().createElement("i",{className:"fa fa-upload",style:{top:"auto",left:"auto"}})))),window.singularUser.account.permission.permDevTool)if(this.state.isDeveloperVersion&&(o="Unknown",this.state.currentVersionchangeDate&&(o=N()(this.state.currentVersionchangeDate).fromNow())),1==this.state.showBusyIcon)i=r().createElement("img",{style:{height:"28px"},src:"/images/loading-bubbles-blue.svg"});else{var c=this.generateVersionSelection();if(c&&c.selection.length){var d=function(e){return r().createElement("li",{key:e.id},r().createElement("a",{onClick:this.changeVersionOfAppTemplate.bind(this,e.id)},e.id," - ",e.title))}.bind(this);i=r().createElement("div",{style:{display:"flex",position:"relative"}},r().createElement("div",{className:"dropup dropdown-white",style:{display:"inline-block"}},r().createElement("button",{tabIndex:"-1",className:"btn btn-white dropdown-toggle v2",style:{minWidth:"auto",height:"28px",margin:"0px"},type:"button",id:"dropdownMenuVersion","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"true"},l),r().createElement("ul",{className:"dropdown-menu",style:{left:"auto",right:"-3px",maxHeight:"180px"}},c.selection.map(d))),a)}else i="not available"}return r().createElement("div",{className:"flex-table",style:{color:"#222"}},r().createElement("div",{className:"flex-table-row"},r().createElement("div",null,"Control App"),r().createElement("div",null,s)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",null,"Control App ID"),r().createElement("div",null,window.singularAppInstance.apptemplate.id)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",null,"Last Modified"),r().createElement("div",null,o)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",null,"Current Version"),r().createElement("div",null,l)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",{style:{position:"relative",top:"3px"}},"Change Version"),r().createElement("div",null,i)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",null,"Storage"),r().createElement("div",null,n)),r().createElement("div",{className:"flex-table-row"},r().createElement("div",{style:{position:"relative",top:"5px"}},"Log to console"),r().createElement("div",null,r().createElement("label",{className:"switch",style:{marginBottom:"5px"}},r().createElement("input",{className:"switch-input",style:{visibility:"inherit"},type:"checkbox",checked:window.singularAppLogDatabaseOperations||!1,onChange:function(t){window.singularAppLogDatabaseOperations=t.target.checked,e.setState({debugDataTraffic:t.target.checked}),console.log("Log to console: ",t.target.checked)}}),r().createElement("span",{className:"switch-label","data-on":"ON","data-off":"OFF"}),r().createElement("span",{className:"switch-handle"})))))}}});var D=n(9769);const U=r().createClass({displayName:"AppInstanceDeveloperPanel",getInitialState:function(){return{}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!D.compareObject(e,this.props)||!D.compareObject(t,this.state)},open:function(){this.refs.appInstanceVersionPanel&&this.refs.appInstanceVersionPanel.getVersion(),$("#AppInstanceDeveloperPanel").modal("show")},render:function(){return r().createElement("div",{id:"AppInstanceDeveloperPanel",className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog"},r().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"80%",maxWidth:"1000px",minWidth:"600px"}},r().createElement("div",{className:"modal-content"},r().createElement("div",{className:"modal-header"},r().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},r().createElement("span",{"aria-hidden":"true"},r().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),r().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Developer Tools")),r().createElement("div",{className:"modal-body"},r().createElement(_,{appInstance:this.props.appInstance,ref:"appInstanceVersionPanel"})))))}});var R=n(89126),P=n(3757),B=n(92171),L=n(79806);function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}var j=n(9769),V=n(87567),M=n(804).Tabs,W=n(804).Tab,z="https://preview.singular.live/";const G=r().createClass({displayName:"AppInstancePreviewConfig",getInitialState:function(){return{dialogOpen:!1,format:"none",deviceID:"",videoclipUrl:"",pictureUrl:"",red5Host:"red5.dev.realitychecksystems.com",red5Name:"",red5Port:"443",red5App:"live",mutePreviewAudio:!1,localVideoInput:[],localAudioInput:[],currentVideoInput:null,currentAudioInput:null,devicePermissionDummy:null,assetList:null,assetListBusy:!0,adaptationGlobals:V.DEFAULT_GLOBALS,uiSettings:{editorResolutionWidth:1920,editorResolutionHeight:1080,editorResolution:1}}},componentWillMount:function(){var e=null;try{e=JSON.parse(localStorage.getItem("PreviewSettings"))}catch(e){}if(!e)return this.fetchLocalDevices(),void this.fetchPreviewAssetList();"default"==e.format&&(e.format="none"),this.setState({currentVideoInput:e.videoInput,currentAudioInput:e.audioInput,format:e.format,deviceID:e.deviceID,videoclipUrl:e.videoclipUrl,pictureUrl:e.pictureUrl,red5Host:e.red5Host,red5Name:e.red5Name,red5Port:e.red5Port,red5App:e.red5App,mutePreviewAudio:e.mutePreviewAudio,uiSettings:{editorResolutionWidth:e.editorResolutionWidth,editorResolutionHeight:e.editorResolutionHeight,editorResolution:e.editorResolution}},this.fetchLocalDevices()),this.fetchPreviewAssetList()},componentDidMount:function(){this.refs.dialogWindow&&$(this.refs.dialogWindow).on("hide.bs.modal",function(){this.close()}.bind(this))},shouldComponentUpdate:function(e,t){return!j.compareObject(e,this.props)||!j.compareObject(t,this.state)},open:function(){this.fetchLocalDevices(),this.setState({dialogOpen:!0},function(){this.refs.dialogWindow&&$(this.refs.dialogWindow).modal("show")}.bind(this))},close:function(){this.setState({dialogOpen:!1})},fetchPreviewAssetList:function(){this.setState({assetListBusy:!0}),p().get(z+"inventory.json").end(function(e,t){if(e)this.props.onNotification("Cannot read preview video and image inventory file","error",5,"tc");else{if(t.headers.location)return void(window.location=t.headers.location);var n;try{n=JSON.parse(t.text)}catch(e){}n&&n.video&&n.image&&this.setState({assetList:n,assetListBusy:!1})}this.setState({assetListBusy:!1})}.bind(this))},fetchLocalDevices:function(){this.setState({devicePermissionDummy:null}),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(function(e){for(var t=[],n=[],i=0;i<e.length;i++)"videoinput"==e[i].kind&&t.push(e[i]),"audioinput"==e[i].kind&&n.push(e[i]);if(!t[0]||t[0].label){t.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),n.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0});for(var a=null,o=0;o<t.length;o++)if(t[o].deviceId==this.state.currentVideoInput){a=this.state.currentVideoInput;break}!a&&t.length&&(a=t[0].deviceId);for(var r=null,s=0;s<n.length;s++)if(n[s].deviceId==this.state.currentAudioInput){r=this.state.currentAudioInput;break}!r&&n.length&&(r=n[0].deviceId),this.setState({localVideoInput:t,localAudioInput:n,currentVideoInput:a,currentAudioInput:r})}else this.setState({localVideoInput:[],localAudioInput:[],currentVideoInput:null,currentAudioInput:null,devicePermissionDummy:t[0].deviceId})}.bind(this)).catch(function(e){console.log("Error while fetching local media devices: ",e)})},onPropertyChanged:function(e,t){var n={};n[e]=t.target.value,this.setState(n)},onMutePreviewAudio:function(e){this.setState({mutePreviewAudio:!this.state.mutePreviewAudio})},saveStateToStorage:function(){try{localStorage.setItem("PreviewSettings",JSON.stringify({videoInput:this.state.currentVideoInput,audioInput:this.state.currentAudioInput,format:this.state.format,deviceID:this.state.deviceID,videoclipUrl:this.state.videoclipUrl,pictureUrl:this.state.pictureUrl,red5Host:this.state.red5Host,red5Name:this.state.red5Name,red5Port:this.state.red5Port,red5App:this.state.red5App,mutePreviewAudio:this.state.mutePreviewAudio,editorResolutionWidth:this.state.uiSettings.editorResolutionWidth,editorResolutionHeight:this.state.uiSettings.editorResolutionHeight,editorResolution:this.state.uiSettings.editorResolution}))}catch(e){}},getVideoURL:function(){return"videoclip"===this.state.format?this.state.videoclipUrl:""},onOK:function(){this.saveStateToStorage(),window.SingularPreviewSettings={videoType:this.state.format,videoURL:this.getVideoURL(),pictureURL:this.state.pictureUrl,red5Host:this.state.red5Host,red5Name:this.state.red5Name,red5Port:this.state.red5Port,red5App:this.state.red5App,deviceVideo:this.state.currentVideoInput,deviceAudio:this.state.currentAudioInput,adaptationGlobals:this.state.adaptationGlobals,mutePreviewAudio:this.state.mutePreviewAudio,editorResolutionWidth:this.state.uiSettings.editorResolutionWidth,editorResolutionHeight:this.state.uiSettings.editorResolutionHeight}},onAdaptationGlobalsChanged:function(e){this.setState({adaptationGlobals:e})},onResolutionSelect:function(e){e||(e=0);var t=(0,B.H)(e);t.editorResolution=e,-1==e?(t.editorResolutionWidth=this.state.uiSettings.editorResolutionWidth?this.state.uiSettings.editorResolutionWidth:1920,t.editorResolutionHeight=this.state.uiSettings.editorResolutionHeight?this.state.uiSettings.editorResolutionHeight:1080):(t.editorResolutionWidth=t.width,t.editorResolutionHeight=t.height),this.setState({uiSettings:t})},onUISettings:function(e,t){var n=this;if("editorResolutionWidth"==e||"editorResolutionHeight"==e||void 0!==e.editorResolutionWidth||void 0!==e.editorResolutionHeight){this.UISettingsTimeoutHandler&&clearTimeout(this.UISettingsTimeoutHandler);var i=Object.assign({},this.state.uiSettings);"object"===H(e)?(void 0!==e.editorResolutionWidth&&(i.editorResolutionWidth=e.editorResolutionWidth),void 0!==e.editorResolutionHeight&&(i.editorResolutionHeight=e.editorResolutionHeight)):i[e]=t,this.setState({uiSettings:i}),this.UISettingsTimeoutHandler=setTimeout(function(){n.UISettingsTimeoutHandler=null,n.onResolutionSelect(n.state.uiSettings.editorResolution)},200)}},render:function(){var e,t="form-control align-left text-input",n="form-control align-left select-input",i=r().createElement("div",{style:{display:"flex",width:"100%",padding:"10px 0px"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"5px 0px"}},"Mute Audio"),r().createElement("label",{className:"switch"},r().createElement("input",{className:"switch-input",style:{visibility:"inherit"},type:"checkbox",checked:this.state.mutePreviewAudio,onChange:this.onMutePreviewAudio}),r().createElement("span",{className:"switch-label","data-on":"On","data-off":"Off"}),r().createElement("span",{className:"switch-handle"})));if("default"==this.state.format&&(e=r().createElement("div",null,i)),"red5"==this.state.format&&(e=r().createElement("div",null,r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Host"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("input",{className:t,type:"text",onChange:this.onPropertyChanged.bind(this,"red5Host"),value:this.state.red5Host})))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Name"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("input",{className:t,type:"text",onChange:this.onPropertyChanged.bind(this,"red5Name"),value:this.state.red5Name})))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Port"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("input",{className:t,type:"text",onChange:this.onPropertyChanged.bind(this,"red5Port"),value:this.state.red5Port})),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"App is set to live by default"))),i)),"picture"==this.state.format){var a=[];this.state.assetList&&(a=this.state.assetList.image),e=r().createElement("div",null,r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Presets"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("select",{className:n,value:this.state.pictureUrl,onChange:this.onPropertyChanged.bind(this,"pictureUrl")},r().createElement("option",{value:""},"Custom"),a.map(function(e,t){return r().createElement("option",{key:t,value:z+e.file},e.name)}))),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Select 'Custom' to provide your own image URL."))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Image URL"),r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",flex:"1"}},r().createElement("input",{className:t,type:"text",onChange:this.onPropertyChanged.bind(this,"pictureUrl"),value:this.state.pictureUrl}))))}if("videoclip"==this.state.format){var o=[];this.state.assetList&&(o=this.state.assetList.video),e=r().createElement("div",null,r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Presets"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("select",{className:n,value:this.state.videoclipUrl,onChange:this.onPropertyChanged.bind(this,"videoclipUrl")},r().createElement("option",{value:""},"Custom"),o.map(function(e,t){return r().createElement("option",{key:t,value:z+e.file},e.name)}))),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Select 'Custom' to provide your own URL."))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Video URL"),r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",flex:"1"}},r().createElement("input",{className:t,type:"text",onChange:this.onPropertyChanged.bind(this,"videoclipUrl"),value:this.state.videoclipUrl}))),i)}if("device"==this.state.format){var s,l;if(this.state.localVideoInput&&this.state.localVideoInput.length&&!this.state.devicePermissionDummy)s=r().createElement("select",{className:n,value:this.state.currentVideoInput,onChange:this.onPropertyChanged.bind(this,"currentVideoInput")},this.state.localVideoInput.map(function(e,t){return r().createElement("option",{key:t,value:e.deviceId},e.label)}));else{var c="No video input found";this.state.devicePermissionDummy&&(c="Cannot access Media Devices"),s=r().createElement("select",{className:n,value:"dummy",disabled:!0},r().createElement("option",{value:"dummy"},c))}l=this.state.localVideoInput&&this.state.localAudioInput.length?r().createElement("select",{className:n,value:this.state.currentAudioInput,onChange:this.onPropertyChanged.bind(this,"currentAudioInput")},this.state.localAudioInput.map(function(e,t){return r().createElement("option",{key:t,value:e.deviceId},e.label)})):r().createElement("select",{className:n,value:"dummy",disabled:!0},r().createElement("option",{value:"dummy"},"No audio input found")),e=r().createElement("div",null,r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Video Input"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},s),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Select your video media device"))),r().createElement("div",{style:{display:"flex",width:"100%"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Audio Input"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},l),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Select your audio media device"))),i)}var d,p,u=this.getVideoURL();1==this.state.dialogOpen&&("device"==this.state.format&&this.state.devicePermissionDummy&&(p=r().createElement("div",null,r().createElement("div",{style:{textAlign:"center"}},"No permission to access Media Devices.",r().createElement("div",null,"For more information click ",r().createElement("a",{target:"_blank",href:"https://support.google.com/chrome/answer/2693767"},"here"))),r().createElement("button",{className:"btn btn-secondary",style:{display:"block",margin:"15px auto"},onClick:this.fetchLocalDevices},"Try to connect"))),d=r().createElement(R.A,{videoType:this.state.format,videoURL:u,pictureURL:this.state.pictureUrl,red5Host:this.state.red5Host,red5Name:this.state.red5Name,red5Port:this.state.red5Port,red5App:this.state.red5App,deviceVideo:this.state.currentVideoInput,deviceAudio:this.state.currentAudioInput,devicePermissionDummy:this.state.devicePermissionDummy,muted:this.state.mutePreviewAudio,mode:"config",ref:"videoPreviewMain"}));var h=(0,B.H)(-1);return this.state.uiSettings&&void 0!==this.state.uiSettings.editorResolution&&(h=(0,B.H)(this.state.uiSettings.editorResolution),-1==this.state.uiSettings.editorResolution&&((h=(0,B.H)(-1)).width=this.state.uiSettings.editorResolutionWidth?this.state.uiSettings.editorResolutionWidth:1920,h.height=this.state.uiSettings.editorResolutionHeight?this.state.uiSettings.editorResolutionHeight:1080)),r().createElement("div",{className:"modal fade u-displaynone singular-modal singular-modal-white",tabIndex:"-1",role:"dialog",ref:"dialogWindow"},r().createElement("div",{className:"modal-dialog modal-lg",role:"document",style:{width:"80%",maxWidth:"1000px",minWidth:"600px"}},r().createElement("div",{className:"modal-content"},r().createElement("div",{className:"modal-header"},r().createElement("button",{tabIndex:"-1",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},r().createElement("span",{"aria-hidden":"true"},r().createElement("i",{style:{width:"20px",height:"20px",position:"relative"},className:"fa fa-times"}))),r().createElement("h4",{className:"modal-title",id:"myModalLabel"},"Preview Settings")),r().createElement("div",{className:"modal-body",style:{color:"rgb(51, 51, 51)",padding:"0px"}},r().createElement(M,{defaultActiveKey:1,id:"device-status-components"},r().createElement(W,{eventKey:1,title:"Output Background",ref:"outputBackgroundTab"},r().createElement("div",{className:"device-config",style:{height:"320px"}},r().createElement("div",{style:{display:"flex",width:"100%",marginBottom:"20px"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Media Type"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"align-left text-input grouped",style:{height:"38px",marginBottom:"2px"}},r().createElement("select",{className:n,value:this.state.format,onChange:this.onPropertyChanged.bind(this,"format")},r().createElement("option",{value:"none"},"None"),r().createElement("option",{value:"picture"},"Picture"),r().createElement("option",{value:"videoclip"},"Video Clip"),r().createElement("option",{value:"red5"},"Red5 WebRTC"),r().createElement("option",{value:"device"},"Media Device"))),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Please select the media type you want to use as background"))),e),r().createElement("div",{className:"device-config",style:{height:"230px",position:"relative",margin:"10px"}},p,d)),r().createElement(W,{eventKey:2,title:"Globals",ref:"globalsTab"},r().createElement("div",{style:{height:"570px"}},r().createElement(P.A,{adaptationGlobals:this.state.adaptationGlobals,onAdaptationGlobalsChanged:this.onAdaptationGlobalsChanged}))),r().createElement(W,{eventKey:3,title:"Resolution",ref:"resolutionTab"},r().createElement("div",{style:{height:"570px"}},r().createElement("div",{style:{display:"flex",width:"100%",marginBottom:"20px"}},r().createElement("div",{style:{color:"#333",whiteSpace:"nowrap",width:"150px",padding:"10px 0px"}},"Resolution"),r().createElement("div",{style:{flex:"1",width:"calc(100% - 150px)"}},r().createElement("div",{className:"onairPreviewToolbar"},r().createElement("div",{className:"tool"},r().createElement(L.A,{onResolutionSelect:this.onResolutionSelect,selectedRes:h,uiSettings:this.state.uiSettings,onUISettings:this.onUISettings}))),r().createElement("div",{style:{fontSize:"12px",color:"#9a9a9a"}},"Select the resolution of the preview window. This should match your output resolution for best results.")))))),r().createElement("div",{style:{textAlign:"center"},className:"modal-footer"},r().createElement("button",{className:"btn btn-primary","data-dismiss":"modal","aria-label":"Close",onClick:this.onOK},"OK"),r().createElement("button",{className:"btn btn-secondary","data-dismiss":"modal","aria-label":"Close"},"Cancel"))))))}});var X=n(53045),F=n(31018),Y=n.n(F),J=n(71906),K=n.n(J),Z=n(9769);const q=r().createClass({displayName:"WebOutputSelector",getInitialState:function(){return this.accountDevicesSubscribe=null,this.loadOutputsHandle=null,this.checkOutputAttachedHandle=null,this.attachDeviceHandle=null,{devices:[],loadDevicesBusy:!1,selectedDeviceID:null,confirmDetachOutput:!1,outputToDetach:null,deviceToBeAttached:null,deviceOnairUrl:null,deviceIsInUse:!1,deviceIsInUseMessage:"",checkIfOutputIsAttachedBusy:!1}},shouldComponentUpdate:function(e,t){return!Z.compareObject(e,this.props)||!Z.compareObject(t,this.state)},componentDidMount:function(){this.setState({loadDevicesBusy:!0}),this.loadOutputs()},componentWillUnmount:function(){this.loadOutputsHandle&&this.loadOutputsHandle.abort(),this.checkOutputAttachedHandle&&this.checkOutputAttachedHandle.abort(),this.attachDeviceHandle&&this.attachDeviceHandle.abort()},loadOutputs:function(){this.loadOutputsHandle&&this.loadOutputsHandle.abort(),this.setState({loadDevicesBusy:!0});var e="";""!=window.singularAccessToken&&(e="&access_token="+window.singularAccessToken),this.loadOutputsHandle=p().get("/apiv1/devices?type=2"+e).set("Content-Type","application/json").end(function(e,t){if(t.headers.location)window.location=t.headers.location;else{this.loadOutputsHandle=null;var n=[];if(e)console.log("error while reading output: "+e);else for(var i=0,a=t.body.length;i<a;i++){var o=t.body[i];2==o.type&&n.push(o)}this.setState({devices:n,loadDevicesBusy:!1,checkIfOutputIsAttachedBusy:!1});var r=n.find(function(e){if(e.appinstance_id==window.singularAppInstance.id)return e});r?this.setState({selectedDeviceID:r.id,deviceOnairUrl:r.onair_url}):this.setState({selectedDeviceID:null,deviceOnairUrl:null})}}.bind(this))},onSearchChange:function(e){this.setState({searchValue:e})},getFilteredAndSortedList:function(){var e=[],t=this.state.searchValue;return t=t?t.toUpperCase():"",this.state.devices&&this.state.devices.length>0&&this.state.devices.map(function(n,i){var a=n.name||"";""!=t&&-1==a.toUpperCase().indexOf(t)||e.push(n)}.bind(this)),e.sort(function(e,t){var n=e.name.toLowerCase(),i=t.name.toLowerCase();return n<i?-1:n>i?1:0}),e},onCheckOutputAttached:function(e){this.setState({checkIfOutputIsAttachedBusy:!0}),this.checkOutputAttachedHandle&&this.checkOutputAttachedHandle.abort(),this.checkOutputAttachedHandle=p().get("/apiv1/devices/"+e).query({access_token:window.singularAccessToken}).end(function(t,n){if(n.headers.location)window.location=n.headers.location;else if(this.loadOutputsHandle=null,t)this.setState({checkIfOutputIsAttachedBusy:!1});else{var i=n.body;i.appinstance_id?this.setState({deviceIsInUse:!0,deviceIsInUseMessage:"The selected device is attached to app ID "+i.appinstance_id+". Do you want to proceed and attach the device to this app?",deviceToBeAttached:e}):this.onExecuteAttachDevice(e)}}.bind(this))},onExecuteAttachDevice:function(e){this.attachDeviceHandle&&this.attachDeviceHandle.abort(),this.attachDeviceHandle=p().put(Z.appendAccessTokenUrl("/apiv1/devices/"+e+"/appinstance")).send({appinstance_id:window.singularAppInstance.id}).end(function(t,n){if(this.attachDeviceHandle=null,t)this.props.onNotification("Error while attaching to device","error",5,"tc"),this.setState({selectedDeviceID:null,deviceToBeAttached:null,checkIfOutputIsAttachedBusy:!1});else{if(n.headers.location)return void(window.location=n.headers.location);this.setState({selectedDeviceID:e,deviceToBeAttached:null,checkIfOutputIsAttachedBusy:!1})}}.bind(this))},onDetachAppExecute:function(){null!=this.state.selectedDeviceID&&(this.setState({loadDevicesBusy:!0}),p().delete(Z.appendAccessTokenUrl("/apiv1/devices/"+this.state.selectedDeviceID+"/appinstance")).set("Content-Type","application/json").end(function(e,t){t.headers.location?window.location=t.headers.location:e?(console.log("error while detaching app: "+e),this.setState({loadDevicesBusy:!1})):(this.setState({selectedDeviceID:null}),this.loadOutputs())}.bind(this)))},onSelectDevice:function(e){"detach"!=e?e!=this.state.selectedDeviceID&&this.onCheckOutputAttached(e):this.setState({confirmDetachOutput:!0})},onCopyClipboard:function(e){this.props.onNotification&&this.props.onNotification(e+" copied to clipboard","success",5,"tc")},render:function(){var e,t,n,i,a,o,s=this;window.singularUser.account.subscription.weboutput_limit;if(this.state.selectedDeviceID||(e=this.getFilteredAndSortedList().map(function(e,t){var n;return n=e.appinstance_id?r().createElement("i",{className:"fa fa-wifi",style:{position:"relative",top:"2px"}}):r().createElement("i",null),r().createElement("li",{key:"device-"+t},r().createElement("a",{onClick:this.onSelectDevice.bind(this,e.id)},r().createElement("div",null,n,r().createElement("span",{style:{width:"150px",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle"}},e.name))))}.bind(this))),this.state.loadDevicesBusy||this.state.checkIfOutputIsAttachedBusy)n=r().createElement("button",{className:"btn btn-white dropdown-toggle",tabIndex:"-1",style:{fontSize:"14px",width:"200px",padding:"0px",margin:"0px"}},r().createElement("img",{style:{height:"28px"},src:"/images/loading-bubbles-blue.svg",className:"loader"}));else{var l,c;if(this.state.selectedDeviceID){var d=this.state.devices.find(function(e){if(e.id==this.state.selectedDeviceID)return e}.bind(this));d?(l=d.name,c=r().createElement("li",{key:"detach"},r().createElement("a",{onClick:this.onSelectDevice.bind(this,"detach")},r().createElement("i",{style:{width:"20px",display:"inline-block"}}),"Detach Current Output"))):l="undefined"}else l="Select Output";n=r().createElement("button",{key:"button_dropdownWebOutputSelector",className:"btn btn-white dropdown-toggle","data-toggle":"dropdown",tabIndex:"-1",style:{paddingTop:"3.75px",paddingBottom:"3.75px"}},r().createElement("div",{style:{width:"calc(100% - 10px)",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},l)),t=r().createElement("ul",{key:"options_dropdownWebOutputSelector",className:"dropdown-menu dropdown-menu-right"},c,e)}return this.state.devices.length&&(i=r().createElement("div",{className:"dropdown dropdown-white"},n,t)),this.state.deviceOnairUrl?(o="Output URL",a=this.state.deviceOnairUrl):(o="App Output URL",a=this.props.appOutputUrl+"?aspect=16:9"),r().createElement("div",{className:"output-selection",style:{display:"flex",alignItems:"center"}},i,this.state.devices.length>0&&r().createElement("button",{tabIndex:"-1",onClick:this.loadOutputs,className:"tool-button",style:{marginRight:"10px",fontSize:"12px"}},r().createElement("i",{className:"fa fa-refresh fa-lg"})),r().createElement(y.A,{text:a,options:{format:"text/plain"},onCopy:this.onCopyClipboard.bind(this,o)},r().createElement("button",{className:"tool-button"},r().createElement("i",{className:"fa fa-clipboard"}))),r().createElement(K(),{show:this.state.deviceIsInUse,title:"",text:this.state.deviceIsInUseMessage,showCancelButton:!0,onConfirm:function(){s.setState({deviceIsInUse:!1}),s.onExecuteAttachDevice(s.state.deviceToBeAttached)},onCancel:function(){s.setState({deviceIsInUse:!1,checkIfOutputIsAttachedBusy:!1})},onEscapeKey:function(){s.setState({deviceIsInUse:!1,checkIfOutputIsAttachedBusy:!1})},onOutsideClick:function(){s.setState({deviceIsInUse:!1,checkIfOutputIsAttachedBusy:!1})}}),r().createElement(K(),{show:this.state.confirmDetachOutput,title:"",text:"Are you sure you want to detach the control app?",showCancelButton:!0,onConfirm:function(){s.setState({confirmDetachOutput:!1}),s.onDetachAppExecute()},onCancel:function(){s.setState({confirmDetachOutput:!1})},onEscapeKey:function(){s.setState({confirmDetachOutput:!1})},onOutsideClick:function(){s.setState({confirmDetachOutput:!1})}}))}});var Q=n(59833),ee=n.n(Q),te=n(16918),ne=n.n(te),ie=n(88534),ae=n.n(ie),oe=n(9769),re=n(73801),se=n(7259);const le=r().createClass({displayName:"AppInstanceControl",mixins:[Y()],getInitialState:function(){return this.mainAppSubscribe=null,this.compUpgradeHandle=null,this.accumulatedLogSize=0,this.triggerUpdateLastModify=h()(this.triggerAppLastModify,1e4),this.sendCommandLog=(0,v.n)(5e3,this._sendCommandLog,{noLeading:!0}),1==window.singularAppInstance.composition_managed_by_singular&&(this.currentCompTS=null,this.currentCompTSRef=null,this.currentCompExtractOfTheOutput=null,this.currentCompExtractRefId=null),{appLoading:!0,globalBusy:!0,appInstance:null,appOutput:null,selectedOutputType:null,selectedOutputStatus:null,controlAppGeneralError:"",controlAppRepair:"",requestedOutputMode:null,compChanged:!1,appChanged:!1,menuBusy:!1,compExtractId:"",signalStrength:0,payloadWrite:0,payloadTotal:0,storageWrite:0,storageTotal:0,showHeader:!0}},componentWillMount:function(){var e=this;if(window.singularAppInstance.noHeader&&this.setState({showHeader:!1}),window.SingularPreviewSettings={videoType:"default"},null!=this.mainAppSubscribe&&this.props.appRtdbRef.off("value",this.mainAppSubscribe),this.mainAppSubscribe=this.props.appRtdbRef.on("value",function(){e.triggerUpdateLastModify()}),this.props.appRtdbRef.child("outputs").on("value",function(t){e.refs.WebOutputSelector&&e.refs.WebOutputSelector.loadOutputs()}),1==window.singularAppInstance.composition_managed_by_singular){var t=function(t){e.checkCompTS(t.val())};this.props.appRtdbRef.child("outputs").on("value",function(n){var i=n.val(),a=i[Object.keys(i)[0]];null==e.currentCompExtractOfTheOutput||e.currentCompExtractOfTheOutput==a.compExtract?(e.currentCompExtractOfTheOutput=a.compExtract,null==a.compExtract||window.singularAccessToken||(e.props.appRtdbRef.child("compExtracts").child(a.compExtract).child("ts").once("value",function(t){e.currentCompTS=t.val()}),e.props.appRtdbRef.child("compExtracts").child(a.compExtract).child("refId").once("value",function(n){e.currentCompExtractRefId=n.val(),p().get("/apiv1/compositions/"+e.currentCompExtractRefId).send().end(function(n,i){if(n)e.currentCompTSRef=null;else if(e.currentCompTSRef&&e.currentCompTSRef.off("value",t),i.body.account_id==window.singularUser.account.accountId)if(null===i.body.datastore){var a=i.body.firebaseUrl;a=a.replace(/https:\/\/.*\.firebaseio.com/gm,"");var o=function(n){e.currentCompTSRef=e.rtdbRef.database.ref(a).child("ts"),e.currentCompTSRef.on("value",t)};null==e.rtdbRef?null==e.props.rtdbRef?s.A.connect(function(t,n){e.rtdbRef=n,o()}):(e.rtdbRef=e.props.rtdbRef,o()):o()}else e.currentCompTSRef=new(ne())(null),new(ae())(e.currentCompTSRef,i.body.datastore).then(function(n){e.currentCompTSRef.child("ts").on("value",t)});else e.currentCompTSRef=null})}))):window.location.reload()})}1==window.multipleDBs&&p().post("/multipledatabases/sync").send({path:window.singularStartupDb}).end()},shouldComponentUpdate:function(e,t){return!oe.compareObject(e,this.props)||!oe.compareObject(t,this.state)},componentDidMount:function(){var e=this;this.setState({globalBusy:!0}),window.addEventListener("message",function(t){t&&t.data&&(window.singularAppInstance.noHeader||"_singular_show_app_header"!=t.data.event||e.setState({showHeader:t.data.value}),"_singular_upgrade_composition"==t.data.event&&e.upgradeComposition(),"_singular_upgrade_app"==t.data.event&&e.upgradeApp(),"_singular_app_loaded"==t.data.event&&(e.sendMessageToApp("_singular_upgrade_app_ready",e.state.appChanged),e.sendMessageToApp("_singular_upgrade_composition_ready",e.state.compChanged)))});var t=a().findDOMNode(this.refs.iframeApp);t.onload=function(){var e=this,n=function(t){e.setState({controlAppGeneralError:"The app is broken and cannot be loaded. "})},i=function(i){ee().createSingularApp(function(i){try{t.contentWindow.singularAppInit&&t.contentWindow.singularAppInit(i);var a,o=i.listOutputs();if(o&&o.length&&(a=o[0]),null==i.getOutput(a.id).getComposition())throw"error";if(e.setState({globalBusy:!1,appInstance:i,appOutput:a?i.getOutput(a.id):null}),a&&a.id){var r=function(e){var t=e.val();t&&this.setState({attachedDevice:t.deviceId,attachedDeviceData:null,compExtractId:t.compExtract||null})}.bind(e);e.props.appRtdbRef.child("outputs").child(a.id).on("value",h()(r,200))}else e.setState({controlAppGeneralError:"This app doesn't have an output defined and cannot be loaded. "})}catch(e){n()}},e.log)};57==window.singularAppInstance.apptemplate.id?this.props.appRtdbRef.once("value",function(t){var a=t.val();if(!a.compExtracts&&a.storage&&a.storage.composition&&null!=a.storage.composition.refId){var o=oe.appendAccessTokenUrl("/apiv1/compositions/".concat(a.storage.composition.refId));fetch(o).then(function(t){404==t.status?n():e.setState({controlAppRepair:"The app is broken. Do you want to try to repair it?",repairCompId:a.storage.composition.refId})}).catch(function(e){n()})}else i()}):i()}.bind(this),window.commandLog=function(t,n){e.accumulatedLogSize+=t,e.sendCommandLog()},window.firebaseWriteTime=function(t,n,i){i&&console.warn("Singular Control App SDK: Real Time Database Timeout while writing ",n),t&&(e.setState({signalStrength:parseInt(t)}),e.sendMessageToApp("_singular_database_stats",{time:t,tag:n,timeout:i}),window.singularAppLogDatabaseOperations&&console.log("Database write: "+t+"ms ",n,i))},window.reportPayloadWrite=function(t,n){e.setState({payloadWrite:t,payloadTotal:n}),e.sendMessageToApp("_singular_payload_stats",{payloadWrite:t,payloadTotal:n}),window.singularAppLogDatabaseOperations&&console.log("Payload write: "+t+" / "+n)},window.reportStorageWrite=function(t,n){e.setState({storageWrite:t,storageTotal:n}),e.sendMessageToApp("_singular_storage_stats",{storageWrite:t,storageTotal:n}),window.singularAppLogDatabaseOperations&&console.log("Storage write: "+t+" / "+n)},window.singularAppInstance.apptemplate&&"published"!=window.singularAppInstance.apptemplate.status&&"development"!=window.singularAppInstance.apptemplate.status&&(this.setState({appChanged:!0}),this.sendMessageToApp("_singular_upgrade_app_ready",!0))},_sendCommandLog:function(){var e="";window.singularAccessToken&&(e="?access_token="+window.singularAccessToken),p().post("/apiv1/appinstances/"+window.singularAppInstance.id+"/logger"+e).send({size:this.accumulatedLogSize}).end(),this.accumulatedLogSize=0},triggerAppLastModify:function(){var e=this,t="";window.singularAccessToken&&(t="?access_token="+window.singularAccessToken),p().put("/apiv1/appinstances/"+window.singularAppInstance.id+"/metadata"+t).send().end(function(t,n){t&&e.onNotification("Failed to update app metadata","error",5,"tc")})},sendMessageToApp:function(e,t){var n=a().findDOMNode(this.refs.iframeApp);n&&n.contentWindow&&n.contentWindow.postMessage&&n.contentWindow.postMessage({event:e,value:t},"*")},checkCompTS:function(e){this.currentCompTS!=e?(this.currentCompTS=e,this.setState({compChanged:!0}),this.sendMessageToApp("_singular_upgrade_composition_ready",!0)):(this.setState({compChanged:!1,menuBusy:!1,globalBusy:!1}),this.sendMessageToApp("_singular_upgrade_composition_ready",!1))},activateGlobalBusy:function(e){this.setState({globalBusy:e})},onSupport:function(){zE.identify({name:window.singularUser.name,email:window.singularUser.email}),zE.activate({hideOnClose:!0})},onIframeLoadCompleted:function(){this.setState({appLoading:!1})},openAnalytics:function(){window.open(window.location.href.replace("/control","/analytics"))},openDeveloperTools:function(){this.refs.AppInstanceDeveloperPanel&&this.refs.AppInstanceDeveloperPanel.open()},openAppInstanceSharePanel:function(){this.refs.AppInstanceSharePanel&&this.refs.AppInstanceSharePanel.open()},openAppInstancePreviewConfig:function(){this.refs.AppInstancePreviewConfig&&this.refs.AppInstancePreviewConfig.open()},openShareOutputPanel:function(e){this.refs.ShareOutputPanel&&this.refs.ShareOutputPanel.open(e)},fetchDeviceData:function(e){p().get(oe.appendAccessTokenUrl("/apiv1/devices/"+e)).send().end(function(e,t){e||this.setState({attachedDeviceData:t.body})}.bind(this))},upgradeApp:function(){this.setState({globalBusy:!0}),p().put("/apiv1/appinstances/"+window.singularAppInstance.id+"/apptemplateversion").send({version:"published"}).end(function(e,t){if(e);else{if(t.headers.location)return void(window.location=t.headers.location);window.location.reload()}}.bind(this))},upgradeComposition:function(){var e=this;this.compUpgradeHandle&&this.compUpgradeHandle.abort(),this.setState({menuBusy:!0,compChanged:!1,globalBusy:!0}),this.compUpgradeHandle=p().put("/apiv1/appinstances/"+window.singularAppInstance.id+"/composition").send({refId:this.currentCompExtractRefId,keepPayload:!0}).end(function(t,n){if(e.compUpgradeHandle=null,t)window.location.reload();else{if(n.headers.location)return void(window.location=n.headers.location);e.currentCompExtractOfTheOutput=null,window.location.reload()}})},editComposition:function(){var e=this;this.setState({menuBusy:!0}),re.editComposition(window.singularAppInstance.id,window.singularAppInstance.name,function(t,n){e.setState({menuBusy:!1}),t?e.onNotification(t,"error",5,"tc"):window.open("/compositions/"+n.compId+"/edit")})},onNotification:function(e,t,n,i){this.refs&&this.refs.notificationSystem&&this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:n,position:i})},render:function(){var e,t,n,i,a,o,s,l,c,d,p,u,h,m=this,v=window.singularAppInstance.apptemplate,w="/apptemplates/"+v.id+"/serve/"+v.version+"/app.html?";window.singularAppInstance.theme&&("light"==window.singularAppInstance.theme?w+="theme=grabyo&":w+="theme="+window.singularAppInstance.theme+"&"),window.singularAppInstance.uiLayout&&(w+="layout="+window.singularAppInstance.uiLayout),1!=window.singularUser.account.permission.permDevTool||window.singularUser.isAccessToken||(e=r().createElement(U,{activateGlobalBusy:this.activateGlobalBusy,appInstance:window.singularAppInstance,ref:"AppInstanceDeveloperPanel"}),t=r().createElement("li",{onClick:this.openDeveloperTools},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-bug"}))," ","Developer Tools")))),this.state.appOutput&&(n=this.state.appOutput.getUrl(),window.singularAppInstance.fid&&(i=se.encode(window.singularAppInstance.fid),n=window.singularUrlBase+"output/"+i+"/"+this.state.appOutput.name)),(window.singularUser.isImpersonated||0==window.singularUser.account.accountId||"enterprise"==window.singularUser.account.subscription.subscription_plan&&!window.singularUser.isAccessToken)&&(a=r().createElement("li",{onClick:this.openAnalytics},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-line-chart"}))," ","Analytics")))),window.singularUser.isAccessToken||(o=r().createElement(A,{ref:"AppInstanceSharePanel",onNotification:this.onNotification}),s=r().createElement("li",{onClick:this.openAppInstanceSharePanel},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-share-alt"}))," ","Manage Access")))),this.state.appChanged&&(l=r().createElement("li",{onClick:this.upgradeApp},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-notification-bubble inline"},r().createElement("i",{className:"fa fa-exclamation"}))," ","Update App")))),this.state.compChanged&&(c=r().createElement("li",{onClick:this.upgradeComposition},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-notification-bubble inline"},r().createElement("i",{className:"fa fa-exclamation"}))," ","Update Composition")))),1!=window.singularAppInstance.composition_managed_by_singular||window.singularUser.isAccessToken||(d=r().createElement("li",{onClick:this.editComposition},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-edit"}))," ","Edit Composition")))),p=0==this.state.menuBusy?r().createElement("button",{className:"tool-button",tabIndex:"-1","data-toggle":"dropdown"},r().createElement("i",{className:"fa fa-ellipsis-v"})):r().createElement("button",{className:"tool-button",tabIndex:"-1"},r().createElement("img",{style:{width:"20px",height:"100%"},src:"/images/loading-bubbles.svg",className:"loader"})),(d||l||c)&&(u=r().createElement("li",{className:"separator"})),window.singularUser.account&&"singular"==window.singularUser.account.brand&&(h=r().createElement("button",{className:"tool-button",tabIndex:"-1",onClick:this.onSupport},r().createElement("i",{className:"fa fa-life-ring"})));var y,b,x,E=r().createElement("div",{style:{display:"flex",height:"100%",alignItems:"center"}},r().createElement(q,{ref:"WebOutputSelector",appOutputUrl:n,onNotification:this.onNotification}),h,r().createElement("div",{className:"btn-group"},r().createElement("div",{className:"btn-group dropdown-white main-menu",role:"group"},void 0,p,r().createElement("ul",{className:"dropdown-menu dropdown-menu-right",style:{overflow:"hidden",top:"32px",width:"160px"}},r().createElement("li",{onClick:this.openShareOutputPanel.bind(this,"url")},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-link"}))," ","Output URL"))),r().createElement("li",{onClick:this.openShareOutputPanel.bind(this,"embed")},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-code"}))," ","Embed Code"))),s,r().createElement("li",{className:"separator"}),d,l,c,u,r().createElement("li",{onClick:this.openAppInstancePreviewConfig},r().createElement("a",null,r().createElement("div",{className:"menu-item-wrapper"},r().createElement("div",{className:"menu-item-icon"},r().createElement("i",{className:"fa fa-eye"}))," ","Preview Settings"))),t,a,void 0))),o,e,r().createElement(G,{ref:"AppInstancePreviewConfig"}),r().createElement(X.A,{url:n,token:i,ref:"ShareOutputPanel",onNotification:this.onNotification})),S="/";window.singularUser&&window.singularUser.isAccessToken&&window.singularUser.account&&7519==window.singularUser.account.accountId&&(S="https://singular.live",y=r().createElement("button",{onClick:function(){return window.open("https://app.singular.live/users/signup","_blank")},style:{background:"#2DC3F7",color:"#ffffff",fontSize:"16px",padding:"2px 10px",border:"1px",cursor:"pointer",margin:"0px 10px"},tabIndex:"-1"},"Signup")),b=!this.state.signalStrength||this.state.signalStrength<0?"#b6b6b6":this.state.signalStrength<700?"#00b300":this.state.signalStrength<1800?"#f7892e":"#c03636",x=this.state.signalStrength<0?"Network latency will not be measured":this.state.signalStrength?"Network latency "+oe.numberWithCommas(this.state.signalStrength)+" milliseconds":"Network latency not measured yet";var I,N,C=0;return this.state.showHeader&&0==this.state.appLoading&&(I=r().createElement("header",{className:"header",style:{display:"flex",alignItems:"center",padding:"0px",height:"40px",border:"0px"}},r().createElement("a",{href:S,tabIndex:"-1",style:{marginLeft:"10px"}},r().createElement("span",{className:"logo"})),y,r().createElement(O(),{placement:"bottom",delayShow:500,overlay:r().createElement(T(),{id:"signalStrength"},x)},r().createElement("div",{style:{padding:"0px 10px",color:b}},r().createElement("i",{className:"fa fa-signal"}))),function(){var e="Playload write / total   "+oe.humanFileSize(m.state.payloadWrite)+"  /  "+oe.humanFileSize(m.state.payloadTotal)+"\nStorage write / total   "+oe.humanFileSize(m.state.storageWrite)+"  /  "+oe.humanFileSize(m.state.storageTotal);m.state.payloadWrite||m.state.storageWrite||m.state.payloadTotal||m.state.storageTotal||(e="No data written yet");var t,n=Math.round((m.state.payloadTotal+m.state.storageTotal)/4194304*1e3)/10;return t=n<50?"gauge-ok":n<75?"gauge-warning":"gauge-error",r().createElement(O(),{placement:"right",overlay:r().createElement(T(),{id:"storage-size-info"},e)},r().createElement("div",{className:"storage-size"},r().createElement("div",{className:"storage-size-gauge "+t,style:{width:n+"%"}}),r().createElement("div",{className:"storage-size-label"},n.toFixed(1)+"%")))}(),r().createElement("div",{style:{padding:"0px 10px",fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre"}},window.singularAppInstance.name),r().createElement("div",{style:{flexGrow:"1"}},r().createElement(g.A,null)),r().createElement("div",{className:"app-header-tools"},E)),C=40),1!=this.state.globalBusy&&1!=this.state.appLoading||(N=r().createElement("div",{style:{width:"100%",height:"100%",backgroundColor:"#333",zIndex:"2",position:"absolute"}},r().createElement("img",{style:{position:"absolute",margin:"auto",top:"0",left:"0",bottom:"0",right:"0"},src:"/images/loading-bubbles-blue.svg",className:"loader"}))),r().createElement("div",{id:"app-instance",className:"height-100p",style:{overflow:"hidden"}},N,r().createElement(f(),{ref:"notificationSystem",style:!1}),I,r().createElement("div",{style:{width:"100%",height:"calc(100% - "+C+"px)"}},r().createElement("iframe",{title:"Control App Instance",ref:"iframeApp",src:w,style:{border:"0px",overflow:"hidden",left:"0px",top:"0px",width:"0px",height:"0px",maxWidth:"100%",maxHeight:"100%",minWidth:"100%",minHeight:"100%"},allowFullScreen:!0,onLoad:function(e){setTimeout(function(){m.onIframeLoadCompleted()},1e3)}})),r().createElement(K(),{show:""!==this.state.controlAppGeneralError,title:"",text:this.state.controlAppGeneralError,onConfirm:function(){window.location.href="/dashboard"},onCancel:function(){window.location.href="/dashboard"},onEscapeKey:function(){window.location.href="/dashboard"},onOutsideClick:function(){window.location.href="/dashboard"}}),r().createElement(K(),{show:""!==this.state.controlAppRepair,title:"",text:this.state.controlAppRepair,showCancelButton:!0,confirmButtonText:"Try to repair",cancelButtonText:"Cancel",onConfirm:function(){fetch(oe.appendAccessTokenUrl("/apiv1/appinstances/".concat(window.singularAppInstance.id,"/composition")),{method:"PUT",body:JSON.stringify({refId:m.state.repairCompId}),headers:{"Content-Type":"application/json"}}).then(function(e){window.location.reload()})},onCancel:function(){window.location.href="/dashboard"},onEscapeKey:function(){window.location.href="/dashboard"},onOutsideClick:function(){window.location.href="/dashboard"}}))}});var ce=n(86479),de=n(9769);const pe=r().createClass({displayName:"AppInstanceAnalytics",mixins:[Y()],getInitialState:function(){return{globalBusy:!0,appInstance:null,appOutput:null}},componentWillMount:function(){},shouldComponentUpdate:function(e,t){return!de.compareObject(e,this.props)||!de.compareObject(t,this.state)},componentDidMount:function(){},onNotification:function(e,t,n,i){this.refs.notificationSystem.addNotification({message:e,level:t,autoDismiss:n,position:i})},render:function(){return r().createElement("div",{id:"app-instance",className:"height-100p singular-browser-content",style:{overflow:"hidden",left:"0px",width:"100%"}},r().createElement(f(),{ref:"notificationSystem",style:!1}),r().createElement("header",{className:"header",style:{display:"flex",alignItems:"center",padding:"0px",height:"40px",border:"0px"}},r().createElement("a",{href:"/",tabIndex:"-1",style:{marginLeft:"10px"}},r().createElement("span",{className:"logo"})),r().createElement("div",{style:{padding:"0px 10px",fontSize:"16px"}},window.singularAppInstance.name)),r().createElement("div",{className:"portal-content",style:{width:"100%",height:"calc(100% - 40px)",borderTop:"solid 1px #00000033",background:"var(--main-bg-color)",paddingLeft:"10px"}},r().createElement(ce.A,{mode:"app",appId:String(window.appInstance),onNotification:this.onNotification})))}});var ue=n(24510);const he=r().createClass({displayName:"DataStoreOnlineStatus",getInitialState:function(){return this.intervalHandle=null,this.offlineTimer=1,{message:null,initializing:!0}},componentDidMount:function(){this.setStatus(!0)},setStatus:function(e){var t=this;e?(this.offlineTimer=1,this.setState({message:null,initializing:!1}),this.intervalHandle&&(clearInterval(this.intervalHandle),this.intervalHandle=null)):this.state.initializing||(this.intervalHandle=setInterval(function(){t.setState({message:"Lost connection. Trying to reconnect ... "+t.offlineTimer+" s"}),t.offlineTimer++},1e3))},render:function(){return null===this.state.message?null:r().createElement("div",{className:"conntecting-status"},r().createElement("div",{className:"connecting-status-wrapper"},r().createElement("div",{className:"connecting-status-content"},r().createElement("div",{className:"message"},this.state.message))))}});var me=n(56574),fe=n.n(me);function ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o,r,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(c)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ge(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ge(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}var we=document.createElement("div");we.id="amOnline",document.body.appendChild(we);var ye=document.getElementById("appInstanceControl");if(ye){try{singularanalytics.event(analyticEventType.CTRL_APP_OPENED,window.singularAppInstance.account_id,"UI",window.location.hostname,{element_id:window.singularAppInstance.id,user_id:window.singularUser.id,metadata:singularanalytics.getUIMetadata(analyticEventType.CTRL_APP_OPENED,{plan:window.singularUser.account.subscription.subscription_plan,appTemplateId:window.singularAppInstance.apptemplate.id,brand:window.singularUser.account.brand})})}catch(e){console.error(e)}var be=window.singularAppInstance.datastore;if(be){var xe;a().render(r().createElement(he,{ref:function(e){xe=e}}),we);var Ee=new(ne())(null);Ee._emptyNodeNull(),new(ae())(Ee,be,window.singularAppInstance.token).then(function(e){var t=e.update,n=e.setStatusCallback;window.singularAppControlData=Ee.val(),window.singularDataStore=be,window.singularDataStoreUpdate=t,window.singularDataStoreSBRef=Ee;var i=function(e){a().render(r().createElement(le,{rtdbRef:null,appRtdbRef:Ee}),ye)},o=[],s=[];if(0==window.singularAppInstance.composition_managed_by_singular){for(var l=0,c=Object.entries(window.singularAppControlData.outputs);l<c.length;l++){var d=ve(c[l],2),p=(d[0],d[1]);p.compExtract&&o.push(p.compExtract)}if(o.length>0&&window.singularAppControlData.compExtracts&&Object.keys(window.singularAppControlData.compExtracts).length>1)for(var u=0,h=Object.entries(window.singularAppControlData.compExtracts);u<h.length;u++){var m=ve(h[u],2),f=m[0];m[1],-1==o.indexOf(f)&&window.singularAppControlData.storage&&!JSON.stringify(window.singularAppControlData.storage).includes(f)&&s.push(f)}s.length>0?fe().uploadCompositionJSON(JSON.stringify(window.singularAppControlData),"app-".concat(window.singularAppInstance.id,"-").concat(Date.now()),"bak",function(e){var n={};s.forEach(function(e){delete window.singularAppControlData.compExtracts[e],Ee.child("compExtracts").child(e).remove(),n["compExtracts.".concat(e)]=null}),Object.keys(n).length>0&&t(n),i()}):i()}else i();n(function(e){"connect"==e?xe.setStatus(!0):"disconnect"==e&&xe.setStatus(!1)})}),window.singularUser.isAccessToken||s.A.connect(function(e,t){if(t){var n=document.createElement("div");n.id="__logout__",document.body.appendChild(n),a().render(r().createElement(ue.A,null),n)}else a().render(r().createElement(c.A,null),we)})}else s.A.connect(function(e,t){if(t){if(a().render(r().createElement(l.A,null),we),t.once("value",function(e){var n=function(e){a().render(r().createElement(le,{rtdbRef:t,appRtdbRef:t}),ye)};window.singularAppControlData=e.val();var i=[],o=[];if(0==window.singularAppInstance.composition_managed_by_singular){for(var s=0,l=Object.entries(window.singularAppControlData.outputs);s<l.length;s++){var c=ve(l[s],2),d=(c[0],c[1]);d.compExtract&&i.push(d.compExtract)}if(i.length>0&&window.singularAppControlData.compExtracts&&Object.keys(window.singularAppControlData.compExtracts).length>1)for(var p=0,u=Object.entries(window.singularAppControlData.compExtracts);p<u.length;p++){var h=ve(u[p],2),m=h[0];h[1],-1==i.indexOf(m)&&window.singularAppControlData.storage&&!JSON.stringify(window.singularAppControlData.storage).includes(m)&&o.push(m)}o.length>0?fe().uploadCompositionJSON(JSON.stringify(window.singularAppControlData),"app-".concat(window.singularAppInstance.id,"-").concat(Date.now()),"bak",function(e){o.forEach(function(e){delete window.singularAppControlData.compExtracts[e],t.child("compExtracts").child(e).remove()}),n()}):n()}else n()}),!window.singularUser.isAccessToken){var n=document.createElement("div");n.id="__logout__",document.body.appendChild(n),a().render(r().createElement(ue.A,null),n)}}else a().render(r().createElement(c.A,null),we)})}var Se=document.getElementById("appInstanceAnalytics");if(Se&&(a().render(r().createElement(pe,null),Se),!window.singularUser.isAccessToken)){var Ae=document.createElement("div");Ae.id="__logout__",document.body.appendChild(Ae),a().render(r().createElement(ue.A,null),Ae)}},59833:function(e,t,n){var i;function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,o,r,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(c)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t,n){return(t=function(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}(function(){"use strict";var o,l,c,d,p=function(e,t,n){return new Promise(function(e,n){window.singularDataStoreSBRef&&window.singularDataStoreUpdate(t),e()})},u=function(e,t){if(window.reportPayloadWrite){var n=0,i=singularAppControlData.compExtracts[e].compositions;for(var a in i)i[a].dataSources&&i[a].dataSources.composition&&i[a].dataSources.composition.controlNode&&i[a].dataSources.composition.controlNode.payload&&(n+=JSON.stringify(i[a].dataSources.composition.controlNode.payload).length);window.reportPayloadWrite(t,n)}},h=function(e,t){window.reportStorageWrite&&window.reportStorageWrite(e,t)},m=function(e,t){var n=Date.now(),i=setTimeout(function(e){window.firebaseWriteTime&&(window.singularDataStoreSBRef?window.firebaseWriteTime(-1,t,!0):window.firebaseWriteTime(Date.now()-n,t,!0)),i=null},5e3);e(function(){i&&(window.firebaseWriteTime&&(window.singularDataStoreSBRef?window.firebaseWriteTime(-1,t,!1):window.firebaseWriteTime(Date.now()-n,t,!1)),clearTimeout(i))})},f=function(){function e(){return this?e:e.toString()}var t,n=0;e.now=function(){return Date.now()+n},e.getOffset=function(){return n};var i=window;try{for(;i;){if(void 0!==i.singularServerDateOffset){t=i.singularServerDateOffset;break}if(i==window.top)break;i=i.parent}}catch(e){}if(void 0!==t)n=t;else{var a=new XMLHttpRequest;a.open("GET","/alive?noCache="+Date.now()+"x"+parseInt(1e6*Math.random())),a.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var e=Date.now(),t=e;try{var i=JSON.parse(this.responseText);i&&i.serverTime&&(e=i.serverTime)}catch(e){}n=-(t-e-(t-o)/2),window&&(window.singularServerDateOffset=n)}};var o=Date.now();a.send()}return e}(),v=(o=function(){var e={},t=!1,n=0,i=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var a=function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t&&"[object Object]"===Object.prototype.toString.call(n[i])?e[i]=o(!0,e[i],n[i]):e[i]=n[i])};n<i;n++)a(arguments[n]);return e},l=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!==s(e)||"object"!==s(t))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!==s(e[n]))return!1;if(!l(e[n],t[n]))return!1}}for(n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0},c=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&(200==this.status?t(JSON.parse(this.response)):t&&t())};var i="";window.singularAccessToken&&(i="?access_token="+window.singularAccessToken),n.open("GET",singularUrlBase+"apiv1/compositions/"+e+i,!0),n.setRequestHeader("Content-type","application/json"),window.singularAppUsername&&window.singularAppPasswd&&n.setRequestHeader("Authorization","Basic "+btoa(window.singularAppUsername+":"+window.singularAppPasswd)),n.send()},d=function(e,t){var n=window.singularAppControlData,i=window.singularUrlBase,d=window.singularAppInstance.id,v=window.singularAppInstance,g=window.singularAccessToken;!function(){var e,t=n.storage?JSON.stringify(n.storage).length:0;if(h(0,t),n.outputs)for(var i in n.outputs){e=n.outputs[i].compExtract;break}e&&u(e,0)}();var w,y,b,x,E,S,A,I,N,C,O,k,T,_,D,U,R,P,B,L,H,j,V,M,W,z,G,X,F,Y,J,K=(w={},y={},b={},x={},E=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},S=function(t,i,a){var o={};o.id=Math.random(),o.ts=Date.now(),o.commands=[],o.commands.push(a);var s={},l=n.compExtracts[t].compositionProps,c=n.compExtracts[t].compositionStates,d=!0;l&&l.timeline2Active&&!1===l.timeline2Active[i]&&(d=!1);var u=function(e,t){var n=e.toLowerCase();return"in"==n?"In":"out1"==n?"Out1":"out2"==n?"Out2":"out"==n?0==t?"Out1":"Out2":void 0}(a.to,d);u&&(s[i]=u);var h,f,v,g=a.target,w=n.compExtracts[t].compositionProps.logicLayers,y=l.timeline2Active,b=l.durations,x=[],E=function(e,t,n,i,a,o){var r=function(e){var t=[];for(var n in e){var i=e[n],a=t.filter(function(e){return e.name==i.name});a.length>0?a[0].comps.push(n):t.push({name:i.name,comps:[n]})}return t}(i),s=[];if("In"==n)for(var l=0;l<r.length;l++)if(-1!=r[l].comps.indexOf(t)){for(var c=0;c<r[l].comps.length;c++){var d=r[l].comps[c];if(o&&o.push(d),d!=t){var p="Out1";(void 0===a[d]||a[d]&&!0===a[d])&&(p="Out2"),e==t?s.push({timelineOwner:d,timeline:d,state:p,delay:i[d].delay,time:i[d].time}):s.push({timelineOwner:e,timeline:d,state:p,delay:i[d].delay,time:i[d].time})}}break}return s}(g,g,u,w,y,x);x.forEach(function(e){"In"==c[e]&&(f=e)}),u&&(c[i]=u),b&&b[f]&&(h=y[f]?b[f].Out:b[f].In),w&&w[g]&&(v=w[g].delay),f||(v="none");var S=0,A=0;if("auto"==v)A=parseFloat(h),isNaN(A)&&(A=0);else if("custom"==v){var I=parseFloat(w[g].time);isNaN(I)&&(I=0),I<0?S=-I:A=I}a.delay=A,E.forEach(function(e){o.commands.unshift({name:a.name,target:e.timeline,to:e.state,delay:S}),s[e.timeline]=e.state}),m(function(i){if(window.singularDataStoreSBRef){var a;e.child("compExtracts").child(t).child("compositionStates").update(s),e.child("compExtracts").child(t).child("command").set(o);var l=(null===(a=n.compExtracts[t])||void 0===a||null===(a=a.compositionProps)||void 0===a?void 0:a.scripts)||{},c=r({},"compExtracts.".concat(t,".command"),o);for(var d in Object.keys(l).length>0&&(c["compExtracts.".concat(t,".compositionProps.scripts")]={},delete n.compExtracts[t].compositionProps.scripts),s)c["compExtracts.".concat(t,".compositionStates.").concat(d)]=s[d];p(0,c).then(function(e){i()})}else e.child("compExtracts").child(t).child("command").set(o,function(n){i(),e.child("compExtracts").child(t).child("compositionStates").update(s)})},"animation");var N=JSON.stringify(o).length,C=JSON.stringify(s).length;window.commandLog&&window.commandLog(N+C,"animation"),1===window.singularAppVerbose&&console.log("*animation",o,N),1===window.singularAppVerbose&&console.log("*animation state",s,C)},A=function(e,t,n){if("string"==typeof n){var i={name:"jump2"};i.target=t,i.to=n,S(e,t,i)}},I=function(e,t,n,i){if("string"==typeof i&&"string"==typeof n){var a={name:"play2"};a.target=t,a.to=i,S(e,t,a)}},N=function(t,i,o){var r=Date.now(),s=o;if("string"==typeof s)try{s=JSON.parse(s)}catch(e){s=null}var l=n.compExtracts[t].compositions;if(l&&l[i]&&l[i].dataSources){var c=l[i].dataSources;if(c&&c.composition&&c.composition.controlNode&&!c.composition.controlNode.payload&&(l[i].dataSources.composition.controlNode.payload={}),c.composition&&c.composition.controlNode&&c.composition.controlNode.payload){var d={},h={},v={};if(c.composition.controlNode.model&&c.composition.controlNode.model.fields)var g=c.composition.controlNode.model.fields;for(var w in g)"button"==g[w].type?d[g[w].id]=!0:"timecontrol"==g[w].type&&(h[g[w].id]=!0),v[g[w].id]=g[w].type;var y=c.composition.controlNode.payload,b=e.child("compExtracts").child(t).child("compositions").child(i).child("dataSources").child("composition").child("controlNode").child("payload"),x={};for(var E in s)if(null!=v[E]){if(d[E]&&"string"==typeof s[E]&&"execute"==s[E].toLowerCase())x[E]={__singularButton:!0,ts:r};else if(h[E]&&s[E].command){var S=s[E].command,A=y[E];if("play"==S)A.isRunning||(x[E]={UTC:f.now(),isRunning:!0,value:A.value?A.value:0});else if("pause"==S){if(A.isRunning){var I=f.now(),N=0,C=I;A&&(N=A.value?A.value:0,C=A.UTC?A.UTC:C),N+=I-C,x[E]={UTC:I,isRunning:!1,value:N}}}else"reset"==S&&(x[E]={UTC:f.now(),isRunning:!1,value:0});x[E]&&(y[E]=x[E])}else x[E]=s[E];h[E]&&s[E].command||(y[E]=s[E])}var O={payloadTs:r};for(var k in x)null!==x[k]&&void 0!==x[k]&&(O["payload/"+k]=x[k]);m(function(e){var o;b.parent.update(O);var r=(null===(o=n.compExtracts[t])||void 0===o||null===(o=o.compositionProps)||void 0===o?void 0:o.scripts)||{},s={};Object.keys(r).length>0&&(s["compExtracts.".concat(t,".compositionProps.scripts")]={},delete n.compExtracts[t].compositionProps.scripts);for(var l="compExtracts.".concat(t,".compositions.").concat(i,".dataSources.composition.controlNode."),c=0,d=Object.entries(O);c<d.length;c++){var h=a(d[c],2),m=h[0],f=h[1];s[l+m.replace(new RegExp("/","g"),".")]=f}p(0,s).then(function(t){e()}),u(t,JSON.stringify(O).length)},"setPayload");var T=JSON.stringify(O).length;window.commandLog&&window.commandLog(T,"setPayload"),1===window.singularAppVerbose&&console.log("*setPayload",O,T)}}},C=function(e,t){if(n.compExtracts[e]){var i=n.compExtracts[e].compositionStates[t];return"In"==i?"In":"Out1"==i||"Out2"==i?"Out":void 0}},O=function(e,t){if(n.compExtracts[e].compositions){var i=n.compExtracts[e].compositions[t];if(i)try{if(i.dataSources){var a=i.dataSources.composition.controlNode.model.fields,o=[];for(var r in a)o.push(a[r]);return o}}catch(e){return}}},k=function(e,t){if(n.compExtracts[e].compositions){var i=n.compExtracts[e].compositions[t];if(!i)return[];if(i.dataSources&&i.dataSources.composition&&i.dataSources.composition.controlNode&&i.dataSources.composition.controlNode.model&&i.dataSources.composition.controlNode.model.groups)return i.dataSources.composition.controlNode.model.groups}return[]},T=function(e,t){if(n.compExtracts[e].compositions){var i=n.compExtracts[e].compositions[t];if(i)try{if(i.dataSources){var a=i.dataSources.composition.controlNode.payload,o=[];for(var r in a)o.push({key:r,value:a[r]});return o}}catch(e){return}}},_=function(e,t){if(n.compExtracts[e].compositions){var i=n.compExtracts[e].compositions[t];if(i&&i.dataSources.composition.controlNode)return o(!0,i.dataSources.composition.controlNode.payload)}},D=function(e,t){O(e,t);var n={},i=U(e,t);if(i&&i.model){for(var a in i.model.fields){var o=i.model.fields[a];n[o.id]=o.defaultValue}N(e,t,n)}},U=function(e,t){if(n.compExtracts[e].compositions){var i=n.compExtracts[e].compositions[t];if(i)return i.dataSources?o(!0,i.dataSources.composition.controlNode):void 0}},R=function(e,t){if(n.compExtracts[e].compositionProps&&n.compExtracts[e].compositionProps.logicLayers)return n.compExtracts[e].compositionProps.logicLayers[t]},P=function(e,t,i){if(n.compExtracts[t].compositionProps&&n.compExtracts[t].compositionProps[e])return n.compExtracts[t].compositionProps[e][i]},B=[],L={},H={},j=function(e){var t,n,i;if("object"!==s(e)||null===e)return e;for(i in t=Array.isArray(e)?[]:{},e)n=e[i],t[i]=j(n);return t},V=function(t,n,i,o,r){if(-1!=i.indexOf("/")&&(L={},H={}),null==o)delete n[i],e.child("storage").child(i)[t](o,function(){r&&r()});else{var c=Math.floor(16777215*Math.random()).toString(16);1===window.singularAppVerbose&&console.log("*storage original",c,o);var d=j(o);if(l(n[i],d))1===window.singularAppVerbose&&console.log("*storage delta",c,void 0,0),r&&r();else{if(null!=n[i]&&"object"==s(d)&&!Array.isArray(d)){var u=Object.keys(n[i]),m=u.filter(function(e){return null==d[e]});m.forEach(function(e){d[e]=null});var f=u.filter(function(e){return-1==m.indexOf(e)&&l(n[i][e],d[e])});f.forEach(function(e){delete d[e]}),(m.length>0||f.length>0)&&(t="update")}n[i]=j(o);var v=JSON.stringify(d).length;window.commandLog&&window.commandLog(v,"storage"),e.child("storage").child(i)[t](d);var g={};if("set"==t)g["storage.".concat(i.replace(new RegExp("/","g"),"."))]=d;else if("update"==t)for(var w="storage.".concat(i.replace(new RegExp("/","g"),"."),"."),y=0,b=Object.entries(d);y<b.length;y++){var x=a(b[y],2),E=x[0],S=x[1];g[w+E.replace(new RegExp("/","g"),".")]=S}p(0,g).then(function(e){r&&r()}),e.child("storage").once("value",function(e){for(var t=JSON.stringify(e.val()).length,n=0,i=0,o=Object.entries(d);i<o.length;i++){var r=a(o[i],2),s=(r[0],r[1]);n+=JSON.stringify(s).length}h(n,t)}),1===window.singularAppVerbose&&console.log("*storage delta",c,d,v)}}},M=function(e){var t;for(var i in n.compExtracts)if(n.compExtracts[i].name==e){t=i;break}return t?W(t):void 0},W=function(t){if("string"==typeof t){if(y[t])return y[t];var i=function(){var i,a,o,s,l,d,u,h=[],m=[],f=[],v=t;if(i=n.compExtracts[v]){o=i.name,a=i.mainComposition,s=v;var g=function(e){if(e.exists()){var t=e.val();l&&l(t),i.compositionState=t}},w=function(e){if(e==a)return o;for(var t in i.subcompositionNames)for(var n in i.subcompositionNames[t])if(n==e)return i.subcompositionNames[t][n];return""},x={};for(var E in i.compositions)x[E]=w(E);var S={},B={},L=function(e,t){if(S[e]){if(t.exists()){var n=t.val();i.compositions[e].dataSources.composition.controlNode.payload=n,d&&d({compId:e==a?s:e,compositionId:e==a?s:e,compName:x[e],compositionName:x[e],payload:n})}}else S[e]=!0},H=function(e,t){if(B[e]){if(t.exists()){var n=t.val();i.compositionStates[e]=n,u&&u({compId:e==a?s:e,compositionId:e==a?s:e,compName:x[e],compositionName:x[e],state:n})}}else B[e]=!0};for(var E in e.child("compExtracts").child(s).child("compositionStates").on("value",g),i.compositions){var j=e.child("compExtracts").child(s).child("compositions").child(E).child("dataSources/composition/controlNode/payload");j.on("value",L.bind(this,E)),m.push(j)}for(var E in i.compositionStates){var V=e.child("compExtracts").child(s).child("compositionStates").child(E);V.on("value",H.bind(this,E)),f.push(V)}i.compositionStates||(i.compositionStates={}),i.compositionStates[a]||(i.compositionStates[a]="Out1");var M=function(e){return z(a,e)},W=function(e,t){var n;if(i&&i.subcompositionNames&&i.subcompositionNames[e])for(var a in i.subcompositionNames[e])if(i.subcompositionNames[e][a]==t){n=a;break}return n?M(n):void 0},z=function(e,t){if("string"==typeof t){if(b[s]&&b[s][t])return b[s][t];var n=function(){var n=t,a=i.subcompositionNames[e][t];if(n){i.compositionStates||(i.compositionStates={}),i.compositionStates[n]||(i.compositionStates[n]="Out1");var o=function(e){return z(n,e)};return{id:n,name:a,jumpTo:function(e){A(s,n,e)},playTo:function(e){I(s,n,i.compositionStates[n],e)},setPayload:function(e){N(s,n,e)},resetPayload:function(){D(s,n)},getSubcomposition:o,getSubcompositionById:o,getSubcompositionByName:function(e){return W(n,e)},find:function(){return F(n,Array.prototype.slice.call(arguments))},listSubcompositions:function(){return G(n)},getState:function(){return C(s,n)},getModel:function(){return O(s,n)},getModelGroups:function(){return k(s,n)},getPayload:function(){return T(s,n)},getPayload2:function(){return _(s,n)},getControlNode:function(){return U(s,n)},getLogicLayer:function(){return R(s,n)},getProp:function(e){return P(e,s,n)}}}}();return b[s]||(b[s]={}),b[s][t]=n,b[s][t]}},G=function(e){var t=[];if(i&&i.subcompositionNames&&i.subcompositionNames[e])for(var n in i.subcompositionNames[e])t.push({id:n,name:i.subcompositionNames[e][n]});return t},X=function(){return G(a)},F=function(e,t){return console.error("find is not supported yet."),[]},Y=function(){D(s,a)},J=function(){return n.compExtracts[s].refId};return{id:s,name:o,compExtractId:s,timestamp:i.ts,playTo:function(e){I(s,a,i.compositionStates[a],e)},jumpTo:function(e){A(s,a,e)},setPayload:function(e){N(s,a,e)},resetPayload:Y,resetAllPayloads:function(){Y(),X().forEach(function(e){(e=M(e.id)).resetPayload()})},getSubcomposition:M,getSubcompositionById:M,getSubcompositionByName:function(e){return W(a,e)},getCompositionInfo:function(e){e&&c(J(),e)},getRefId:J,find:function(){return F(a,Array.prototype.slice.call(arguments))},listSubcompositions:X,getState:function(){return C(s,a)},getModel:function(){return O(s,a)},getModelGroups:function(){return k(s,a)},getPayload:function(){return T(s,a)},getPayload2:function(){return _(s,a)},getControlNode:function(){return U(s,a)},getLogicLayer:function(){return R(s,a)},getProp:function(e){return P(e,s,a)},remove:function(t){h.forEach(function(e){e.setComposition(null)}),e.child("compExtracts").child(s).remove(),p(0,r({},"compExtracts.".concat(s),null)).then(function(i){console.log("remove comp"),h=[],X(),delete b[s],delete n.compExtracts[s],delete y[s],e.child("compExtracts").child(s).child("compositionStates").off("value",g),m.forEach(function(e){return e.off("value")}),f.forEach(function(e){return e.off("value")}),t&&t()})},_setOutput:function(e){-1==h.indexOf(e)&&h.push(e)},_removeOutput:function(e){var t=h.indexOf(e);-1!=t&&h.splice(t,1)},on:function(e,t){t&&("animation_state"==e?l=t:"payload_changed"==e?d=t:"state_changed"==e?u=t:console.warn("Invalid event: "+e))},off:function(e){"animation_state"==e?l=void 0:"payload_changed"==e?d=void 0:"state_changed"==e&&(u=void 0)},getUISettings:function(){return n.compExtracts[s].uiSettings},getDisplayVariants:function(){return n.compExtracts[s].displayVariants}}}}();return y[t]=i,y[t]}},X=function(e,t){t.data&&"_singular_singularapp_compositionbrowser"==t.data.event&&e(t.data.params)},F=function(e,t){t.data&&"_singular_singularapp_imagebrowser"==t.data.event&&e(t.data.params)},Y=function(e,t){t.data&&"_singular_singularapp_audiobrowser"==t.data.event&&e(t.data.params)},{storage:{set:function(e,t,n){m(function(i){V("set",L,e,t,function(e){i(),n&&n()})},"storage")},update:function(e,t,n){m(function(i){V("update",H,e,t,function(e){i(),n&&n()})},"storage")},get:function(t,n){n&&(t?e.child("storage").child(t).once("value",function(e){n(e.val())}):e.child("storage").once("value",function(e){n(e.val())}))},on:function(t,n){var i=function(e){n&&n(e.val())};B.push([n,i]),n&&e.child("storage").child(t).on("value",i)},off:function(t,n){for(var i=-1,a=0;a<B.length;a++)if(B[a][0]==n){i=a;break}-1!=i&&(e.child("storage").child(t).off("value",B[i][1]),B.splice(i,1))},remove:function(t,n){delete L[t],delete H[t],e.child("storage").child(t).remove(),p(0,r({},"storage.".concat(t),null)).then(function(e){n&&n()})}},log:{info:function(e,n){t({type:"info",desc:n,title:e})},warn:function(e,n){t({type:"warn",desc:n,title:e})},error:function(e,n){t({type:"error",desc:n,title:e})}},getOutput:z=function(t){if(w[t])return w[t];var a=function(){var a,o,l=t;if(l&&n.outputs[l]){for(var c in n.outputs)if(c==t){a=n.outputs[c].name;break}var u=n.outputs[l].compExtract;return o=W(u),u&&o||console.warn("No default composition assigned."),{name:a,id:l,setComposition:function(t){if(t!=o)if(o&&o._removeOutput(this),t){if("object"!==s(t))return void console.error("setComposition() expected composition object.");if(o=t,t._setOutput(this),e.child("outputs").child(l).child("compExtract").set(o.compExtractId),p(0,r({},"outputs.".concat(l,".compExtract"),o.compExtractId)),e.child("broadcast/compExtract").once("value",function(t){t.exists()&&e.child("compExtracts").child(o.compExtractId).once("value",function(t){e.child("broadcast/compExtract").set(t.val())})}),window.singularDataStoreSBRef&&e.child("broadcast/compExtract").exists()){var n=e.child("broadcast/compExtract").val();p(0,r({},"broadcast.compExtract",n))}}else o=t,e.child("outputs").child(l).child("compExtract").remove(),p(0,r({},"outputs.".concat(l,".compExtract"),null))},getComposition:function(){return o},getUrl:function(){return i+"appinstances/"+d+"/outputs/"+a+"/onair"},getPreviewUrl:function(){return i+"appinstances/"+d+"/outputs/"+a+"/preview"}}}}();return a.getComposition()&&a.getComposition()._setOutput(a),w[t]=a,w[t]},getOutputById:z,getOutputByName:function(e){var t;for(var i in n.outputs)if(n.outputs[i].name==e){t=i;break}return t?z(t):void 0},getComposition:W,getCompositionById:W,getCompositionByName:M,getCompositionUrl:function(e){if(e&&n.compExtracts[e.id])return n.compExtracts[e.id].compositionUrl},importComposition:function(e,t){n.compExtracts||(n.compExtracts={});var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var e;try{e=JSON.parse(this.responseText)}catch(e){t&&t({success:!1,desc:"Internal server error 100."})}if(Array.isArray(e)){var i=[];e.forEach(function(e){i.push({name:e.name,compositionId:e.id,id:e.mainComposition}),n.compExtracts[e.id]=e}),t&&t({success:!0,compositionIds:i})}else t&&t({success:!1,desc:"Internal server error 101."})}else t&&t({success:!1,desc:this.responseText})};var o="";window.singularAccessToken&&(o="?access_token="+window.singularAccessToken),a.open("POST",i+"apiv1/appinstances/"+d+"/importcomp"+o,!0),a.setRequestHeader("Content-type","application/json"),window.singularAppUsername&&window.singularAppPasswd&&a.setRequestHeader("Authorization","Basic "+btoa(window.singularAppUsername+":"+window.singularAppPasswd)),a.send(JSON.stringify(e))},getCompositionInfo:c,listCompositions:G=function(e){var t=[];for(var i in n.compExtracts)!0!==e&&void 0===n.compExtracts[i].compositionUrl||t.push({name:n.compExtracts[i].name,id:i});return t},listOutputs:function(){var e=[];for(var t in n.outputs)e.push({name:n.outputs[t].name,id:t});return e},listIdsByName:function(e,t){for(var n=[],i=0;i<e.length;i++)e[i].name.toLowerCase()==t.toLowerCase()&&n.push(e[i].id);return n},getCompositionBrowserUrl:function(){var e="";return g&&(e="&access_token="+g),i+"externals/browser?showSearch=true&showHeader=true"+e},getImageBrowserUrl:function(){var e="";return g&&(e="&access_token="+g),i+"externals/browser?type=image&showSearch=true&showHeader=true"+e},getAudioBrowserUrl:function(){var e="";return g&&(e="&access_token="+g),i+"externals/browser?type=audio&showSearch=true&showHeader=true"+e},compositionBrowserEventCallback:function(e,t){t&&(e.removeEventListener("message",X),e.addEventListener("message",X.bind(this,t)))},imageBrowserEventCallback:function(e,t){t&&(e.removeEventListener("message",F),e.addEventListener("message",F.bind(this,t)))},audioBrowserEventCallback:function(e,t){t&&(e.removeEventListener("message",Y),e.addEventListener("message",Y.bind(this,t)))},renderSingularForm:function(){console.error("renderSingularForm is not supported.")},removeSingularForm:function(){console.error("removeSingularForm is not supported.")},createSingularForm:function(e,t,n,a,r){var s;r&&(s=r.refId),n||(n={model:{}});var l,c={};if((c=o(!0,n)).model&&(!n.payload||n.payload&&(null==n.payload||null==n.payload)))for(var d in c.payload={},c.model.fields){var p=c.model.fields[d];c.payload[p.id]=p.defaultValue}for(var d in x)if(x[d].dom==t){l=x[d];break}if(l){l.controlNode=c,l.callback=a,l.refId=s;var u={event:"_singular_singularapp_singularform_set_controlnode",controlNode:l.controlNode,refId:l.refId};l.iframe.contentWindow.postMessage(u,"*")}else{var h=function(e){if(e.data){var t=x[e.data.formId];if("_singular_singularapp_singularform_loaded"==e.data.event){var n={event:"_singular_singularapp_singularform_set_controlnode",controlNode:t.controlNode,refId:t.refId};t.iframe.contentWindow.postMessage(n,"*"),t.callback({event:"load"})}else"_singular_singularapp_singularform_changed"==e.data.event?t.callback({event:"change",refId:e.data.refId,payload:e.data.payload,changedProperty:e.data.changedProperty}):"_singular_singularapp_singularform_button_clicked"==e.data.event?t.callback({event:"button_clicked",refId:e.data.refId,buttonId:e.data.buttonId}):"_singular_singularapp_singularform_imagebrowser_clicked"==e.data.event?t.callback({event:"imagebrowser_clicked",refId:e.data.refId,payloadKey:e.data.payloadKey}):"_singular_singularapp_singularform_audiobrowser_clicked"==e.data.event&&t.callback({event:"audiobrowser_clicked",refId:e.data.refId,payloadKey:e.data.payloadKey})}},m=!1;for(var d in x)if(x[d].window==e){m=!0;break}m||e.addEventListener("message",h);var f=document.createElement("iframe"),v=E();x[v]={dom:t,callback:function(e){a&&a(e)},controlNode:c,iframe:f,onMessageFunc:h,window:e,refId:s},f.src=i+"externals/singularform?formId="+v,f.style.width="100%",f.style.height="100%",f.style.border="solid 0px black",t.appendChild(f)}return function(e,t){var n=t,i=function(e,t){var i;for(var a in x)if(x[a].dom==n){i=x[a];break}if(i){var o={event:e,payload:t};i.iframe.contentWindow.postMessage(o,"*")}};return{window:e,dom:n,destroy:J.bind(this,n),setPayload:function(e){i("_singular_singularapp_singularform_set_payload",e)},updatePayload:function(e){i("_singular_singularapp_singularform_update_payload",e)}}}(e,t)},destroySingularForm:J=function(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild);for(var t in x)x[t].dom==e&&delete x[t]},removeCompositionById:function(e,t){var n=W(e);n?n.remove(t):t&&t()},removeCompositionByName:function(e,t){var n=M(e);n?n.remove(t):t&&t()},removeAllCompositions:function(e){var t=function(){var n=G(!0);n.length>0?W(n[0].id).remove(function(){t()}):e&&e()};t()},getAppInstanceInfo:function(){return v},ServerDate:f,registerWindow:function(e){e.addEventListener("message",function(e){if(("_singular_composition_payload_changed"===e.data.event||"_singular_composition_payload_sdk"===e.data.event)&&e.data.compExtract&&e.data.compExtract&&n.compExtracts[e.data.compExtract]){var t=n.compExtracts[e.data.compExtract].compositions[e.data.params.compId||e.data.params.compositionId];t.dataSources.composition.controlNode.payload=o(!0,t.dataSources.composition.controlNode.payload,e.data.params.payload)}})}});return K},{createWithAppInstanceKey:function(e,t,n,i,a,o){if(n){window.singularAppUsername=i,window.singularAppPasswd=a,window.singularUrlBase=t,window.singularAccessToken=o;var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==this.readyState)if(200==this.status)try{var e=JSON.parse(this.responseText);window.singularAppInstance=e.appInstance;var t={apiKey:"AIzaSyAio3OzdJyS0XSVm8_AiUqa7Ux5z716RrA",authDomain:"fiery-torch-2122.firebaseapp.com",databaseURL:"https://fiery-torch-2122.firebaseio.com",storageBucket:"fiery-torch-2122.appspot.com"},i=firebase.initializeApp(t),a=i.database().ref().child(e.firebaseUrl.replace(t.databaseURL,""));i.auth().signInWithCustomToken(e.firebaseToken).then(function(){a.once("value",function(e){window.singularAppControlData=e.val();var t=d(a,function(e){console.log(JSON.stringify(e))});n(t)})}).catch(function(e){n(void 0)})}catch(e){n(void 0)}else n(void 0)},r.open("POST",t+"apiv1/apptemplates/virtualappinstance",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send("key="+e)}},createSingularApp:function(e,t){if(window.singularDataStoreSBRef){var n=window.singularDataStoreSBRef;e(d(n,t))}else n=window.singularRtdbCoreRef.child(window.singularStartupDb),e(d(n,t))}});void 0===(i=function(){return v}.call(t,n,t,e))||(e.exports=i)}).call(this)},71906:(e,t,n)=>{"use strict";"undefined"==typeof window?e.exports=function(){return null}:e.exports=n(10062)},89634:(e,t,n)=>{"use strict";e.exports=n(92007),e.exports.Panel=n(46784)}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.amdO={},e=[],i.O=(t,n,a,o)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,a,o]=e[d],s=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(i.O).every(e=>i.O[e](n[l]))?n.splice(l--,1):(s=!1,o<r&&(r=o));if(s){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,a,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={983:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,o,[r,s,l]=n,c=0;if(r.some(t=>0!==e[t])){for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(l)var d=l(i)}for(t&&t(n);c<r.length;c++)o=r[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},n=self.webpackChunkSingular=self.webpackChunkSingular||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[967,822,34,12,727,761,119,274,515,900,459],()=>i(36683));a=i.O(a)})();